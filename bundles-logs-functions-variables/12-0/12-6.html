<h3>12.6 Variable context <code>this</code></h3>

<p><br>

   <p>This context <samp><span>this</span></samp> is used to access information about promises during their execution. It is context dependent and not universally meaningful or available, but provides a context for variables where one is needed (such as when passing the value of a list variable into a parameterized <code>edit_line</code> promise from a <code>file</code> promise). For example:

<pre>bundle agent resolver(s,n)
{ 
files:
  "$(sys.resolv)" 

      create        => "true",
      edit_line     => doresolv("@(this.s)","@(this.n)"),
      edit_defaults => reconstruct;
}
</pre>

   <p>Note that every unqualified variable is automatically considered to be in context <samp><span>this</span></samp>, so that a reference to the variable <code>$(foo)</code> is identical to referencing <code>$(this.foo)</code>. You are strongly encouraged to <b>not</b> take advantage of this behaviour, but simply to be aware that if you attempt to declare a variable name with one of the following special reserved names, CFEngine will issue a warning (and you can reference your variable by qualifying it with the bundle name in which it is declared).

<ul>
<li><a>Variable this.handle</a>
<li><a>Variable this.promise_filename</a>
<li><a>Variable this.promise_linenumber</a>
<li><a>Variable this.promiser</a>
<li><a>Variable service_policy</a>
<li><a>Variable this.this</a>
</ul>

<div>
<a></a>
<a></a>

</div>

<h4>12.6.1 Variable this.handle</h4>

<p>This variable points to the promise handle of the currently handled promise; it is useful for referring to the intention in log messages.

<div>
<a></a>
<a></a>


</div>

<h4>12.6.2 Variable this.promise_filename</h4>

<p>This variable reveals the name of the file in which the current promise is defined.

<div>
<a></a>
<a></a>


</div>

<h4>12.6.3 Variable this.promise_linenumber</h4>

<p>This variable reveals the line number in the file at which it is used. It is useful to differentiate otherwise identical reports promises.

<div>
<a></a>
<a></a>

</div>

<h4>12.6.4 Variable this.promiser</h4>

<p>The special variable <code>$(this.promiser)</code> is used to refer to the current value of the promiser itself, in a number of allowed cases, typically when searches can take place. Current promise types that define <code>$(this.promiser)</code> are: <code>files</code>, <code>processes</code>, <code>commands</code>.

   <p>This variable is useful in <code>files</code> promises, for instance when using pattern matching or <code>depth_search</code> that implicitly match multiple objects. In that case, <code>$(this.promiser)</code> refers to the currently identified file that makes the promise. For example:

<pre>bundle agent find666
{
files:
  "/home"
    file_select => world_writeable,
    transformer => "/bin/echo DETECTED $(this.promiser)",
    depth_search => recurse("inf");

  "/etc/.*"
    file_select => world_writeable,
    transformer => "/bin/echo DETECTED $(this.promiser)";
}

body file_select world_writeable
{
  search_mode => { "o+w" };
  file_result => "mode";
}
</pre>

<div>
<a></a>
<a></a>


</div>

<h4>12.6.5 Variable service_policy</h4>

<p>This variable is set to the values of the promise attribute <code>service_policy</code>. For example:

<pre>services:

  "www"  service_policy => "start";
</pre>
This is typically used in the adaptations for custom services bundles in the service methods (See <a>service_method in services</a>).

<div>
<a></a>
<a></a>


</div>

<h4>12.6.6 Variable this.this</h4>

<p>From version core 3.3.0 this variables is reserved. It is used by functions like <code>maplist()</code> to represent the current object in a transformation map.

   </ul>



<div>
<a></a>


</div>


