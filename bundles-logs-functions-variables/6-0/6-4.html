<h3>6.4 <code>reports</code> promises in <samp><span>*</span></samp></h3>

<p><br>

   <p>Reports promises simply print messages. Outputting a message without qualification can be a `dangerous' operation. In a large installation it could unleash an avalanche of messaging. For that reason reports promises are not allowed to be in the class <samp><span>any</span></samp>; they must be in a more specific class. This is not a fool-proof protection but it generally weeds out simple carelessness. 

   <p><table><tr><td>
<pre>     
      reports:
     
       "<var>literal string or file refererence</var>",
     
           printfile = <var>printfile_body</var>,
           ...;
     
</pre>
   </td></tr></table>

   <p>Messages outputted from report promises are prefixed with the letter <samp><span>R</span></samp> to distinguish them from other output; for example from <code>commands</code>.

   <p>In CFEngine 2 reporting was performed with <code>alerts</code>. In CFEngine3 this has been replaced by <code>reports</code>.

   <p><br>

<pre>
bundle agent report
{
reports:

  linux::

   "/etc/passwd except $(const.n)"

    # printfile => pr("/etc/passwd","5");

     showstate => { "otherprocs", "rootprocs" };

}

</pre>

   <p><br>

<ul>
<li><a>friend_pattern in reports</a>
<li><a>intermittency in reports</a>
<li><a>lastseen in reports</a>
<li><a>printfile in reports</a>
<li><a>report_to_file in reports</a>
<li><a>bundle_return_value_index in reports</a>
<li><a>showstate in reports</a>
</ul>

<div>
<a></a>
<a></a>

</div>

<h4>6.4.1 <code>friend_pattern</code></h4>

<p><b>Type</b>: string

<p><b>Allowed input range</b>: (arbitrary string)

<p><b>Synopsis</b>: Regular expression to keep selected hosts from the friends report list

<p><b>Example</b>:<br>
<br>

<pre>
reports:

  linux::

   "Friend status report"

          lastseen => "0",
     friend_pattern => "host1|host2|.*\.domain\.tld";

</pre>

<p><b>Notes</b>:<br>
<br>

   <p>This regular expression should match hosts we want to exclude from friend reports.

<div>
<a></a>

</div>

<h4>6.4.2 <code>intermittency</code></h4>

<p><b>Type</b>: real

<p><b>Allowed input range</b>: <code>0,1</code>

<p><b>Default value:</b> false

<p><b>Synopsis</b>: Real number threshold [0,1] of intermittency about current peers, report above 

<p><b>Example</b>:<br>
<br>

<p><b>Notes</b>:<br>
<br>

<div>
<a></a>

</div>

<h4>6.4.3 <code>lastseen</code></h4>

<p><b>Type</b>: int

<p><b>Allowed input range</b>: <code>0,99999999999</code>

<p><b>Synopsis</b>: Integer time threshold in hours since current peers were last seen, report absence

<p><b>Example</b>:<br>
<br>

   <p>In control:
<pre>
body agent control
{
lastseen => "false";
}

</pre>



   <p>See also in reports:
<pre>
reports:

  "Comment"

    lastseen => "10";

</pre>




<p><b>Notes</b>:<br>
<br>

   <p>In reports: After this time (hours) has passed, CFEngine will begin to warn about the host being overdue. After the <code>lastseenexpireafter</code> expiry time, hosts will be purged from this host's database (default is a week).

   <p>In control: Determines whether CFEngine will record last seen intermittency profiles (reliability diagnostics) in <samp><span>WORKDIR/lastseen</span></samp>. This generates a separate file for each each host that connects to the current host.  For central hubs this can result is a huge number of files.

<div>
<a></a>

</div>

<h4>6.4.4 <code>printfile</code> (body template)</h4>

<p><b>Type</b>: (ext body)

     <dl>
<dt><samp><code>file_to_print</code></samp><dd><b>Type</b>: string

     <p><b>Allowed input range</b>: <code>"?(/.*)</code>

     <p><b>Synopsis</b>: Path name to the file that is to be sent to standard output

     <p><b>Example</b>:<br>
<br>

     <pre>     
     body printfile example
     {
     file_to_print   => "/etc/motd";
     number_of_lines => "10";
     }
     
</pre>

     <p><b>Notes</b>:<br>
<br>

     <p>Include part of a file in a report.

     <br><dt><samp><code>number_of_lines</code></samp><dd><b>Type</b>: int

     <p><b>Allowed input range</b>: <code>0,99999999999</code>

     <p><b>Synopsis</b>: Integer maximum number of lines to print from selected file

     <p><b>Example</b>:<br>
<br>

     <pre>     
     body printfile example
     {
     number_of_lines => "10";
     }
     
</pre>

     <p><b>Notes</b>:<br>
<br>

   </dl>

<div>
<a></a>
<a></a>

</div>

<h4>6.4.5 <code>report_to_file</code></h4>

<p><b>Type</b>: string

<p><b>Allowed input range</b>: <code>"?(/.*)</code>

<p><b>Synopsis</b>: The path and filename to which output should be appended

<p><b>Example</b>:<br>
<br>

<pre>
bundle agent test
{
reports:

  linux::

   "$(sys.date),This is a report from $(sys.host)"

       report_to_file => "/tmp/test_log";
}

</pre>

<p><b>Notes</b>:<br>
<br>

   <p>Append the output of the report to the named file instead of standard output.  If the file cannot be opened for writing then the report defaults to the standard output.

<div>
<a></a>
<a></a>

</div>

<h4>6.4.6 <code>bundle_return_value_index</code></h4>

<p><b>Type</b>: string

<p><b>Allowed input range</b>: <code>[a-zA-Z0-9_$(){}\[\].:]+</code>

<p><b>Synopsis</b>: The promiser is to be interpreted as a literal value that the caller can accept as a result for this bundle; in other words, a return value with array index defined by this attribute.

<p><b>Example</b>:<br>
<br>

<pre>body common control
{
bundlesequence => { "test" };
}


bundle agent test
{
methods:

   "any" usebundle => child,
    useresult => "my_return_var";


reports:

  cfengine_3::

    "My return was: \"$(my_return_var[1])\" and \"$(my_return_var[2])\""; 
    
}

bundle agent child
{
reports:

 cfengine_3::

   # Map these indices into the useresult namespace

   "this is a return value"  
      bundle_return_value_index => "1";

   "this is another return value"  
      bundle_return_value_index => "2";

}
</pre>

<p><b>Notes</b>:<br>
<br>

   <p>Return values are limited to scalars.

<div>
<a></a>

</div>

<h4>6.4.7 <code>showstate</code></h4>

<p><b>Type</b>: slist

<p><b>Allowed input range</b>: (arbitrary string)

<p><b>Synopsis</b>: List of services about which status reports should be reported to standard output 

<p><b>Example</b>:<br>
<br>

<pre>
reports:
  cfengine::

    "Comment"

      showstate => {"www_in", "ssh_out", "otherprocs" };

</pre>

<p><b>Notes</b>:<br>
<br>

   <p>The basic list of services is:

     <dl>
<dt><samp><span>users</span></samp><dd>Users logged in
<br><dt><samp><span>rootprocs</span></samp><dd>Privileged system processes
<br><dt><samp><span>otherprocs</span></samp><dd>Non-privileged process
<br><dt><samp><span>diskfree</span></samp><dd>Free disk on / partition
<br><dt><samp><span>loadavg</span></samp><dd>% kernel load utilization
<br><dt><samp><span>netbiosns_in</span></samp><dd>netbios name lookups (in)
<br><dt><samp><span>netbiosns_out</span></samp><dd>netbios name lookups (out)
<br><dt><samp><span>netbiosdgm_in</span></samp><dd>netbios name datagrams (in)
<br><dt><samp><span>netbiosdgm_out</span></samp><dd>netbios name datagrams (out)
<br><dt><samp><span>netbiosssn_in</span></samp><dd>netbios name sessions (in)
<br><dt><samp><span>netbiosssn_out</span></samp><dd>netbios name sessions (out)
<br><dt><samp><span>irc_in</span></samp><dd>IRC connections (in)
<br><dt><samp><span>irc_out</span></samp><dd>IRC connections (out)
<br><dt><samp><span>cfengine_in</span></samp><dd>CFEngine connections (in)
<br><dt><samp><span>cfengine_out</span></samp><dd>CFEngine connections (out)
<br><dt><samp><span>nfsd_in</span></samp><dd>nfs connections (in)
<br><dt><samp><span>nfsd_out</span></samp><dd>nfs connections (out)
<br><dt><samp><span>smtp_in</span></samp><dd>smtp connections (in)
<br><dt><samp><span>smtp_out</span></samp><dd>smtp connections (out)
<br><dt><samp><span>www_in</span></samp><dd>www connections (in)
<br><dt><samp><span>www_out</span></samp><dd>www connections (out)
<br><dt><samp><span>ftp_in</span></samp><dd>ftp connections (in)
<br><dt><samp><span>ftp_out</span></samp><dd>ftp connections (out)
<br><dt><samp><span>ssh_in</span></samp><dd>ssh connections (in)
<br><dt><samp><span>ssh_out</span></samp><dd>ssh connections (out)
<br><dt><samp><span>wwws_in</span></samp><dd>wwws connections (in)
<br><dt><samp><span>wwws_out</span></samp><dd>wwws connections (out)
<br><dt><samp><span>icmp_in</span></samp><dd>ICMP packets (in)
<br><dt><samp><span>icmp_out</span></samp><dd>ICMP packets (out)
<br><dt><samp><span>udp_in</span></samp><dd>UDP dgrams (in)
<br><dt><samp><span>udp_out</span></samp><dd>UDP dgrams (out)
<br><dt><samp><span>dns_in</span></samp><dd>DNS requests (in)
<br><dt><samp><span>dns_out</span></samp><dd>DNS requests (out)
<br><dt><samp><span>tcpsyn_in</span></samp><dd>TCP sessions (in)
<br><dt><samp><span>tcpsyn_out</span></samp><dd>TCP sessions (out)
<br><dt><samp><span>tcpack_in</span></samp><dd>TCP acks (in)
<br><dt><samp><span>tcpack_out</span></samp><dd>TCP acks (out)
<br><dt><samp><span>tcpfin_in</span></samp><dd>TCP finish (in)
<br><dt><samp><span>tcpfin_out</span></samp><dd>TCP finish (out)
<br><dt><samp><span>tcpmisc_in</span></samp><dd>TCP misc (in)
<br><dt><samp><span>tcpmisc_out</span></samp><dd>TCP misc (out)
<br><dt><samp><span>webaccess</span></samp><dd>Webserver hits
<br><dt><samp><span>weberrors</span></samp><dd>Webserver errors
<br><dt><samp><span>syslog</span></samp><dd>New log entries (Syslog)
<br><dt><samp><span>messages</span></samp><dd>New log entries (messages)
<br><dt><samp><span>temp0</span></samp><dd>CPU Temperature 0
<br><dt><samp><span>temp1</span></samp><dd>CPU Temperature 1
<br><dt><samp><span>temp2</span></samp><dd>CPU Temperature 2
<br><dt><samp><span>temp3</span></samp><dd>CPU Temperature 3
<br><dt><samp><span>cpu</span></samp><dd>%CPU utilization (all)
<br><dt><samp><span>cpu0</span></samp><dd>%CPU utilization 0
<br><dt><samp><span>cpu1</span></samp><dd>%CPU utilization 1
<br><dt><samp><span>cpu2</span></samp><dd>%CPU utilization 2
<br><dt><samp><span>cpu3</span></samp><dd>%CPU utilization 3
</dl>

<div>
<a></a>

</div>


