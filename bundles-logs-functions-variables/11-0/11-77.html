<h3>11.77 Function readtcp</h3>

<p><b>Synopsis</b>: readtcp(arg1,arg2,arg3,arg4) returns type <b>string</b>

   <p><br>
   <i>arg1</i> : Host name or IP address of server socket, <i>in the range</i> .*
<br>
   <i>arg2</i> : Port number, <i>in the range</i> 0,99999999999
<br>
   <i>arg3</i> : Protocol query string, <i>in the range</i> .*
<br>
   <i>arg4</i> : Maximum number of bytes to read, <i>in the range</i> 0,99999999999
<br>

<p>Connect to tcp port, send string and assign result to variable

<p><b>Example</b>:<br>
<br>

<pre>
bundle agent example

{     
vars:

  "my80" string => readtcp("research.iu.hio.no","80","GET /index.php HTTP/1.1$(const.r)$(const.n)Host: research.iu.hio.no$(const.r)$(const.n)$(const.r)$(const.n)",20);

classes:

  "server_ok" expression => regcmp("[^\n]*200 OK.*\n.*","$(my80)");

reports:

  server_ok::

    "Server is alive";

  !server_ok::

    "Server is not responding - got $(my80)";
}

</pre>

     <dl>
<dt><samp><span>hostnameip</span></samp><dd>The host name or IP address of a tcp socket. 
<br><dt><samp><span>port</span></samp><dd>The port number to connect to. 
<br><dt><samp><span>sendstring</span></samp><dd>A string to send to the TCP port to elicit a response
<br><dt><samp><span>maxbytes</span></samp><dd>The maximum number of bytes to read in response. 
</dl>

   <p>Important note: not all Unix TCP read operations respond to signals for interruption so poorly formed requests can hang. Always test TCP connections fully before deploying.

<p><b>Notes</b>:<br>
<br>

   <p>If the send string is empty, no data are sent or received from the socket. Then the function only tests whether the TCP port is alive and returns an empty variable.

   <p>Note that on some systems the timeout mechanism does not seem to successfully interrupt the waiting system calls so this might hang if you send a query string that is incorrect. This should not happen, but the cause has yet to be diagnosed.

<div>
<a></a>

</div>


