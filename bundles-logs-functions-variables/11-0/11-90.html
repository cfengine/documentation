<h3>11.90 Function splayclass</h3>

<p><b>Synopsis</b>: splayclass(arg1,arg2) returns type <b>class</b>

   <p><br>
   <i>arg1</i> : Input string for classification, <i>in the range</i> .*
<br>
   <i>arg2</i> : Splay time policy, <i>in the range</i> daily,hourly
<br>

<p>True if the first argument's time-slot has arrived, according to a policy in arg2

<p><b>Example</b>:<br>
<br>

<pre>
body common control

{
bundlesequence  => { "example" };
}

###########################################################

bundle agent example

{     
classes:

  "my_result" expression => splayclass("$(sys.host)$(sys.ipv4)","daily");

reports:

  my_result::

    "Load balanced class activated";

}

</pre>

<p><b>Notes</b>:<br>
<br>

   <p>The lvalue class evaluates to true if the system clock lies within a scheduled time-interval that maps to a hash of the first argument (which may be any arbitrary string). Different strings will hash to different time intervals, and thus one can map different tasks to time-intervals.

   <p>This function may be used to distribute a task, typically on multiple hosts, in time over a day or an hourly period, depending on the policy in the second argument (that must be one of <code>"daily"</code> or <code>"hourly"</code>). This is useful for copying resources to multiple hosts from a single server, (e.g.  large software updates), when simultaneous scheduling would lead to a bottleneck and/or server overload.

   <p>The function is similar to the <code>splaytime</code> feature in <code>cf-execd</code>, except that it allows you to base the decision on any string-criterion on a given host. The entropy (or string-variation) in the first argument determines how effectively CFEngine will be able to distribute tasks. CFEngine instances with the same first argument will yield a true result at the same time (and different first argument will yield a true result at a different time). Thus tasks could be scheduled according to group names for predictability, or according to IP addresses for distribution across the policy interval.

   <p>The times at which the splayclass will be defined depends on the second argument. If the first argument is <code>"hourly"</code> then the class will be defined for a 5-minute interval every hour (and if the first argument is <code>"daily"</code>, then the class will be defined for one 5-minute interval every day. This means that <code>splayclass</code> assumes that you are running CFEngine with the default schedule of "every 5 minutes". If you change the executor <code>schedule</code> control variable, you may prevent the splayclass from ever being defined (that is, if the hashed 5-minute interval that is selected by the splayclass is a time when you have told CFEngine <i>not</i> to run).

<div>
<a></a>

</div>


