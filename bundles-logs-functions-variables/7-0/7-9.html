<h3>7.9 <code>replace_patterns</code> promises in <samp><span>edit_line</span></samp></h3>

<p><br>

   <p>This promise refers to arbitrary text patterns in a file. The pattern is expressed as a PCRE regular expression.

   <p><table><tr><td>
<pre>     
       replace_patterns:
     
        "<var>search pattern</var>"
     
           replace_with = <var>replace_body</var>,
           ...;
     
</pre>
   </td></tr></table>

   <p><br>

<pre>
bundle edit_line upgrade_cfexecd
{
  replace_patterns:

    "cfexecd" replace_with => value("cf-execd");
}

########################################

body replace_with value(x)	# defined in cfengine_stdlib.cf
{
replace_value => "$(x)";
occurrences => "all";
}

</pre>

   <p><br>

   <p>This is a straightforward search and replace function. Only the portion of the line that matches the pattern in the promise will be replaced; the remainder of the line will not be affected. You can also use PCRE lookbehind and lookahead patterns to restrict the lines upon which the pattern will match.

   <p><b>NOTE:</b> In <code>replace_patterns</code> promises, the regular expression may match a line fragment, that is, it is unanchored.

   <p>See: <a>Anchored vs. unanchored regular expressions</a>

<ul>
<li><a>replace_with in replace_patterns</a>
</ul>

<div>
<a></a>
<a></a>

</div>

<h4>7.9.1 <code>replace_with</code> (body template)</h4>

<p><b>Type</b>: (ext body)

     <dl>
<dt><samp><code>occurrences</code></samp><dd><b>Type</b>: (menu option)

     <p><b>Allowed input range</b>: <br>
     <pre>                    <code>all</code>
                    <code>first</code>
</pre>
     <p><b>Synopsis</b>: Menu option to replace all occurrences or just first (NB the latter is non-convergent)

     <p><b>Default value:</b> all

     <p><b>Example</b>:<br>
<br>

     <pre>     
     body replace_with example
     {
     occurrences => "first";		# Warning! Using "first" is non-convergent
     }
     
</pre>

     <p><b>Notes</b>:<br>
<br>

     <p>A policy for string replacement.

     <p>Using "first" is generally unwise, as it will change a different matching string each time the promise is executed, and may not "catch up" with whatever external action is altering the text the promise applies to.

     <br><dt><samp><code>replace_value</code></samp><dd><b>Type</b>: string

     <p><b>Allowed input range</b>: <code>.*</code>

     <p><b>Synopsis</b>: Value used to replace regular expression matches in search

     <p><b>Example</b>:<br>
<br>

     <pre>     
     body replace_with example(s)
     {
     replace_value => "$(s)";
     }
     
</pre>

     <p><b>Notes</b>:<br>
<br>

   </dl>

<div>
<a></a>
<a></a>

</div>


