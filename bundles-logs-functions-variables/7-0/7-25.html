<h3>7.25 <code>storage</code> promises in <samp><span>agent</span></samp></h3>

<p><br>

   <p>Storage promises refer to disks and filesystem properties.

   <p><table><tr><td>
<pre>     
      storage:
     
         "/<var>disk volume or mountpoint</var>"
     
           volume = <var>volume_body</var>,
           ...;
     
</pre>
   </td></tr></table>

   <p>In CFEngine 2, storage promises were divided into <code>disks</code> or <code>required</code>, and <code>misc_mounts</code> types. The old mount-models for binary and home servers has been deprecated and removed from CFEngine 3. Users who use these models can reconstruct them from the low-level tools.

   <p><br>

<pre>
bundle agent storage

{
storage:

  "/usr" volume  => mycheck("10%");
  "/mnt" mount   => nfs("nfsserv.example.org","/home");

}

#######################################################

body volume mycheck(free)   # reusable template

{
check_foreign  => "false";
freespace      => "$(free)";
sensible_size  => "10000";
sensible_count => "2";
}

body mount nfs(server,source)

{
mount_type => "nfs";
mount_source => "$(source)";
mount_server => "$(server)";
edit_fstab => "true";
}
</pre>

   <p><br>

<ul>
<li><a>mount in storage</a>
<li><a>volume in storage</a>
</ul>

<div>
<a></a>

</div>

<h4>7.25.1 <code>mount</code> (body template)</h4>

<p><b>Type</b>: (ext body)

     <dl>
<dt><samp><code>edit_fstab</code></samp><dd><b>Type</b>: (menu option)

     <p><b>Allowed input range</b>: <br>
     <pre>                    <code>true</code>
                    <code>false</code>
                    <code>yes</code>
                    <code>no</code>
                    <code>on</code>
                    <code>off</code>
</pre>
     <p><b>Synopsis</b>: true/false add or remove entries to the file system table ("fstab")

     <p><b>Default value:</b> false

     <p><b>Example</b>:<br>
<br>

     <pre>     
     body mount example
     {
     edit_fstab => "true";
     }
     
</pre>

     <p><b>Notes</b>:<br>
<br>

     <p>The default behaviour is to not place edits in the file system table.

     <br><dt><samp><code>mount_type</code></samp><dd><b>Type</b>: (menu option)

     <p><b>Allowed input range</b>: <br>
     <pre>                    <code>nfs</code>
                    <code>nfs2</code>
                    <code>nfs3</code>
                    <code>nfs4</code>
</pre>
     <p><b>Synopsis</b>: Protocol type of remote file system

     <p><b>Example</b>:<br>
<br>

     <pre>     
     body mount example
     {
     mount_type => "nfs3";
     }
     
</pre>

     <p><b>Notes</b>:<br>
<br>

     <p>This field is mainly for future extensions.

     <br><dt><samp><code>mount_source</code></samp><dd><b>Type</b>: string

     <p><b>Allowed input range</b>: <code>"?(/.*)</code>

     <p><b>Synopsis</b>: Path of remote file system to mount

     <p><b>Example</b>:<br>
<br>
<pre>     
     body mount example
     {
     mount_source "/location/disk/directory";
     }
     
</pre>

     <p><b>Notes</b>:<br>
<br>

     <p>This is the location on the remote device, server, SAN etc.

     <br><dt><samp><code>mount_server</code></samp><dd><b>Type</b>: string

     <p><b>Allowed input range</b>: (arbitrary string)

     <p><b>Synopsis</b>: Hostname or IP or remote file system server

     <p><b>Example</b>:<br>
<br>

     <pre>     
     body mount example
     {
     mount_server => "nfs_host.example.org";
     }
     
</pre>

     <p><b>Notes</b>:<br>
<br>

     <p>Hostname or IP address, this could be on a SAN.

     <br><dt><samp><code>mount_options</code></samp><dd><b>Type</b>: slist

     <p><b>Allowed input range</b>: (arbitrary string)

     <p><b>Synopsis</b>: List of option strings to add to the file system table ("fstab")

     <p><b>Example</b>:<br>
<br>

     <pre>     body mount example
     {
     mount_options => { "rw", "acls" };
     }
     
</pre>

     <p><b>Notes</b>:<br>
<br>

     <p>This list is concatenated in a form appropriate for the filesystem. The options must be legal options for the system mount commands.

     <br><dt><samp><code>unmount</code></samp><dd><b>Type</b>: (menu option)

     <p><b>Allowed input range</b>: <br>
     <pre>                    <code>true</code>
                    <code>false</code>
                    <code>yes</code>
                    <code>no</code>
                    <code>on</code>
                    <code>off</code>
</pre>
     <p><b>Synopsis</b>: true/false unmount a previously mounted filesystem

     <p><b>Default value:</b> false

     <p><b>Example</b>:<br>
<br>

     <pre>     
     body mount example
     {
     unmount => "true";
     }
     
</pre>

     <p><b>Notes</b>:<br>
<br>

   </dl>

<div>
<a></a>

</div>

<h4>7.25.2 <code>volume</code> (body template)</h4>

<p><b>Type</b>: (ext body)

     <dl>
<dt><samp><code>check_foreign</code></samp><dd><b>Type</b>: (menu option)

     <p><b>Allowed input range</b>: <br>
     <pre>                    <code>true</code>
                    <code>false</code>
                    <code>yes</code>
                    <code>no</code>
                    <code>on</code>
                    <code>off</code>
</pre>
     <p><b>Synopsis</b>: true/false verify storage that is mounted from a foreign system on this host

     <p><b>Default value:</b> false

     <p><b>Example</b>:<br>
<br>

     <pre>     
     body volume example
     
     {
     #..
     check_foreign  => "false";
     }
     
</pre>

     <p><b>Notes</b>:<br>
<br>

     <p>CFEngine will not normally perform sanity checks on filesystems that are not local to the host. If <code>true</code> it will ignore a partition's network location and ask the current host to verify storage located physically on other systems.

     <br><dt><samp><code>freespace</code></samp><dd><b>Type</b>: string

     <p><b>Allowed input range</b>: <code>[0-9]+[MBkKgGmb%]</code>

     <p><b>Synopsis</b>: Absolute or percentage minimum disk space that should be available before warning

     <p><b>Example</b>:<br>
<br>

     <pre>     
     body volume example1
     {
     freespace => "10%";
     }
     
     body volume example2
     {
     freespace => "50M";
     }
     
</pre>

     <p><b>Notes</b>:<br>
<br>

     <p>The amount of freespace that is promised on a storage device. Once this promise is found not to be kept (that is, if the free space falls below the promised value), warnings are generated.  You may also want to use the results of this promise to control other promises.
     
     <p>See: <a>classes in *</a>.

     <br><dt><samp><code>sensible_size</code></samp><dd><b>Type</b>: int

     <p><b>Allowed input range</b>: <code>0,99999999999</code>

     <p><b>Synopsis</b>: Minimum size in bytes that should be used on a sensible-looking storage device

     <p><b>Example</b>:<br>
<br>

     <pre>     
     body volume example
     {
     sensible_size => "20K";
     }
     
</pre>

     <p><b>Notes</b>:<br>
<br>

     <pre>     
     body volume control
     {
     sensible_size => "20K";
     }
     
</pre>

     <br><dt><samp><code>sensible_count</code></samp><dd><b>Type</b>: int

     <p><b>Allowed input range</b>: <code>0,99999999999</code>

     <p><b>Synopsis</b>: Minimum number of files that should be defined on a sensible-looking storage device

     <p><b>Example</b>:<br>
<br>

     <pre>     
     body volume example
     {
     sensible_count => "20";
     }
     
</pre>

     <p><b>Notes</b>:<br>
<br>

     <p>Files must be readable by the agent. In other words, it is assumed that the agent has privileges on volumes being checked.

     <br><dt><samp><code>scan_arrivals</code></samp><dd><b>Type</b>: (menu option)

     <p><b>Allowed input range</b>: <br>
     <pre>                    <code>true</code>
                    <code>false</code>
                    <code>yes</code>
                    <code>no</code>
                    <code>on</code>
                    <code>off</code>
</pre>
     <p><b>Synopsis</b>: true/false generate pseudo-periodic disk change arrival distribution

     <p><b>Default value:</b> false

     <p><b>Example</b>:<br>
<br>

     <pre>     
     body volume example
     {
     scan_arrivals => "true";
     }
     
</pre>

     <p><b>Notes</b>:<br>
<br>

     <p>This operation should not be left `on' for more than a single run (maximum once per week). It causes CFEngine to perform an extensive disk scan noting the schedule of changes between files. This can be used for a number of analyses including optimum backup schedule computation.
   </dl>
   


<div>
<a></a>

</div>


