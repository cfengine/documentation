<html lang="en">
<head>
<title>Searching in cfengine</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="Searching in cfengine">
<meta name="generator" content="makeinfo 4.12">
<link title="Top" rel="top" href="#Top">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; }
  span.sansserif { font-family:sans-serif; font-weight:normal; }
h1, h2, a, table.list th
{
    color: #1f6e6b;
}

.node
{
background: #ddd url(Logo2-small.png) right no-repeat;
}

.menu
{
background: #eef url(menu.png) right no-repeat;
}

.contents
{
background-color: #e9f4e9;
}

.index-cp
{
background: #fff url(index-cp.png) right repeat-y;
}

.index-vr
{
background: #fff url(index-vr.png) right repeat-y;
}

.index-mb
{
background: #eee url(index-faq.png) right repeat-y;
}

table.border
{
  border-color: #4e8b8c;
  border-style: solid;
  border-width: 1px;
}

BODY {
     font-family: Verdana, Arial, Helvetica, sans-serif;
     font-style: normal;
     font-size: 11pt;
     background: #FFFFFF;
     color: #000000;
     }

P {
  font-family: Verdana, Arial, Helvetica, sans-serif;
  }

FONT.liten {font-size: 70%; }

H1, H2, H3 {
        font-weight: normal;
        color: #2c2e70;
        margin-bottom: 0em;
        }

TABLE { vertical-align: top; }

H1 { font-size: 140% }
H2 { font-size: 120% }
H3 { font-size: 110% }
H4 { font-style: italic; }

TD, TH, UL {
        font-family: Verdana, Arial, Helvetica, sans-serif;
        font-style: normal;
        }

TH { background: #9999FF;
     font-family: Verdana, Arial, Helvetica, sans-serif;
     color: blue;
  font-size: 10pt;
   }

TD { color: #000000;
     font-family: Verdana, Arial, Helvetica, sans-serif;
     font-size: 10pt;
   }

PRE { font-family: "Lucida Typewriter", "Courier", monotype;
      font-style: normal;
     font-size: 11pt;
background-color: #eee;
    }

.tynn {
        font-family: Arial, Helvetica, sans-serif;
        font-size: smaller;
        font-style: normal;
        font-weight: lighter;
        margin-bottom: 0em;
     font-size: 11pt;
        }

A:link { color: #2c2e70 }
A:visited { color: black }
A:active { color: #600041 }
--></style>
</head>
<body>
<h1 class="settitle">Searching in cfengine</h1>
<div class="node">
<p><hr>
<a name="Top"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Searching-for-files">Searching for files</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#dir">(dir)</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#dir">(dir)</a>

</div>

<h2 class="unnumbered">CFEngine-Anomalies</h2>

   <p><a href="#Contents"><h1>COMPLETE TABLE OF CONTENTS</h1></a>

   <p><h2>Summary of contents</h2>

<!-- ********************************************************************** -->
<!-- CHAPTER -->
<!-- ********************************************************************** -->
   <p><table class="cartouche" summary="cartouche" border="1"><tr><td>

   <p>In this module you will learn about

     <ul>
<li>How to select particular files in a search
<li>How to select paricular processes in the process table
<li>Find and edit text in files.
<li>Combine powerful search criteria

   </ul>
   </td></tr></table>

<ul class="menu">
<li><a accesskey="1" href="#Searching-for-files">Searching for files</a>
<li><a accesskey="2" href="#Searching-for-text-inside-files">Searching for text inside files</a>
<li><a accesskey="3" href="#Searching-for-processes">Searching for processes</a>
<li><a accesskey="4" href="#Troubleshooting-Filters">Troubleshooting Filters</a>
<li><a accesskey="5" href="#Iteration">Iteration</a>
</ul>

<!--  -->
<div class="node">
<p><hr>
<a name="Searching-for-files"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Searching-for-text-inside-files">Searching for text inside files</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Top">Top</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">1 Searching for files</h2>

<!--  -->
<ul class="menu">
<li><a accesskey="1" href="#Controlling-Directory-Tree-Traversal">Controlling Directory Tree Traversal</a>
<li><a accesskey="2" href="#Inclusion-and-Exclusion-Patterns">Inclusion and Exclusion Patterns</a>
<li><a accesskey="3" href="#Wildcards-and-Regular-expressions">Wildcards and Regular expressions</a>
<li><a accesskey="4" href="#File-Filters">File Filters</a>
<li><a accesskey="5" href="#Patterns-self_002dtest-questions">Patterns self-test questions</a>
</ul>

<div class="node">
<p><hr>
<a name="Controlling-Directory-Tree-Traversal"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Inclusion-and-Exclusion-Patterns">Inclusion and Exclusion Patterns</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Searching-for-files">Searching for files</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Searching-for-files">Searching for files</a>

</div>

<h3 class="section">1.1 Controlling Directory Tree Traversal</h3>

<p>There are many cases in system configuration where we want to scan
through a set of files and apply checks and controls to all or a few
of them. A typical pattern is to specify a directory and apply a rule to all files and
subdirectories. It is also possible to limit the search to include or exclude
certain directories, or pick out specific files matching specified criteria.

   <p>There are two options which control how subdirectories are handled. By default, rules apply only to the
items directly within specified directories; in other words, actions
are not recursive by default.

     <dl>
<dt>&lsquo;<samp><span class="samp">recurse=</span><var>depth</var></samp>&rsquo;<dd>Perform recursive checks/operations, descending at most
<var>depth</var> levels. Use the keyword <code>inf</code> to descend to the bottom of the directory tree.

     <br><dt>&lsquo;<samp><span class="samp">xdev=false</span></samp>&rsquo;<dd>Do not descend into subdirectories residing on different disk partitions.
By default, partition boundaries are not crossed.

   </dl>

   <p>Here are some examples of these options:
<pre class="smallexample">
     files:   # Check ownerships under /usr/local

         /usr/local
              owner=root
              group=admin
              mode=755
              recurse=inf


     tidy:    # Clear /tmp and subdirectories (&gt;3 days old)

         /tmp
             age=3
             include=*
             rmdirs=sub
             exclude=.X11
             recurse=inf
             xdev=off

</pre>
   <p>The first rule checks the user and group owners of files in the
<samp><span class="file">/usr/local</span></samp> directory tree, reporting on any which are
incorrectly set. The second rule removes files and empty
subdirectories that not been accessed in 3 days under <samp><span class="file">/tmp</span></samp>
(except the <samp><span class="file">.X11</span></samp> subdirectory), regardless of the disk
partition on which the items reside.

   <p>See the discussion of the <code>ignore</code> option in the next section
for another method of controlling directory tree traversal.

<!--  -->
<div class="node">
<p><hr>
<a name="Inclusion-and-Exclusion-Patterns"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Wildcards-and-Regular-expressions">Wildcards and Regular expressions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Controlling-Directory-Tree-Traversal">Controlling Directory Tree Traversal</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Searching-for-files">Searching for files</a>

</div>

<h3 class="section">1.2 Inclusion and Exclusion Patterns</h3>

<p>The simplest way to limit a file search is to use the three pattern
matching criteria below.  These directives use simple shell pattern
matching symbols or wildcards &lsquo;<samp><span class="samp">*</span></samp>&rsquo; and &lsquo;<samp><span class="samp">?</span></samp>&rsquo;, not POSIX regular
expressions.

<!-- ................................................... -->
<ul class="menu">
<li><a accesskey="1" href="#Local-criteria-_0028per-promise-rule_0029">Local criteria (per promise rule)</a>
<li><a accesskey="2" href="#Global-criteria-_0028per-promise-rule_0029">Global criteria (per promise rule)</a>
</ul>

<div class="node">
<p><hr>
<a name="Local-criteria-(per-promise-rule)"></a>
<a name="Local-criteria-_0028per-promise-rule_0029"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Global-criteria-_0028per-promise-rule_0029">Global criteria (per promise rule)</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Inclusion-and-Exclusion-Patterns">Inclusion and Exclusion Patterns</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Inclusion-and-Exclusion-Patterns">Inclusion and Exclusion Patterns</a>

</div>

<h4 class="subsection">1.2.1 Local criteria (per promise rule)</h4>

     <dl>
<dt>&lsquo;<samp><span class="samp">include=</span><var>pattern</var></samp>&rsquo;<dd>Include file-only items matching the specified patterns when selecting files for verification or modification. Patterns
may include the shell wildcards <code>*</code> (match any characters, including no characters) and <code>?</code> (match any one character).
<br><dt>&lsquo;<samp><span class="samp">exclude=</span><var>pattern</var></samp>&rsquo;<dd>Exclude file-only items matching the specified patterns when selecting files
for verification or modification. Global exclusion lists can be specified for copying and
linking operations via the <code>ExcludeCopy</code> and <code>ExcludeLink</code> settings in the <code>control</code> section (respectively).

     <br><dt>&lsquo;<samp><span class="samp">ignore=</span><var>pattern</var></samp>&rsquo;<dd>Ignore items matching the specified patterns. In contrast to <code>exclude</code>, directories matching
an item in the <code>ignore</code> list are not traversed during recursive operations. A global list of directories to ignore
can be specified via the <code>ignore</code> stanza (see the example below).

</dl>

<!-- ................................................... -->
<div class="node">
<p><hr>
<a name="Global-criteria-(per-promise-rule)"></a>
<a name="Global-criteria-_0028per-promise-rule_0029"></a>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Local-criteria-_0028per-promise-rule_0029">Local criteria (per promise rule)</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Inclusion-and-Exclusion-Patterns">Inclusion and Exclusion Patterns</a>

</div>

<h4 class="subsection">1.2.2 Global criteria (per promise rule)</h4>

<p>Here are some examples of global versions of settings and options:

<pre class="smallexample">
     control:

         ExcludeCopy = ( *.bak *~ )

     ignore:

         .Xll
         /usr/local

     tidy:    # Remove non-recent files from /tmp and /scratch

         /tmp age=1 include= * recurse=inf
         /scratch age=1 include=* exclude=*.sav

     copy:    # Update local documentation from server silo

        /masterdoc dest=/usr/local/doc server=silo

</pre>
   <p>The example specifies a global exclusion list for copy operations and
a list of subdirectories to ignore during recursive operations. The
<code>tidy</code> rule will clean up files that haven't been accessed today
from <samp><span class="file">/tmp</span></samp> and all of its subdirectories except <samp><span class="file">/tmp/.X11</span></samp>
(the location of X11 semaphores).  It will also remove such files from
the <samp><span class="file">/scratch</span></samp> directory except ones having the extension
<code>.sav</code>.

   <p>The <code>copy</code> rule copies all files from <samp><span class="file">/masterdoc</span></samp> on remote host <samp><span class="file">silo</span></samp>
that are newer than the version in <samp><span class="file">/usr/local/doc</span></samp> (if any),
excluding any whose names end in a tilde character (<code>emacs</code>
backup files) or having the extension <samp><span class="file">.bak</span></samp>, using the global
copy exclusion list. Note that having <samp><span class="file">/usr/local</span></samp> in the
directory ignore list does not affect the file copying operation since
the former applies only to directory traversal in recursive
operations.

<!-- ........................................................... -->
<div class="node">
<p><hr>
<a name="Wildcards-and-Regular-expressions"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#File-Filters">File Filters</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Inclusion-and-Exclusion-Patterns">Inclusion and Exclusion Patterns</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Searching-for-files">Searching for files</a>

</div>

<h3 class="section">1.3 Wildcards and Regular expressions</h3>

<p><table class="cartouche" summary="cartouche" border="1"><tr><td>

   <p>HINT: <i>Use the regex tester on the cfengine.com website to make sure your regular expressions behave
as you expect.</i>

</td></tr></table>

   <p>Regular expressions may be used in many contexts. They should not be
confused with shell <i>wildcards</i> or <i>patterns</i>, which are cruder
pattern matching strings.

   <p>Regular expressions are used in cfengine particularly in connection with
<code>editfiles</code> and <code>processes</code> to search for lines matching
certain expressions.  They can also be used in <code>filter</code>s.
A regular expression is a generalized wildcard. In
cfengine wildcards, you can use the characters '*' and '?' to match any
character or number of characters.  Regular expressions are more
complicated than wildcards, but have far more flexibility.

   <p><i>NOTE: the special characters </i><code>*</code><i> and </i><code>?</code><i>  used in
wildcards do not have the same meanings as regular expressions!</i>

   <p>Some regular expressions match only a single string. For example, every
string which contains no special characters is a regular expression
which matches only a string identical to itself. Thus the regular
expression <code>cfengine</code> would match only the string "cfengine", not
"Cfengine" or "cfengin" etc.  Other regular expressions could match more
general strings. For instance, the regular expression <code>c*</code> matches
any number of c's (including none). Thus this expression would match the
empty string, "c", "cccc", "ccccccccc", but not "cccx".

<ul class="menu">
<li><a accesskey="1" href="#Regular-expressions">Regular expressions</a>
</ul>

<div class="node">
<p><hr>
<a name="Regular-expressions"></a>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Wildcards-and-Regular-expressions">Wildcards and Regular expressions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Wildcards-and-Regular-expressions">Wildcards and Regular expressions</a>

</div>

<h4 class="subsection">1.3.1 Regular expressions</h4>

<p><a name="index-Matching-strings-1"></a><a name="index-Regular-expressions-2"></a><a name="index-Expressions_002c-regular-3"></a>The wildcards belong to the shell. They are used for matching
filenames. UNIX has a more general and widely used mechanism for
matching <em>strings</em>, this is through <em>regular expressions</em>.

   <p>Regular expressions are used by the <code>egrep</code> utility, text editors
like <code>ed</code>, <code>vi</code> and <code>emacs</code> and <code>sed</code> and <code>awk</code>.
They are also used in the C programming language
for matching input as well as in the Perl programming language and <code>lex</code>
tokenizer. Here are some examples using the <code>egrep</code> command
which print lines from the file <code>/etc/rc</code> which match certain
conditions. The  construction is part of <code>egrep</code>. Everything
in between these symbols is a regular expression. Notice that
special shell symbols <code>! * &amp;</code> have to be preceded with a backslash
<code>\</code> in order to prevent the shell from expanding them!
<a name="index-g_t_0040code_007begrep_007d-command-4"></a>
<pre class="smallexample">
     # Print all lines beginning with a comment #

     egrep '(^#)'           /etc/rc

     # Print all lines which DON'T begin with #

     egrep '(^[^#])'        /etc/rc

     # Print all lines beginning with e, f or g.

     egrep '(^[efg])'       /etc/rc

     # Print all lines beginning with uppercase

     egrep '(^[A-Z])'       /etc/rc

     # Print all lines NOT beginning with uppercase

     egrep '(^[^A-Z])'      /etc/rc

     # Print all lines containing ! * &amp;

     egrep '([\!\*\&amp;])'     /etc/rc

     # All lines containing ! * &amp; but not starting #

     egrep '([^#][\!\*\&amp;])' /etc/rc
</pre>
   <p class="noindent">Regular expressions are made up of the following `atoms'.

<p class="noindent">These examples assume that the file <samp><span class="file">/etc/rc</span></samp> exists.
If it doesn't exist on the machine you are using, try to
find the equivalent by, for instance, replacing
<code>/etc/rc</code> with <code>/etc/rc*</code> which will try to
find a match beginning with the rc.

   <p><a name="index-g_t_002e-in-regular-expressions-5"></a><a name="index-g_t_005e-in-regular-expressions-6"></a><a name="index-g_t_0024-in-regular-expressions-7"></a><a name="index-g_t_005b_005d-in-regular-expressions-8"></a><a name="index-g_t_002a-in-regular-expressions-9"></a><a name="index-g_t_002b-in-regular-expressions-10"></a><a name="index-g_t_003f-in-regular-expressions-11"></a><a name="index-g_t_002e-in-regular-expressions-12"></a><a name="index-g_t_005e-in-regular-expressions-13"></a><a name="index-g_t_0024-in-regular-expressions-14"></a><a name="index-g_t_005b_005d-in-regular-expressions-15"></a><a name="index-g_t_002a-in-regular-expressions-16"></a><a name="index-g_t_002b-in-regular-expressions-17"></a><a name="index-g_t_003f-in-regular-expressions-18"></a>
     <dl>
<dt>&lsquo;<samp><span class="samp">.</span></samp>&rsquo;<dd>Match any single character except the end of line.
<br><dt>&lsquo;<samp><span class="samp">^</span></samp>&rsquo;<dd>Match the beginning of a line as the first character.
<br><dt>&lsquo;<samp><span class="samp">$</span></samp>&rsquo;<dd>Match end of line as last character.
<br><dt>&lsquo;<samp><span class="samp">[..]</span></samp>&rsquo;<dd>Match any character in the list between the square brackets.(see below).
<br><dt>&lsquo;<samp><span class="samp">*</span></samp>&rsquo;<dd>Match zero or more occurrences of the preceding expression.
<br><dt>&lsquo;<samp><span class="samp">+</span></samp>&rsquo;<dd>Match one or more occurrences of the preceding expression.
<br><dt>&lsquo;<samp><span class="samp">?</span></samp>&rsquo;<dd>Match zero or one occurrence of the preceding expression.
</dl>

   <p>You can find a complete list in the Unix manual pages. The square
brackets above are used to define a <em>class</em> of characters to be
matched. Here are some examples,

     <ul>
<li>If the square brackets contain a list of
characters, $[a-z156]$ then a single occurrence of any character in the
list will match the regular expression: in this case any lowercase
letter or the numbers 1, 5 and 6.

     <li>If the first character in the brackets is the caret
symbol &lsquo;<samp><span class="samp">^</span></samp>&rsquo; then any character <em>except</em> those in the list will
be matched.

     <li>Normally a dash or minus sign &lsquo;<samp><span class="samp">-</span></samp>&rsquo; means a range of characters.
If it is the first character after the &lsquo;<samp><span class="samp">[</span></samp>&rsquo; or after &lsquo;<samp><span class="samp">[^</span></samp>&rsquo; then it
is treated literally.
</ul>

<!--  -->
<div class="node">
<p><hr>
<a name="File-Filters"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Patterns-self_002dtest-questions">Patterns self-test questions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Wildcards-and-Regular-expressions">Wildcards and Regular expressions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Searching-for-files">Searching for files</a>

</div>

<h3 class="section">1.4 File Filters</h3>

<p>Sometimes, the inclusion and exclusion options do not provide
sufficient flexibility to select just the items we intend. For such
cases, cfengine provides filters which can be used to build complex
file and process selection expressions.  A filter is a description of
items that we would like to include. Filters are declared in separate
stanzas in their own section of the <samp><span class="file">cfagent.conf</span></samp> configuration
and are attached to any number of rules, as attributes, using their
identifier.

   <p>Each filter is parameterized by a number of matching criteria. Each
filter has a result which is expressed as the logical combination of a
number of criteria.

<h4 class="subsection">1.4.1 File Filter Parameters</h4>

<p>The following components can be used to construct file filters:

     <ul>
<li><code>Owner</code> and <code>Group</code> can use numerical id's or names, or "none" for users or groups which are undefined in the system <samp><span class="file">passwd</span></samp>/<samp><span class="file">group</span></samp> file.

     <li><code>Mode</code> applies only to file objects. It shares syntax with the mode= strings in the files command. This test returns true if the bits which are specified as `should be set' are indeed set, and those which are specified as `should not be set' are not set.

     <li><code>Atime</code>, <code>Ctime</code>, <code>Mtime</code> These specify times to time ranges (via the <code>From</code> and <code>To</code> prefixes&mdash;see the third example below). If the file's time stamps lie in the specified range, the expression evaluates to true. Times are specified by a six component vector: (<var>year</var>, <var>month</var>, <var>day</var>, <var>hour</var>, <var>minutes</var>, <var>seconds</var>)
This may be evaluated as two functions: <code>date()</code> or <code>tminus()</code> which give
absolute times and times relative to the current time respectively. In
addition, the keywords <code>now</code> and <code>inf</code> (infinity) may be used.

     <li><code>Size</code> Specifies the file's size (or a size range when the prefixes <code>From</code> or <code>To</code> are included).
The keyword <code>inf</code> may also be used.

     <li><code>Type:</code> applies only to file objects may be a list of file types which are to be matched. The list should be separated by the OR symbol $\mid$, since these types are mutually exclusive. Values include <code>reg</code>, <code>link</code>,
<code>dir</code>, <code>socket</code>, <code>fifo</code>, <code>door</code> and <code>char</code>.

     <li><code>NameRegex</code> matches the name of the file with a regular expression.

     <li><code>IsSymLinkTo</code> applies only when the file object is a symbolic link.
It is true if the regular expression matches the contents of the link.
<li><code>ExecProgram</code> matches if the command returns successfully (with return code 0). Note that this feature introduces an implicit dependency on the command being called. This might be exploitable as a security weakness by advanced intruders.

     <li><code>ExecRegex</code> matches the parenthesized test string against the output of the specified command.

     <li><code>Result</code> A logical expression specifying the way in which the above elements are combined into a single filter.

   </ul>

<!-- ................................................ -->
<ul class="menu">
<li><a accesskey="1" href="#Example-file-filter-by-magic-number">Example file filter by magic number</a>
<li><a accesskey="2" href="#Example-file-filter-by-link-dest">Example file filter by link dest</a>
<li><a accesskey="3" href="#Example-file-filter-combined">Example file filter combined</a>
<li><a accesskey="4" href="#Example-file-filter-setuid">Example file filter setuid</a>
<li><a accesskey="5" href="#Example-file-filter-custom-scan">Example file filter custom scan</a>
<li><a accesskey="6" href="#Example-file-filter-tidy-junk">Example file filter tidy junk</a>
<li><a accesskey="7" href="#Example-file-filter-compress">Example file filter compress</a>
<li><a accesskey="8" href="#Example-file-filter-find-changes">Example file filter find changes</a>
</ul>

<div class="node">
<p><hr>
<a name="Example-file-filter-by-magic-number"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Example-file-filter-by-link-dest">Example file filter by link dest</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#File-Filters">File Filters</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-Filters">File Filters</a>

</div>

<h4 class="subsection">1.4.2 Example file filter - by magic number</h4>

<pre class="smallexample">     filters:
         { badgif        # Look for executables disguised as GIF
             NameRegex:  ".*gif"
             ExecRegex: "/bin/file (.*ELF.*)"
             Result: "ExecRegex.NameRegex"
         }

</pre>
<!-- ................................................ -->
<div class="node">
<p><hr>
<a name="Example-file-filter-by-link-dest"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Example-file-filter-combined">Example file filter combined</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Example-file-filter-by-magic-number">Example file filter by magic number</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-Filters">File Filters</a>

</div>

<h4 class="subsection">1.4.3 Example file filter by link destination</h4>

<pre class="smallexample">
         { histnull      # Check if users set history to dev/null
             NameRegex:   ".*history"
             IsSymLinkTo: "/dev/null"
             Result: "IsSymLinkTo.NameRegex"
             DefineClasses: "history"
         }

</pre>
<!-- ................................................ -->
<div class="node">
<p><hr>
<a name="Example-file-filter-combined"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Example-file-filter-setuid">Example file filter setuid</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Example-file-filter-by-link-dest">Example file filter by link dest</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-Filters">File Filters</a>

</div>

<h4 class="subsection">1.4.4 Example file filter combined parameters</h4>

<pre class="smallexample">         { old_or_big    # Find .dat files that are old or big
            FromMtime: "date(2001,1,1,0,0,0)"
            ToMtime: "tminus(0,0,1,0,0,0)"
            FromSize: "5m"
            ToSize: "inf"
            NameRegex: "dat\$"
            Return: "NameRegex.(Mtime|Size)"
         }
</pre>
   <p>In the final filter, <code>Size</code> is shorthand for <code>(FromSize.ToSize)</code>, and similar
abbreviations can be used for other numerical and time-period based items (e.g.,
<code>Mtime</code> in the same filter).

<!-- ................................................ -->
<div class="node">
<p><hr>
<a name="Example-file-filter-setuid"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Example-file-filter-custom-scan">Example file filter custom scan</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Example-file-filter-combined">Example file filter combined</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-Filters">File Filters</a>

</div>

<h4 class="subsection">1.4.5 Example file filter - setuid</h4>

<pre class="smallexample">
     filters:
       { setuid
         Owner: "root"
         Mode: "+6000"
         Result: "Owner.Mode"
       }

     files:
         /home recurse=inf filter=setuid mode=-6002
           action=fixplain inform=on syslog=on

</pre>
<!-- ................................................ -->
<div class="node">
<p><hr>
<a name="Example-file-filter-custom-scan"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Example-file-filter-tidy-junk">Example file filter tidy junk</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Example-file-filter-setuid">Example file filter setuid</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-Filters">File Filters</a>

</div>

<h4 class="subsection">1.4.6 Example file filter - custom scanner</h4>

<p>Another filter example shows how you might use a custom program or script
to scan files, e.g. for testing for viruses or harmful content.

<pre class="smallexample">
     filters:

     { virus

     Type: "reg"
     ExecRegex: "$(Grep) 'Content-.*EXE.*'  $(this) (.*)" # Look for EXE attacments
     Result:    "Type.ExecRegex"
     DefineClasses: "virus"
     }

     ###########################################################################

     files:

     /imap-dir r=inf filter=virus action=alert
     /var/mail r=inf filter=virus action=alert

     ###########################################################################

     shellcommands:

     virus::

      "/bin/echo Virus Alert on files"
</pre>
   <!-- ................................................ -->
<div class="node">
<p><hr>
<a name="Example-file-filter-tidy-junk"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Example-file-filter-compress">Example file filter compress</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Example-file-filter-custom-scan">Example file filter custom scan</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-Filters">File Filters</a>

</div>

<h4 class="subsection">1.4.7 Example file filter - tidy junk</h4>

<pre class="smallexample">
     # cf.users

     control:

         # backup exclusions

         excludecopy = ( *.EXE *.avi *.ZIP *.AVI *.MP3
                         *.mp3 *.o *.dvi *.rar  )

         backupdirs = ( bkupAH:bkupIN:bkupOZ )

         SensibleCount = ( 20 )

     filters:

         { history  # Shell history = /dev/null
           NameRegex:     ".*history"
           IsSymLinkTo:   "/dev/null"
           Result:        "IsSymLinkTo.NameRegex"
           DefineClasses: "historyalert"
         }

         { setuid  # SetUID/SetGID
           Owner:   "root"
           Group:   "0"
           Mode:    "+6000"
           Result:  "(Owner|Group).Mode"
         }

     tidy:

       emergency|labs::  # emergency class used for ad-hoc runs
         /home include=.rhosts age=0 inform=on
         /home include=core r=inf age=1
         /home include=a.out r=inf age=1
         /home include=*.o r=inf age=7

         /home/.netscape/cache include=*
           recurse=inf age=3 type=atime

     # Make sure backup disks don't get full
        backupserver.Hr17.OnTheHour::
          /${backupdirs} include=* recurse=inf age=14

</pre>
<!-- ................................................ -->
<div class="node">
<p><hr>
<a name="Example-file-filter-compress"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Example-file-filter-find-changes">Example file filter find changes</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Example-file-filter-tidy-junk">Example file filter tidy junk</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-Filters">File Filters</a>

</div>

<h4 class="subsection">1.4.8 Example file filter - compress files</h4>

<p>Example compressing all pdf files in sub-directories of <samp><span class="file">/mydirectory</span></samp>.

<pre class="smallexample">     control:

      actionsequence = ( files )

      CompressCommand = (/usr/bin/gzip )

     filters:

         { pdf_files

         NameRegex:     ".*.pdf|.*.fdf"
         Result:        "NameRegex"
         }

     files:

       /mydirectory

         filter=pdf_files
         r=inf
         action=compress

</pre>
   <!-- ................................................ -->
<div class="node">
<p><hr>
<a name="Example-file-filter-find-changes"></a>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Example-file-filter-compress">Example file filter compress</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-Filters">File Filters</a>

</div>

<h4 class="subsection">1.4.9 Example file filter - find files changed</h4>

<p>This example shows how to generate a list of the files that cfengine
identifies, by promising an unrealistic condition which you know will
not by satisfied by any file you are looking for (removing all
permissions from the file).

<pre class="smallexample">
     control:

      actionsequence = ( files )

     filters:

         { new_files

         # Files changed in the last 3 hr 30 mins
         FromMtime: "tminus(0,0,0,3,30,0)"
         ToMtime:   "inf"
         Result:    "Mtime"
         }

     files:

       /home/user

         mode=0           # trick to generate a warning
         filter=new_files
         r=inf
         action=warnall


</pre>
   <!--  -->
<ul class="menu">
<li><a accesskey="1" href="#Patterns-self_002dtest-questions">Patterns self-test questions</a>
</ul>

<div class="node">
<p><hr>
<a name="Patterns-self-test-questions"></a>
<a name="Patterns-self_002dtest-questions"></a>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#File-Filters">File Filters</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Searching-for-files">Searching for files</a>

</div>

<h3 class="section">1.5 Patterns self-test questions</h3>

<p><table class="cartouche" summary="cartouche" border="1"><tr><td>
     <ol type=1 start=1>

     <li>How do I add a filter to a file search?
<li>How do I specify what the filter is looking for?
<li>How can I see/test what files cfengine identifies?

        </ol>
</td></tr></table>

<!--  -->
<div class="node">
<p><hr>
<a name="Searching-for-text-inside-files"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Searching-for-processes">Searching for processes</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Searching-for-files">Searching for files</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">2 Searching for text inside files</h2>

<p>The contents of a file are an independent degree of freedom to
configure.  Most Unix files are traditionally line based (though
increasingly Java has brought XML into play).
CFEngine 2's editing features are based primarily on line-based
files.

<ul class="menu">
<li><a accesskey="1" href="#Line-based-editing-patterns">Line based editing patterns</a>
<li><a accesskey="2" href="#Replacing-Text-fragments">Replacing Text fragments</a>
<li><a accesskey="3" href="#Editing-self_002dtest-questions">Editing self-test questions</a>
</ul>

<div class="node">
<p><hr>
<a name="Line-based-editing-patterns"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Replacing-Text-fragments">Replacing Text fragments</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Searching-for-text-inside-files">Searching for text inside files</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Searching-for-text-inside-files">Searching for text inside files</a>

</div>

<h3 class="section">2.1 Line based editing patterns</h3>

<p>There is a recurring pattern in editing features:

     <dl>
<dt>&lsquo;<samp><span class="samp">..IfNoSuchLine</span></samp>&rsquo;<dd>Applies if there is no literal match between a line in the file and the quoted string.
<br><dt>&lsquo;<samp><span class="samp">..LineContaining</span></samp>&rsquo;<dd>Applies if there is (no) literal match between a substring of a line and the quoted string.
<br><dt>&lsquo;<samp><span class="samp">..LineStarting</span></samp>&rsquo;<dd>Applies if there is (no) literal match between the start of a line and the quoted string.
<br><dt>&lsquo;<samp><span class="samp">..LineMatching</span></samp>&rsquo;<dd>Applies if there is (no) literal match between a complete line of the file and the quoted regular expression.
</dl>

<p class="noindent">For example
<pre class="smallexample">
     SetLine "mark woz 'ere"
     AppendIfNoLineMatching "mark .*"

</pre>
   <p class="noindent">will append the line in <code>SetLine</code> if no line matches the regular

<pre class="smallexample">
     editfiles:
         { /etc/hosts.allow  # Disable access for this domain
             HashCommentLinesContaining "bad-guys.org"
         }

         { /etc/xinetd.d
             # Make sure telnet is disabled
             BeginGroupIfFileExists "telnet"
               DeleteLinesMatching "disable *="
               GotoLastLine
               InsertLine "disable = yes"
             EndGroup

             # If no access control, limit to subnet
             SetLine "only_from = 192.168.9"
             AppendIfNoLineMatching "only_from"
         }

</pre>
   <!-- ..................................................... -->
<div class="node">
<p><hr>
<a name="Replacing-Text-fragments"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Editing-self_002dtest-questions">Editing self-test questions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Line-based-editing-patterns">Line based editing patterns</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Searching-for-text-inside-files">Searching for text inside files</a>

</div>

<h3 class="section">2.2 Replacing Text fragments</h3>

<pre class="smallexample">
      ReplaceAll <var>quoted-regex</var> With <var>quoted-string</var>

</pre>
   <p>Replace all instances of strings matching the regular expression in the
first quotes with the exact string in the second set of quotes,
throughout the current file. Note that cfengine matches on a left to
right basis, with the first match taking precedence, so if your regular
expression matches text ambiguously it is the first occurrence which is
replaced. For example, if you replace &lsquo;<samp><span class="samp">cf.*</span></samp>&rsquo; with &lsquo;<samp><span class="samp">CFENGINE</span></samp>&rsquo;
and cfengine encounters a line &lsquo;<samp><span class="samp">hello cfengine cfengine</span></samp>&rsquo;, then this
will be replaced with &lsquo;<samp><span class="samp">hello CFENGINE</span></samp>&rsquo; even though two possible
strings match the regular expression. On the other hand if the
expression is not ambiguous, say replacing &lsquo;<samp><span class="samp">cfengine</span></samp>&rsquo; with
&lsquo;<samp><span class="samp">CFENGINE</span></samp>&rsquo;, then the result would be &lsquo;<samp><span class="samp">hello CFENGINE CFENGINE</span></samp>&rsquo;.

   <p>Rather than replacing all occurrences, you might want to pick only
the first.

<pre class="smallexample">
      ReplaceFirst <var>quoted-regex</var> With <var>quoted-string</var>

</pre>
   <p>For each line of the current file, replace the first string matching the
regular expression in the first quotes (<var>quoted-regex</var>) with the
string given in the second set of quotes (<var>quoted-string</var>).
Matching is done left to right.  For example, if you replace
&lsquo;<samp><span class="samp">``YY = [[:digit:]][[:digit:]]''</span></samp>&rsquo; with &lsquo;<samp><span class="samp">``YY = 04''</span></samp>&rsquo; and
cfengine encounters &lsquo;<samp><span class="samp">``YY = 03 but old YY = 70''</span></samp>&rsquo; then it will
be replaced with &lsquo;<samp><span class="samp">``YY = 04 but old YY = 70''</span></samp>&rsquo;

<ul class="menu">
<li><a accesskey="1" href="#Examples-of-text-matching-in-editfiles">Examples of text matching in editfiles</a>
<li><a accesskey="2" href="#Replacing-fields-in-tabular-files">Replacing fields in tabular files</a>
</ul>

<div class="node">
<p><hr>
<a name="Examples-of-text-matching-in-editfiles"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Replacing-fields-in-tabular-files">Replacing fields in tabular files</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Replacing-Text-fragments">Replacing Text fragments</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Replacing-Text-fragments">Replacing Text fragments</a>

</div>

<h4 class="subsection">2.2.1 Examples of text matching in editfiles</h4>

<pre class="smallexample">
     editfiles:
         { /var/spool/cron/tabs/root
           AutoCreate
           AppendIfNoSuchLine
             "0,15,30,45 * * * * /var/cfengine/bin/cfexecd -F"
         }

         { /etc/sysconfig/apache2
           BeginGroupIfNoLineMatching "APACHE_SERVER_FLAGS=\"SVN_VIEWCVS\""
             ReplaceAll "APACHE_SERVER_FLAGS=\"\"
               With "APACHE_SERVER_FLAGS=\"SVN_VIEWCVS\""
           EndGroup

           BeginGroupIfNoLineMatching
           "APACHE_CONF_INCLUDE_FILES=\"/master/my-http.conf\""
             ReplaceAll "APACHE_CONF_INCLUDE_FILES=\"\"
               With "APACHE_CONF_INCLUDE_FILES=\"/master/my-http.conf\"
           EndGroup

           BeginGroupIfNoLineMatching ".*php4 dav dav_svn.*"
             ReplaceAll "php4" With "php4 dav dav_svn"
           EndGroup
         }

         { /etc/postfix/main.cf
           ReplaceAll "^mydomain =.*" With "mydomain = iu.hio.no"
           ReplaceAll "^relayhost =.*" With "relayhost = [nexus.iu.hio.no]"
           AppendIfNoSuchLine "relayhost = [nexus.iu.hio.no]"
           AppendIfNoSuchLine "mydomain = iu.hio.no"
         }

     # Default PHP memory model is too small

         { /etc/php.ini
           ReplaceAll "^memory_limit =.*" With "memory_limit = 16M"
           AppendIfNoSuchLine "memory_limit = 16M"
         }

</pre>
<!-- ....................................................... -->
<div class="node">
<p><hr>
<a name="Replacing-fields-in-tabular-files"></a>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Examples-of-text-matching-in-editfiles">Examples of text matching in editfiles</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Replacing-Text-fragments">Replacing Text fragments</a>

</div>

<h4 class="subsection">2.2.2 Replacing fields in tabular files</h4>

<pre class="smallexample">
     ReplaceLinesMatchingField <var>quoted-number</var>

</pre>
   <p>This command replaces any lines in the current file with the current line
set by <code>SetLine</code> or <code>ForEachLineIn</code>, if the lines
are split into fields (e.g. the password file) separated by the
<code>SplitOn</code> character (':' by default), and the corresponding
fields match.

   <p>The idea behind this command was to be able to override global
passwords (from a file which gets distributed) by new passwords
in a local file. Rather than maintaining the files separately,
this simply overrides the entries with the new ones.

<!--  -->
<ul class="menu">
<li><a accesskey="1" href="#Patterns-self_002dtest-questions">Patterns self-test questions</a>
</ul>

<div class="node">
<p><hr>
<a name="Editing-self-test-questions"></a>
<a name="Editing-self_002dtest-questions"></a>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Replacing-Text-fragments">Replacing Text fragments</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Searching-for-text-inside-files">Searching for text inside files</a>

</div>

<h3 class="section">2.3 Editing self-test questions</h3>

<p><table class="cartouche" summary="cartouche" border="1"><tr><td>
     <ol type=1 start=1>

     <li>How can I search and replace text in editfiles?
<li>How do I ensure that the replacement is convergent?
<li>How can I edit fields in tabular files?
<li>How can I make conditional edits based on matched patterns?

        </ol>
</td></tr></table>

<!--  -->
<div class="node">
<p><hr>
<a name="Searching-for-processes"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Troubleshooting-Filters">Troubleshooting Filters</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Searching-for-text-inside-files">Searching for text inside files</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">3 Searching for processes</h2>

<p>Process filters match common fields from <code>ps</code> command output.

     <ul>
<li><code>PID:</code> process ID (parameter is a quoted regular expression).
<li><code>PPID:</code> parent process ID (quoted regular expression).
<li><code>PGID:</code> process group ID (quoted regular expression).
<li><code>RSize:</code> resident size (quoted regular expression).
<li><code>VSize:</code> virtual memory size (quoted regular expression).
<li><code>Status:</code> status (quoted regular expression).
<li><code>Command:</code> CMD or COMMAND fields (quoted regular expression).
<li><code>TTime:</code> Total elapsed time in TIME field (accumulated time). The prefixes <code>From</code> and <code>To</code> may be used to specify
a range.
<li><code>STime:</code> Starting time for process in STIME or START field (accumulated time).
The prefixes <code>From</code> and <code>To</code> may be used to specify
a range.
<li><code>TTY:</code> terminal type, or none (quoted regular expression).
<li><code>Priority:</code> PRI or NI field (quoted regular expression).
<li><code>Threads:</code> NLWP field for SVR4 (quoted regular expression).
<li><code>Result:</code> logical combination of above returned by filter (quoted regular expression).
</ul>

   <p>Note that these names are all case sensitive.

<!-- ................................................ -->
<ul class="menu">
<li><a accesskey="1" href="#Example-file-process-filter-by-accumulated-time">Example file process filter by accumulated time</a>
<li><a accesskey="2" href="#Example-file-process-filter-started-recently">Example file process filter started recently</a>
<li><a accesskey="3" href="#Text-editing-self_002dtest-questions">Text editing self-test questions</a>
</ul>

<div class="node">
<p><hr>
<a name="Example-file-process-filter-by-accumulated-time"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Example-file-process-filter-started-recently">Example file process filter started recently</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Searching-for-processes">Searching for processes</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Searching-for-processes">Searching for processes</a>

</div>

<h3 class="section">3.1 Example process filter by accumulated time</h3>

<p>Here is an example process filter in action:

<pre class="smallexample">
     filters:

     #  Processes owned by root with &gt; 2 hrs CPU time
         { program_gone_bad
             Owner: "root"
             FromTTime: "accumulated(0,0,0,200,0,0)"
             ToTTime: "inf"
             Result: "Owner.TTime"
         }

     processes:

         "." filter=program_gone_bad action=warn

</pre>
   <p>In this case, the regular expression searched for among the output from
<code>ps</code> is any character (specified by single period).

<!-- ................................................ -->
<div class="node">
<p><hr>
<a name="Example-file-process-filter-started-recently"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Text-editing-self_002dtest-questions">Text editing self-test questions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Example-file-process-filter-by-accumulated-time">Example file process filter by accumulated time</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Searching-for-processes">Searching for processes</a>

</div>

<h3 class="section">3.2 Example process filter - started recently</h3>

<pre class="smallexample">
     control:

      actionsequence = ( processes )

     filters:

         { new_processes

         # New processes started in past hour and half

         FromSTime: "tminus(0,0,0,1,30,0)"
         ToSTime:   "inf"
         Result:    "STime"
         }

     processes:

      "." filter=new_processes action=warn

</pre>
<!--  -->
<ul class="menu">
<li><a accesskey="1" href="#Text-editing-self_002dtest-questions">Text editing self-test questions</a>
</ul>

<div class="node">
<p><hr>
<a name="Text-editing-self-test-questions"></a>
<a name="Text-editing-self_002dtest-questions"></a>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Example-file-process-filter-started-recently">Example file process filter started recently</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Searching-for-processes">Searching for processes</a>

</div>

<h3 class="section">3.3 Text editing self-test questions</h3>

<p><table class="cartouche" summary="cartouche" border="1"><tr><td>
     <ol type=1 start=1>

     <li>What is the difference between STime and TTime?
<li>Do I have to run process scripts as root?
<li>How can I make a more powerful <code>killall</code> command?

        </ol>
</td></tr></table>

<!--  -->
<div class="node">
<p><hr>
<a name="Troubleshooting-Filters"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Iteration">Iteration</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Searching-for-processes">Searching for processes</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">4 Troubleshooting Filters</h2>

<p>Two common causes of error in constructing filters are the following:

     <ul>
<li>Incorrect capitalization of the filter attributes:
e.g. &ldquo;FromMTime&rdquo; for <code>FromMtime</code>.
<li>Forgetting to include a colon after the attribute name when
specifying its value:
     <pre class="smallexample">          FromSize    "100m"         <var>Will not work without the colon!</var>
</pre>
     </ul>

<!--  -->
<div class="node">
<p><hr>
<a name="Iteration"></a>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Troubleshooting-Filters">Troubleshooting Filters</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">5 Iteration</h2>

<p>In all cases a search for a pattern implies some iteration over the possible matches.
Cfengine's iteration (i.e. looping) capabilities. In some cases we can think of
iterating over files, processes or other objects. In other cases we iterate over the
set of all possible parameters to a given configuration promise.

<ul class="menu">
<li><a accesskey="1" href="#Iteration-over-lists-as-a-pattern">Iteration over lists as a pattern</a>
</ul>

<div class="node">
<p><hr>
<a name="Iteration-over-lists-as-a-pattern"></a>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Iteration">Iteration</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Iteration">Iteration</a>

</div>

<h3 class="section">5.1 Iteration over lists as a pattern</h3>

<p>Variables can be used as iterators in a limited number of scenarios in
cfengine 2. The iteration was originally modelled on the shell list
idea, as represented in <code>PATH</code> names, and the &lsquo;<samp><span class="samp">IFS</span></samp>&rsquo;
variable. Only in cfengine 3 has this poor decision been rectified.

   <p>Iteration is implicit. When list variables are subsituted into
expressions iteration over the list elements is assumed if i) it makes
sense, and ii) the limitations of cfengine 2 can cope with the
iteration.

   <p>A loop is therefore made by substituing a variables that is a list. A list
variable is one which consists of strings separated by a list separator.
The default list separator is the colon &lsquo;<samp><span class="samp">:</span></samp>&rsquo; character, as in the shell:

<pre class="smallexample">     control:

      listvar = ( one:two:three:four )

</pre>
   <p>The action that contains a variable to be interpreted as a list appears
as separate actions, one for each case:

<pre class="smallexample">     shellcommand:

       "/bin/echo $(listvar)"
</pre>
   <p>is equivalent to

<pre class="smallexample">     shellcommand:

       "/bin/echo one"
       "/bin/echo two"
       "/bin/echo three"
       "/bin/echo four"
</pre>
   <p>If multiple iterators are used, these are handled as nested loops:

<pre class="smallexample">     cfengine::/bin/echo one 1:     one 1
     cfengine::/bin/echo one 2:     one 2
     cfengine::/bin/echo one 3:     one 3
     cfengine::/bin/echo one 4:     one 4
     cfengine::/bin/echo two 1:     two 1
     cfengine::/bin/echo two 2:     two 2
     cfengine::/bin/echo two 3:     two 3
     cfengine::/bin/echo two 4:     two 4
     cfengine::/bin/echo three:     three 1
     cfengine::/bin/echo three:     three 2
     cfengine::/bin/echo three:     three 3
     cfengine::/bin/echo three:     three 4
     cfengine::/bin/echo four :     four 1
     cfengine::/bin/echo four :     four 2
     cfengine::/bin/echo four :     four 3
     cfengine::/bin/echo four :     four 4
</pre>
   <p>Where iterators are not allowed, the implied lists are treated as scalars:

<pre class="smallexample">
     alerts:

      amnexus::

       "do $(list1) $(list2)"
</pre>
   <p>e.g.

<pre class="smallexample">
     cfengine:: do one:two:three:four 1:2:3:4
</pre>
   <p>Iterative expansion is currently restricted to:
     <ul>
<li>In the directory field of the admit/deny server access rules,

     <li>In the `from' field of a copy action,
<li>In the server field of the copy action,

     <li>In the directory field of the disable action,

     <li>In the directory field of the files action,

     <li>In the `to' field of a multiple link action,

     <li>In the directory field of the required/disk action,

     <li>In a resolve item.

     <li>In the directory field of a tidy action,

     <li>In the arguments, replyto and server attributes of methods.

     <li>Names in the ignore action.

     <li>A shellcommands body.

     <li>In admit/deny path and attributes of cfserver.

   </ul>

<!-- ========================================================================= -->
<!-- @node Index,  , CFEngine Methods, Top -->
<!-- @unnumbered Concept Index -->
<!-- @printindex cp -->
<!-- ========================================================================= -->
   <p><a name="Contents">

   <div class="contents">
<h2>Table of Contents</h2>
<ul>
<li><a name="toc_Top" href="#Top">CFEngine-Anomalies</a>
<li><a name="toc_Searching-for-files" href="#Searching-for-files">1 Searching for files</a>
<ul>
<li><a href="#Controlling-Directory-Tree-Traversal">1.1 Controlling Directory Tree Traversal</a>
<li><a href="#Inclusion-and-Exclusion-Patterns">1.2 Inclusion and Exclusion Patterns</a>
<ul>
<li><a href="#Local-criteria-_0028per-promise-rule_0029">1.2.1 Local criteria (per promise rule)</a>
<li><a href="#Global-criteria-_0028per-promise-rule_0029">1.2.2 Global criteria (per promise rule)</a>
</li></ul>
<li><a href="#Wildcards-and-Regular-expressions">1.3 Wildcards and Regular expressions</a>
<ul>
<li><a href="#Regular-expressions">1.3.1 Regular expressions</a>
</li></ul>
<li><a href="#File-Filters">1.4 File Filters</a>
<ul>
<li><a href="#File-Filters">1.4.1 File Filter Parameters</a>
<li><a href="#Example-file-filter-by-magic-number">1.4.2 Example file filter - by magic number</a>
<li><a href="#Example-file-filter-by-link-dest">1.4.3 Example file filter by link destination</a>
<li><a href="#Example-file-filter-combined">1.4.4 Example file filter combined parameters</a>
<li><a href="#Example-file-filter-setuid">1.4.5 Example file filter - setuid</a>
<li><a href="#Example-file-filter-custom-scan">1.4.6 Example file filter - custom scanner</a>
<li><a href="#Example-file-filter-tidy-junk">1.4.7 Example file filter - tidy junk</a>
<li><a href="#Example-file-filter-compress">1.4.8 Example file filter - compress files</a>
<li><a href="#Example-file-filter-find-changes">1.4.9 Example file filter - find files changed</a>
</li></ul>
<li><a href="#Patterns-self_002dtest-questions">1.5 Patterns self-test questions</a>
</li></ul>
<li><a name="toc_Searching-for-text-inside-files" href="#Searching-for-text-inside-files">2 Searching for text inside files</a>
<ul>
<li><a href="#Line-based-editing-patterns">2.1 Line based editing patterns</a>
<li><a href="#Replacing-Text-fragments">2.2 Replacing Text fragments</a>
<ul>
<li><a href="#Examples-of-text-matching-in-editfiles">2.2.1 Examples of text matching in editfiles</a>
<li><a href="#Replacing-fields-in-tabular-files">2.2.2 Replacing fields in tabular files</a>
</li></ul>
<li><a href="#Editing-self_002dtest-questions">2.3 Editing self-test questions</a>
</li></ul>
<li><a name="toc_Searching-for-processes" href="#Searching-for-processes">3 Searching for processes</a>
<ul>
<li><a href="#Example-file-process-filter-by-accumulated-time">3.1 Example process filter by accumulated time</a>
<li><a href="#Example-file-process-filter-started-recently">3.2 Example process filter - started recently</a>
<li><a href="#Text-editing-self_002dtest-questions">3.3 Text editing self-test questions</a>
</li></ul>
<li><a name="toc_Troubleshooting-Filters" href="#Troubleshooting-Filters">4 Troubleshooting Filters</a>
<li><a name="toc_Iteration" href="#Iteration">5 Iteration</a>
<ul>
<li><a href="#Iteration-over-lists-as-a-pattern">5.1 Iteration over lists as a pattern</a>
</li></ul>
</li></ul>
</div>

   <p><script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-2576171-2");
pageTracker._initData();
pageTracker._trackPageview();
</script>

</body></html>

