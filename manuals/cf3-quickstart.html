<html lang="en">
<head>
<title>CFEngine Quick Start Guide</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="CFEngine Quick Start Guide">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="top" href="#Top">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
@font-face {
    font-family: 'CFE_FONT';
    src: url('fonts/eot/opensans-regular-webfont.eot');
    src: local('â˜º'),  url('fonts/ttf/opensans-regular-webfont.ttf') format('truetype'), url('fonts/svg/opensans-regular-webfont.svg') format('svg');
    font-weight: normal;
    font-style: normal;
}    
pre {
    background-color: #EEFFDD;
    border: 1px solid #CCCCCC;
    font-family: courier;
    margin-bottom: 10px;
    margin-top: 10px;
    padding: 5px;
    font-size: 90%;
    }
pre.display { font-family:inherit }
pre.format  { font-family:inherit }
pre.smallexample
pre.smalllisp,
pre.smallformat,
pre.smalldisplay {
  font-size: 90%;
} 

span.sc    { font-variant:small-caps }
span.roman { font-family:serif; font-weight:normal; } 
span.sansserif { font-family:sans-serif; font-weight:normal; } 

body {
    font:  90%  'CFE_FONT', arial, Helvetica,sans-serif; 
    color: #646464;
    padding: 10px 20px;
    width: 960px;
    margin: 0 auto;
}
.node
{
    text-align: right;
    padding: 2px;
    font-size: smaller;
}
.node hr {
    border: 0;
    width: 100%;
    color: #CCC;
    background-color: #CCC;
    height: 5px;
}
.section {
    padding-right: 0px;
    padding-bottom: 0px;
    padding-left: 0px;
}

h1 {
    font-size: 26px;
    font-weight: normal;
    line-height: 32px;
    margin: 32px 0 16px;
    text-align: left;
    text-transform: uppercase;
}

h2 {
    color: #9E9981 !important;
    font-size: 16px;
    line-height: 18px;
    font-weight: normal;
    margin: 16px 0 26px;
    text-align: left;
}
h3 {
    margin-top: 3px;
    margin-right: 0px;
    margin-bottom: 10px;
    margin-left: 0px;
    line-height: 20px;
    font-size: 16px;
    font-weight: normal;
}

.contents
{
    background-color: #CCC;
    padding-top: 2px;
    padding-right: 2px;
    padding-bottom: 2px;
    padding-left: 10px;
}

.index-cp
{  
background: #fff url(index-cp.png) right repeat-y;
}

.index-vr
{  
background: #fff url(index-vr.png) right repeat-y;
}

.index-mb
{  
background: #eee url(index-faq.png) right repeat-y;
}

table.border
{
	border-color: #666;
	border-width: 0px;
}

FONT.liten {font-size: 80%; }
 
.tynn {
    font-family: Arial, Helvetica, sans-serif;
    font-size: smaller;
    font-style: normal;
    font-weight: lighter;
    margin-bottom: 0em;
    font-size: 11pt;
}
.verbatim {
    color: #000;
    margin-top: 0px;
    margin-right: 0px;
    margin-bottom: 20px;
    margin-left: 0px;
}
.example {
    color: #000;
    width: 100%;
    margin-top: 0px;
    margin-right: 0px;
    margin-bottom: 20px;
    margin-left: 0px;
}
.smallexample {
    color: #000;
    padding-top: 10px;
    padding-right: 30px;
    padding-bottom: 5px;
    padding-left: 30px;
    margin-top: 0px;
    margin-right: 0px;
    margin-bottom: 0px;
    margin-left: 0px;
}
.cartouche {
    padding: 5px;
    font-style: italic;
    font-size: 85%;
}

table.cartouche {
    border: none !important;
}

 .cartouche td  {
    background-color: #ddd;
    border: 1px solid #ccc;
    padding: 5px;
}

A:link { color: #2c2e70 }
A:visited { color: black }
A:active { color: #600041 }
dt em {font-weight: bold}
/* don't change this rule */    
pre.sp {
    background: none !important;   
    border:none !important
}
/* --- */
/*code hightlight*/
.red { color: #b80047; font-weight: bold; }

.blue { color: blue;  /*font-weight: bold;*/ }

.green { color: darkgreen; }

.comment { font-style: italic; }
--></style>
</head>
<body>
<h1 class="settitle">CFEngine Quick Start Guide</h1>
<div class="node">
<a name="Top"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Welcome-to-CFEngine_0021">Welcome to CFEngine!</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#dir">(dir)</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#dir">(dir)</a>

</div>

<h2 class="unnumbered">CFEngine Quick Start Guide</h2>

<ul class="menu">
<li><a accesskey="1" href="#Welcome-to-CFEngine_0021">Welcome to CFEngine!</a>
<li><a accesskey="2" href="#CFEngine-by-Example">CFEngine by Example</a>
<li><a accesskey="3" href="#Next-steps">Next steps</a>
</ul>

   <div class="contents">
<h2>Table of Contents</h2>
<ul>
<li><a name="toc_Top" href="#Top">CFEngine Quick Start Guide</a>
<ul>
<li><a href="#Welcome-to-CFEngine_0021">Welcome to CFEngine!</a>
<ul>
<li><a href="#CFEngine-Automation-Overview">CFEngine Automation Overview</a>
<li><a href="#CFEngine-Components-_002d_002d-What-Are-they-and-How-Do-They-Work_003f">CFEngine Components &ndash; What Are they and How Do They Work?</a>
<li><a href="#Hubs">Hubs, Servers and Clients</a>
</li></ul>
<li><a href="#CFEngine-by-Example">CFEngine by Example</a>
<ul>
<li><a href="#Installation">Installation</a>
<li><a href="#CFEngine-File-Structure">CFEngine File Structure</a>
<li><a href="#Create-and-Manually-Execute-a-Policy">Create and Manually Execute a Policy</a>
<li><a href="#CFEngine-Client">CFEngine Client, Server Operations</a>
</li></ul>
<li><a href="#Next-steps">Next steps</a>
</li></ul>
</li></ul>
</div>

<div class="node">
<a name="Welcome-to-CFEngine!"></a>
<a name="Welcome-to-CFEngine_0021"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#CFEngine-by-Example">CFEngine by Example</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Top">Top</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h3 class="unnumberedsec">Welcome to CFEngine!</h3>

<p>CFEngine is a systems management tool designed to help you configure
and automate your IT infrastructure. It can expertly handle any number
of tasks, ranging from the standardization of server builds to the
deployment and management of software and services.  In terms of real
time administration, CFEngine has the ability to maintain system
security from both a file system and process perspective and report on
environmental health and status.

<ul class="menu">
<li><a accesskey="1" href="#CFEngine-Automation-Overview">CFEngine Automation Overview</a>
<li><a accesskey="2" href="#CFEngine-Components-_002d_002d-What-Are-they-and-How-Do-They-Work_003f">CFEngine Components -- What Are they and How Do They Work?</a>
<li><a accesskey="3" href="#Hubs">Hubs</a>
</ul>

<div class="node">
<a name="CFEngine-Automation-Overview"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#CFEngine-Components-_002d_002d-What-Are-they-and-How-Do-They-Work_003f">CFEngine Components -- What Are they and How Do They Work?</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Welcome-to-CFEngine_0021">Welcome to CFEngine!</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Welcome-to-CFEngine_0021">Welcome to CFEngine!</a>

</div>

<h4 class="unnumberedsubsec">CFEngine Automation Overview</h4>

<p>CFEngine is a distributed solution that is completely independent of
host operating systems, network topology or system processes. You
describe the ideal state of a given system by creating promises
and the CFEngine agent ensures that the necessary steps are taken to
achieve this state.  Automation in CFEngine is executed through a
series of components that run locally on client, server or hub (Nova
Only) systems.

<div class="node">
<a name="CFEngine-Components----What-Are-they-and-How-Do-They-Work%3f"></a>
<a name="CFEngine-Components-_002d_002d-What-Are-they-and-How-Do-They-Work_003f"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Hubs">Hubs</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#CFEngine-Automation-Overview">CFEngine Automation Overview</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Welcome-to-CFEngine_0021">Welcome to CFEngine!</a>

</div>

<h4 class="unnumberedsubsec">CFEngine Components &ndash; What Are they and How Do They Work?</h4>

<p>The power behind CFEngine lies in its components and the scripting
language used to interact with them. Once you know the scripting
language, you can clearly and specifically express your desired end
state, allowing CFEngine to achieve your goals with precision.

   <p>There are a number of components in CFEngine, with each component
performing a unique function. The following components form the basis
of automation:

     <dl>
<dt><code>cf-execd</code><dd>The cf-execd process can be likened to the cron process in UNIX/Linux or the Windows Scheduler. It runs as a daemon and its job is to start the cf-agent process at a specified time interval. This user configurable interval defaults to 5 minutes. 
<br><dt><code>cf-agent</code><dd>Is an agent that is called by the cf-execd process. The cf-agent component does the heavy work of  system automation and maintenance. 
<br><dt><code>cf-serverd</code><dd>The cf-serverd process is used to distribute policy and/or data files. 
</dl>

   <p>In conjunction with the process/agents listed, CFEngine needs to know
what you would like to automate, maintain or configure. For this
purpose, CFEngine has two additional components: promises and
policies.  A promise is a statement, written in plain text using the
CFEngine language, that describes the desired state of a system.  A
policy is a collection of one or more related promises, which is
executed every time the cf-agent runs.

   <p>Next are the actual working files which are processed by CFEngine
whenever the cf-agent process runs. Perhaps the most important file is
the default policy file, which is called promises.cf. It is stored
locally on every host, enabling execution with or without network
dependencies. If you would like to update a policy, you simply make a
change to the desired policy file on the policy server or hub (Nova
Only), then update promises.cf accordingly. Each client Agent will
automatically pull the new version in, then execute the new
instructions on the next run.

<div class="node">
<a name="Hubs"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#CFEngine-Components-_002d_002d-What-Are-they-and-How-Do-They-Work_003f">CFEngine Components -- What Are they and How Do They Work?</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Welcome-to-CFEngine_0021">Welcome to CFEngine!</a>

</div>

<h4 class="unnumberedsubsec">Hubs, Servers and Clients</h4>

<p>Once CFEngine is installed on a system, it can function as either a
standalone client or as a part of a multi-node infrastructure. 
Clients are designed to pull policies from either a CFEngine policy
server or hub (Nova Only), or, from themselves in the absence of a
policy server. If a system is dedicated as a CFEngine policy server or
hub, it is still a client that will maintain it's own state regardless
of it's function to the rest of CFEngine infrastructure. In addition,
a client can assume various roles in any given infrastructure; be it a
version control repository, distribution server or end host.

   <p>Checkpoint:

     <ul>
<li>CFEngine uses agents and language to perform automation and configuration tasks
<li>Instructions written in CFEngine syntax are known as promises
<li>One or more related promises can be written into a text file known as a policy
<li>The promise.cf file references policy files that each system will run in order to perform local automation, configuration and security tasks
<li>CFEngine maintains a desired system state on networked systems by utilizing client initiated pull technology; changes are never pushed or forced
<li>Networked CFEngine clients will check its policy server or hub (Nova Only) in order pull new policy changes when they are updated
<li>The cf-agent process verifies the promises.cf file, then applies the policies to ensure that all promises are being kept
<li>The  cf-execd daemon starts cf-agent process on a regular intervals
<li>The cf-serverd runs on a hub or server and allows client systems to retrieve policy changes and files. 
</ul>

<div class="node">
<a name="CFEngine-by-Example"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Next-steps">Next steps</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Welcome-to-CFEngine_0021">Welcome to CFEngine!</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h3 class="unnumberedsec">CFEngine by Example</h3>

<p>For the purpose of these exercises, it would be ideal to have 2 test
systems available for CFEngine installation and configuration. You
will name the first test system cfhub and the second system, which you
will use in Step 3, will be named cfhost. Although installation and
testing on a single host will sufficiently demonstrate the power of
promises and policies, using 2 or more systems will allow you to
experience what CFEngine brings to the table in terms of multi-system
management.

<ul class="menu">
<li><a accesskey="1" href="#Installation">Installation</a>
<li><a accesskey="2" href="#CFEngine-File-Structure">CFEngine File Structure</a>
<li><a accesskey="3" href="#Create-and-Manually-Execute-a-Policy">Create and Manually Execute a Policy</a>
<li><a accesskey="4" href="#CFEngine-Client">CFEngine Client</a>
</ul>

<div class="node">
<a name="Installation"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#CFEngine-File-Structure">CFEngine File Structure</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#CFEngine-by-Example">CFEngine by Example</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#CFEngine-by-Example">CFEngine by Example</a>

</div>

<h4 class="unnumberedsubsec">Installation</h4>

<p>The CFEngine package comes in many different flavors. For Linux
systems, CFEngine is available as a pre-compiled binary for many
distributions, including: Debian, Fedora, RHEL, SuSE and Ubuntu. These
packages are available from <a href="http://cfengine.com/inside/myspace">http://cfengine.com/inside/myspace</a>. To
unpack the binaries (you must install them as root):

     <dl>
<dt><i>Nova Installation:</i><dd>
     For Nova, you will designate one at least one server as the hub, which should be installed first:

          <dl>
<dt><i>RedHat/SuSE</i><dd>
          <pre class="smallexample">               rpm -ihv cfengine-nova-2.1.x.y.rpm
               rpm -ihv cfengine-nova-expansion.2.1.x.y.rpm
</pre>
          <br><dt><i>Debian/Ubuntu</i><dd>
          <pre class="smallexample">               dpkg --install  cfengine-nova-2.1.x.y.deb
               dpkg --install  cfengine-nova-expansion.2.1.x.y.deb
</pre>
          </dl>
     To install Nova on non-Hub systems:
          <dl>
<dt><i>RedHat/SuSE</i><dd>
          <pre class="smallexample">               rpm -ihv cfengine-nova-2.1.x.y.rpm
</pre>
          <br><dt><i>Debian/Ubuntu</i><dd>
          <pre class="smallexample">               dpkg --install  cfengine-nova-2.1.x.y.deb
</pre>
          </dl>

     <p class="noindent">On the hub, a public key has now been created in

     <p><samp><span class="file">/var/cfengine/ppkeys/localhost.pub</span></samp>

     <p class="noindent">as part of the package
installation. You should send this public key to CFEngine Support as
an attachment in the ticket system, to obtain a license file
license.dat. Save the returned license file to
<samp><span class="file">/var/cfengine/masterfiles/license.dat</span></samp> on the hub before continuing.

     <p>For more details on software licensing see:

     <p><a href="https://cfengine.com/software/Licensing.pdf">https://cfengine.com/software/Licensing.pdf</a>

     <br><dt><i>Community Installation:</i><dd>
Prior to installing CFEngine, you should first ensure that the following packages are installed:

          <ul>
<li>OpenSSL - Open source Secure Sockets Layer for encryption. 
<li>BerkeleyDB (version 3.2 or later) - Lightweight flat-file database system. 
<li>PCRE - Perl Compatible Regular Expression library. 
</ul>

     <p>If they are not installed, then you can easily install them using the appropriate package manager:

          <dl>
<dt><i>Debian/Ubuntu:</i><dd><code>apt-get install libdb4.* libpcre3 libssl </code>
<br><dt><i>CentOS/RedHat:</i><dd><code>yum install db4 pcre openssl</code>
<br><dt><i>SuSE:</i><dd><code>zypper install libdb-4_* pcre libopenssl </code>
</dl>

     <p>Once the prerequisites are installed or verified, you may proceed to the CFEngine installation.

          <dl>
<dt><i>RedHat/SuSE:</i><dd><code>rpm -ihv cfengine-community-3.x.y.rpm</code>
<br><dt><i>Debian/Ubuntu:</i><dd><code>dpkg --install  cfengine-community-3.x.y.deb</code>
</dl>

     <p>For other UNIX/Linux systems, you may download and compile the source code, which is available from http://cfengine.com/source_code. 
</dl>

<div class="node">
<a name="CFEngine-File-Structure"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Create-and-Manually-Execute-a-Policy">Create and Manually Execute a Policy</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Installation">Installation</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#CFEngine-by-Example">CFEngine by Example</a>

</div>

<h4 class="unnumberedsubsec">CFEngine File Structure</h4>

<p>The CFEngine application is fully contained within the <samp><span class="file">/var/cfengine</span></samp>
directory tree. Although you will get to know this file system
intimately as you progress, here is a quick breakdown of the directory
structure and some of the files and functions associated with each
subdirectory:

     <dl>
<dt><samp><span class="file">/var/cfengine/bin  - Consists of the agents and daemons that run CFEngine, including:</span></samp><dd>
          <ul>
<li><samp><span class="file">cf-agent</span></samp> -  Agent: Executes the promises.cf file; ensures that all promises are being kept
<li><samp><span class="file">cf-execd</span></samp> -  Daemon: Starts the cf-agent process at a specified time interval. 
<li><samp><span class="file">cf-serverd</span></samp>  - Daemon: Provides network services; used to distribute policy and data files
<li><samp><span class="file">cf-monitord</span></samp> -  Daemon: Collects system statistics
<li><samp><span class="file">cf-promises</span></samp>  - Agent: Verifies CFEngine's configuration syntax
<li><samp><span class="file">cf-runagent</span></samp>  - Agent: Contacts a remote system to run cf-agent
<li><samp><span class="file">cf-report</span></samp>  - Agent: Extracts and presents report data in HTML,XML or graph formats
<li><samp><span class="file">cf-know</span></samp>  - Agent: Builds knowledge maps based on promises and data
</ul>

     <br><dt><samp><span class="file">/var/cfengine/masterfiles</span></samp><dd>
Policy repository which grants access to local or bootstrapped
CFEngine clients when they need to update their policies. Policies
obtained from <samp><span class="file">/var/cfengine/masterfiles</span></samp> are then cached in
<samp><span class="file">/var/cfengine/inputs</span></samp> for local policy execution. The
<samp><span class="file">cf-agent</span></samp> executable does not execute policies directly from
this repository.

     <br><dt><samp><span class="file">/var/cfengine/inputs</span></samp><dd>	Cached policy repository located on a CFEngine client. The <samp><span class="file">cf-agent</span></samp> executable  	executes policies from this repository.

     <br><dt><samp><span class="file">/var/cfengine/outputs</span></samp><dd>	Directory where <samp><span class="file">cf-agent</span></samp> creates its output files.

     <br><dt><samp><span class="file">/var/cfengine/ppkeys</span></samp><dd>	Directory used to store encrypted public/private keys for CFEngine client/server network communications.

     <br><dt><samp><span class="file">/var/cfengine/reports</span></samp><dd>	Directory used to store reports generated by cf-report .

     <br><dt><samp><span class="file">/var/cfengine/lib</span></samp><dd>	Directory to store shared objects and dependencies that are in the bundled packages.

   </dl>

<div class="node">
<a name="Create-and-Manually-Execute-a-Policy"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#CFEngine-Client">CFEngine Client</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#CFEngine-File-Structure">CFEngine File Structure</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#CFEngine-by-Example">CFEngine by Example</a>

</div>

<h4 class="unnumberedsubsec">Create and Manually Execute a Policy</h4>

<p>If you have ever taken a course in programming, then you are probably
familiar with the Hello World program. For CFEngine3, the Hello
World policy would look like this:

<pre class="verbatim">body common control  
{
<span class="red">bundlesequence </span>=> { "test" };
}

<span class="red">bundle agent</span> <span class="blue">test</span>
{
<span class="red">reports:
</span>  cfengine_3::
      "Hello world!";
}
</pre>

   <p>This policy can be manually run by performing the following steps:

     <ol type=1 start=1>
<li>Log on to the new host; copy and paste the above Hello World script into a text file named <samp><span class="file">/var/cfengine/inputs/test.cf</span></samp>

     <li>Verify the syntax by running cf-promises &ndash; if verification is successful, you will see no output:

     <pre class="smallexample">          root@cfhub #  cf-promises -f /var/cfengine/inputs/test.cf
</pre>
     <li>Execute the policy &ndash; if everything was successful, the string &lsquo;<samp><span class="samp">R: Hello World!</span></samp>&rsquo; will be outputted immediately below the command:

     <pre class="smallexample">          root@cfhub #   cf-agent -f /var/cfengine/inputs/test.cf
          R: Hello world!
</pre>
        </ol>

   <p>Like many languages, CFEngine has a structure which allows
declarations, variables and classes. The body structure is a place to
list constraints and items that control the flow of a policy.  It can
be seen as a template macro (similar to the main() function in c) that
organizes promise attributes.  The bundle structure can be viewed as a
collection of promises under a single name, much like a subroutine in
other languages.

   <p>Looking at the `Hello World' promise syntax, you will notice that it
starts with the following body structure:

<pre class="verbatim">body common control 
{
<span class="red">bundlesequence </span>=> { "test" };
}
</pre>

   <p>In this example, the body common control is used to control promise behavior by calling the bundle agent test, which is a collection of promise attributes:

<pre class="verbatim">bundle agent test  
{
<span class="red">reports:
</span>  cfengine_3::
   "Hello world!";
}
</pre>

   <p>This bundle structure contains a special type of promise known as
reports: , which will automatically output `Hello World' if all
conditions of the promise are kept. Finally, there is the <code>cfengine_3::</code>
class. This class is defined by CFEngine out of the box. When it's
used in a promise, it checks to see that the CFEngine client is
running version 3.

   <p>So, to summarize; the promise that you just wrote and executed checked
that the version of CFEngine you are running is at version 3; and if
it is at version 3, it sent the Hello World string to the command
line.

   <p>Now that you have a better understanding of how the syntax works, we
will go over the method we used to execute the policy. The policy that
you wrote, test.cf was manually executed by the cf-agent binary. Prior
to running the <samp><span class="file">cf-agent</span></samp> command, you checked the promise syntax by
running the <samp><span class="file">cf-promises</span></samp> binary:
<pre class="smallexample">     root@cfhub #  cf-promises -f /var/cfengine/inputs/test.cf
</pre>
   <p>Normally, cf-promises is automatically executed by cf-agent as part of
its run time operations, where, by default, it verifies the
configuration syntax in the <samp><span class="file">promises.cf</span></samp> file. By adding the -f flag
and specifying a file name and path, you directed cf-promises to check
and verify the specified file only: test.cf.  In addition, we chose to
run the policy manually, which is why we invoked cf-agent from the
command line:
<pre class="smallexample">     root@cfhub # cf-agent -f /var/cfengine/inputs/test.cf
</pre>
   <p>As a rule, CFEngine is fully automated and the cf-agent binary is
started by the cf-execd daemon at a user specified interval (defaults
to 5 minutes). Again, in this instance, the agent was manually started
using the -f flag to execute the specified file.

   <p>If you would like to experiment with promise construction and manual
execution, the following link will take you to a web based site
designed for that purpose: Quickstart Promise Editor
 <a href="http://cfengine.com/policy_wizard/">http://cfengine.com/policy_wizard/</a>

<div class="node">
<a name="CFEngine-Client"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Create-and-Manually-Execute-a-Policy">Create and Manually Execute a Policy</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#CFEngine-by-Example">CFEngine by Example</a>

</div>

<h4 class="unnumberedsubsec">CFEngine Client, Server Operations</h4>

<p>In Step 2, we demonstrated how CFEngine operates as a standalone
system. While there may be a few instances where running CFEngine on a
standalone system is ideal; the real power of CFEngine lies in its
ability to perform multiple tasks in a multi-tiered network
environment. To demonstrate the working relationship between a
CFEngine policy server and client, we will set up a client named
cfhost and configure it to pull and execute policies from the cfhub
system, which will be set up as the policy server.  Before we start,
it might be helpful to get a `look' at how CFEngine maintains a
configured state in a networked environment. Note that the revision
control system is optional. You only need to place your policy file
into the <samp><span class="file">/var/cfengine/masterfiles</span></samp> directory, then update the
promises.cf file accordingly.

   <div class="block-image"><img src="qs1.png" alt="qs1.png"></div>

   <p>The objective of this exercise is to check that a file named
<samp><span class="file">cf_test_file</span></samp> exists on both the CFEngine policy server and client. If
it does not exists, we are instructing CFEngine to create
it. Additionally, we are directing CFEngine to ensure that the
permissions are set to 644; that it is owned by root; and the group
ownership is the &lsquo;<samp><span class="samp">sys</span></samp>&rsquo; group.

     <ol type=1 start=1>
<li>Create a second test system and name it cfhost. 
<li>Log on to cfhost; install and configure CFEngine according to the instructions given in Step 1. 
<li>Open a new terminal window and log on to cfhub. 
<li>Find the hostname or IP address of cfhub, here we will assume the address is 172.16.100.134
<li>Designate cfhub as the policy server by bootstrapping it using its own IP address:

     <pre class="smallexample">          root@cfhub# /var/cfengine/bin/cf-agent --bootstrap --policy-server 172.16.100.134
</pre>
     <li>CFEngine will output diagnostic information upon bootstrap. If all is well you should see the following in the output:

     <pre class="smallexample">          -&gt; Bootstrap to 172.16.100.134 completed successfully
</pre>
     <li>Return to cfhost and bootstrap it to the IP address of the policy server cfhub:  172.16.100.134

     <pre class="smallexample">          root@cfhost# /var/cfengine/bin/cf-agent --bootstrap --policy-server 172.16.100.134
</pre>
     <li>Ensure that the bootstrap was successful

     <li>On cfhub, go to the /var/cfengine/masterfiles directory, create a new file and name it cftest1.cf,  then copy the following lines into it:

     <pre class="verbatim">     bundle agent test 
     {   
<span class="red">     files: 
</span>       "/tmp/cf_test_file"   
<span class="red">           comment </span>=><span class="green"> "Promise that a plain file exists with stated permissions",</span>
<span class="red">             perms </span>=><span class="blue"> mog("644", "root", "sys"),</span>
<span class="red">            create </span>=><span class="green"> "true";</span>
     }
</pre>

     <li>Open the /var/cfengine/masterfiles/promises.cf file and locate the body common control
 section:

     <pre class="verbatim">     body common control  
     {
<span class="red">     bundlesequence </span>=> { "main" };
<span class="red">     inputs </span>=> { 
               "cfengine_stdlib.cf", 
               };
<span class="red">     version </span>=><span class="green"> "Community Promises.cf 1.0.0";</span>
     }
</pre>

     <p>Modify this section by adding the new bundle name and input file (in red):

     <pre class="verbatim">     body common control 
     {
<span class="red">     bundlesequence </span>=> { "main","test" };
<span class="red">             inputs </span>=> { 
                       "cfengine_stdlib.cf", 
                       "cftest1.cf",
                       };
<span class="red">            version </span>=><span class="green"> "Community Promises.cf 1.0.0";</span>
     }
</pre>

     <li>Save the /var/cfengine/masterfiles/promises.cf file.

     <li>Return to cfhost and manually start the agent by running:  &lsquo;<samp><span class="samp">/var/cfengine/bin/cf-agent -Kv</span></samp>&rsquo;. The &lsquo;<samp><span class="samp">-K</span></samp>&rsquo; switch will bypass any locks and the &lsquo;<samp><span class="samp">-v</span></samp>&rsquo; switch will allow you to see the actual output.

     <li>After  the agent runs successfully,  check to see if the promise was kept by looking for the <samp><span class="file">/tmp/cf_test_file</span></samp> file on both cfhub and cfhost.
        </ol>

   <p>Additionally, take a look at the <samp><span class="file">/var/cfengine/inputs</span></samp> on cfhost; you
will now see the cftest1.cf file, which was moved from cfhub. You will
also notice that the original promises.cf file has been saved and the
<samp><span class="file">promises.cf</span></samp> file from cfhub is now in its place.

   <p>The exercise above was a simple example utilizing a very
straightforward client/ server setup. CFEngine can scale to fit any
existing environment as illustrated in the image below:

   <div class="block-image"><img src="qs2.png" alt="qs2.png"></div>

   <p>In this example, there are multiple policy distribution servers. Each
policy server acts as a discrete distribution point for policies that
are unique to a specific subset of hosts. Additionally, a CFEngine
Nova Hub acts as a policy distribution point for a number of clients,
including Windows, Mac and Virtual Machines.  The Nova Hub also allows
provides a management and reporting Web interface for all of the
systems that it manages.

   <p>We hope that this document has been a helpful first step in your quest
to unleash the power of CFEngine in your environment! For more
information, please visit the CFEngine Web Site, where you will find a
wealth of documentation; including tips, tricks, tutorial's, manual's,
references, How-To's and cookbooks.

<div class="node">
<a name="Next-steps"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#CFEngine-by-Example">CFEngine by Example</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h3 class="unnumberedsec">Next steps</h3>

<p>We recommend the following reading:

     <ul>
<li>CFEngine Concepts: <a href="http://cfengine.com/manuals/cf3-conceptguide.html">http://cfengine.com/manuals/cf3-conceptguide.html</a>
<li>Get started, first promises: <a href="http://cfengine.com/manuals/cf3-tutorial.html#First-promises">http://cfengine.com/manuals/cf3-tutorial.html#First-promises</a>
</ul>

<p class="noindent">For a complete overview:
     <ul>
<li>Tutorial: <a href="http://cfengine.com/manuals/cf3-tutorial.html">http://cfengine.com/manuals/cf3-tutorial.html</a>
<li>Reference manual: <a href="http://cfengine.com/manuals/cf3-reference.html">http://cfengine.com/manuals/cf3-reference.html</a>
</ul>

<p class="noindent">Links to external resources:
     <ul>
<li>Getting Started with CFEngine 3 by Vertical Sysadmin:<br>
<a href="http://www.verticalsysadmin.com/cfengine/Getting_Started_with_CFEngine_3.pdf">http://www.verticalsysadmin.com/cfengine/Getting_Started_with_CFEngine_3.pdf</a>
<li>CFEngine 3 Beginning Examples:<br>
<a href="http://www.verticalsysadmin.com/cfengine/beginning_examples/">http://www.verticalsysadmin.com/cfengine/beginning_examples/</a><br>
This is, basically, a selection from /usr/local/share/doc/cfengine/ which has over 200 examples. 
<li>"CFEngine 3 Tutorial" by Neil Watson:<br>
<a href="http://watson-wilson.ca/2011/05/cfengine-3-cookbook-begins.html">http://watson-wilson.ca/2011/05/cfengine-3-cookbook-begins.html</a>
</ul>

</body></html>


