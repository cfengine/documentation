<html lang="en">
<head>
<title>CFEngine 3 Nova Owner's Manual</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="CFEngine 3 Nova Owner's Manual">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="top" href="#Top">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
@font-face {
    font-family: 'CFE_FONT';
    src: url('fonts/eot/opensans-regular-webfont.eot');
    src: local('☺'),  url('fonts/ttf/opensans-regular-webfont.ttf') format('truetype'), url('fonts/svg/opensans-regular-webfont.svg') format('svg');
    font-weight: normal;
    font-style: normal;
}    
pre {
    background-color: #EEFFDD;
    border: 1px solid #CCCCCC;
    font-family: courier;
    margin-bottom: 10px;
    margin-top: 10px;
    padding: 5px;
    font-size: 90%;
    }
pre.display { font-family:inherit }
pre.format  { font-family:inherit }
pre.smallexample
pre.smalllisp,
pre.smallformat,
pre.smalldisplay {
  font-size: 90%;
} 

span.sc    { font-variant:small-caps }
span.roman { font-family:serif; font-weight:normal; } 
span.sansserif { font-family:sans-serif; font-weight:normal; } 

body {
    font:  90%  'CFE_FONT', arial, Helvetica,sans-serif; 
    color: #646464;
    padding: 10px 20px;
    width: 960px;
    margin: 0 auto;
}
.node
{
    text-align: right;
    padding: 2px;
    font-size: smaller;
}
.node hr {
    border: 0;
    width: 100%;
    color: #CCC;
    background-color: #CCC;
    height: 5px;
}
.section {
    padding-right: 0px;
    padding-bottom: 0px;
    padding-left: 0px;
}

h1 {
    font-size: 26px;
    font-weight: normal;
    line-height: 32px;
    margin: 32px 0 16px;
    text-align: left;
    text-transform: uppercase;
}

h2 {
    color: #9E9981 !important;
    font-size: 16px;
    line-height: 18px;
    font-weight: normal;
    margin: 16px 0 26px;
    text-align: left;
}
h3 {
    margin-top: 3px;
    margin-right: 0px;
    margin-bottom: 10px;
    margin-left: 0px;
    line-height: 20px;
    font-size: 16px;
    font-weight: normal;
}

.contents
{
    background-color: #CCC;
    padding-top: 2px;
    padding-right: 2px;
    padding-bottom: 2px;
    padding-left: 10px;
}

.index-cp
{  
background: #fff url(index-cp.png) right repeat-y;
}

.index-vr
{  
background: #fff url(index-vr.png) right repeat-y;
}

.index-mb
{  
background: #eee url(index-faq.png) right repeat-y;
}

table.border
{
	border-color: #666;
	border-width: 0px;
}

FONT.liten {font-size: 80%; }
 
.tynn {
    font-family: Arial, Helvetica, sans-serif;
    font-size: smaller;
    font-style: normal;
    font-weight: lighter;
    margin-bottom: 0em;
    font-size: 11pt;
}
.verbatim {
    color: #000;
    margin-top: 0px;
    margin-right: 0px;
    margin-bottom: 20px;
    margin-left: 0px;
}
.example {
    color: #000;
    width: 100%;
    margin-top: 0px;
    margin-right: 0px;
    margin-bottom: 20px;
    margin-left: 0px;
}
.smallexample {
    color: #000;
    padding-top: 10px;
    padding-right: 30px;
    padding-bottom: 5px;
    padding-left: 30px;
    margin-top: 0px;
    margin-right: 0px;
    margin-bottom: 0px;
    margin-left: 0px;
}
.cartouche {
    padding: 5px;
    font-style: italic;
    font-size: 85%;
}

table.cartouche {
    border: none !important;
}

 .cartouche td  {
    background-color: #ddd;
    border: 1px solid #ccc;
    padding: 5px;
}

A:link { color: #2c2e70 }
A:visited { color: black }
A:active { color: #600041 }
dt em {font-weight: bold}
/* don't change this rule */    
pre.sp {
    background: none !important;   
    border:none !important
}
/* --- */
/*code hightlight*/
.red { color: #b80047; font-weight: bold; }

.blue { color: blue;  /*font-weight: bold;*/ }

.green { color: darkgreen; }

.comment { font-style: italic; }
--></style>
</head>
<body>
<h1 class="settitle">CFEngine 3 Nova Owner's Manual</h1>
<div class="node">
<a name="Top"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Introduction">Introduction</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#dir">(dir)</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#dir">(dir)</a>

</div>

<h2 class="unnumbered">CFEngine 3 Nova Owner's Manual</h2>

   <p><a href="#Contents"><h1>COMPLETE TABLE OF CONTENTS</h1></a>
<h2>Summary of contents</h2>

<ul class="menu">
<li><a accesskey="1" href="#Introduction">Introduction</a>
<li><a accesskey="2" href="#Requirements">Requirements</a>
<li><a accesskey="3" href="#Installing-CFEngine-3-Nova">Installing CFEngine 3 Nova</a>
<li><a accesskey="4" href="#Upgrading-CFEngine-Nova">Upgrading CFEngine Nova</a>
<li><a accesskey="5" href="#Mission-Portal">Mission Portal</a>
<li><a accesskey="6" href="#Monitoring-extensions">Monitoring extensions</a>
<li><a accesskey="7" href="#File-Access-Control-Lists">File Access Control Lists</a>
<li><a accesskey="8" href="#Server-extensions">Server extensions</a>
<li><a accesskey="9" href="#Environments-and-workflows">Environments and workflows</a>
<li><a href="#Virtualization">Virtualization</a>
<li><a href="#Content_002dDriven-Policies">Content-Driven Policies</a>
<li><a href="#Windows_002dspecific-features-in-Nova">Windows-specific features in Nova</a>
<li><a href="#Configuration-of-external-authentication">Configuration of external authentication</a>
</ul>

<!-- ***************************************************** -->
<!-- * CHAPTER -->
<!-- ***************************************************** -->
<div class="node">
<a name="Introduction"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Requirements">Requirements</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Top">Top</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">1 Introduction</h2>

<p>CFEngine 3 Nova is a commercially licensed version of the core CFEngine
software<a rel="footnote" href="#fn-1" name="fnd-1"><sup>1</sup></a> with enterprise library extensions. All of
the documentation for CFEngine 3 applies to CFEngine 3 Nova.

   <p>The aim of CFEngine 3 Nova is to offer a knowledge-enhanced framework for configuration man-
agement that goes beyond mere technical configuration to support the needs of businesses. Features
include compliance management, reporting and business integration, and tools for handling necessary
complexity. CFEngine 3 Nova has features to support Cloud Computing for public and private clouds, as
well as greater integration facilities with database resources.

<!-- This document describes installation, features, and first steps in using CFEngine 3 Nova. -->
<!-- ***************************************************** -->
<!-- * CHAPTER -->
<!-- ***************************************************** -->
<div class="node">
<a name="Requirements"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Installing-CFEngine-3-Nova">Installing CFEngine 3 Nova</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Introduction">Introduction</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">2 Requirements</h2>

<ul class="menu">
<li><a accesskey="1" href="#Hardware-requirements">Hardware requirements</a>
<li><a accesskey="2" href="#Operating-system-support">Operating system support</a>
</ul>

<div class="node">
<a name="Hardware-requirements"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Operating-system-support">Operating system support</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Requirements">Requirements</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Requirements">Requirements</a>

</div>

<h3 class="section">2.1 Hardware requirements</h3>

<p>The default CFEngine 3 Nova architecture uses a single hub, or policy server, to publish changes of policy
and to aggregate knowledge about the environment, but you can set up as many as you like to manage
different parts of your organization independently. The CFEngine technology is not centralized by
nature. Most users choose to centralize updating of policy and report aggregation for convenience
however.

   <p>The default architecture and configuration skeleton of CFEngine 3 Nova is expected to scale to a few thousand hosts with a
dedicated policy hub. In such a case, your hub machine should have at least 2 GB of memory and a modern processor. 
For machines under CFEngine’s management (clients), a full installation of CFEngine 3 Nova requires about 20 MB of disk storage. Otherwise disk usage depends on your specific policies, especially those that concern reporting. Each software component (agent) typically uses under 10 MB of memory, but spikes in memory usage can occur if several agents run simultaneously. CFEngine recommends to have 256 MB available memory on the clients.

<!--  -->
<div class="node">
<a name="Operating-system-support"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Hardware-requirements">Hardware requirements</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Requirements">Requirements</a>

</div>

<h3 class="section">2.2 Operating system support</h3>

<p>CFEngine can be made to run on most operating systems. For efficiency
CFEngine only supports a number of recent popular operating systems,
which should be up to date with patches. If we don't have packages for
your particular operating systems we can usually make packages by
special arrangement.

   <p>The hub (policy server) is only available for derivatives of the
top GNU/Linux distributions (Debian, Red Hat, SuSE, Ubuntu), as these make available
software that the hub relies on for data storage and processing. 
Operating system choices for the hub are:

<pre class="example">      Debian 5,6
      Ubuntu 8,10
      RHEL/CentOS 5,6
      SLES/openSuSE   11
</pre>
   <p>Nova provides a version of CFEngine running natively on Windows, with
support for registry management, Windows services and file
security, See <a href="#Windows_002dspecific-features-in-Nova">Windows-specific features in Nova</a>. Support for Solaris zones has been added through
automated zone detection and process model adaptation.

   <p>A working package manager is required on the hub/policy server to install an Apache Web Server, php module, MongoDB, subversion, etc. You should start from a blank system (i.e. with none of these components installed) to avoid potential interference with the installation process. No special software is otherwise required on machines in your network, CFEngine bundles all critical dependencies in the Nova package.

<!-- ***************************************************** -->
<!-- * CHAPTER -->
<!-- ***************************************************** -->
<div class="node">
<a name="Installing-CFEngine-3-Nova"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Upgrading-CFEngine-Nova">Upgrading CFEngine Nova</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Requirements">Requirements</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">3 Installing CFEngine 3 Nova</h2>

<ul class="menu">
<li><a accesskey="1" href="#Installation-procedure">Installation procedure</a>
<li><a accesskey="2" href="#Troubleshooting">Troubleshooting</a>
<li><a accesskey="3" href="#Frequently-Asked-Questions">Frequently Asked Questions</a>
</ul>

<div class="node">
<a name="Installation-procedure"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Troubleshooting">Troubleshooting</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Installing-CFEngine-3-Nova">Installing CFEngine 3 Nova</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Installing-CFEngine-3-Nova">Installing CFEngine 3 Nova</a>

</div>

<h3 class="section">3.1 Installation procedure</h3>

<p>CFEngine 3 Nova is designed to be simple to install in its default configuration. The installation
process has three phases:

     <ul>
<li>Unpacking the software. 
<li>Obtaining a license. 
<li>Adapting policy. 
</ul>

   <p>You should start from a blank system See <a href="#Hardware-requirements">Hardware requirements</a>. If you have been using CFEngine Community Edition and you have
already developed a policy, set aside this policy during the installation process. You will be able
to integrate it back later.

   <p>Nova is provided in two packages, <samp><span class="file">cfengine-nova</span></samp> and <samp><span class="file">cfengine-nova-expansion</span></samp>. The main software package
must be installed on every host (including the hub). The expansion package is only installed on the policy hub. You should install and set up the hub first.

   <p>References to package managers assume that additional packages might need to be installed on the hub (policy server). Root privilege is required for the installation.

     <ol type=1 start=1>
<li>Verify that the machine's network connection is working and that port 5308 is open for both incoming and outgoing connections (to assure communication between the hub and clients). On the hub, verify that package managers <code>yum</code>,
<code>zypper</code> or <code>apt-get</code> are working. They will be used to
install a web server, database, php server and subversion. If you are not able to set up a package manager and
repository on the hub, please See <a href="#Frequently-Asked-Questions">Frequently Asked Questions</a>, for manual installation.

     <li>Copy the Nova packages to the system. On the hub (policy server):
     <pre class="example">          cfengine-nova_2.1.<var>xxx.[rpm|deb]</var>
          cfengine-nova-expansion_2.1.<var>xxx.[rpm|deb]</var>
</pre>
     <p class="noindent">On all other machines:
     <pre class="example">          cfengine-nova_2.1.<var>xxx.[rpm|deb]</var>
</pre>
     <li>Unpack the software:
          <dl>
<dt><i>Red Hat family</i><dd>
          <pre class="example">               host# rpm -ihv <var>packages</var>
</pre>
          <br><dt><i>SUSE family</i><dd>
          <pre class="example">               host# rpm -ihv <var>packages</var>
</pre>
          <br><dt><i>Debian family</i><dd>
          <pre class="example">               host# dpkg --install  <var>packages</var>
</pre>
          </dl>

     <li>On the hub, a public key has now been created in <samp><span class="file">/var/cfengine/ppkeys/localhost.pub</span></samp> as part of the
package installation. You should send this public key to CFEngine Support<a rel="footnote" href="#fn-2" name="fnd-2"><sup>2</sup></a> as an attachment in the ticket system,
to obtain a license file <samp><span class="file">license.dat</span></samp>.

     <p><table class="cartouche" summary="cartouche" border="1"><tr><td>
Save the returned license file to <samp><span class="file">/var/cfengine/masterfiles/license.dat</span></samp>
on the hub before continuing. 
</td></tr></table>

     <p>See more details for the software licensing here;
<a href="https://cfengine.com/software/Licensing.pdf">https://cfengine.com/software/Licensing.pdf</a>

     <li>The remaining steps apply to all hosts, but you should install the hub or policy server first. For large systems (&gt; 1000 hosts) we recommend increasing the memory limit in php.ini on the hub (for instance to 128 MB).

     <p>Find the hostname or IP address of the hub (policy server), here we assume &lsquo;<samp><span class="samp">123.456.789.123</span></samp>&rsquo; is the address. 
<pre class="verbatim">      hub # /var/cfengine/bin/cf-agent --bootstrap --policy-server 123.456.789.123
</pre>
Use the same command on all hosts, i.e. *** do not bootstrap the policy server with a localhost address ***
If you mistype the address of the hub, we recommend doing the following steps to re-boostrap. 
<pre class="verbatim">      hub # /var/cfengine/bin/cf-agent --bootstrap --policy-server 123.456.789.124
      hub # killall cf-execd cf-serverd cf-monitord cf-hub
      hub # rm -rf /var/cfengine/inputs/*
      hub # rm -f /var/cfengine/policy_server.dat
      hub # /var/cfengine/bin/cf-agent --bootstrap --policy-server 123.456.789.123
</pre>

     <p>CFEngine will output diagnostic information upon bootstrap (written to command line and syslog; cf-agent will also return a value: ERROR: 1, SUCCESS: 0). Error messages will be displayed if bootstrapping failed, pursue these to get an indication of what went wrong and correct accordingly. If all is well you should see the following in the output:

     <pre class="verbatim">     
     -> Bootstrap to 123.456.789.123 completed successfully
     
</pre>

     <li>CFEngine should now be up and running on your system. It will copy its default policy files into <samp><span class="file">masterfiles</span></samp> on the hub (policy server) provided that the directory is empty (fresh install). When the clients are bootstrapped, they will contact the hub and copy them to their <samp><span class="file">inputs</span></samp> directory.

     <li>To complete licensing setup, you should make a promise to accept the license
terms by editing <samp><span class="file">/var/cfengine/masterfiles/promises.cf</span></samp>
on the hub (policy server), changing the line &lsquo;<samp><span class="samp">host_licenses_paid =&gt; "&lt;NUMBER&gt;";</span></samp>&rsquo;
in &lsquo;<samp><span class="samp">body common control</span></samp>&rsquo; to reflect the correct number of licenses that you have subscribed to.

        </ol>

<p class="noindent"><b>How to assess success in this procedure:</b>

     <ol type=1 start=1>

     <li>Look at the process list on the systems with &lsquo;<samp><span class="samp">ps waux | grep cf-</span></samp>&rsquo;. 
You should be able to see <code>cf-execd</code> running, and eventually other processes from
the CFEngine suite like <code>cf-monitord</code> <code>cf-serverd</code>. On the hub, you should
also eventually see <code>cf-hub</code>. Note that it may take 5&ndash;10 minutes before all the
processes get started.

     <li>Look for files in <samp><span class="file">/var/cfengine/inputs</span></samp> (Unix)
or <samp><span class="file">C:\Program Files\Cfengine\inputs</span></samp> (Windows). The license
file will be copied out from the policy server to the clients as part
of the normal distribution of policy. Each machine should get a
copy of the <samp><span class="file">license.dat</span></samp> file in <samp><span class="file">/var/cfengine/inputs</span></samp>
(Unix) or <samp><span class="file">C:\Program Files\Cfengine\inputs</span></samp> (Windows).

     <li>On the hub, the file <samp><span class="file">/var/cfengine/promise_knowledge.cf</span></samp> should have been
created, and should contain data.

     <li>Finally, try to connect to the web server at port 80 on the hub/policy host (for example at http://123.456.789.123). 
You should see a login page like the one shown in the figure below:

     <pre class="sp">
     
     </pre>
     <div align="center"><img src="img-login.png" alt="Mission Portal login"></div>
     <div align="center">Figure: Mission Portal login screen</div>
     <pre class="sp">
     
     </pre>
     
     Default user name and password is 'admin' and 'admin' (make sure to change this at first login to prevent unauthorized access; but see also Appendix A on configuration of LDAP).
        </ol>

   <p>Note that some of the displays in the Mission Portal may be blank when you log in just after installation; some reports and graphs are only updated every six hours. It may also take some time for the system to fully converge, do not get troubled if initially there are some promises repaired or not kept.

<!--  -->
<div class="node">
<a name="Troubleshooting"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Frequently-Asked-Questions">Frequently Asked Questions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Installation-procedure">Installation procedure</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Installing-CFEngine-3-Nova">Installing CFEngine 3 Nova</a>

</div>

<h3 class="section">3.2 Troubleshooting</h3>

<ul class="menu">
<li><a accesskey="1" href="#Apache-HTTP-error_005flog-is-your-friend">Apache HTTP error_log is your friend</a>
<li><a accesskey="2" href="#Some-report-pages-return-HTTP-error-404">Some report pages return HTTP error 404</a>
<li><a accesskey="3" href="#First-time-login-to-Mission-Portal-fails">First time login to Mission Portal fails</a>
<li><a accesskey="4" href="#Cannot-send-emails-from-the-Mission-Portal">Cannot send emails from the Mission Portal</a>
<li><a accesskey="5" href="#Warning-messages-on-web-pages-in-SLES_002fOpenSuSE-Hub">Warning messages on web pages in SLES/OpenSuSE Hub</a>
<li><a accesskey="6" href="#Knowledge-map-remains-unpopulated">Knowledge map remains unpopulated</a>
</ul>

<div class="node">
<a name="Apache-HTTP-error_log-is-your-friend"></a>
<a name="Apache-HTTP-error_005flog-is-your-friend"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Some-report-pages-return-HTTP-error-404">Some report pages return HTTP error 404</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Troubleshooting">Troubleshooting</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Troubleshooting">Troubleshooting</a>

</div>

<h4 class="subsection">3.2.1 Apache HTTP error_log is your friend</h4>

<p>The first place to diagnose (if all CFEngine processes and mongod are up and running) is:<br>
<i>RHEL 5,6 / CentOS 5</i>
<pre class="verbatim">   /var/log/httpd/error_log
</pre>
<i>SLES 11 / OpenSuSE 11 / Debian 5,6 / Ubuntu 8,10</i>
<pre class="verbatim">   /var/log/apache2/error_log
</pre>

<p class="noindent">This log file will often provide useful information on which components are not operating properly.

<div class="node">
<a name="Some-report-pages-return-HTTP-error-404"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#First-time-login-to-Mission-Portal-fails">First time login to Mission Portal fails</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Apache-HTTP-error_005flog-is-your-friend">Apache HTTP error_log is your friend</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Troubleshooting">Troubleshooting</a>

</div>

<h4 class="subsection">3.2.2 Some report pages return HTTP error 404</h4>

<p>Confirm that Apache REWRITE module is ON. Restarting httpd/apache2 service is required if rewrite was disabled.

<div class="node">
<a name="First-time-login-to-Mission-Portal-fails"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Cannot-send-emails-from-the-Mission-Portal">Cannot send emails from the Mission Portal</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Some-report-pages-return-HTTP-error-404">Some report pages return HTTP error 404</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Troubleshooting">Troubleshooting</a>

</div>

<h4 class="subsection">3.2.3 First time login to Mission Portal fails</h4>

<p>MongoDB needs to be initialized for authentication of the default user. Run the following command:
<i>RHEL 5,6 / CentOS 5</i>
<pre class="verbatim">   $ /var/cfengine/bin/mongorestore -d phpcfengine /var/www/html/phpcfenginenova
</pre>
<i>SLES 11 / OpenSuSE 11</i>
<pre class="verbatim">   $ /var/cfengine/bin/mongorestore -d phpcfengine /srv/www/htdocs/phpcfenginenova
</pre>
<i>Debian 5,6 / Ubuntu 8,10</i>
<pre class="verbatim">   $ /var/cfengine/bin/mongorestore -d phpcfengine /var/www/phpcfenginenova
</pre>

<p class="noindent">Default user name and password is 'admin' and 'admin'.

<div class="node">
<a name="Cannot-send-emails-from-the-Mission-Portal"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Warning-messages-on-web-pages-in-SLES_002fOpenSuSE-Hub">Warning messages on web pages in SLES/OpenSuSE Hub</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#First-time-login-to-Mission-Portal-fails">First time login to Mission Portal fails</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Troubleshooting">Troubleshooting</a>

</div>

<h4 class="subsection">3.2.4 Cannot send emails from the Mission Portal</h4>

<p>The default email address used by the system is "admin@cfengine.com". To change this, edit <samp><span class="file">application/config/ion_auth.php</span></samp> at the line containing:
<pre class="verbatim">   $config['admin_email'] = "admin@cfengine.com";
</pre>

<div class="node">
<a name="Warning-messages-on-web-pages-in-SLES%2fOpenSuSE-Hub"></a>
<a name="Warning-messages-on-web-pages-in-SLES_002fOpenSuSE-Hub"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Knowledge-map-remains-unpopulated">Knowledge map remains unpopulated</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Cannot-send-emails-from-the-Mission-Portal">Cannot send emails from the Mission Portal</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Troubleshooting">Troubleshooting</a>

</div>

<h4 class="subsection">3.2.5 Warning messages on web pages in SLES/OpenSuSE Hub</h4>

<p>Warnings appear because the default environment is set to "Development" and in this context the Mission Portal will show all php errors to the user. Set the environment to "Production" to silence these warnings, they will still be logged in Apache Error_log. To edit the default environment, visit "index.php" in your default web root directory and change the following line to suit your needs:
<pre class="verbatim">   define('ENVIRONMENT', 'Development');
</pre>

<div class="node">
<a name="Knowledge-map-remains-unpopulated"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Warning-messages-on-web-pages-in-SLES_002fOpenSuSE-Hub">Warning messages on web pages in SLES/OpenSuSE Hub</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Troubleshooting">Troubleshooting</a>

</div>

<h4 class="subsection">3.2.6 Knowledge map remains unpopulated</h4>

<p>Try building the Knowledge map manually:<br>
   <i>RHEL 5 / CentOS 5</i>
<pre class="verbatim">   $ /var/cfengine/bin/cf-promises -r &amp;&amp; /var/cfengine/bin/cf-know -f 
       /var/www/html/docs/enterprise_build.cf -b
</pre>
   <i>SLES 11 / OpenSuSE 11</i>
<pre class="verbatim">   $ /var/cfengine/bin/cf-promises -r &amp;&amp; /var/cfengine/bin/cf-know -f 
       /srv/www/htdocs/docs/enterprise_build.cf -b
</pre>
   <i>Debian 5,6 / Ubuntu 8,10</i>
<pre class="verbatim">   $ /var/cfengine/bin/cf-promises -r &amp;&amp; /var/cfengine/bin/cf-know -f 
       /srv/www/htdocs/docs/enterprise_build.cf -b
</pre>

<!--  -->
<div class="node">
<a name="Frequently-Asked-Questions"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Troubleshooting">Troubleshooting</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Installing-CFEngine-3-Nova">Installing CFEngine 3 Nova</a>

</div>

<h3 class="section">3.3 Frequently Asked Questions</h3>

<!-- @menu -->
<!-- * How do I install the prerequisites for the hub manually?:: -->
<!-- @end menu -->
<!-- @node How do I install the prerequisites for the hub manually?,  , Frequently Asked Questions, Frequently Asked Questions -->
<h4 class="subsection">3.3.1 How do I install the prerequisites for the hub manually?</h4>

<p>See INSTALLATION.TXT (can be found on the CFEngine software download page: <a href="https://cfengine.com/software/">https://cfengine.com/software/</a>) for a list of dependencies for the hub.

   <p>To install the packages you might want to use <code>yum</code> on Red Hat/CentOS/Fedora,
<code>zypper</code> on SUSE or <code>apt</code> on Debian/Ubuntu.

<!--  -->
<h4 class="subsection">3.3.2 Why do I get a promise failed with the message <code>Can't stat</h4>

<p>/var/cfengine/master_software_updates/SOME-OS</code> on some hosts?

   <p>There is a built-in promise to automatically upgrade the Nova
binaries. By default, the clients will check for an update package
every time Nova runs. So if the clients find that there is no source
directory to download the files from, the message will be displayed.

   <p>To fix the problem, simply create an empty directory mentioned in the
message on the hub.
<pre class="verbatim"> hub # mkdir /var/cfengine/master_software_updates/SOME-OS
</pre>

<!--  -->
<h4 class="subsection">3.3.3 I did bootstrap the hub <em>before</em> obtaining a license file, what should I do?</h4>

<p>Four steps need to be followed to correct this minor issue.
     <ol type=1 start=1>
<li>obtain a working license file and copy it to <samp><span class="file">/var/cfengine/masterfiles</span></samp>
<pre class="verbatim">      hub # cp /tmp/license.dat /var/cfengine/masterfiles
</pre>
<li>killall Nova running processes
<pre class="verbatim">      hub # killall cf-execd cf-serverd cf-monitord cf-hub
</pre>
<li>wipe out <samp><span class="file">/var/cfengine/inputs </span></samp>
<pre class="verbatim">      hub # rm -rf /var/cfengine/inputs
</pre>
<li>bootstrap the policy hub
<pre class="verbatim">      hub # /var/cfengine/bin/cf-agent --bootstrap --policy-server 123.456.789.123
</pre>
        </ol>

<!--  -->
<h4 class="subsection">3.3.4 On my hub, I get messages of connection failures to a database. For example, in <code>messages</code>, I can see something like <code>!! Could not open connection to report database for saving</code>. What should I do?, How do I upgrade from CFEngine Community 3 to CFEngine 3 Nova?,</h4>

<p>This message comes from the <code>cf-hub</code> process. It is responsible
for pulling reports from hosts that have contacted the hub to get
policy updates. When these reports are fetched, they are stored in a local MongoDB database on the hub. This message is produced when there is a failure in the connection to the database.

   <p>Probably, the issue is that the database server is not running on your
hub. Run the <code>ps</code>-command to check this.
<pre class="verbatim"> hub # ps -e | grep mongod
</pre>

   <p>If the <code>mongod</code> process <em>is</em> running, it must be
misconfigured or in some bad state. Please look at the newest entry in
<samp><span class="file">/var/log/mongod.log</span></samp> to diagnose the problem, and contact
CFEngine Technical Support if necessary.

   <p>If the <code>mongod</code> process <em>is not</em> running, please follow the
steps below.

     <ol type=1 start=1>
<li>Run
  hub # <code>/var/cfengine/bin/cf-twin -Kvf failsafe.cf &gt; /tmp/cfout</code>
<li>Check again if the <code>mongod</code> is running, if so, the problem
is probably fixed now. 
<li>If <code>mongod</code> is still not running, please search the output
file for lines starting as follows.

     <pre class="verbatim">     ...
     nova>  -> Making a one-time restart promise for mongod
     ...
     ...
     nova>  -> Executing '/var/cfengine/bin/mongod....
     nova>  -> Backgrounding job /var/cfengine/bin/mongod...
     nova>  -> Completed execution of /var/cfengine/bin/mongod...
     ...
</pre>

     <p>If you don't see the first line above, Nova does not try to start
<code>mongod</code> &mdash; so check if you bootstrapped your hub correctly. If
you see all lines, it means that Nova starts <code>mongod</code>, but the process just
terminates immediately after. If so, continue to the next step.

     <li>Look at the newest entry in <samp><span class="file">/var/log/mongod.log</span></samp>. It
should give you more details of why the <code>mongod</code> process refuses
to start. The two most common scenarios are described next.

     <li>If <code>mongod</code> has been terminated unexpectedly, it might have
left a lock-file behind that stops it from starting again. Try
deleting <samp><span class="file">/var/cfengine/state/mongod.lock</span></samp> if it exists.

     <li>If the database is corrupted, you can have <samp><span class="file">mongod</span></samp> create a new one by moving
<samp><span class="file">/var/cfengine/state/cf-report.*</span></samp> out of the way. There are also
tools and documentation for repairing a database at
<a href="http://www.mongodb.org/">http://www.mongodb.org/</a>.

     <p>Note that almost all of the <code>cfreport</code> database is recreated with data collected from clients. This happens every 5 minutes or 6 hours (depending on the probe), you may consider whether deleting the database is an acceptable solution. CFEngine AS or CFEngine Inc can not be held responsible for data loss in this respect.
        </ol>

<!--  -->
<h4 class="subsection">3.3.5 How do I upgrade from CFEngine Community 3 to CFEngine 3 Nova?</h4>

<p>CFEngine 3 Nova comes with policies that are specific to Nova functionality, we therefore urge you to set aside your
current community policy. Install CFEngine 3 Nova, set up the Nova hub by
following this document, and then integrate your existing
policy to the hub manually, in small testable steps.

   <p>CFEngine 3 Nova is compatible with the Community Edition of CFEngine 3, but
some process files are now managed by CFEngine 3 Nova for user convenience.

<!-- ***************************************************** -->
<!-- * CHAPTER -->
<!-- ***************************************************** -->
<div class="node">
<a name="Upgrading-CFEngine-Nova"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Mission-Portal">Mission Portal</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Installing-CFEngine-3-Nova">Installing CFEngine 3 Nova</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">4 Upgrading CFEngine Nova</h2>

<p>When upgrading the software from an earlier version, you should
upgrade the hub (policy server) machine first. Any other hosts
in your network that act as servers for encrypted copy operations
would preferably be upgraded next. This is because a stronger form of
encryption-hash is used in newer versions, which the older servers
cannot understand.

   <p>CFEngine packages its software in operating system compatible package
formats (RPM, DEB, PKG, MSI, etc). New packages are made available on the
cfengine.com website; these can be downloaded and installed
in the standard way.

     <ol type=1 start=1>
<li>Go to <a href="https://cfengine.com/software">https://cfengine.com/software</a> (login required)
<li>Download the particular package for your operating systems
        </ol>

<!--  -->
<ul class="menu">
<li><a accesskey="1" href="#Upgrade-procedure">Upgrade procedure</a>
<li><a accesskey="2" href="#How-can-I-do-phased-deployment_003f">How can I do phased deployment?</a>
<li><a accesskey="3" href="#What-if-I-have-multiple-operating-system-platforms_003f">What if I have multiple operating system platforms?</a>
<li><a accesskey="4" href="#How-do-Nova-policies-update-if-I-already-have-my-own-policy_003f">How do Nova policies update if I already have my own policy?</a>
</ul>

<div class="node">
<a name="Upgrade-procedure"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#How-can-I-do-phased-deployment_003f">How can I do phased deployment?</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Upgrading-CFEngine-Nova">Upgrading CFEngine Nova</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Upgrading-CFEngine-Nova">Upgrading CFEngine Nova</a>

</div>

<h3 class="section">4.1 Upgrade procedure</h3>

<p>The following is a general procedure to upgrade to CFEngine 3 Nova from earlier versions. It is assumed that the packages are placed in the <samp><span class="file">/tmp</span></samp> directory. To upgrade, start with the hub (policy server):

     <ol type=1 start=1>
<li>Stop all CFE processes
<pre class="verbatim">        $ /etc/init.d/cfengine3 stop
     or
        $ for i in cf-execd cf-serverd cf-monitord cf-hub mongod; do pkill $i; done
</pre>

     <li>Upgrade cfengine-nova and cfengine-nova-expansion <br>
[RedHat/CentOS/SUSE]
<pre class="verbatim">        $ rpm -Uvh /tmp/cfengine-nova-2.1.0-5.x86_64.rpm /tmp/cfengine-nova-
        expansion-2.1.0-5.x86_64.rpm
</pre>
[Debian/Ubuntu]
<pre class="verbatim">        $ dpkg --install /tmp/cfengine-nova_2.1.0-5_x86_64.deb /tmp/cfengine-nova-
        expansion_2.1.0-5_x86_64.deb
</pre>

     <li>Nova's dependencies have changed so we have to correct cf-twin (libgd and libmysqlclient were removed)
<pre class="verbatim">        $ cp /var/cfengine/bin/cf-agent /var/cfengine/bin/cf-twin
</pre>

     <li>Remove database lock if present
<pre class="verbatim">        $ rm /var/cfengine/state/mongod.lock
</pre>

     <li>Copy the new CFEngine policy files to $(sys.workdir)/masterfiles. The files with a prefix "CFE_" will be handled by CFEngine, do not make changes to these. They are mostly renamed versions of old files (cfengine.cf, knowledge.cf, etc) where some promises have been added to ensure that the Mission Portal will work properly. 
<pre class="verbatim">        $ cd /var/cfengine/master_software_updates/NovaBase
        $ cp CFE_cfengine.cf CFE_knowledge.cf CFE_hub_specific.cf 
        company_knowledge.cf cfengine_stdlib.cf /var/cfengine/masterfiles
</pre>
Comments:
          <ul>
<li>CFE_cfengine.cf
    - contains
<pre class="verbatim">                     bundle agent cfengine_management{}
     </pre>
      and agent bundles for all Nova hosts. 
<li>CFE_knowledge.cf
    - mostly Nova Knowledge Map setup
<li>CFE_hub_specific.cf
    - all necessary bundles to build the Nova HUB (policy server) is in this file
<li>company_knowledge.cf
    - a custom Knowledge Map configuration. You may add any information you'd like to incorporate your company knowledge into the Nova Knowledge Map
<li>cfengine_stdlib.cf
    - the latest standard CFEngine bodies and bundles
</ul>

     <li>Modify contents in promises.cf
          <ul>
<li>Correct input files in
<pre class="verbatim">             "inputs => {}";
     </pre>
               <ul>
<li>Change cfengine.cf to CFE_cfengine.cf
<li>Change knowledge.cf to CFE_knowledge.cf
<li>Add CFE_hub_specific.cf
<pre class="verbatim">                  inputs => {
                             "CFE_cfengine.cf",
                             "CFE_hub_specific.cf",
                             "CFE_knowledge.cf",
                             "update.cf",
                             "cfengine_stdlib.cf",
                             "environment_$(environments.active)/promises.cf",
                            };
          </pre>
</ul>

          <li>Add "commercial_customer" class to
<pre class="verbatim">          "bundle common def{}"
          
          
<span class="red">             classes:
</span>              "commercial_customer"<span class="red"> or </span>=> { "nova_edition", "constellation_edition" },
<span class="red">                             comment </span>=><span class="green"> "Define a global class for CFE Nova and Constellation",</span>
<span class="red">                              handle </span>=><span class="green"> "common_def_classes_commercial_customer";</span>
     </pre>

          <li>Delete the whole
<pre class="verbatim">             bundle agent cfengine_management{}
     </pre>
(It was moved to CFE_hub_specific.cf)

          <li>Add <code>"track_value"</code> to <code>"body agent control</code>"
<pre class="verbatim">             any:
<span class="red">              track_value </span>=><span class="green"> "true";</span>
     </pre>
</ul>

     <li>Tidy up $(sys.doc_root) directory<br>
[Debian/Ubuntu]
<pre class="verbatim">        $ rm -rf /var/www/*
</pre>
[RHEL/CentOS]
<pre class="verbatim">        $ rm -rf /var/www/html/*
</pre>
[SLES/openSUSE]
<pre class="verbatim">        $ rm -rf /srv/www/htdocs/*
</pre>

     <li>Restart CFEngine processes
<pre class="verbatim">        $ /etc/init.d/cfengine3 start
     or
        $ /var/cfengine/bin/cf-execd
</pre>

     <li>You will need to re-initialize the MongoDB if you have trouble logging in after upgrade, see See <a href="#First-time-login-to-Mission-Portal-fails">First time login to Mission Portal fails</a>.
        </ol>

   <pre class="sp">

</pre>
For client upgrades there are 2 approaches: manual or automatic upgrade.
     <ol type=1 start=1>
<li>Manual: Update cfengine-nova on each client by <code>rpm</code> or <code>dpkg</code> command. Update cf-twin as described in step 3 in the update procedure for the hub (i.e. overwrite the old cf-twin). 
<li>Automatic: On the hub, copy the architecture specific cfengine-nova packages to their distribution directories in <samp><span class="file">/var/cfengine/master_software_updates</span></samp> (i.e. put the files in the respective architecture subdirectories) and CFEngine 3 Nova will take care of the rest.
        </ol>

<!--  -->
<div class="node">
<a name="How-can-I-do-phased-deployment%3f"></a>
<a name="How-can-I-do-phased-deployment_003f"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#What-if-I-have-multiple-operating-system-platforms_003f">What if I have multiple operating system platforms?</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Upgrade-procedure">Upgrade procedure</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Upgrading-CFEngine-Nova">Upgrading CFEngine Nova</a>

</div>

<h3 class="section">4.2 How can I do phased deployment?</h3>

<p>Using CFEngine classes to select a subset of machines, you can deploy of updates on a small
number of test systems first.

<!--  -->
<div class="node">
<a name="What-if-I-have-multiple-operating-system-platforms%3f"></a>
<a name="What-if-I-have-multiple-operating-system-platforms_003f"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#How-do-Nova-policies-update-if-I-already-have-my-own-policy_003f">How do Nova policies update if I already have my own policy?</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#How-can-I-do-phased-deployment_003f">How can I do phased deployment?</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Upgrading-CFEngine-Nova">Upgrading CFEngine Nova</a>

</div>

<h3 class="section">4.3 What if I have multiple operating system platforms?</h3>

<p>As of version 1.1 of CFEngine Nova, CFEngine will look for updates in an operating specific
location on the policy server. To update a particular operating system, you only need to place
its package in the correct subdirectory and the client host will know where to look.

<!--  -->
<div class="node">
<a name="How-do-Nova-policies-update-if-I-already-have-my-own-policy%3f"></a>
<a name="How-do-Nova-policies-update-if-I-already-have-my-own-policy_003f"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#What-if-I-have-multiple-operating-system-platforms_003f">What if I have multiple operating system platforms?</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Upgrading-CFEngine-Nova">Upgrading CFEngine Nova</a>

</div>

<h3 class="section">4.4 How do Nova policies update if I already have my own policy?</h3>

<p>New CFEngine package updates will not overwrite your existing policy. That means that they
will also not improve your current updating arrangement without your approval.

   <p><table class="cartouche" summary="cartouche" border="1"><tr><td>
If you want to make use of CFEngine’s enhancements to standard policy files like
‘update.cf’, you need to examine and integrate these changes to your policy server manually. 
Update the software before updating policy, as new policy might require new features in
the software. 
</td></tr></table>

   <p>If you require assistance upgrading, contact CFEngine Support.

<!-- ***************************************************** -->
<!-- * CHAPTER -->
<!-- ***************************************************** -->
<div class="node">
<a name="Mission-Portal"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Monitoring-extensions">Monitoring extensions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Upgrading-CFEngine-Nova">Upgrading CFEngine Nova</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">5 Mission Portal</h2>

<ul class="menu">
<li><a accesskey="1" href="#Mission-Portal-Rooms">Mission Portal Rooms</a>
<li><a accesskey="2" href="#Finders">Finders</a>
<li><a accesskey="3" href="#Viewers">Viewers</a>
<li><a accesskey="4" href="#Editors">Editors</a>
<li><a accesskey="5" href="#Mission-Portal-Administration">Mission Portal Administration</a>
</ul>

<p>The Mission Portal is the centerpiece
of user interaction with CFEngine 3 Nova. It can be accessed by connecting to the hub (policy server) with your web browser (for example at http://123.456.789.123; default port 80). From here you can get a complete overview of operations and performance, business and compliance, organizational knowledge and library.

   <div class="block-image"><img src="img-missionportal.png" alt="Mission Portal"></div>
<div align="center">Figure: The mission portal</div>

<!-- *****COPY BELOW FROM cf3-nova-mission-portal.texinfo******* -->
<div class="node">
<a name="Mission-Portal-Rooms"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Finders">Finders</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Mission-Portal">Mission Portal</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Mission-Portal">Mission Portal</a>

</div>

<h3 class="section">5.1 Mission Portal Rooms</h3>

<ul class="menu">
<li><a accesskey="1" href="#Mission-Status">Mission Status</a>
<li><a accesskey="2" href="#Mission-Engineering">Mission Engineering</a>
<li><a accesskey="3" href="#Mission-Planning">Mission Planning</a>
<li><a accesskey="4" href="#Mission-Library">Mission Library</a>
</ul>

<p>There are four main rooms in the Mission Portal that offer insight into different aspects of operations:

     <ul>
<li>Mission status: a top level overview of compliance status and business value
<li>Mission engineering: a place to see the current state of system repair
<li>Mission planning: a place to plan and make policy changes
<li>Mission library: a knowledge bank that connects information together
</ul>

   <p>Each of these rooms is a beginning from which you can refine your overview and search
through information.

<div class="node">
<a name="Mission-Status"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Mission-Engineering">Mission Engineering</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Mission-Portal-Rooms">Mission Portal Rooms</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Mission-Portal-Rooms">Mission Portal Rooms</a>

</div>

<h4 class="subsection">5.1.1 Mission Status</h4>

<p>Mission status is a high level summary of how well the entire system is behaving.

   <pre class="sp">

</pre>
<img src="img-status.png" alt="Mission Status">
<div align="center">Figure: The status of IT operations.</div>
<pre class="sp">

</pre>

Business Value and Host Status:
The two pie charts show the business value of the promises kept/not kept and well as host status, respectively. Business value is associated with the value of promises as defined in policy files. In the Host Status chart, each host represents a slice of the pie and is classified into red, yellow, green and blue according to the level of their compliance. A host is red if less than 80% of its promises are kept, yellow if 20% or more of its promises were repaired and host is now compliant, green if more than 80% of its promises are kept, and blue if there is no contact between the hub and the client host (unreachable).

   <p>Compliance Summary:
The row of bar meters shows the compliance (average percentage of promises kept, repaired or not kept) of all registered hosts <a rel="footnote" href="#fn-3" name="fnd-3"><sup>3</sup></a> in blocks of 6 hours for the past week. It summarizes performance and anomalous behavior in a simple red (promises not kept), yellow (promises repaired) and green (promises kept) scale. Click on a bar to see which promises were kept/not kept.

   <p>Services/Goals:
A summary of Mission goals (as defined in user policy files; these examples are from <samp><span class="file">company_knowledge.cf</span></samp>). Edit the file in the policy editor (Planning room -&gt; repository), or edit the file in your own text editor, to change these goals.

<div class="node">
<a name="Mission-Engineering"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Mission-Planning">Mission Planning</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Mission-Status">Mission Status</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Mission-Portal-Rooms">Mission Portal Rooms</a>

</div>

<h4 class="subsection">5.1.2 Mission Engineering</h4>

<p>Mission engineering illustrates the state of the system in relation to the desired state at all scales. Zoom in to specific areas and examine the impact of promises, query data, and extract reports.

   <pre class="sp">

</pre>
<img src="img-engineering.png" alt="Mission Engineering">
<div align="center">Figure: Mission Engineering</div>
<pre class="sp">

</pre>

<b>Host Status:</b>
     <ul>
<li>The hosts are classified into red, yellow, green and blue according to the status of their compliance. A host is red if less than 80% of its promises are kept (&gt; 20% not compliant), yellow if 20% or more of its promises were repaired and host is now compliant (&gt; 20% repaired, now compliant), green if more than 80% of its promises are kept (&gt; 80% compliant), and blue if there is no contact between the hub and the client (host unreachable). Clicking a link produces a list of the hosts in that category:

     <pre class="sp">
     
     </pre>
     <div align="center"><img src="img-complianthosts.png" alt="Compliant hosts"></div>
     <div align="center">Figure: Compliant hosts</div>
     <pre class="sp">
     
     </pre>
     
The list presents the name of hosts and three action icons:
          <ul>
<li>Yellow warning triangle: View the promises not kept on this host
<li>Pulse line: View vitals signs (statistics) on this host
<li>Red X: Delete this host (host will be deleted from database, but may re-appear if CFEngine is still running on it; see footnote below).<a rel="footnote" href="#fn-4" name="fnd-4"><sup>4</sup></a>
</ul>

     <li>Worst available host rank: Display the weakest hosts (that have been in contact with the hub) over the last hour. 
<li>Hub replication status: Display status of redundant monitoring hubs (if activated). 
</ul>

   <pre class="sp">

</pre>
<b>Promise compliance summary for reachable hosts:</b> <br>
The row of bar meters shows the compliance (average percentage of promises kept, repaired or not kept) of all registered hosts over the past week, the past day and the past hour. It summarizes performance
and anomalous behavior in a simple red (promises not kept), yellow (promises repaired), and green (promises kept) scale. The "Chng" bar relates to the amount of changes made to files monitored by a CFEngine policy in the last hour (change watch). It is green if no changes have been made. The level of yellow increases as changes occur (but it will never be red).  For the "Seen" bar, CFEngine monitors the average time between connections to the clients; a last seen promise is considered not kept if the hub has not been in touch with a host for said average time plus two standard deviations, repaired for said average time plus the interval between one and two standard deviations, and kept for said average time plus the interval between zero and one standard deviation. The "Anom" bar relates to anomalies and is generated from monitoring data (vitals) for the last week in the following fashion: all observations (over the whole week) that are more than two std deviations away from the average is counted as not kept. They are counted as repaired if the distance is between one and two standard deviations from the average. Otherwise, they are kept &amp; green.

   <pre class="sp">

</pre>
<b>Finders:</b> <br>
The Mission Engineering room comes with six finder functions (modules that make it simple and intuitive to browse and search for objects of a particular type, see section on Finders): host, class, promises, reports, summary reports, and CDP (Content Driven Policies) reports.

<div class="node">
<a name="Mission-Planning"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Mission-Library">Mission Library</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Mission-Engineering">Mission Engineering</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Mission-Portal-Rooms">Mission Portal Rooms</a>

</div>

<h4 class="subsection">5.1.3 Mission Planning</h4>

<p>Make changes to policies, goals determined by promises and implement specific tactics to achieve the desired state. Interact with data, approve changes and anomalies. Get an overview of users logged on to the Mission Portal, as well as their current activity.

   <pre class="sp">

</pre>
<img src="img-planning.png" alt="Mission Planning">
<div align="center">Figure: Mission Planning</div>
<pre class="sp">

</pre>

Policy Goals:
List of policy goals as defined in policy files; these examples are from <samp><span class="file">company_knowledge.cf</span></samp>. Edit the file in the policy editor (Planning room -&gt; repository) or edit the file in your own text editor. The "More..." button links  to the Service Catalogue, click to see which bundles contribute to these policy goals.

<p class="noindent">Action buttons:
     <ul>
<li>Edit policies: Edit policy files in the integrated policy editor (requires Subversion)
<li>Track records: Overview of promises repaired or not kept
<li>Approve policies: To be developed
<li>Service catalogue: See which bundles contribute to policy goals
</ul>

<p class="noindent">Logged on:
Shows users currently logged on to the Mission Portal and their activity.

<p class="noindent">Activity log:
Shows the latest activity entries. Type in a new activity to keep colleagues posted on current work.

<div class="node">
<a name="Mission-Library"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Mission-Planning">Mission Planning</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Mission-Portal-Rooms">Mission Portal Rooms</a>

</div>

<h4 class="subsection">5.1.4 Mission Library</h4>

<p>The Library contains finders for documents, topics, a notes archive, and (external) link to the CFEngine community.

   <pre class="sp">

</pre>
<img src="img-library.png" alt="Mission Library">
<div align="center">Figure: Mission Library</div>
<pre class="sp">

</pre>

Library buttons:
     <ul>
<li>Docs: Overview of documentation that was packaged with CFEngine 3 Nova. 
<li>Find Topic: Search for topics either by scrolling through the alphabetical list or by typing in the search box (same as the search box on top right of page). 
<li>Notes Archive: Get overview of all notes made in regard to hosts or reports. 
<li>Community: External link to the CFEngine community
</ul>

<!--  -->
<div class="node">
<a name="Finders"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Viewers">Viewers</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Mission-Portal-Rooms">Mission Portal Rooms</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Mission-Portal">Mission Portal</a>

</div>

<h3 class="section">5.2 Finders</h3>

<ul class="menu">
<li><a accesskey="1" href="#Host-finder">Host finder</a>
<li><a accesskey="2" href="#Class-finder">Class finder</a>
<li><a accesskey="3" href="#Promise-finder">Promise finder</a>
<li><a accesskey="4" href="#Report-finder">Report finder</a>
<li><a accesskey="5" href="#Summary-report-finder">Summary report finder</a>
<li><a accesskey="6" href="#CDP-report-finder">CDP report finder</a>
<li><a accesskey="7" href="#Topic-finder">Topic finder</a>
</ul>

<p>Finders are modules that make it simple and intuitive to browse and search for objects of a particular type. Some are located in the Mission Engineering room, others in the Mission Library or the generic search box in the top right corner.

   <pre class="sp">

</pre>
<div align="center"><img src="img-finders.png" alt="Finders"></div>
<div align="center">Figure: Finders in the Mission Engineering room</div>
   <pre class="sp">

</pre>

<!--  -->
<div class="node">
<a name="Host-finder"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Class-finder">Class finder</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Finders">Finders</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Finders">Finders</a>

</div>

<h4 class="subsection">5.2.1 Host finder</h4>

<p>The host finder is located in the Mission Engineering room and will display a list of hosts. Browse by scrolling through the list, click a letter corresponding to the first letter of a host name, or search for hosts in the search box (top right corner). Clicking on a host name will bring you to the host viewer.

   <pre class="sp">

</pre>
<div align="center"><img src="img-hostfinder.png" alt="Host finder"></div>
<div align="center">Figure: Host finder</div>
   <pre class="sp">

</pre>

<div class="node">
<a name="Class-finder"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Promise-finder">Promise finder</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Host-finder">Host finder</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Finders">Finders</a>

</div>

<h4 class="subsection">5.2.2 Class finder</h4>

<p>The class finder is located in the Mission Engineering room and will display a list of classes. Browse by scrolling through the list, click a letter corresponding to the first letter of a class name, or search for classes in the search box (top right corner; choose between searching all, time, soft or IP classes). Clicking on a class will bring you to a report for that class profile.

   <pre class="sp">

</pre>
<div align="center"><img src="img-classfinder.png" alt="Class finder"></div>
<div align="center">Figure: Class finder.</div>
   <pre class="sp">

</pre>

<!--  -->
<div class="node">
<a name="Promise-finder"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Report-finder">Report finder</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Class-finder">Class finder</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Finders">Finders</a>

</div>

<h4 class="subsection">5.2.3 Promise finder</h4>

<p>The promise finder is located in the Mission Engineering room and will display a list of promises. Browse by scrolling through the list, click a letter corresponding to the first letter of a promiser/bundle/handle name (set alternative in search box and click a letter in the right column), or search for promiser/bundle/handle in the search box (top right corner; choose between searching promiser, bundle, or handle). Clicking on a promise/bundle will bring you to the promise/bundle viewer.

   <pre class="sp">

</pre>
<div align="center"><img src="img-promisefinder.png" alt="Promise finder"></div>
<div align="center">Figure: Promise finder</div>
   <pre class="sp">

</pre>

<div class="node">
<a name="Report-finder"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Summary-report-finder">Summary report finder</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Promise-finder">Promise finder</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Finders">Finders</a>

</div>

<h4 class="subsection">5.2.4 Report finder</h4>

<p>The report finder is located in the Mission Engineering room and will display a list of standard report categories. Browse by scrolling through the list. Clicking on a report category will bring up a query table that will produce a report according to the entered query criteria.

   <pre class="sp">

</pre>
<div align="center"><img src="img-reportsfinder.png" alt="Report finder"></div>
<div align="center">Figure: Report finder</div>
   <pre class="sp">

</pre>

Standard reports:
     <ul>
    <li>Bundle profile: Status of promise bundles and when they were last verified
    <li>Business value report: Accumulated value of promises kept
    <li>Class profile: User defined classes observed on the system
    <li>Compliance by promise: Compliance of each promise individually
    <li>Compliance summary: Total summary of host compliance
    <li>File change log: Log of all detected changes to files from changes promises
    <li>File change diffs: Delta/difference comparison showing file changes
    <li>Last saw hosts: Log of when neighboring hosts were last observed online
    <li>Patches available: A list of patches currently claimed to be available by the local package manager
    <li>Patch status: A list of (un)applied patches according to the local package manager
    <li>Performance: Execution time used to verify selected promises
    <li>Promises repaired log: Log of actual repairs made to the system
    <li>Promises repaired summary: Cumulative (histogram) summary of promises repaired
    <li>Promises not kept log: Log of promises that could not or would not be kept
    <li>Promises not kept summary: Cumulative (histogram) summary of promises not kept
    <li>Setuid/gid root programs: Current list of observed setuid/setgid root programs
    <li>Software installed: List of software packages claimed to be installed according to the local package manager
    <li>Variables: Table of variable values last observed
</ul>

<div class="node">
<a name="Summary-report-finder"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#CDP-report-finder">CDP report finder</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Report-finder">Report finder</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Finders">Finders</a>

</div>

<h4 class="subsection">5.2.5 Summary report finder</h4>

<p>Find the current state of knowledge about promise compliance. Search by promise handle and/or host group (host class) and/or specific host. Click the <code>Help?</code> link to open the Promise finder or Classes finder to view available promise handles or host groups (host classes), respectively.

   <pre class="sp">

</pre>
<div align="center"><img src="img-summaryreportfinder.png" alt="Summary report finder"></div>
<div align="center">Figure: Summary report finder</div>
   <pre class="sp">

</pre>

The result shows the number of hosts and their compliance when a single promise handle is specified, and an expectation value <a rel="footnote" href="#fn-5" name="fnd-5"><sup>5</sup></a> of the number of hosts that match a search criteria when a search string (regex) is specified. Click <code>New search</code> to change or refine the query.

   <pre class="sp">

</pre>
<div align="center"><img src="img-summaryreport.png" alt="Summary report"></div>
<div align="center">Figure: Summary report</div>
   <pre class="sp">

</pre>

<div class="node">
<a name="CDP-report-finder"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Topic-finder">Topic finder</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Summary-report-finder">Summary report finder</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Finders">Finders</a>

</div>

<h4 class="subsection">5.2.6 CDP report finder</h4>

<p>A Content-Driven Policy (CDP) is a text file with lines containing semi-colon separated fields, like a spreadsheet or tabular file. Each line in the file is parsed and results in a specific type of promise being made, depending on which type the Content-Driven Policy is. The CDP report finder lists template CDPs that come with CFEngine 3 Nova, click to view a report on the selected topic.

   <pre class="sp">

</pre>
<div align="center"><img src="img-cdpreportfinder.png" alt="CDP report finder"></div>
<div align="center">Figure: CDP report finder</div>
   <pre class="sp">

</pre>

<div class="node">
<a name="Topic-finder"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#CDP-report-finder">CDP report finder</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Finders">Finders</a>

</div>

<h4 class="subsection">5.2.7 Topic finder</h4>

<p>The Topic finder is located in the Mission Library and will display a list of common topics. Browse by scrolling through the list, click a letter corresponding to the first letter of a topic name, or search for topics in the search box (top right corner). Clicking on a topic will bring you either to a document, web page or the Topic viewer (Knowledge map).

   <pre class="sp">

</pre>
<div align="center"><img src="img-topicsfinder.png" alt="Topic finder"></div>
<div align="center">Figure: Topic finder</div>
   <pre class="sp">

</pre>

<div class="node">
<a name="Viewers"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Editors">Editors</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Finders">Finders</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Mission-Portal">Mission Portal</a>

</div>

<h3 class="section">5.3 Viewers</h3>

<ul class="menu">
<li><a accesskey="1" href="#Host-viewer">Host viewer</a>
<li><a accesskey="2" href="#Bundle-viewer">Bundle viewer</a>
<li><a accesskey="3" href="#Promise-viewer">Promise viewer</a>
<li><a accesskey="4" href="#Vital-signs-viewer">Vital signs viewer</a>
<li><a accesskey="5" href="#Topics-viewer-_0028Knowledge-map_0029">Topics viewer (Knowledge map)</a>
<li><a accesskey="6" href="#Weakest-hosts-viewer">Weakest hosts viewer</a>
<li><a accesskey="7" href="#Report-viewer">Report viewer</a>
</ul>

<p>Viewers show info about the main objects at different scales of the system.

<div class="node">
<a name="Host-viewer"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Bundle-viewer">Bundle viewer</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Viewers">Viewers</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Viewers">Viewers</a>

</div>

<h4 class="subsection">5.3.1 Host viewer</h4>

<p>Shows information about hosts, including name, status, operating system, vital signs, promises not kept, standard and custom reports, and more. View and make notes about the host.

   <pre class="sp">

</pre>
<div align="center"><img src="img-hostviewer.png" alt="Host viewer"></div>
<div align="center">Figure: Host viewer</div>
   <pre class="sp">

</pre>

<b>Action buttons:</b>
     <ul>
<li>Reports: Tabular summary of the host's internal information, tailored to a particular topics
<li>Notes: View and make comments about this host
<li>Vitals: Overview of monitoring data for this host and its current performance statistics
<li>Problems: Overview of promises not kept by this host
</ul>

<p class="noindent"><b>Monitored jobs:</b>
To be developed.

<p class="noindent"><b>Analysis:</b>
The bar meter shows the host-summary status of a number of key performance indicators:

     <ul>
<li>Week: The average level of promise-compliance over the whole past week. 
<li>Day:  The average level of promise-compliance over the past day. 
<li>Hour:  The average level of promise-compliance over the past hour. 
<li>Perf: The average performance status of the system, compared to the learned norm. 
<li>Chng: Software update status of the system (only shows on hub, not displayed on clients). 
<li>Seen: The average level of connectivity compliance (to the hub) over the past week . 
<li>Anom: Level of anomalous site-wide activity on the system. 
</ul>

<p class="noindent"><b>Host details (discovered):</b>
Lists properties that CFEninge has discovered about the host (alias (name), operating system, release version of operating system, etc.). You can also delete this host by pressing the button on the right (host will be deleted from database, but may re-appear if CFEngine is still running on it; see footnote below).<a rel="footnote" href="#fn-6" name="fnd-6"><sup>6</sup></a>

<div class="node">
<a name="Bundle-viewer"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Promise-viewer">Promise viewer</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Host-viewer">Host viewer</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Viewers">Viewers</a>

</div>

<h4 class="subsection">5.3.2 Bundle viewer</h4>

<p>The bundle viewer provides an interface to explore the context (class) in which a bundle is used and the promises made within that bundle. Tabs display other bundles using the one currently viewed and a general overview of all bundles. Navigate to interact with other views and get a complete picture of context, leads, references, affected objects, similar topics, and more.

   <pre class="sp">

</pre>
<div align="center"><img src="img-bundleviewer.png" alt="Bundle viewer"></div>
<div align="center">Figure: Bundle viewer</div>
   <pre class="sp">

</pre>

<div class="node">
<a name="Promise-viewer"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Vital-signs-viewer">Vital signs viewer</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Bundle-viewer">Bundle viewer</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Viewers">Viewers</a>

</div>

<h4 class="subsection">5.3.3 Promise viewer</h4>

<p>The promise viewer shows a promise definition and body. There are tabs for viewing leads (promise type, context, dependencies), other promises used in same bundle, other promises made by same promiser, and other promises of same type.

   <pre class="sp">

</pre>
<div align="center"><img src="img-promiseviewer.png" alt="Promise viewer"></div>
<div align="center">Figure: Promise viewer</div>
   <pre class="sp">

</pre>

<div class="node">
<a name="Vital-signs-viewer"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Topics-viewer-_0028Knowledge-map_0029">Topics viewer (Knowledge map)</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Promise-viewer">Promise viewer</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Viewers">Viewers</a>

</div>

<h4 class="subsection">5.3.4 Vital signs viewer</h4>

<p>The Vital signs viewer shows an
overview of monitoring data from each host and its current performance
statistics. In order to see data in these graphs, each host in the CFEngine
managed network must be running <code>cf-monitord</code> and <code>cf-serverd</code>. 
This is the default behavior for a Nova installation.

   <pre class="sp">

</pre>
<div align="center"><img src="img-vitalsviewer.png" alt="Vital signs viewer"></div>
<div align="center">Figure: Vital signs viewer</div>
   <pre class="sp">

</pre>

<div class="node">
<a name="Topics-viewer-(Knowledge-map)"></a>
<a name="Topics-viewer-_0028Knowledge-map_0029"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Weakest-hosts-viewer">Weakest hosts viewer</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Vital-signs-viewer">Vital signs viewer</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Viewers">Viewers</a>

</div>

<h4 class="subsection">5.3.5 Topics viewer (Knowledge map)</h4>

<p>The Topics viewer, or Knowledge map, is a <i>sematic web</i> of subject references and document pointers. In a semantic web, you are presented with links to
documents about your chosen topic. In addition you are
offered <i>leads</i> and possible pathways to topics that are known to be
related. These leads don't just point you to more documents, but
explain <i>how</i> neighboring issues are related.  The aim is to help
the user learn from the experience of browsing, by conveying the
meaning of the current topic in relation to other issues in the
system. This is how <i>knowledge transfer</i> occurs.

   <p>The Knowledge Map can be found by searching for a topic in the top right corner or through the topic finder in the Mission Library (this will sometimes also lead directly to a document or web page instead).

   <pre class="sp">

</pre>
<div align="center"><img src="img-topicsviewer.png" alt="Topics viewer"></div>
<div align="center">Figure: Topics viewer (Knowledge map)</div>
   <pre class="sp">

</pre>

The yellow sphere represents the current topic, surrounding (blue) spheres represent related topics, and the size of the spheres represents the number of associations each topic has. This map is navigable: click on a different topic to see a new view centered on that topic and its associations. The tabs will show leads, references, topics in the same context, and sub topics in the same context. Links can also lead to other viewers in the Mission Portal, documents and web pages related to the current topic.

<div class="node">
<a name="Weakest-hosts-viewer"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Report-viewer">Report viewer</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Topics-viewer-_0028Knowledge-map_0029">Topics viewer (Knowledge map)</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Viewers">Viewers</a>

</div>

<h4 class="subsection">5.3.6 Weakest hosts viewer</h4>

<p>A link to the worst ranked hosts is located in the Mission Engineering room. This ranks all hosts that have reported to the hub <a rel="footnote" href="#fn-7" name="fnd-7"><sup>7</sup></a> according to their level of promises not kept during the last hour, with the worst host on top.

   <pre class="sp">

</pre>
<div align="center"><img src="img-weakesthostsviewer.png" alt="Weakest hosts"></div>
<div align="center">Figure: Weakest hosts</div>
   <pre class="sp">

</pre>

<div class="node">
<a name="Report-viewer"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Weakest-hosts-viewer">Weakest hosts viewer</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Viewers">Viewers</a>

</div>

<h4 class="subsection">5.3.7 Report viewer</h4>

<p>A significant capability of CFEngine 3 Nova is the existence of automated system reporting. A report is a tabular summary of CFEngine's internal information, tailored to a particular purpose. Reports describe
attributes and qualities of managed hosts and can be filtered through the text boxes on top of each column.

   <pre class="sp">

</pre>
<div align="center"><img src="img-reportviewer.png" alt="Report viewer"></div>
<div align="center">Figure: Report viewer</div>
   <pre class="sp">

</pre>

Reports are updated at different intervals, the default values are every 5 minutes or every 6 hours (this can be changed by the user). Below is a list of standard reports, updated every 5 minutes unless otherwise noted:
     <ul>
     <li>Bundle profile: Status of promise bundles and when they were last verified
     <li>Business value report: Accumulated value of promises kept (6 hrs)
     <li>Class profile: User defined classes observed on the system
     <li>Compliance by promise: Compliance of each promise individually
     <li>Compliance summary: Total summary of host compliance
     <li>File change log: Log of all detected changes to files from changes promises
     <li>File change diffs: Delta/difference comparison showing file changes
     <li>Last saw hosts: Log of when neighboring hosts were last observed online
     <li>Patches available: A list of patches currently claimed to be available by the local package  manager (6 hrs)
     <li>Patch status: A list of (un)applied patches according to the local package manager (6 hrs)
     <li>Performance: Execution time used to verify selected promises
     <li>Promises repaired log: Log of actual repairs made to the system
     <li>Promises repaired summary: Cumulative (histogram) summary of promises repaired
     <li>Promises not kept log: Log of promises that could not or would not be kept
     <li>Promises not kept summary: Cumulative (histogram) summary of promises not kept
     <li>Setuid/gid root programs: Current list of observed setuid/setgid root programs (6 hrs)
     <li>Software installed: List of software packages claimed to be installed according to the local package manager (6 hrs)
     <li>Variables: Table of variable values last observed (6 hrs)
</ul>

<div class="node">
<a name="Editors"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Mission-Portal-Administration">Mission Portal Administration</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Viewers">Viewers</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Mission-Portal">Mission Portal</a>

</div>

<h3 class="section">5.4 Editors</h3>

<ul class="menu">
<li><a accesskey="1" href="#Policy-editor">Policy editor</a>
<li><a accesskey="2" href="#Integration-with-subversion">Integration with subversion</a>
</ul>

<div class="node">
<a name="Policy-editor"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Integration-with-subversion">Integration with subversion</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Editors">Editors</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Editors">Editors</a>

</div>

<h4 class="subsection">5.4.1 Policy editor</h4>

<p>The CFEngine 3 Nova Mission Portal provides an editor for working on
CFEngine language. The editor provides syntax high-lighting and look-up to make working
with CFEngine's extensive language easier. There is a tie-in for Subversion version
control repositories; the Mission Portal will prompt you for the path and login credentials. Setup of a subversion repository has to be done separately.

   <pre class="sp">

</pre>
<div align="center"><img src="img-svncheckout.png" alt="SVN checkout"></div>
<div align="center">Figure: SVN checkout</div>
   <pre class="sp">

</pre>

The main key commands in the editor Window are:

     <dl>
<dt><i>Auto completion: Ctrl+Space</i><dd>Shows a pop-up menu of possible items. This is context sensitive,
e.g. it also works inside lists (e.g. <code>bsdflags</code>) to provide
possible values. 
<br><dt><i>Undo: Ctrl+Z</i><dd> In Safari, Ctrl-backspace may be used. 
<br><dt><i>Redo: Ctrl+Y</i><dd>Undo an undo operation, i.e. reverse the direction of transaction roll. 
<br><dt><i>Indent: TAB</i><dd>Format a file to a standard indentation. 
</dl>

   <p>Multiple documents appear as tabs along the top of the screen.
   <pre class="sp">

</pre>
<div align="center"><img src="img-policy-editor.png" alt="Policy Editor"></div>
<div align="center">Figure: The Policy Editor</div>
   <pre class="sp">

</pre>

The CFEngine 3 Nova policy editor detects syntax errors and highlights
these in red to avoid mistakes when editing.  In addition, by using
the <code>Check syntax</code> button, it is possible to pre-test the policy
before committing changes to a repository. This will run
<code>promises.cf</code> through the <code>cf-promises</code> parser.

   <p>The main menu on the left hand panel shows the main work flow items for
policy editing. Clicking the arrow in the panel divider collapses the
menu and gives full-screen editing.

   <p>The right hand panel shows basic file and Subversion commands. The <code>Save</code> button will store a local/version of the opened files without committing to the repository.

<div class="node">
<a name="Integration-with-subversion"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Policy-editor">Policy editor</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Editors">Editors</a>

</div>

<h4 class="subsection">5.4.2 Integration with subversion</h4>

<p>The default architecture proposes to work in close dialog with a version
repository. CFEngine recommends the use of such a repository and currently
supports subversion.

   <p>For the moment, user management in the Mission Portal only concerns access to the Mission Portal settings. It does not affect the ability to edit or approve policies in the policy editor. Access control and authorization for policies are handled by
subversion's authentication system so that edits made in the Mission
Portal can be interleaved with edits from other sources.  The
subversion repository thus becomes the centerpiece of the distributed
coordination, as is the intended function of version control systems.

   <p>When working with a subversion repository, you first do a
&rdquo;checkout&rdquo;. This allows you to select the repository you want to
download and creates a working environment based on it. Note that the
editor currently only views files in the checked out repository, so if
you have a directory hierarchy, you need to check out multiple
times. After doing a checkout, you can view the path to the current
repository at the top.

<!-- @sp 1 -->
<!-- @center @image{editor-svnpath,6cm,,Path to the current repository} -->
<!-- @center Figure: Path to the current repository. -->
<!-- @sp 1 -->
   <p>The &rdquo;update&rdquo; command downloads the newest files from the already checked
out subversion repository, while &rdquo;commit&rdquo; updates the repository
with your working copy. You also have the ability to see the
repository log of the 20 last changes. This includes changed files,
users and log messages. For more detailed information on working with
subversion, see <a href="http://svnbook.red-bean.com">http://svnbook.red-bean.com</a>.

   <p>After editing you may or may not commit changes. When closing an
edited file, you are also given the option to commit at once.

<!-- @sp 1 -->
<!-- @center @image{savefiledlg,6cm,,The front page} -->
<!-- @center Figure: Save file with repository commit -->
<!-- @sp 1 -->
   <p>The menu choice to commit a current version commits all files in the
configuration repository. Commits require a mandatory comment. CFEngine recommends
you use this to explain why a change was made, or relate it to an incident number, etc. 
The details of <i>what</i> was changed are already documented by the version control
logs. 
<!-- @sp 1 -->
<!-- @center @image{commitdlg,6cm,,The front page} -->
<!-- @center Figure: Commit dialogue -->
<!-- @sp 1 -->
<!-- @sp 1 -->
<!-- @center @image{updatedialog,6cm,,The front page} -->
<!-- @center Figure: Updating the repository contents. -->
<!-- @sp 1 -->

<div class="node">
<a name="Mission-Portal-Administration"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Editors">Editors</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Mission-Portal">Mission Portal</a>

</div>

<h3 class="section">5.5 Mission Portal Administration</h3>

<ul class="menu">
<li><a accesskey="1" href="#Mission-Portal-Settings">Mission Portal Settings</a>
<li><a accesskey="2" href="#Mission-Portal-User-Admin">Mission Portal User Admin</a>
<li><a accesskey="3" href="#Troubleshooting-_002d-Mission-Portal-Logs">Troubleshooting - Mission Portal Logs</a>
</ul>

<div class="node">
<a name="Mission-Portal-Settings"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Mission-Portal-User-Admin">Mission Portal User Admin</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Mission-Portal-Administration">Mission Portal Administration</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Mission-Portal-Administration">Mission Portal Administration</a>

</div>

<h4 class="subsection">5.5.1 Mission Portal Settings</h4>

<p>Configure and view various settings for the Mission Portal.

   <pre class="sp">

</pre>
<img src="img-settings.png" alt="Mission Portal Settings">
<div align="center">Figure: Mission Portal Settings</div>
<pre class="sp">

</pre>
     <ul>
<li>List of saved searches: View saved searches (e.g. searches saved from reports viewer/finder)
<li>Mission Portal settings: Configure access authentication mode (internal database, LDAP, Active Directory)
<li>My preferences: Turn tool tips on/off and enter default number of rows to be shown in reports
</ul>

<div class="node">
<a name="Mission-Portal-User-Admin"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Troubleshooting-_002d-Mission-Portal-Logs">Troubleshooting - Mission Portal Logs</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Mission-Portal-Settings">Mission Portal Settings</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Mission-Portal-Administration">Mission Portal Administration</a>

</div>

<h4 class="subsection">5.5.2 Mission Portal User Admin</h4>

<p>For the moment, user management in the Mission Portal only concerns access to the Mission Portal settings page. It does not affect the ability to edit or approve policies in the policy editor. Access control and authorization for policies are handled by subversion's authentication system, see section on "Integration with subversion".

   <p>On a fresh install the default user "admin" belongs to the "admin" user group and has access to the settings page. Add users and define user groups (Admin, Faculty, Developer, etc.). Alternatively, configure the Mission Portal for use of external authentication (LDAP, Active Directory), see Appendix A. Note that the actual setup of external authentication (definition of users, groups, directory hierarchy, etc.) has to be done independently and is not covered in this document.

   <pre class="sp">

</pre>
<img src="img-useradmin.png" alt="Mission Portal User Admin">
<div align="center">Figure: Mission Portal User Admin</div>
<pre class="sp">

</pre>

<div class="node">
<a name="Troubleshooting---Mission-Portal-Logs"></a>
<a name="Troubleshooting-_002d-Mission-Portal-Logs"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Mission-Portal-User-Admin">Mission Portal User Admin</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Mission-Portal-Administration">Mission Portal Administration</a>

</div>

<h4 class="subsection">5.5.3 Troubleshooting - Mission Portal Logs</h4>

<p>The Mission Portal will log php errors, errors related to the configuration of external authentication (LDAP/Active Directory) and occurrences of the fall-back solution if external authentication fails. The log can be found in DOCROOT/application/logs (i.e. <code>/var/www/application/logs</code> for Ubuntu and <code>/var/www/html/application/logs</code> for Red Hat). The logs folder must be writable by apache, i.e. by 'www-data' user.

<!-- ***************************************************** -->
<!-- * CHAPTER -->
<!-- ***************************************************** -->
<div class="node">
<a name="Monitoring-extensions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#File-Access-Control-Lists">File Access Control Lists</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Mission-Portal">Mission Portal</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">6 Monitoring extensions</h2>

<p>CFEngine 3 Nova incorporates a lightweight monitoring agent, whose aim
is to provide meaningful performance data about systems, in a scalable
fashion.  CFEngine 3 Nova does not aim to replace specialized
rapid-update monitoring and alarm systems; it provides a context-aware
summary of current state that is always displayed in relation to
previous system behavior, for comparison. The aim is to offer useful
analytics rather than jump-to alarms.

   <p>CFEngine's monitoring component <code>cf-monitord</code> records a number of
performance data about the system by default. These include process
counts, service traffic, load average and CPU utilization and
temperature when available.  In the Community Edition, data are
only collected and stored for personal use, but users have to work to see
results.  CFEngine 3 Nova improves on this in three ways.

     <ul>
<li>Data collected from the monitoring system are integrated into
the aggregate knowledge console.

     <li>It adds a three year life-cycle trend summary, based on
`shift'-averages.

     <li>It adds customizable promises to monitor or
log specific highly specific user data through the generic promise
interface.

   </ul>

   <p>The end result is to display time series traces of system performance, like the
above mentioned values, and customized logs feeding custom-defined
reports.

<ul class="menu">
<li><a accesskey="1" href="#Integration-of-monitoring-with-knowledge-base">Integration of monitoring with knowledge base</a>
<li><a accesskey="2" href="#Long-term-trends">Long term trends</a>
<li><a accesskey="3" href="#Custom-promises-to-measure">Custom promises to measure</a>
<li><a accesskey="4" href="#Uses-for-custom-monitoring">Uses for custom monitoring</a>
</ul>

<div class="node">
<a name="Integration-of-monitoring-with-knowledge-base"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Long-term-trends">Long term trends</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Monitoring-extensions">Monitoring extensions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Monitoring-extensions">Monitoring extensions</a>

</div>

<h3 class="section">6.1 Integration of monitoring with knowledge base</h3>

<p>CFEngine 3 Nova integrates monitoring reports with the automated base
knowledge to provide self-analysis and simple summary reporting;
the Mission Portal shows important status summaries and allow users to drill down to specific reporting data.

<div align="center"><img src="img-status.png" alt="Integrated Monitoring"></div>

   <p>Detailed time-series views can be collected and collated, providing
honest and accurate data that allow you to gauge your own confidence
level in system performance.  Unlike most monitoring solutions,
CFEngine shows you its own confidence in the measurements taken. It
takes a finite amount of time to measure and transport data from
systems to the knowledge console. That time also provides information
about system performance. CFEngine always promises to tell you how old
data are and how confident it is in the values.

   <div class="block-image"><img src="img-vitalsviewer.png" alt="Integrated Monitoring"></div>

<!--  -->
<div class="node">
<a name="Long-term-trends"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Custom-promises-to-measure">Custom promises to measure</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Integration-of-monitoring-with-knowledge-base">Integration of monitoring with knowledge base</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Monitoring-extensions">Monitoring extensions</a>

</div>

<h3 class="section">6.2 Long term trends</h3>

<p>CFEngine normally operates with time-series data represented
in two forms:

     <ul>
<li>A weekly average, plotted on a periodogram, showing performance now in relation
to the same time of week in previous weeks. After about a month data are forgotten
to ensure a sufficient rate of adaptation to new patterns. 
<li>The past four hours in high resolution. 
</ul>

   <p>CFEngine 3 Nova adds quarter day averages of recorded time-series which go back three
years in time. Three years is considered to be the lifetime of a computer. 
Summaries of the detailed performance are summarized by flat averages for
a four-shift day:
     <ul>
<li><b>Night shift</b>: from midnight 00:00 to 06:00
<li><b>Morning shift</b>: from 06:00 to 12:00
<li><b>Afternoon shift</b>: from 12:00 to 18:00
<li><b>Evening shift</b>: from 18:00 to 00:00
</ul>

<!--  -->
<div class="node">
<a name="Custom-promises-to-measure"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Uses-for-custom-monitoring">Uses for custom monitoring</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Long-term-trends">Long term trends</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Monitoring-extensions">Monitoring extensions</a>

</div>

<h3 class="section">6.3 Custom promises to measure</h3>

<p>CFEngine 3 Nova adds a new promise type in bundles for the monitoring
agent. These are written just like all other promises within a bundle
destined for the agent concerned. In this case:

<pre class="verbatim">bundle monitor watch

{
<span class="red">measurements:
</span>
<span class="comment">  # promises ...
</span>

}

</pre>

<ul class="menu">
<li><a accesskey="1" href="#Extraction-strings-and-logging">Extraction strings and logging</a>
<li><a accesskey="2" href="#Extracting-one_002doff-numerical-data">Extracting one-off numerical data</a>
<li><a accesskey="3" href="#Extraction-to-list-variable">Extraction to list variable</a>
</ul>

<!--  -->
<div class="node">
<a name="Extraction-strings-and-logging"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Extracting-one_002doff-numerical-data">Extracting one-off numerical data</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Custom-promises-to-measure">Custom promises to measure</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Custom-promises-to-measure">Custom promises to measure</a>

</div>

<h4 class="subsection">6.3.1 Extraction strings and logging</h4>

<p>Let's take a generic example. Suppose we have a file of nonsense  <samp><span class="file">/tmp/testmeasure</span></samp>
and we want to extract some information that we call a `blonk'
from the file. A blonk is always on the second line of this file following
a prefix `Blonk blonk '. We would get the value like this:

<pre class="verbatim">
  "/tmp/testmeasure"

<span class="red">      handle </span>=><span class="green"> "blonk_watch",</span>
<span class="red">      stream_type </span>=><span class="green"> "file",</span>
<span class="red">      data_type </span>=><span class="green"> "string",</span>
<span class="red">      history_type </span>=><span class="green"> "log",</span>
<span class="red">      units </span>=><span class="green"> "blonks",</span>
<span class="red">      match_value </span>=> find_blonks,
<span class="red">      action </span>=><span class="blue"> sample_min("10");</span>

</pre>

   <p>This promise body has several attributes.

     <dl>
<dt><code>handle</code><dd>It is essential to give measurement promises handles, as these are used to label the
log files that will store the values.

     <br><dt><code>stream_type</code><dd>Tells us that we are reading from what the system considered to be a regular file
on the file-system.

     <br><dt><code>data_type</code><dd>This says that data are to be treated as text with no other meaning.

     <br><dt><code>history_type</code><dd>This tells us that we want to log the values with a time stamp.

     <br><dt><code>units</code><dd>This string is used in documentation to explain the measurement units of this result.

     <br><dt><code>match_value</code><dd>This is a body reference that represents the algorithm by which we extract data from the file.

     <br><dt><code>action</code><dd>This is the generic action parameter that may be added to all promises. We use it
here to limit the sample rate of this promise; <code>cf-monitord</code> samples by default
at a rate of once per 2.5 minutes. 
</dl>

   <p>The matching body uses a method for selecting the correct line, and a way
for extracting a pattern from the line. In every case the value extracted
is described  by using a regular expression <i>back-reference</i>, i.e. 
a parenthesized expression  within a regular expression. The expression should
match the entire line and should contain exactly one parenthesis.

<pre class="verbatim">body match_value find_blonks
{
<span class="red">select_line_number </span>=><span class="green"> "2";</span>
<span class="red">extraction_regex </span>=><span class="green"> "Blonk blonk ([blonk]+).*";</span>
}
</pre>

   <p>The sampling rate is controlled by using the generic <code>action</code> constraint.
<pre class="verbatim">body action sample_min(x)
{
<span class="red">ifelapsed </span>=><span class="green"> "$(x)";</span>
<span class="red">expireafter </span>=><span class="green"> "$(x)";</span>
}
</pre>

<!--  -->
<div class="node">
<a name="Extracting-one-off-numerical-data"></a>
<a name="Extracting-one_002doff-numerical-data"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Extraction-to-list-variable">Extraction to list variable</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Extraction-strings-and-logging">Extraction strings and logging</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Custom-promises-to-measure">Custom promises to measure</a>

</div>

<h4 class="subsection">6.3.2 Extracting one-off numerical data</h4>

<p>In this example we extract an integer value from an existing file. 
Notice that CFEngine samples the process table during <code>processes</code>
promises so you might be able to save a new execution of a
shell command and use the cached data, depending on your need
for immediacy. It is always good practice to limit the system
load incurred by monitoring.

<pre class="verbatim">  # Test 2 - follow a special process over time
<span class="comment">  # using CFEngine's process cache to avoid re-sampling
</span>

   "/var/cfengine/state/cf_rootprocs"

<span class="red">      handle </span>=><span class="green"> "monitor_self_watch",</span>
<span class="red">      stream_type </span>=><span class="green"> "file",</span>
<span class="red">      data_type </span>=><span class="green"> "int",</span>
<span class="red">      history_type </span>=><span class="green"> "static",</span>
<span class="red">      units </span>=><span class="green"> "kB",</span>
<span class="red">      match_value </span>=> proc_value(".*cf-monitord.*",

         "root\s+[0-9.]+\s+[0-9.]+\s+[0-9.]+\s+[0-9.]+\s+([0-9]+).*");

</pre>

   <p>This match body selects a line matching a particular regular expression
and extracts the 6th column of the process table. The regular expression
skips first the root string and then five numerical values. 
The value is extracted into a one-off value

<pre class="verbatim">body match_value proc_value(x,y)
{
<span class="red">select_line_matching </span>=><span class="green"> "$(x)";</span>
<span class="red">extraction_regex </span>=><span class="green"> "$(y)";</span>
}
</pre>

<!--  -->
<div class="node">
<a name="Extraction-to-list-variable"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Extracting-one_002doff-numerical-data">Extracting one-off numerical data</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Custom-promises-to-measure">Custom promises to measure</a>

</div>

<h4 class="subsection">6.3.3 Extraction to list variable</h4>

<p>In this example we discover a list of disks attached to the system.
<pre class="verbatim">  # Test 3, discover disk device information

  "/bin/df"

<span class="red">      stream_type </span>=><span class="green"> "pipe",</span>
<span class="red">      data_type </span>=><span class="green"> "slist",</span>
<span class="red">      history_type </span>=><span class="green"> "static",</span>
<span class="red">      units </span>=><span class="green"> "device",</span>
<span class="red">      match_value </span>=><span class="blue"> file_system,</span>
<span class="red">      action </span>=><span class="blue"> sample_min("480"); # this is not changing much!</span>

</pre>

<pre class="verbatim">
<span class="red">body match_value</span> <span class="blue">file_system</span>
{
<span class="red">select_line_matching </span>=><span class="green"> "/.*";</span>
<span class="red">extraction_regex </span>=><span class="green"> "(.*)";</span>
}

</pre>

<!--  -->
<div class="node">
<a name="Uses-for-custom-monitoring"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Custom-promises-to-measure">Custom promises to measure</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Monitoring-extensions">Monitoring extensions</a>

</div>

<h3 class="section">6.4 Uses for custom monitoring</h3>

<p>Unlike most other monitoring tools that use heavy-weight scripting
languages to extract data, often running many processes for each
measurement, CFEngine is a lightweight probe, using file interfaces
and regular expressions. Thus its impact on the
system is minimal. The possibilities for using this are therefore
extremely broad:

     <ul>
<li>Extracting accounting data from systems for charge-back. 
This could be useful in cloud scenarios. 
<li>Discovering memory leaks. 
<li>Looking for zombie processes relating to specific software. 
<li>Logging up-time. 
<li>System class-dependent discovery and extraction of any kind of text
for insertion into a CMDB. 
</ul>

<!-- ***************************************************** -->
<!-- * CHAPTER -->
<!-- ***************************************************** -->
<div class="node">
<a name="File-Access-Control-Lists"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Server-extensions">Server extensions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Monitoring-extensions">Monitoring extensions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">7 File Access Control Lists</h2>

<ul class="menu">
<li><a accesskey="1" href="#ACL-Introduction">ACL Introduction</a>
<li><a accesskey="2" href="#File-ACL-example">File ACL example</a>
<li><a accesskey="3" href="#CFEngine-3-Generic-ACL-Syntax">CFEngine 3 Generic ACL Syntax</a>
<li><a accesskey="4" href="#POSIX-ACL-type">POSIX ACL type</a>
<li><a accesskey="5" href="#NT-ACL-type">NT ACL type</a>
</ul>

<!--  -->
<div class="node">
<a name="ACL-Introduction"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#File-ACL-example">File ACL example</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#File-Access-Control-Lists">File Access Control Lists</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-Access-Control-Lists">File Access Control Lists</a>

</div>

<h3 class="section">7.1 ACL Introduction</h3>

<p>Access Control Lists (ACL) allow for a more fine-grained access control on
file system objects than standard Unix permissions. In spite of the success
of the POSIX model's simplicity the functionality is limited.

   <p>File permission security is a subtle topic. Users should take care
when experimenting with ACLs as the results can often be
counter-intuitive. In some cases the functioning of a system can be
compromised by changes of access rights.

   <p>Not all file systems support ACLs. In Unix systems there is a plethora
of different file system types, which have different models of ACLs. 
Be aware that the mount-options for a file-system may affect the ACL
semantics.

   <p><table class="cartouche" summary="cartouche" border="1"><tr><td>
<i>Note that when adding a user to a group, this will not have any
effect until the next time the user logs in on many operating
systems.</i>
</td></tr></table>

   <p>As CFEngine works across multiple platforms and needs to support ACLs
with different APIs, a common ACL syntax has been abstracted to add a
layer of portability. This is a specific feature of CFEngine, not of
the host systems. A generic syntax ensures that the ACLs that are
commonly needed can be coded in a portable fashion. CFEngine 3 Nova's
ACL model is translated into native permissions for implementation;
CFEngine does not interfere with native access mechanisms in any way. 
The CFEngine ACL syntax is similar to the POSIX ACL syntax, which is
supported by BSD, Linux, HP-UX and Solaris.

   <p>CFEngine also allows you to specify platform-dependent ACLs. Of
course, these ACLs will only work on the given platform, and must
therefore be shielded with classes that select the appropriate model
within the promise body.

   <p>Currently, CFEngine 3 Nova supports the following ACL APIs and operating
systems.

   <p><table summary=""><tr align="left"><th valign="top" width="30%">ACL type </th><th valign="top" width="30%">Operating system
<br></th></tr><tr align="left"><td valign="top" width="30%">NTFS </td><td valign="top" width="30%">Windows Server 2003, 2008
<br></td></tr><tr align="left"><td valign="top" width="30%">POSIX </td><td valign="top" width="30%">Linux
   <br></td></tr></table>

<!--  -->
<div class="node">
<a name="File-ACL-example"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#CFEngine-3-Generic-ACL-Syntax">CFEngine 3 Generic ACL Syntax</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ACL-Introduction">ACL Introduction</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-Access-Control-Lists">File Access Control Lists</a>

</div>

<h3 class="section">7.2 File ACL example</h3>

<p>The form of a CFEngine files promise that uses ACLs is as follows:
<pre class="verbatim">
<span class="comment">#
</span>
<span class="comment"># test_acl.cf
</span>
<span class="comment">#
</span>

<span class="red">body common control
</span>{
<span class="red">bundlesequence </span>=> { "acls" };
}

<span class="comment">#########################################
</span>

<span class="red">bundle agent</span> <span class="blue">acls</span>

{
<span class="red">files:
</span>
  "/office/shared"

<span class="red">    acl </span>=><span class="blue"> template;</span>
}

<span class="comment">#########################################
</span>

<span class="red">body acl</span> <span class="blue">template</span>

{
<span class="red">acl_method </span>=><span class="green"> "overwrite";</span>
<span class="red">acl_directory_inherit </span>=><span class="green"> "parent";</span>

 linux|solaris::

<span class="red">  acl_type </span>=><span class="green"> "posix";</span>

<span class="red">  aces </span>=> {
<span class="red">          "user:*:rw",
</span><span class="red">          "user:root:rw",
</span><span class="red">          "group:*:r",
</span><span class="red">          "mask:rwx",
</span><span class="red">          "all:r"
</span>          };

 windows::

<span class="red">  acl_type </span>=><span class="green"> "ntfs";</span>

<span class="red">  aces </span>=> {
<span class="red">          "user:Administrator:rw(po)",
</span><span class="red">          "all:r"
</span>          };
}

</pre>

<ul class="menu">
<li><a accesskey="1" href="#Concepts">Concepts</a>
<li><a accesskey="2" href="#Entity-types">Entity types</a>
<li><a accesskey="3" href="#Owners">Owners</a>
<li><a accesskey="4" href="#Changing-owner">Changing owner</a>
<li><a accesskey="5" href="#Permissions">Permissions</a>
<li><a accesskey="6" href="#Deny-permissions">Deny permissions</a>
<li><a accesskey="7" href="#Changing-permissions">Changing permissions</a>
<li><a accesskey="8" href="#Effective-permissions">Effective permissions</a>
<li><a accesskey="9" href="#Inheritance">Inheritance</a>
</ul>

<!--  -->
<div class="node">
<a name="Concepts"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Entity-types">Entity types</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#File-ACL-example">File ACL example</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-ACL-example">File ACL example</a>

</div>

<h4 class="subsection">7.2.1 Concepts</h4>

<p>As mentioned, there are many different ACL APIs. For example, the
POSIX draft standard, NTFS and NFSv4 have different and incompatible
ACL APIs. As CFEngine is cross-platform, these differences should, for
the most usual cases, be transparent to the user. However, some
distinctions are impossible to make transparent, and thus the user
needs to know about them.

   <p>We will explore the different concepts of ACL implementations that are
critical to understanding how permissions are defined and enforced in
the different file systems. As a running example, we will consider
NTFS ACLs and POSIX ACLs, because the distinction between these ACL
APIs is strong.

<!--  -->
<div class="node">
<a name="Entity-types"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Owners">Owners</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Concepts">Concepts</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-ACL-example">File ACL example</a>

</div>

<h4 class="subsection">7.2.2 Entity types</h4>

<p>All ACL APIs support three basic entity types: user, group and
all. User and group are simply users and groups of the system, where a
group may contain multiple users. all is all users of the system, this
type is called "other" in POSIX and "Everyone" in NTFS.

<!--  -->
<div class="node">
<a name="Owners"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Changing-owner">Changing owner</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Entity-types">Entity types</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-ACL-example">File ACL example</a>

</div>

<h4 class="subsection">7.2.3 Owners</h4>

<p>All file system objects have an owner, which by default is the entity
that created the object. The owner can always be a user. However, in
some file systems, groups can also be owners (e.g. the
"Administrators" group in NTFS). In some ACL APIs (e.g POSIX),
permissions can be set explicitly for the owner, i.e. the owner has an
independent ACL entry.

<!--  -->
<div class="node">
<a name="Changing-owner"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Permissions">Permissions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Owners">Owners</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-ACL-example">File ACL example</a>

</div>

<h4 class="subsection">7.2.4 Changing owner</h4>

<p>It is generally not possible for user A to set user B as the
owner of a file system object, even if A owns the object. The
superuser ("root" in POSIX, "Administrator" in NTFS) can however
always set itself as the owner of an object. In POSIX, the superuser
may in fact set any user as the owner, but it NTFS it can only take
ownership.

<!--  -->
<div class="node">
<a name="Permissions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Deny-permissions">Deny permissions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Changing-owner">Changing owner</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-ACL-example">File ACL example</a>

</div>

<h4 class="subsection">7.2.5 Permissions</h4>

<p>An entity can be given a set of permissions on a file system object
(e.g. read and write). The data structure holding the permissions for
one entity is called an "Access Control Entry" (ACE). As many users
and groups may have sets of permissions on a given object, multiple
Access Control Entries are combined to an Access Control List, which
is associated with the object.

   <p>The set of available permissions differ with ACL APIs. For example,
the "Take Ownership" permission in NTFS has no equivalent in
POSIX. However, for the most common situations, it is possible to get
equivalent security properties by mapping a set of permissions in one
API to another set in a second API.

   <p>There are however different rules for the access to the contents of a
directory with no access. In POSIX, no sub-objects of a directory with
no access can be accessed. However, in NTFS, sub-objects that the entity
has access rights to can be accessed, regardless of whether the entity
has access rights to the containing directory.

<!--  -->
<div class="node">
<a name="Deny-permissions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Changing-permissions">Changing permissions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Permissions">Permissions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-ACL-example">File ACL example</a>

</div>

<h4 class="subsection">7.2.6 Deny permissions</h4>

<p>If no permissions are given to a particular entity, the entity will be
denied any access to the object. But in some file systems, like NTFS,
it is also possible to explicitly deny specific permissions to
entities. Thus, two types of permissions exist in these systems: allow
and deny.

   <p>It is generally good practice to design the ACLs to specify who is
allowed to do some operations, in contrary to who is not allowed to do
some operations, if possible. The reason for this is that describing
who is not allowed to do things tend to lead to more complex
rules and could therefore more easily lead to mis-configurations and
security holes. A good rule is to only define that users should not be
able to access a resource in the following two scenarios:

     <ul>
<li>Denying access to a subset of a group which is allowed access
<li>Denying a specific permission when a user or a group has full access
</ul>

   <p>If you think about it, this is the same principle that applies to
firewall configuration: it is easier to white-list, specify who should
have access, than to blacklist, specify who should not have access. In
addition, since CFEngine is designed to be cross-platform and some ACL
permissions are not available on all platforms, we should strive to
keep the ACLs as simple as possible. This helps us avoid surprises
when the ACLs are enforced by different platforms.

<!--  -->
<div class="node">
<a name="Changing-permissions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Effective-permissions">Effective permissions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Deny-permissions">Deny permissions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-ACL-example">File ACL example</a>

</div>

<h4 class="subsection">7.2.7 Changing permissions</h4>

<p>Generally, only the owner may change permissions on a file system
object. However, superusers can also indirectly change permissions by
taking ownership first. In POSIX, superusers can change permissions
without taking ownership. In NTFS, either ownership or a special
permission ("Change Permissions") is needed to alter permissions.

<!--  -->
<div class="node">
<a name="Effective-permissions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Inheritance">Inheritance</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Changing-permissions">Changing permissions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-ACL-example">File ACL example</a>

</div>

<h4 class="subsection">7.2.8 Effective permissions</h4>

<p>Unfortunately, even though two ACL APIs support all the permissions
listed in an ACL, the ACL may be interpreted differently. For a given
entity and object with ACL, there are two conceptually different ways
to interpret which permissions the entity obtains: ACE precedence and
cumulative ACL.

<!-- TODO: create figure of example? -->
   <p>For example, let &lsquo;<samp><span class="samp">alice</span></samp>&rsquo; be a user of the group
&lsquo;<samp><span class="samp">staff</span></samp>&rsquo;. There is an ACL on the file <samp><span class="file">schedule</span></samp>, giving
&lsquo;<samp><span class="samp">alice</span></samp>&rsquo; write permission, and the group &lsquo;<samp><span class="samp">staff</span></samp>&rsquo; read
permission. We will consider two ways to determine the effective
permissions of &lsquo;<samp><span class="samp">alice</span></samp>&rsquo; to <samp><span class="file">schedule</span></samp>.

   <p>Firstly, by taking the most precise match in the ACL, &lsquo;<samp><span class="samp">alice</span></samp>&rsquo; will be
granted write permission only. This is because an ACE describing &lsquo;<samp><span class="samp">alice</span></samp>&rsquo;
is more precise than an ACE describing a group &lsquo;<samp><span class="samp">alice</span></samp>&rsquo; is member
of. However, note that some ACEs may have the same precedence, like
two ACEs describing permissions for groups &lsquo;<samp><span class="samp">alice</span></samp>&rsquo; is member of. Then,
cumulative matching will be done on these ACEs (explained next). This
is how POSIX does it.

   <p>Secondly, we can take the cumulative permissions, which yields a user
permissions from all the ACE entries with his user name, groups he is
member of or the ACE entry specifying all users. In this case,
&lsquo;<samp><span class="samp">alice</span></samp>&rsquo; would get read and write on <samp><span class="file">schedule</span></samp>. NTFS
computes the effective permissions in this way.

<!--  -->
<div class="node">
<a name="Inheritance"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Effective-permissions">Effective permissions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-ACL-example">File ACL example</a>

</div>

<h4 class="subsection">7.2.9 Inheritance</h4>

<!-- TODO: Correct to inherit to someone ? -->
<p>Directories have ACLs associated with them, but they also have the
ability to inherit an ACL to sub-objects created within them. POSIX
calls the former ACL type "access ACL" and the latter "default ACL",
and we will use the same terminology.

<!-- TODO: Create tool to output effective permissions if ACL is applied ? -->
<!--  -->
<div class="node">
<a name="CFEngine-3-Generic-ACL-Syntax"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#POSIX-ACL-type">POSIX ACL type</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#File-ACL-example">File ACL example</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-Access-Control-Lists">File Access Control Lists</a>

</div>

<h3 class="section">7.3 CFEngine 3 Generic ACL Syntax</h3>

<!-- FIXME: TODO: Say which OS's we are supporting, and which ACL types -->
<!-- we are supporting on them. -->
<p>The CFEngine 3 ACL syntax is divided into two main parts, a generic
and an API specific (native). The generic syntax can be used on any
file system for which CFEngine supports ACLs, while the native syntax
gives access to all the permissions available under a particular ACL
API.

   <p>An ACL can contain both generic and native syntax. However, if it
contains native syntax, it can only be enforced on systems supporting
the given ACL API. Thus, only the generic syntax is portable.

   <p>Note that even though the same generic ACL is set on two systems with
different ACL APIs, it may be enforced differently because the ACE
matching algorithms differ. For instance, as discussed earlier, NTFS
uses cumulative matching, while POSIX uses precedence
matching. CFEngine cannot alter the matching algorithms, and
simulating one or the other by changing ACL definitions is not
possible in all cases, and would probably lead to confusion. Thus, if
an ACL is to be used on two systems with different ACL APIs, the user
is encouraged to check that any differences in matching algorithms do
not lead to mis-configurations.

   <p>The CFEngine generic ACL syntax explained next, and native syntax is
described in following sections.

   <p><table class="cartouche" summary="cartouche" border="1"><tr><td>
<pre class="smallexample">     body acl acl_alias:
     {
     acl_type              =&gt; "<var>generic</var>"/"<var>ntfs</var>"/"<var>posix</var>";
     acl_method            =&gt; "<var>append</var>"/"<var>overwrite</var>";
     acl_directory_inherit =&gt; "<var>nochange</var>"/"<var>clear</var>"/"<var>parent</var>"/"<var>specify</var>";
     aces                  =&gt; {
                               "user:uid:mode[:perm_type]", ...,
                               "group:gid:mode[:perm_type]", ...,
                               "all:mode[:perm_type]"
                              };
     specify_inherit_aces  =&gt; {
                               "user:uid:mode[:perm_type]", ...,
                               "group:gid:mode[:perm_type]", ...,
                               "all:mode[:perm_type]"
                              };
     }
</pre>
   </td></tr></table>

     <ul>
<li><code>acl_alias</code> is the name of the specified ACL. It can be any
  identifier containing alphanumeric characters and underscores. We
will use this name when referring to the ACL.

     <li><code>acl_type</code> (optional) specifies the ACL API used to
describe the ACL. It defaults to <code>generic</code>, which allows only
CFEngine generic ACL syntax, but is valid on all supported
systems. <code>acl_type</code> only needs to be specified if native
permissions are being used in the ACL (see <code>nperms</code> below). If
<code>acl_type</code> is set to anything other than <code>generic</code>, the
system on which it is enforced must support this ACL API.

     <li><code>acl_method</code> (optional) can be set to either
  <code>append</code> or <code>overwrite</code>, and defaults to
  <code>append</code>. Setting it to <code>append</code> only adds or modifies the
  ACEs that are specified in <code>aces</code> (and
  <code>specify_inherit_aces</code>, see below). If set to
  <code>overwrite</code>, the specified ACL will completely replace the
  currently set ACL. All required fields must then be set in the
  specified ACL (e.g. <code>all</code> in POSIX), see the following sections
  describing the supported native APIs.

     <!-- TODO: Support acl_method:append for specify_inherit_aces independently? -->
     <li><code>acl_directory_inherit</code> (optional) specifies the ACL of
  newly created sub-objects. Only valid if the ACL is set on a
directory. On directories, <code>nochange</code> is the default and
indicates that the ACL that is currently given to newly created child
objects is left unchanged. If set to <code>clear</code>, no ACL will be
inherited, but the file system specifies a default ACL, which varies
with the file system (see the following sections on the supported ACL
APIs). <code>parent</code> indicates that the ACL set in <code>aces</code> (see
below) should be inherited to sub-objects.  If set to <code>specify</code>,
<code>specify_inherit_aces</code> specifies the inherited ACL, and
<code>acl_method</code> applies for <code>specify_inherit_aces</code> too.

     <li><code>aces</code> is a list of access control entries. It is parsed
  from left to right, and multiple entries with the same entity-type
  and id is allowed. This is necessary to specify permissions with
  different <code>perm_type</code> for the same entity (e.g. to allow read
  permission but explicitly deny write).

     <li><code>specify_inherit_aces</code> (optional) is a list of access control
  entries that are set on child objects. It is also parsed from left
  to right and allows multiple entries with same entity-type and
  id. Only valid if <code>acl_directory_inherit</code> is set to
  <code>specify</code>.

     <li><code>user</code> indicates that the line applies to a user specified
  by the user identifier <code>uid</code>. <code>mode</code> is the permission
  mode string.

     <li><code>group</code> indicates that the line applies to a group specified
  by the group identifier <code>gid</code>. <code>mode</code> is the permission
  mode string.

     <li><code>all</code> indicates that the line applies to every
  user. <code>mode</code> is the permission mode string.

     <li><code>uid</code> is a valid user name for the system and
  cannot be empty. However, if <code>acl_type</code> is <code>posix</code>,
<code>uid</code> can be set to * to indicate the user that owns the file
system object.

     <li><code>gid</code> is a valid group name for the system and
  cannot be empty. However, if <code>acl_type</code> is <code>posix</code>,
<code>gid</code> can be set to * to indicate the file group.

     <li><code>mode</code> is one or more strings
  <code>op</code>|<code>gperms</code>|(<code>nperms</code>); a concatenation of <code>op</code>,
  <code>gperms</code> and optionally (<code>nperms</code>), see below, separated
  with commas (e.g. +rx,-w(s)). <code>mode</code> is parsed from left to
  right. 
<!-- TODO: include support for @code{fullaccess}, @code{noaccess}, -->
<!-- and @code{remove} -->

     <li><code>op</code> specifies the operation on any existing permissions,
  if the specified ACE already exists. <code>op</code> can be =, empty, + or
  -. = or empty sets the permissions to the ACE as stated, + adds and
  - removes the permissions from any existing ACE.

     <li><code>nperms</code> (optional) specifies ACL API specific
  (native) permissions. Only valid if <code>acl_type</code> is not
  <code>generic</code>. Valid values for <code>nperms</code> varies with different
  ACL types, and are specified in subsequent sections.

     <li><code>perm_type</code> (optional) can be set to either <code>allow</code> or
  <code>deny</code>, and defaults to <code>allow</code>. <code>deny</code> is only valid
  if <code>acl_type</code> is set to an ACL type that support deny
  permissions.

     <li><code>gperms</code> (generic permissions) is a concatenation of zero
  or more of the characters shown in the table below. If left empty,
  none of the permissions are set. 
</ul>

   <p><table summary=""><tr align="left"><th valign="top" width="5%">Flag </th><th valign="top" width="20%">Description </th><th valign="top" width="30%">Semantics on file </th><th valign="top" width="40%">Semantics on directory

<p><br></th></tr><tr align="left"><td valign="top" width="5%"><code>r</code> </td><td valign="top" width="20%">Read </td><td valign="top" width="30%">Read data, permissions, attributes </td><td valign="top" width="40%">Read
directory contents, permissions, attributes
<br></td></tr><tr align="left"><td valign="top" width="5%"><code>w</code> </td><td valign="top" width="20%">Write </td><td valign="top" width="30%">Write data </td><td valign="top" width="40%">Create, delete, rename sub-objects
<br></td></tr><tr align="left"><td valign="top" width="5%"><code>x</code> </td><td valign="top" width="20%">Execute </td><td valign="top" width="30%">Execute file </td><td valign="top" width="40%">Access sub-objects
   <br></td></tr></table>

   <p>Note that the <code>r</code> permission is not necessary to read an object's
permissions and attributes in all file systems (e.g. in POSIX, having
<code>x</code> on its containing directory is sufficient).

<!--  -->
<ul class="menu">
<li><a accesskey="1" href="#Generic-syntax-examples">Generic syntax examples</a>
</ul>

<div class="node">
<a name="Generic-syntax-examples"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#CFEngine-3-Generic-ACL-Syntax">CFEngine 3 Generic ACL Syntax</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#CFEngine-3-Generic-ACL-Syntax">CFEngine 3 Generic ACL Syntax</a>

</div>

<h4 class="subsection">7.3.1 Generic syntax examples</h4>

<pre class="verbatim">body common control
{
<span class="red">bundlesequence </span>=> { "acls" };
}

<span class="red">bundle agent</span> <span class="blue">acls</span>
{
<span class="red">files:
</span>  "/office/schedule"
<span class="red">    acl </span>=><span class="blue"> small;</span>

  "/office/audit_dir"
<span class="red">    acl </span>=><span class="blue"> dirinherit;</span>
}

<span class="red">body acl</span> <span class="blue">small</span>
{
<span class="red">aces </span>=> {"user:alice:w", "group:staff:r", "all:"};
}

<span class="red">body acl</span> <span class="blue">dirinherit</span>
{
<span class="red">acl_directory_inherit </span>=><span class="green"> "parent";</span>
<span class="red">aces </span>=> {"user:alice:+w,-x", "user:bob:+r,-w", "group:staff:=rx", "all:-w"};
}
</pre>
See the following sections on native ACL types for more examples.

<!-- TODO: include support for the following as mode -->
<!-- Keywords: -->
<!-- remove              = setting mode = remove removes any existing -->
<!-- ACE with the given user or group. Only valid if -->
<!-- @code{method}:@code{overwrite}. -->
<!-- fullaccess  = setting mode = fullaccess grants every permission -->
<!-- supported by the file system to the given entity -->
<!-- (user, group, all). The owner of the object and -->
<!-- properties like suid, sgid and -->
<!-- sticky are left unchanged. -->
<!-- noaccess    = setting mode = noaccess denies every permission for -->
<!-- the entity (user, group, all). The entity is left -->
<!-- with no access rights to the object. Note that the -->
<!-- entity might nonetheless be able to change the -->
<!-- permissions (e.g. by being the owner of the object -->
<!-- or a superuser). -->
<!-- TODO: Define user, group, mask and other to u, g, m, o instead / also? -->
<!-- TODO: Examples: ACLs, console output, screen-shots -->
<!--  -->
<div class="node">
<a name="POSIX-ACL-type"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#NT-ACL-type">NT ACL type</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#CFEngine-3-Generic-ACL-Syntax">CFEngine 3 Generic ACL Syntax</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-Access-Control-Lists">File Access Control Lists</a>

</div>

<h3 class="section">7.4 POSIX ACL type</h3>

<!--  -->
<ul class="menu">
<li><a accesskey="1" href="#POSIX_002dspecific-ACL-syntax">POSIX-specific ACL syntax</a>
<li><a accesskey="2" href="#Generic-syntax-mapping">Generic syntax mapping</a>
<li><a accesskey="3" href="#POSIX-ACL-examples">POSIX ACL examples</a>
</ul>

<div class="node">
<a name="POSIX-specific-ACL-syntax"></a>
<a name="POSIX_002dspecific-ACL-syntax"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Generic-syntax-mapping">Generic syntax mapping</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#POSIX-ACL-type">POSIX ACL type</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#POSIX-ACL-type">POSIX ACL type</a>

</div>

<h4 class="subsection">7.4.1 POSIX-specific ACL syntax</h4>

<p><b>Native permissions</b>
The valid values for <code>nperms</code> in POSIX are <code>r</code>,<code>w</code>, and
<code>x</code>. These are in fact the same as the generic permissions, so
specifying them as generic or native gives the same effect.

   <p><b>File owner and group</b>
A user-ACE with uid set to * indicates file object owner. A group-ACE
with gid set to * indicates file group.

   <p><b>mask</b> mask can be specified as a normal ACE, as
<code>mask:mode</code>. mask specifies the maximum permissions that are
granted to named users (not owning user), file group and named
groups. mask is optional, if it is left unspecified it will will be
computed as the union of the permissions granted to named users, file
group and named groups (see acl_calc_mask(3)).

   <p><b>Required ACEs</b> POSIX requires existence of an ACE for the file
owner, (<code>user:*:mode</code>), the file group (<code>group:*:mode</code>),
other (<code>all:mode</code>) and mask (<code>mask:mode</code>). As mentioned,
CFEngine automatically creates a mask-ACE, if missing. However, if
<code>method</code> is set to <code>overwrite</code>, the user must ensure that
the rest of the required entries are specified.

<!--  -->
<div class="node">
<a name="Generic-syntax-mapping"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#POSIX-ACL-examples">POSIX ACL examples</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#POSIX_002dspecific-ACL-syntax">POSIX-specific ACL syntax</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#POSIX-ACL-type">POSIX ACL type</a>

</div>

<h4 class="subsection">7.4.2 Generic syntax mapping</h4>

<p><b>Entity types</b>
All entity types in the generic syntax are mapped to the corresponding
entity types with the same name in POSIX, except <code>all</code> which
corresponds to <code>other</code> in POSIX.

   <p><b>Generic permissions</b>

   <p>As shown in the table below, <code>gperms</code> is mapped straightforward
from generic to POSIX permission flags.

   <p><table summary=""><tr align="left"><th valign="top" width="30%">Generic flag  </th><th valign="top" width="30%">POSIX flag
<br></th></tr><tr align="left"><td valign="top" width="30%"><code>r</code> </td><td valign="top" width="30%"><code>r</code>
<br></td></tr><tr align="left"><td valign="top" width="30%"><code>w</code> </td><td valign="top" width="30%"><code>w</code>
<br></td></tr><tr align="left"><td valign="top" width="30%"><code>x</code> </td><td valign="top" width="30%"><code>x</code>
   <br></td></tr></table>

   <p><b>Inheritance</b> POSIX supports <code>acl_directory_inherit</code> set to
<code>specify</code>. The <code>specify_inherit_aces</code> list is then set as the
default ACL in POSIX (see acl(5)).

   <p>If <code>acl_directory_inherit</code> is set to <code>parent</code>, CFEngine
copies the access ACL to the default ACL. Thus, newly created objects
get the same access ACL as the containing directory.

   <p><code>acl_directory_inherit</code> set to <code>clear</code> corresponds to no
POSIX default ACL. This results in that newly created objects get ACEs
for owning user, group and other. The permissions are set in
accordance with the mode parameter to the creating function and the
umask (usually results in 644 for files and 755 for directories).

   <p><b>Further reading</b> The manual page <code>acl(5)</code> contains much
information on POSIX ACLs, including the access check algorithm. In
particular, this shows that POSIX uses ACE precedence matching, and
exactly how it is done. Operating systems usually bundle tools for
manipulating ACLs, for example <code>getfacl(1)</code> and
<code>setfacl(1)</code>.

<div class="node">
<a name="POSIX-ACL-examples"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Generic-syntax-mapping">Generic syntax mapping</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#POSIX-ACL-type">POSIX ACL type</a>

</div>

<h4 class="subsection">7.4.3 POSIX ACL examples</h4>

<pre class="verbatim">body common control
{
<span class="red">bundlesequence </span>=> { "acls" };
}

<span class="red">bundle agent</span> <span class="blue">acls</span>
{
<span class="red">files:
</span>
  "/office/timetable"
<span class="red">    acl </span>=><span class="blue"> nativeperms;</span>

  "/office/user_dir"
<span class="red">    acl </span>=><span class="blue"> specifyinherit;</span>
}

<span class="red">body acl</span> <span class="blue">nativeperms</span>
{
<span class="red">acl_type </span>=><span class="green"> "posix";</span>
<span class="red">aces </span>=> {"user:alice:r(w)", "user:root:=(rwx)",
<span class="red">         "group:staff:-r(x)", "all:-(w)", "mask:(rx)"};
</span>}

<span class="red">body acl</span> <span class="blue">specifyinherit</span>
{
<span class="red">acl_type </span>=><span class="green"> "posix";</span>
<span class="red">acl_method </span>=><span class="green"> "overwrite";</span>
<span class="red">acl_directory_inherit </span>=><span class="green"> "specify";</span>
<span class="red">aces </span>=> {"user:*:rwx", "group:*:rx", "user:alice:rwx",
<span class="red">         "user:root:rx", "group:staff:r", "all:rx"};
</span><span class="red">specify_inherit_aces </span>=> {"user:*:", "group:*:", "all:"};
}
</pre>

<!--  -->
<div class="node">
<a name="NT-ACL-type"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#POSIX-ACL-type">POSIX ACL type</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-Access-Control-Lists">File Access Control Lists</a>

</div>

<h3 class="section">7.5 NT ACL type</h3>

<!--  -->
<ul class="menu">
<li><a accesskey="1" href="#NT_002dspecific-ACL-syntax">NT-specific ACL syntax</a>
</ul>

<div class="node">
<a name="NT-specific-ACL-syntax"></a>
<a name="NT_002dspecific-ACL-syntax"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#NT-ACL-type">NT ACL type</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#NT-ACL-type">NT ACL type</a>

</div>

<h4 class="subsection">7.5.1 NT-specific ACL syntax</h4>

<p><b>Native permissions</b>
NTFS supports fourteen so-called special file permissions. However, we
do not consider the <code>Synchronize</code> permission because it is used
for a different purpose than the other permissions. In order to give
access to the thirteen relevant permissions, CFEngine defines a native
permission flag for each of them. This one-to-one mapping is as
follows.

   <p><table summary=""><tr align="left"><th valign="top" width="40%">NTFS Special Permission </th><th valign="top" width="20%">CFEngine nperm
<br></th></tr><tr align="left"><td valign="top" width="40%">Execute File / Traverse Folder </td><td valign="top" width="20%">x
<br></td></tr><tr align="left"><td valign="top" width="40%">Read Data / List Folder </td><td valign="top" width="20%">r
<br></td></tr><tr align="left"><td valign="top" width="40%">Read Attributes </td><td valign="top" width="20%">t
<br></td></tr><tr align="left"><td valign="top" width="40%">Read Extended Attributes </td><td valign="top" width="20%">T
<br></td></tr><tr align="left"><td valign="top" width="40%">Write Data / Create Files </td><td valign="top" width="20%">w
<br></td></tr><tr align="left"><td valign="top" width="40%">Append Data / Create Folders </td><td valign="top" width="20%">a
<br></td></tr><tr align="left"><td valign="top" width="40%">Write Attributes </td><td valign="top" width="20%">b
<br></td></tr><tr align="left"><td valign="top" width="40%">Write Extended Attributes </td><td valign="top" width="20%">B
<br></td></tr><tr align="left"><td valign="top" width="40%">Delete Sub-folders and Files </td><td valign="top" width="20%">D
<br></td></tr><tr align="left"><td valign="top" width="40%">Delete </td><td valign="top" width="20%">d
<br></td></tr><tr align="left"><td valign="top" width="40%">Read Permissions </td><td valign="top" width="20%">p
<br></td></tr><tr align="left"><td valign="top" width="40%">Change Permissions </td><td valign="top" width="20%">c
<br></td></tr><tr align="left"><td valign="top" width="40%">Take Ownership </td><td valign="top" width="20%">o
   <br></td></tr></table>

   <p>The semantics of these special permissions can be found in the
references for further reading below.

   <p><b>Denying permissions</b>
NTFS supports setting <code>perm_type</code> to <code>deny</code> in addition to
<code>allow</code>, which is the default. This can for instance be used to
denying a user a particular permission that a group membership grants
him. It is important to note that the precedence of allow and deny
permissions is as follows:

     <ol type=1 start=1>
<li>Explicit Deny
<li>Explicit Allow
<li>Inherited Deny from parent
<li>Inherited Allow from parent
<li>Inherited Deny from grandparent
<li>Inherited Allow from grandparent
<li>...
        </ol>

   <p>Thus, the closer the permission is to the object in the directory
path, the greater precedence it is given.

   <p>An important point here is that even though a user is denied access in
a parent directory and this permission is inherited, but one of the
groups he is member of is explicitly allowed access to a file in that
directory, he is actually allowed to access the file.

   <p><b>Ownership</b>
In NTFS, the default owner is the user who is currently logged on. The
only exceptions occur when the user is a member of either the
&lsquo;<samp><span class="samp">Administrators</span></samp>&rsquo; group or the &lsquo;<samp><span class="samp">Domain Admins</span></samp>&rsquo; group.

   <p>Owners of NTFS objects can allow another user to take ownership by
giving that user Take Ownership permission. Owners can also give other
users the Change Permissions flag. In addition, members of the
&lsquo;<samp><span class="samp">Administrator</span></samp>&rsquo; group can always take ownership. It is never
possible to give ownership of an object to a user, but members of
the &lsquo;<samp><span class="samp">Administrator</span></samp>&rsquo; group can give ownership to that group.

<h4 class="subsection">7.5.2 Generic syntax mapping</h4>

<p><b>Entity types</b>
The three entity types of NTFS are called user, group and
Everyone. The user and group entity types in NTFS are mapped to the
user and group entity types in CFEngine. Everyone is mapped to all in
CFEngine.

   <p><b>Generic permissions</b>
For NTFS, CFEngine maps the <code>gperms</code> to <code>nperms</code> as
follows.

   <p><table summary=""><tr align="left"><th valign="top" width="30%">Generic flag  </th><th valign="top" width="30%">Native flags
<br></th></tr><tr align="left"><td valign="top" width="30%"><code>r</code> </td><td valign="top" width="30%"><code>rtTp</code>
<br></td></tr><tr align="left"><td valign="top" width="30%"><code>w</code> </td><td valign="top" width="30%"><code>wabB</code>
<br></td></tr><tr align="left"><td valign="top" width="30%"><code>x</code> </td><td valign="top" width="30%"><code>x</code>
   <br></td></tr></table>

   <p>The rationale for this mapping is discussed next.

   <p>NTFS groups the thirteen special permissions to create five sets of
permissions:
     <ul>
<li>Read
<li>Read &amp; Execute
<li>Write
<li>Modify
<li>Full Control
</ul>
   In addition, we have the List Folder Contents set, which is equivalent
to the Read &amp; Execute set but is only available to- and inherited by
directories. The Full Control set is unsurprisingly all the thirteen
special permissions. An overview of the NTFS mapping of special
permissions to sets is given in the references stated as further
reading below. The NTFS permission sets can be expressed in CFEngine
syntax as follows.

   <p><table summary=""><tr align="left"><th valign="top" width="30%">NTFS sets  </th><th valign="top" width="40%">CFEngine gperms|(nperms)
<br></th></tr><tr align="left"><td valign="top" width="30%"><code>Read</code> </td><td valign="top" width="40%"><code>r</code>
<br></td></tr><tr align="left"><td valign="top" width="30%"><code>Write</code> </td><td valign="top" width="40%"><code>w</code>
<br></td></tr><tr align="left"><td valign="top" width="30%"><code>Read &amp; Execute</code> </td><td valign="top" width="40%"><code>rx</code>
<br></td></tr><tr align="left"><td valign="top" width="30%"><code>Modify</code> </td><td valign="top" width="40%"><code>rwx(d)</code>
<br></td></tr><tr align="left"><td valign="top" width="30%"><code>Full Control</code> </td><td valign="top" width="40%"><code>rwx(dDco)</code>
   <br></td></tr></table>

   <p><b>Inheritance</b>
<code>acl_directory_inherit</code> set to <code>clear</code> disables
inheritance, such that child objects get a default ACL specified by
the operating system, namely Full control for the file object creator and
<code>SYSTEM</code> accounts.

   <p><b>POSIX compatibility</b>
Be aware that setting <code>gperms</code> to &lsquo;<samp><span class="samp">rwx</span></samp>&rsquo; on directories is
more restrictive in NTFS than in POSIX ACLs. This is because NTFS does
not allow deletion of objects within a directory without a Delete
Sub-folders and Files permission on the directory (or a Delete
permission on the object itself), while in POSIX, &lsquo;<samp><span class="samp">rwx</span></samp>&rsquo; on the
directory is sufficient to delete any file or directory within it
(except when the sticky-flag is set on the directory). Thus, on
directories, the NTFS-equivalent to POSIX <code>gperms</code> set to
&lsquo;<samp><span class="samp">rwx</span></samp>&rsquo; is &lsquo;<samp><span class="samp">rwx(D)</span></samp>&rsquo;. However, for files, &lsquo;<samp><span class="samp">rwx</span></samp>&rsquo; is
equivalent in POSIX and NTFS semantics.

   <p>In POSIX ACLs, there is no explicit delete permission, but the
execute, write and sticky permissions on the containing directory
determines if a user has privileges to delete. In POSIX, the owner and
root can change permissions, while usually only the root may change
the ownership, so there is no direct equivalent to the Change
Permission and Take Ownership in POSIX.

   <p><b>Further reading</b>
A description of the fourteen NTFS permission and the mapping of these
into sets is given at <a href="http://support.microsoft.com/kb/308419">http://support.microsoft.com/kb/308419</a>.

<h4 class="subsection">7.5.3 NT ACL examples</h4>

<pre class="verbatim">body common control
{
<span class="red">bundlesequence </span>=> { "acls" };
}

<span class="red">bundle agent</span> <span class="blue">acls</span>
{
<span class="red">files:
</span>
<span class="red">  "C:\Program Files\Secret Program"
</span><span class="red">    acl </span>=><span class="blue"> restrictive;</span>

<span class="red">  "D:\Shared"
</span><span class="red">    acl </span>=><span class="blue"> sharespace;</span>
}

<span class="red">body acl</span> <span class="blue">restrictive</span>
{
<span class="red">acl_type </span>=><span class="green"> "ntfs";</span>
<span class="red">acl_method </span>=><span class="green"> "overwrite";</span>
<span class="red">acl_directory_inherit </span>=><span class="green"> "parent";</span>
<span class="red">aces </span>=> {"user:Administrator:r"};
}

<span class="red">body acl</span> <span class="blue">sharespace</span>
{
<span class="red">acl_type </span>=><span class="green"> "ntfs";</span>
<span class="red">acl_method </span>=><span class="green"> "overwrite";</span>
<span class="red">acl_directory_inherit </span>=><span class="green"> "specify";</span>
<span class="red">aces </span>=> { "user:Administrator:rwx(dDco)",
<span class="red">          "group:Hackers:rwx(dDco):deny",
</span><span class="red">          "all:rw" };
</span><span class="red">specify_inherit_aces </span>=> {"user:Administrator:r"};
}
</pre>

<!-- ***************************************************** -->
<!-- * CHAPTER -->
<!-- ***************************************************** -->
<div class="node">
<a name="Server-extensions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Environments-and-workflows">Environments and workflows</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#File-Access-Control-Lists">File Access Control Lists</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">8 Server extensions</h2>

<p>CFEngine 3 Nova adds a simple server extension to the Community Edition
server, namely the ability to encode data directly in policy. 
This feature is useful for distributing password hashes
to systems.

<ul class="menu">
<li><a accesskey="1" href="#Server-access-resource-type">Server access resource type</a>
<li><a accesskey="2" href="#Function-remotescalar">Function remotescalar</a>
<li><a accesskey="3" href="#Example-remote-scalar-lookup">Example remote scalar lookup</a>
</ul>

<div class="node">
<a name="Server-access-resource-type"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Function-remotescalar">Function remotescalar</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Server-extensions">Server extensions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Server-extensions">Server extensions</a>

</div>

<h3 class="section">8.1 Server access resource type</h3>

<p>By default, access to resources granted by the server are
files. However, sometimes it is useful to cache <code>literal</code>
strings, hints and data in the server, e.g. the contents of variables,
hashed passwords etc for easy access. In the case of literal data, the
promise handle serves as the reference identifier for queries. Queries
are instigated by function calls by any agent.

<pre class="verbatim">access:

  "This is a string with a $(localvar) for remote collection"

<span class="red">        handle  </span>=><span class="green"> "test_scalar",</span>
<span class="red">  resource_type </span>=><span class="green"> "literal",</span>
<span class="red">        admit   </span>=> { "127.0.0.1" };

</pre>

   <p>The promise looks exactly like a promise for a file object, but the data
are literal and entered into the policy. This is a useful approach for
distributing password hashes on a need-to-know basis from a central location. 
The server configuration file need not be distributed to any client, thus
only authorized systems will have access to the hashes.

<div class="node">
<a name="Function-remotescalar"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Example-remote-scalar-lookup">Example remote scalar lookup</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Server-access-resource-type">Server access resource type</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Server-extensions">Server extensions</a>

</div>

<h3 class="section">8.2 Function <code>remotescalar</code></h3>

<p>The client side of the literal look up function is:

   <p><table class="cartouche" summary="cartouche" border="1"><tr><td>
<pre class="example">     
     (string) remotescalar(<var>resource handle</var>,<var>host/IP address</var>,<var>encrypt</var>);
     
</pre>
   </td></tr></table>

   <p>This function downloads a string from a remote server, using the promise handle
as a variable identifier.

<p class="noindent"><b>ARGUMENTS</b>:

     <dl>
<dt>&lsquo;<samp><span class="samp">resource handle</span></samp>&rsquo;<dd>The name of the promise on the server side
<br><dt>&lsquo;<samp><span class="samp">host or IP address</span></samp>&rsquo;<dd>The location of the server on which the resource resides. 
<br><dt>&lsquo;<samp><span class="samp">encrypt</span></samp>&rsquo;<dd>Whether to encrypt the connection to the server.
     <pre class="smallexample">               true
               yes
               false
               no
</pre>
     </dl>

<div class="node">
<a name="Example-remote-scalar-lookup"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Function-remotescalar">Function remotescalar</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Server-extensions">Server extensions</a>

</div>

<h3 class="section">8.3 Example remote scalar lookup</h3>

<pre class="verbatim">########################################################
<span class="comment">#
</span>
<span class="comment"># Remote value from server connection to cf-serverd
</span>
<span class="comment">#
</span>
<span class="comment">########################################################
</span>

<span class="red">body common control
</span>
{
<span class="red">bundlesequence  </span>=> { "testbundle"  };

<span class="red">version </span>=><span class="green"> "1.2.3";</span>
}

<span class="comment">########################################################
</span>

<span class="red">bundle agent</span> <span class="blue">testbundle</span>

{
<span class="red">vars:
</span>
 "remote"<span class="red"> string </span>=> remotescalar("test_scalar","127.0.0.1","yes");

<span class="red">reports:
</span>
  linux::

    "Receive value $(remote)";
}

<span class="comment">#########################################################
</span>
<span class="comment"># Server config
</span>
<span class="comment">#########################################################
</span>

<span class="red">body server</span> <span class="blue">control</span>

{
<span class="red">allowconnects         </span>=> { "127.0.0.1" , "::1" };
<span class="red">allowallconnects      </span>=> { "127.0.0.1" , "::1" };
<span class="red">trustkeysfrom         </span>=> { "127.0.0.1" , "::1" };
<span class="red">allowusers            </span>=> { "mark" };
}

<span class="comment">#########################################################
</span>

<span class="red">bundle server</span> <span class="blue">access_rules()</span>

{
<span class="red">vars:
</span>
  "localvar"<span class="red"> string </span>=><span class="green"> "literal string";</span>

<span class="red">access:
</span>
  "This is a $(localvar) for remote access"

<span class="red">        handle  </span>=><span class="green"> "test_scalar",</span>
<span class="red">  resource_type </span>=><span class="green"> "literal",</span>
<span class="red">        admit   </span>=> { "127.0.0.1" };
}

</pre>

<!-- ***************************************************** -->
<!-- * CHAPTER -->
<!-- ***************************************************** -->
<div class="node">
<a name="Environments-and-workflows"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Virtualization">Virtualization</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Server-extensions">Server extensions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">9 Environments and workflows</h2>

<ul class="menu">
<li><a accesskey="1" href="#Environments-in-Nova">Environments in Nova</a>
<li><a accesskey="2" href="#Implementing-workflows-in-Nova">Implementing workflows in Nova</a>
</ul>

<div class="node">
<a name="Environments-in-Nova"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Implementing-workflows-in-Nova">Implementing workflows in Nova</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Environments-and-workflows">Environments and workflows</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Environments-and-workflows">Environments and workflows</a>

</div>

<h3 class="section">9.1 Environments in Nova</h3>

<pre class="sp">

</pre>

Nova supports notion of `environments' &ndash; named groups of hosts, like
`development', 'QA' and 'production' hosts.

   <p>Each environment gets
     <ul>
<li>Separate subdirectory `environment_&lt;NAME&gt;' for storing promises
<li>Separate subdirectory `environment_&lt;NAME&gt;/cdp_inputs' for content-based policies
<li>grouping of hosts belonging to environment in GUI
</ul>

   <p>Default Nova policies group hosts into environments in bundle `common
environments'. This bundle defines
     <ul>
<li>`environments.active' variable. This variable holds the name of environment for current host, and is used by other promises in Nova templates. This variable does not affect grouping in GUI. 
<li>global `environment_&lt;NAME&gt;' class. This class should be defined if given host belongs to the `&lt;NAME&gt;' environment. GUI groups hosts using this class. 
</ul>
   Administrator may customize this bundle as needed, adding or removing
environments defined (Nova does not have any built-in environment
names), changing rules for hosts selection and making any other
modifications, the only requirement for environments feature to work
is keeping aforementioned variables and classes defined. Note that the
environment name 'any' is reserved.

   <p>Default rules expect file `environment_$(promises.active)/promises.cf'
to exist and to contain bundle `agent main', this bundle is included
last from main promises.cf and should implement/include/use any
environment-specific rules.

<div class="node">
<a name="Implementing-workflows-in-Nova"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Environments-in-Nova">Environments in Nova</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Environments-and-workflows">Environments and workflows</a>

</div>

<h3 class="section">9.2 Implementing workflows in Nova</h3>

<p>Workflows are implemented easily with Nova, administrator starts with
defining necessary set of environments (usually those are
`development', `testing' and 'production'), then develops new
configuration in one enviroment, and promotes rules first to testing
and then to production environment.

   <p>Promotion of rules is performed by copying rules from one
environment's subdirectory to next one.

<!-- ***************************************************** -->
<!-- * CHAPTER -->
<!-- ***************************************************** -->
<div class="node">
<a name="Virtualization"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Content_002dDriven-Policies">Content-Driven Policies</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Environments-and-workflows">Environments and workflows</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">10 Virtualization</h2>

<ul class="menu">
<li><a accesskey="1" href="#What-are-virtualization-and-cloud-computing_003f">What are virtualization and cloud computing?</a>
<li><a accesskey="2" href="#Why-build-virtualization-support-into-CFEngine_003f">Why build virtualization support into CFEngine?</a>
<li><a accesskey="3" href="#What-can-CFEngine-do-with-virtual-machines_003f">What can CFEngine do with virtual machines?</a>
<li><a accesskey="4" href="#Environments-promises">Environments promises</a>
<li><a accesskey="5" href="#Virtualization-types-supported">Virtualization types supported</a>
<li><a accesskey="6" href="#Distinct-states">Distinct states</a>
<li><a accesskey="7" href="#Example-deployment">Example deployment</a>
</ul>

<div class="node">
<a name="What-are-virtualization-and-cloud-computing%3f"></a>
<a name="What-are-virtualization-and-cloud-computing_003f"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Why-build-virtualization-support-into-CFEngine_003f">Why build virtualization support into CFEngine?</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Virtualization">Virtualization</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Virtualization">Virtualization</a>

</div>

<h3 class="section">10.1 What are virtualization and cloud computing?</h3>

<pre class="sp">

</pre>

Virtualization refers to the ability to run multiple host instances on
a single physical node. Cloud computing typically refers to what is
called `platform as a service', or deployment of virtual machines on
demand, often as an on-line service.

   <p>In this document, virtualization support refers specifically to
hypervisor technologies supported by the open source library layer <i>libvirt</i>
project, which includes interfaces for Xen, KVM, Vmware-ESX, and more. 
CFEngine thus integrates freely with other tools based on this library, such
as <i>virsh</i> and the <i>Virtual Manager</i> graphical user interface.

<div class="node">
<a name="Why-build-virtualization-support-into-CFEngine%3f"></a>
<a name="Why-build-virtualization-support-into-CFEngine_003f"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#What-can-CFEngine-do-with-virtual-machines_003f">What can CFEngine do with virtual machines?</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#What-are-virtualization-and-cloud-computing_003f">What are virtualization and cloud computing?</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Virtualization">Virtualization</a>

</div>

<h3 class="section">10.2 Why build virtualization support into CFEngine?</h3>

<pre class="sp">

</pre>

Virtualization engines (usually called supervisors or hypervisors) are
seeing an explosion of development. They exist as a number of projects
in various stages of maturity. The libvirt project was designed as
an integration layer based on an XML specification.

   <p>The tools for management are still quite primitive and require much
manual work. CFEngine has a unique role to play in maintaining desired
state in virtual machine systems.

   <p>In the cloud, virtual machines may be rented from remote commercial
providers, and managed as disposable resources. Convergent or
`self-healing' maintenance is an essential method for managing
machines that are geographically remote and awkward to access, e.g. 
machines in other time-zones that it is impractical to monitor by
legacy methods.

<div class="node">
<a name="What-can-CFEngine-do-with-virtual-machines%3f"></a>
<a name="What-can-CFEngine-do-with-virtual-machines_003f"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Environments-promises">Environments promises</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Why-build-virtualization-support-into-CFEngine_003f">Why build virtualization support into CFEngine?</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Virtualization">Virtualization</a>

</div>

<h3 class="section">10.3 What can CFEngine do with virtual machines?</h3>

<pre class="sp">

</pre>

The simple answer is: most things that <i>libvirt</i> can do, with added
convergence to a desired state: that means, creating, destroying and
starting and stopping machines. By starting virtual machines through
CFEngine, you can be sure that a given `virtual guest' is running on
one and only one physical host, thus avoiding conflicts that are
difficult to detect with centralized systems.

   <p>CFEngine does not support everything that libvirt does &ndash; it offers a
simplified interface that is meant for robustness, stability and
hands-free repeatability.

   <pre class="sp">

</pre>
<p><table class="cartouche" summary="cartouche" border="1"><tr><td>
CFEngine does not use libvirt's TLS based web communication layer.  It
manages every host as an independent entity, in typical CFEngine
fashion, using CFEngine's own distributed cooperation to provide the
implicit communication.  CFEngine does not currently support so-called
`live migration' of virtual machines. 
</td></tr></table>

   <pre class="sp">

</pre>

<div class="node">
<a name="Environments-promises"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Virtualization-types-supported">Virtualization types supported</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#What-can-CFEngine-do-with-virtual-machines_003f">What can CFEngine do with virtual machines?</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Virtualization">Virtualization</a>

</div>

<h3 class="section">10.4 Environments promises</h3>

<pre class="sp">

</pre>

A virtual machine is one example of what CFEngine calls an
`environment'.  You can promise to create (and host) an environment
with certain attributes, just as you can promise to host a file or a
process. Here is a simple example:

<pre class="verbatim">body common control
{
<span class="red">bundlesequence  </span>=> { "my_vm_cloud" };   
}

<span class="comment">#######################################################
</span>

<span class="red">bundle agent</span> <span class="blue">my_vm_cloud</span>
{
<span class="red">environments:
</span>
   "myUbuntu" # the running instance name, defined in XML

<span class="red">       environment_resources </span>=><span class="blue"> virt_xml,</span>
<span class="red">       environment_type      </span>=><span class="green"> "xen",</span>
<span class="red">       environment_host      </span>=><span class="green"> "my_physical_computer", # ipv4_10_1_2_3</span>
<span class="red">       environment_state     </span>=><span class="green"> "create";</span>
}

<span class="comment">#######################################################
</span>

<span class="red">body environment_resources</span> <span class="blue">virt_xml</span>
{
<span class="red">env_spec_file </span>=><span class="green"> "/srv/xen/centos5-libvirt-create.xml";</span>
}

</pre>

     <ul>
<li>The promiser (in this case &lsquo;<samp><span class="samp">myUbuntu</span></samp>&rsquo;) is the name of the virtual
machine. This should be a unique identifier, as we need to be able to
refer to machines uniquely.

     <li>The environment host is the name of the computer that
is the host for the virtual machine.

     <li>Normally when we want to ensure something on a machine, we use classes
to decide where the promise will be made. For environments, however,
we need to make promises about the uniqueness of the machine. When you
make a machine instance you normally want it to be running on one and
only one host. So you want <i>every</i> machine to make a promise. On the
environment's host, you want to promise that the environment is
running, and on every other machine you want to promise that it is
not. In CFEngine, you simply include a unique class belonging to host
in the promise using <code>environment_host</code> and CFEngine assumes that
rest. Unique classes might include
          <ul>
<li>Hostname class e.g. <code>myhost_CFEngine_com</code>
<li>IP address class e.g. <code>ipv4_123_456_789_123</code>
</ul>
     </ul>

   <p>An alternative way to write this example is to quote the XML
specification in CFEngine directly. This has a few advantages: you can
re-use the data and use it as a template, filling in
CFEngine-variables. You can thus adapt the configuration using
CFEngine's classes.

<pre class="verbatim">bundle agent my_vm_cloud
{
<span class="red">environments:
</span>
   "myUbuntu" # the running instance name, defined in XML
<span class="red">       environment_resources </span>=><span class="blue"> virt_xml("$(this.promiser)"),</span>
<span class="red">       environment_type      </span>=><span class="green"> "xen",</span>
<span class="red">       environment_host      </span>=><span class="green"> "myphysicalcomputer";</span>
<span class="red">       environment_state     </span>=><span class="green"> "create"</span>
}

<span class="comment">#######################################################
</span>

<span class="red">body environment_resources</span> <span class="blue">virt_xml(host)</span>
{
<span class="red">env_spec_file </span>=><span class="blue"> </span>

"&lt;domain type='xen'>
  &lt;name>$(host)&lt;/name>
  &lt;os>
    &lt;type>linux&lt;/type>
    &lt;kernel>/var/lib/xen/install/vmlinuz-ubuntu10.4-x86_64&lt;/kernel>
    &lt;initrd>/var/lib/xen/install/initrd-vmlinuz-ubuntu10.4-x86_64&lt;/initrd>
<span class="red">    &lt;cmdline> kickstart=http://example.com/myguest.ks &lt;/cmdline>
</span>  &lt;/os>
  &lt;memory>131072&lt;/memory>
  &lt;vcpu>1&lt;/vcpu>
  &lt;devices>
    &lt;disk type='file'>
      &lt;source file='/var/lib/xen/images/$(host).img'/>
      &lt;target dev='sda1'/>
    &lt;/disk>
    &lt;interface type='bridge'>
      &lt;source bridge='xenbr0'/>
<span class="red">      &lt;mac address='aa:00:00:00:00:11'/>
</span>      &lt;script path='/etc/xen/scripts/vif-bridge'/>
    &lt;/interface>
    &lt;graphics type='vnc' port='-1'/>
    &lt;console tty='/dev/pts/5'/>
  &lt;/devices>
&lt;/domain>
";
}
</pre>

   <p>You should consult the libvirt documentation for the details of the XML specification.

<div class="node">
<a name="Virtualization-types-supported"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Distinct-states">Distinct states</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Environments-promises">Environments promises</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Virtualization">Virtualization</a>

</div>

<h3 class="section">10.5 Virtualization types supported</h3>

<pre class="sp">

</pre>

CFEngine currently supports virtualization only through libvirt, so it supports
those technologies that libvirt supports. Currently this includes  most popular
technologies. You must choose the type of monitor that is to be responsible for
keeping the environment promise. In CFEngine, you should choose between a
machine environment or network environment of the following types:
     <dl>
<dt><code>xen</code><dd>A Xen hypervisor virtual domain. 
<br><dt><code>kvm</code><dd>A KVM hypervisor virtual domain. 
<br><dt><code>esx</code><dd>A VMware hypervisor virtual domain. 
<br><dt><code>test</code><dd>The libvirt test-hypervisor virtual domain. 
<br><dt><code>xen_net</code><dd>A Xen hypervisor virtual network. 
<br><dt><code>kvm_net</code><dd>A KVM hypervisor virtual network
<br><dt><code>esx_net</code><dd>An ESX/VMWare hypervisor virtual network. 
<br><dt><code>test_net</code><dd>The test hypervisor virtual network. 
<br><dt><code>zone</code><dd>A Solaris zone (future development)
<br><dt><code>ec2</code><dd>An Amazon EC2 instance (future development)
<br><dt><code>eucalyptus</code><dd>A Eucalyptus instance (future development)
</dl>

   <p>Once again, you must consult the libvirt documentation for details.

<div class="node">
<a name="Distinct-states"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Example-deployment">Example deployment</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Virtualization-types-supported">Virtualization types supported</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Virtualization">Virtualization</a>

</div>

<h3 class="section">10.6 Distinct states</h3>

<pre class="sp">

</pre>

Libvirt recognizes a number of distinct states are transliterated into CFEngine
as
     <dl>
<dt><code>create</code><dd>Build and start an environment. 
<br><dt><code>delete</code><dd>Halt and remove runtime resources associated with an environment. 
<br><dt><code>running</code><dd>An existing environment is in a running state. 
<br><dt><code>suspended</code><dd>An existing environment is in a `paused' state. 
<br><dt><code>down</code><dd>An existing environment is in a halted state. 
</dl>
   The default promised state is for a machine to be running
wherever the  <code>environment_host</code> class is true, and
suspended or down elsewhere.

<div class="node">
<a name="Example-deployment"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Distinct-states">Distinct states</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Virtualization">Virtualization</a>

</div>

<h3 class="section">10.7 Example deployment</h3>

<pre class="sp">

</pre>

Prerequisites: you need to make a `disk image' for the machine, or a
virtual disk of blocks that can be allocated. This image does not have to
contain any data, it will simply as a block device for the VM. You
can then install it by booting the machine from a network image, like a
PXE/kickstart installation.

   <p>If you want to allocate disk blocks as the file grows, you can create
a file with a hole. The following command will creates a file of
2048MB, but the actual data blocks are allocated in a lazy fashion:

<pre class="verbatim">
<span class="comment"># dd if=/dev/zero of=/srv/xen/my.img oflag=direct bs=1M seek=2047 count=1
</span>

</pre>
To reserve all the data blocks right away:
<pre class="verbatim">
<span class="comment"># dd if=/dev/zero of=/srv/xen/my.img oflag=direct bs=1M count=2048
</span>

</pre>

   <p>Libvirt uses an XML file format that cannot be circumvented. CFEngine
promises to honor the promises that are expressed in this file, as in
the examples above.  You need to find out about this file format from
the libvirt website.  To get CFEngine to Honor these promises, you
point it to the specification that it should promise using
<code>spec_file</code>.

   <p>You need to set up a network for virtual machines to communicate with
the outside world. This can also be done with CFEngine, using the
network promise types to build a bridge into a virtual network.

   <p>Then just run CFEngine to start, stop or manage the virtual environments on
each localhost. Run in verbose mode to see how CFEngine maintains the states
convergently.
<pre class="verbatim"># cf-agent -v
</pre>

<!-- ***************************************************** -->
<!-- * CHAPTER -->
<!-- ***************************************************** -->
<div class="node">
<a name="Content-Driven-Policies"></a>
<a name="Content_002dDriven-Policies"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Windows_002dspecific-features-in-Nova">Windows-specific features in Nova</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Virtualization">Virtualization</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">11 Content-Driven Policies</h2>

<p>In Nova 2.0, Content-Driven Policies (CDP) were introduced to make
policy management easier. In contrast to policies written in the
CFEngine language, these are semi-colon separated fields in a text
file that the user just fills with content. All the underlying
enforcement and reporting are taken care of automatically by Nova.

   <p>For example, to manage three Windows services, the following
services-CDP will suffice.

<pre class="verbatim"># masterfiles/cdp_inputs/service_list.txt

Dnscache;stop;fix;windows
ALG;start;warn;windows
RemoteRegistry;start;fix;Windows_Server_2008

</pre>

   <p>The meanings of the fields are different depending of the CDP-type,
but explained in the file header. With these three lines, we ensure
the correct status of three services on all our Windows machines and
are given specialized reports on the outcome.

<!-- The Content-Driven Policy services report is shown below. -->
<!-- @image{cdp_services_report,15cm,,The Content-Driven Policy services report,png} -->
<h3 class="section">11.1 Benefits of Content-Driven Policies</h3>

<p>As seen in the example above, Content-Driven Policies are easy to
write and maintain, especially for users unfamiliar with the CFEngine
language. They are designed to capture the essence of a specific,
popular use of CFEngine, and make it easier. For example, the services
Content-Driven Policy above has the following equivalent in the
CFEngine language.

<pre class="smallexample">     
     bundle agent service_example
     {
     services:
     
       "Dnscache"
         comment            =&gt; "Check services status of Dnscache",
         handle             =&gt; "srv_Dnscache_windows",
         service_policy     =&gt; "stop",
         service_method     =&gt; force_deps,
         action             =&gt; policy("fix"),
         ifvarclass         =&gt; "windows";
     
       "ALG"
         comment            =&gt; "Check services status of ALG",
         handle             =&gt; "srv_ALG_windows",
         service_policy     =&gt; "start",
         service_method     =&gt; force_deps,
         action             =&gt; policy("warn"),
         ifvarclass         =&gt; "windows";
     
       "RemoteRegistry"
         comment            =&gt; "Check services status of ALG",
         handle             =&gt; "srv_ALG_windows",
         service_policy     =&gt; "start",
         service_method     =&gt; force_deps,
         action             =&gt; policy("fix"),
         ifvarclass         =&gt; "Windows_Server_2008";
     
     }
     
</pre>
   <p>Writing this policy is clearly more time-consuming and error-prone. On
the other hand, it allows for much more flexibility than Content-Driven
Policies, when that is needed.

   <p>CFEngine provides Content-Driven Policies to cover mainstream
management tasks like the following.

     <ul>
<li>File change/difference management
<li>Service management
<li>Database management
<li>Application / script management
</ul>

<h3 class="section">11.2 Getting started</h3>

<p>All the CDP input files are located in
<code>/var/cfengine/masterfiles/cdp_inputs</code> on your policy hub. Nova
is bundled with some examples, but ensure to <em>edit the examples
before enabling them</em>.

   <p>To enable all the CDPs located in <code>cdp_inputs/</code>, open
<code>promises.cf</code> in your masterfiles directory. Remove the comment
(<code>#</code>) in front of the cdp entries in <code>bundlesequence</code> and
<code>inputs</code>, to make it look like the following.

<pre class="verbatim">bundlesequence => {
                  "def",
                  "cfengine_management",
                  "service_catalogue",
                  "cdp",
...

<span class="red">        inputs </span>=> {
...
                  "cdp_lib/cdp.cf",
                  "cdp_lib/cdp_acls.cf",
                  "cdp_lib/cdp_registry.cf",
                  "cdp_lib/cdp_file_changes.cf",
                  "cdp_lib/cdp_file_diffs.cf",
                  "cdp_lib/cdp_services.cf",
                  "cdp_lib/cdp_commands.cf",
...
</pre>

   <p>When the hosts start reporting back on the outcome of these policies
(usually within 10 minutes), you can view the reports in the CDP reports viewer or from your
Knowledge Map on the policy hub.

<!-- Go to the @code{Status} tab, find the -->
<!-- Content-Driven Policies drop-down, select the CDP type -->
<!-- (e.g. @code{Services}) and click @code{Generate}. -->
<!-- @image{cdp_reports_generate,15cm,,Generating Content-Driven Policy reports,png} -->
<!-- ***************************************************** -->
<!-- * CHAPTER -->
<!-- ***************************************************** -->
<div class="node">
<a name="Windows-specific-features-in-Nova"></a>
<a name="Windows_002dspecific-features-in-Nova"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Configuration-of-external-authentication">Configuration of external authentication</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Content_002dDriven-Policies">Content-Driven Policies</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">12 Windows-specific features in Nova</h2>

<p>In this section, we will explore the Windows-specific features of the
native Windows version of CFEngine 3 Nova, and how it integrates with
Windows. We will also consider features that are more interesting or
popular on Windows than on other platforms.

   <p>Feature highlights include Windows service management and integration,
event logging, Windows registry repair, and fine-tuned file security
support through access control lists. See the sections on databases
and ACLs to find information on Windows registry repair and NTFS ACLs,
respectively. We will look at some of the other added features next.

<h3 class="section">12.1 Windows service management</h3>

<p>CFEngine 3 Nova can maintain complete control of the state of all
Windows services, in addition to Unix daemons. Services prone to
security issues or errors can easily be given a disabled state.

   <div class="block-image"><img src="winservice-disabled_policy.png" alt="Disabled Windows service"></div>

   <p>A service can also be given a running state, in which case CFEngine
Nova ensures that it is running, and starts it if it is not, with
parameters if desired. More advanced policy options are also
available, including support for starting and stopping dependencies,
and configuring when the services should be started (e.g. only when
they are being used).

   <p>Furthermore, the CFEngine executor in Nova now runs as a Windows
service itself. This means it runs in the background an starts with
Windows, before any user logs in. It can be configured, started and
stopped from the &ldquo;Services&rdquo; listing in Windows.

   <p>Note that the name of a service in Windows may be different from its
&ldquo;Display name&rdquo;. CFEngine 3 Nova policies use the name, not the display
name, due to the need of uniqueness.

   <div class="block-image"><img src="winservice-properties_name.png" alt="Windows service name and Display name"></div>

<h3 class="section">12.2 Windows event logging</h3>

<p>Event logs are the Windows counterpart to syslog from Unix. The main
difference is that event logs aim to group similar log messages,
giving each group an event id.

   <div class="block-image"><img src="winevent-repaired-acl-closeup.png" alt="Promise repaired in Event Viewer"></div>

   <p>A program that creates logs, such as CFEngine 3 Nova, must define the
possible event IDs, and their meaning. In many applications, only one
event id is defined, a generic log message. However, CFEngine 3 Nova
defines the following range of event IDs, which allows for automatic
handling of log messages.

   <p><table summary=""><tr align="left"><th valign="top" width="40%">Description </th><th valign="top" width="20%">Event ID </th><th valign="top" width="20%">Type
<br></th></tr><tr align="left"><td valign="top" width="40%">Promise kept </td><td valign="top" width="20%">100 </td><td valign="top" width="20%">Information
<br></td></tr><tr align="left"><td valign="top" width="40%">Promise repaired </td><td valign="top" width="20%">101 </td><td valign="top" width="20%">Information
<br></td></tr><tr align="left"><td valign="top" width="40%">Promise not repaired due warn only policy </td><td valign="top" width="20%">102 </td><td valign="top" width="20%">Error
<br></td></tr><tr align="left"><td valign="top" width="40%">Promise not repaired due to error </td><td valign="top" width="20%">103 </td><td valign="top" width="20%">Error
<br></td></tr><tr align="left"><td valign="top" width="40%">Report promise </td><td valign="top" width="20%">104 </td><td valign="top" width="20%">Information
<br></td></tr><tr align="left"><td valign="top" width="40%">Generic information </td><td valign="top" width="20%">105 </td><td valign="top" width="20%">Information
<br></td></tr><tr align="left"><td valign="top" width="40%">Generic verbose </td><td valign="top" width="20%">106 </td><td valign="top" width="20%">Information
<br></td></tr><tr align="left"><td valign="top" width="40%">Generic warning </td><td valign="top" width="20%">107 </td><td valign="top" width="20%">Warning
<br></td></tr><tr align="left"><td valign="top" width="40%">Generic error </td><td valign="top" width="20%">108 </td><td valign="top" width="20%">Error
   <br></td></tr></table>

   <div class="block-image"><img src="winevent-notkept-storage.png" alt="Promise not kept in Event Viewer"></div>

   <p>The Nova event logs can be found under the &ldquo;System&rdquo; logs.  Almost
all monitoring products for Windows supports reading event logs, and
they can thus monitor logs from CFEngine 3 Nova as well. This makes it
possible to do more advanced querying on the status of a machine
running CFEngine 3 Nova, e.g. to show all promises that have not been
kept in a certain time interval. However, we recommend using the
Knowledge Map to do more advanced things, as it is specifically made
for this purpose and supports all operating systems that CFEngine runs
on.

<h3 class="section">12.3 Windows special variables</h3>

<p>Three new special variables have been added to the Windows version of
CFEngine 3 Nova.

     <ul>
<li><code>sys.windir</code> contains the Windows directory,
e.g. &ldquo;C:\WINDOWS&rdquo;.

     <li><code>sys.winsysdir</code> contains the Windows system directory,
e.g. &ldquo;C:\WINDOWS\system32&rdquo;.

     <li><code>sys.winprogdir</code> contains the program files directory,
e.g. &ldquo;C:\Program Files&rdquo;.

   </ul>

   <p>Note that these variables are not statically coded, but retrieved from
the current system. For example, <code>sys.winprogdir</code> is often
different on Windows versions in distinct languages.

<h3 class="section">12.4 Windows hard classes</h3>

<p>The Windows version of CFEngine 3 Nova defines hard classes to pinpoint
the exact version of Windows that it is running on, the service pack
version and if it's a server or workstation.

   <p>First of all, the class <code>windows</code> is defined on all Windows
platforms. For Windows workstations, such as Windows XP,
<code>WinWorkstation</code> is defined. On Windows servers, such as Windows
Server 2003, <code>WinServer</code> is defined. In addition, if the server
is a domain controller, <code>DomainController</code> is defined. Note that
if <code>DomainController</code> is defined, then <code>WinServer</code> is also
defined, for natural reasons.

   <p>The class <code>Service_Pack_X_Y</code> is defined according to the service
pack version. For example, at the time of writing,
<code>Service_Pack_3_0</code> is set on an updated Windows XP operating
system.

   <p>To allow taking specific actions on different Windows versions, one
of the following hard classes is defined.

     <ul>
<li><code>Windows_7</code>
<li><code>Windows_Server_2008_R2</code>
<li><code>Windows_Server_2008</code>
<li><code>Windows_Vista</code>
<li><code>Windows_Server_2003_R2</code>
<li><code>Windows_Home_Server</code>
<li><code>Windows_Server_2003</code>
<li><code>Windows_XP_Professional_x64_Edition</code>
<li><code>Windows_XP</code>
<li><code>Windows_2000</code>
</ul>

   <p>Note that all defined hard classes for a given system is shown by
running <code>cf-promises -v</code>.

<h3 class="section">12.5 Notes on windows policies</h3>

<p>A potential problem source when writing policies for windows is that
paths to executables often contain spaces. This makes it impossible
for CFEngine to know where the executable ends and the parameters to
it starts. To solve this, we place escaped quotes around the
executable.

   <p>Additionally, Windows does not support that processes start themselves
in in the background (i.e. fork off a child process in the Unix
world). The result is that CFEngine is always waiting for the commands
to finish execution before checking the next promise. To avoid this,
use the background attribute in the action body-part.

   <p>Both these things are demonstrated in the following example.

<pre class="verbatim">
<span class="red">body common control
</span>{
<span class="red">bundlesequence  </span>=> { "main" };
}

<span class="red">bundle agent</span> <span class="blue">main</span>
{
<span class="red">commands:
</span>
<span class="red">"\"C:\Program Files\Some Dir\program name.bat\" --silent --batch"
</span><span class="red">  action </span>=><span class="blue"> background;</span>
}

<span class="red">body action</span> <span class="blue">background</span>
{
<span class="red">background </span>=><span class="green"> "true";</span>
}

</pre>

   <p>Finally, one should note that Windows lacks support for certain
features that are utilized in Unix versions of CFEngine. These include
symbolic links, file groups, user and group identifiers.

   <p>Thus, the parts of promises containing these features will be
ignored. For example, the <code>getgid()</code> function does not return
anything on Windows. The reference manual documents exactly which
promises are ignored and not.  Also, <code>cf-agent</code> from CFEngine
Nova prints warning messages on ignored attributes when run in verbose
mode.

<!-- ***************************************************** -->
<!-- * APPENDIX -->
<!-- ***************************************************** -->
<div class="node">
<a name="Configuration-of-external-authentication"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Configure-LDAP">Configure LDAP</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Windows_002dspecific-features-in-Nova">Windows-specific features in Nova</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="appendix">Appendix A Configuration of external authentication</h2>

<p>External authentication is available for CFEngine 3 Nova and up, but by default the Mission Portal will use the embedded database to store user information (default user name and password are "admin" and "admin"). Note that users in the default database will be locked out of the Mission Portal upon configuration of external authentication. They will regain access if external authentication is deactivated by selecting the Database button on the Mission Portal Settings page (see below).

   <p>To enable external authentication on a fresh install, log on to the Mission Portal with the default user and password and go to "Settings". Click "Mission Portal Settings" and enter the appropriate configuration for LDAP or Active Directory as described below.

<ul class="menu">
<li><a accesskey="1" href="#Configure-LDAP">Configure LDAP</a>
<li><a accesskey="2" href="#Configure-Active-Directory">Configure Active Directory</a>
<li><a accesskey="3" href="#Directory-structure">Directory structure</a>
</ul>

<div class="node">
<a name="Configure-LDAP"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Configure-Active-Directory">Configure Active Directory</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Configuration-of-external-authentication">Configuration of external authentication</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Configuration-of-external-authentication">Configuration of external authentication</a>

</div>

<h3 class="section">A.1 Configure LDAP</h3>

<p>Select the LDAP button and enter the appropriate configuration settings for your system.

   <pre class="sp">

</pre>
<div align="center"><img src="img-configldap.png" alt="Configure LDAP"></div>
<div align="center">Figure: Configure LDAP</div>
   <pre class="sp">

</pre>

Form fields:

     <ul>
<li>LDAP host: Address of the LDAP machine
<li>Base dn: LDAP root, the top entry (starting point) in the directory
<li>Login attribute: Field name used to match user name, e.g. uid. 
<li>User directory: Directory name where user names are stored, e.g. cn=users or ou=people
<li>Member attribute: Field name used to match user group (only needed for OPENLDAP), e.g. memberUid
</ul>

   <p>Always check that the entered configuration is correct by clicking the "Test it" button before submitting changes. Enter a valid user name and password in the popup to test LDAP bind. Submitting an incorrect configuration will put LDAP down and lock out all users, CFE Nova therefore comes with a fallback solution. Select a fallback administrator group in the database from the dropbox, CFE Nova will look for users in this group when an incorrect configuration has been passed. A member of this group will then be able to log on to the Mission Portal using his database user name and password and restart the external authentication configuration.

   <p>Also select which user group will have general administrator privileges in the Mission Portal. This group will be able to access the Mission Portal settings and configuration tools.

<!--  -->
<div class="node">
<a name="Configure-Active-Directory"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Directory-structure">Directory structure</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Configure-LDAP">Configure LDAP</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Configuration-of-external-authentication">Configuration of external authentication</a>

</div>

<h3 class="section">A.2 Configure Active Directory</h3>

<p>Select the Active Directory button.

   <pre class="sp">

</pre>
<div align="center"><img src="img-configactivedirectory.png" alt="Configure Active Directory"></div>
<div align="center">Figure: Configure Active Directory</div>
   <pre class="sp">

</pre>

Form fields:

     <ul>
<li>LDAP host: Address of the LDAP machine
<li>Base dn: LDAP root, the top entry (starting point) in the directory
<li>Login attribute: Field name used to match user name, e.g. uid. 
<li>User directory: Directory name where user names are stored, e.g. cn=users or ou=people
<li>Active directory domain: Field name used to match directory domain on Windows machines, e.g. windows1.test.cfengine.com
</ul>

   <p>Always check that the entered configuration is correct by clicking the "Test it" button before submitting changes. Enter a valid user name and password in the popup to test LDAP bind. Submitting an incorrect configuration will put LDAP down and lock out all users, CFE Nova therefore comes with a fallback solution. Select a fallback administrator group in the database from the dropbox, CFE Nova will look for users in this group when an incorrect configuration has been passed. A member of this group will then be able to log on to the Mission Portal using his database user name and password and restart the external authentication configuration.

   <p>Also select which user group will have general administrator privileges in the Mission Portal. This group will be able to access the Mission Portal settings and configuration tools.

<div class="node">
<a name="Directory-structure"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Configure-Active-Directory">Configure Active Directory</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Configuration-of-external-authentication">Configuration of external authentication</a>

</div>

<h3 class="section">A.3 Directory structure</h3>

<p>The Mission Portal imposes some limitations on directory structure for the use of external authentication. All users have to be stored in a direct child directory of the root (base dn). You may use subdirectories if you need to organize users into categories, but do not put more than one user directory directly under the root (base dn) as the user search will only cover the first encountered directory.

   <p>The same counts for group directories.

<!-- ========================================================================= -->
<!-- @node Index,  , CFEngine Methods, Top -->
<!-- @unnumbered Concept Index -->
<!-- @printindex cp -->
<!-- ========================================================================= -->
   <p><a name="Contents">
   <div class="contents">
<h2>Table of Contents</h2>
<ul>
<li><a name="toc_Top" href="#Top">CFEngine 3 Nova Owner's Manual</a>
<li><a name="toc_Introduction" href="#Introduction">1 Introduction</a>
<li><a name="toc_Requirements" href="#Requirements">2 Requirements</a>
<ul>
<li><a href="#Hardware-requirements">2.1 Hardware requirements</a>
<li><a href="#Operating-system-support">2.2 Operating system support</a>
</li></ul>
<li><a name="toc_Installing-CFEngine-3-Nova" href="#Installing-CFEngine-3-Nova">3 Installing CFEngine 3 Nova</a>
<ul>
<li><a href="#Installation-procedure">3.1 Installation procedure</a>
<li><a href="#Troubleshooting">3.2 Troubleshooting</a>
<ul>
<li><a href="#Apache-HTTP-error_005flog-is-your-friend">3.2.1 Apache HTTP error_log is your friend</a>
<li><a href="#Some-report-pages-return-HTTP-error-404">3.2.2 Some report pages return HTTP error 404</a>
<li><a href="#First-time-login-to-Mission-Portal-fails">3.2.3 First time login to Mission Portal fails</a>
<li><a href="#Cannot-send-emails-from-the-Mission-Portal">3.2.4 Cannot send emails from the Mission Portal</a>
<li><a href="#Warning-messages-on-web-pages-in-SLES_002fOpenSuSE-Hub">3.2.5 Warning messages on web pages in SLES/OpenSuSE Hub</a>
<li><a href="#Knowledge-map-remains-unpopulated">3.2.6 Knowledge map remains unpopulated</a>
</li></ul>
<li><a href="#Frequently-Asked-Questions">3.3 Frequently Asked Questions</a>
<ul>
<li><a href="#Frequently-Asked-Questions">3.3.1 How do I install the prerequisites for the hub manually?</a>
<li><a href="#Frequently-Asked-Questions">3.3.2 Why do I get a promise failed with the message <code>Can't stat</a>
<li><a href="#Frequently-Asked-Questions">3.3.3 I did bootstrap the hub <em>before</em> obtaining a license file, what should I do?</a>
<li><a href="#Frequently-Asked-Questions">3.3.4 On my hub, I get messages of connection failures to a database. For example, in <code>messages</code>, I can see something like <code>!! Could not open connection to report database for saving</code>. What should I do?, How do I upgrade from CFEngine Community 3 to CFEngine 3 Nova?,</a>
<li><a href="#Frequently-Asked-Questions">3.3.5 How do I upgrade from CFEngine Community 3 to CFEngine 3 Nova?</a>
</li></ul>
</li></ul>
<li><a name="toc_Upgrading-CFEngine-Nova" href="#Upgrading-CFEngine-Nova">4 Upgrading CFEngine Nova</a>
<ul>
<li><a href="#Upgrade-procedure">4.1 Upgrade procedure</a>
<li><a href="#How-can-I-do-phased-deployment_003f">4.2 How can I do phased deployment?</a>
<li><a href="#What-if-I-have-multiple-operating-system-platforms_003f">4.3 What if I have multiple operating system platforms?</a>
<li><a href="#How-do-Nova-policies-update-if-I-already-have-my-own-policy_003f">4.4 How do Nova policies update if I already have my own policy?</a>
</li></ul>
<li><a name="toc_Mission-Portal" href="#Mission-Portal">5 Mission Portal</a>
<ul>
<li><a href="#Mission-Portal-Rooms">5.1 Mission Portal Rooms</a>
<ul>
<li><a href="#Mission-Status">5.1.1 Mission Status</a>
<li><a href="#Mission-Engineering">5.1.2 Mission Engineering</a>
<li><a href="#Mission-Planning">5.1.3 Mission Planning</a>
<li><a href="#Mission-Library">5.1.4 Mission Library</a>
</li></ul>
<li><a href="#Finders">5.2 Finders</a>
<ul>
<li><a href="#Host-finder">5.2.1 Host finder</a>
<li><a href="#Class-finder">5.2.2 Class finder</a>
<li><a href="#Promise-finder">5.2.3 Promise finder</a>
<li><a href="#Report-finder">5.2.4 Report finder</a>
<li><a href="#Summary-report-finder">5.2.5 Summary report finder</a>
<li><a href="#CDP-report-finder">5.2.6 CDP report finder</a>
<li><a href="#Topic-finder">5.2.7 Topic finder</a>
</li></ul>
<li><a href="#Viewers">5.3 Viewers</a>
<ul>
<li><a href="#Host-viewer">5.3.1 Host viewer</a>
<li><a href="#Bundle-viewer">5.3.2 Bundle viewer</a>
<li><a href="#Promise-viewer">5.3.3 Promise viewer</a>
<li><a href="#Vital-signs-viewer">5.3.4 Vital signs viewer</a>
<li><a href="#Topics-viewer-_0028Knowledge-map_0029">5.3.5 Topics viewer (Knowledge map)</a>
<li><a href="#Weakest-hosts-viewer">5.3.6 Weakest hosts viewer</a>
<li><a href="#Report-viewer">5.3.7 Report viewer</a>
</li></ul>
<li><a href="#Editors">5.4 Editors</a>
<ul>
<li><a href="#Policy-editor">5.4.1 Policy editor</a>
<li><a href="#Integration-with-subversion">5.4.2 Integration with subversion</a>
</li></ul>
<li><a href="#Mission-Portal-Administration">5.5 Mission Portal Administration</a>
<ul>
<li><a href="#Mission-Portal-Settings">5.5.1 Mission Portal Settings</a>
<li><a href="#Mission-Portal-User-Admin">5.5.2 Mission Portal User Admin</a>
<li><a href="#Troubleshooting-_002d-Mission-Portal-Logs">5.5.3 Troubleshooting - Mission Portal Logs</a>
</li></ul>
</li></ul>
<li><a name="toc_Monitoring-extensions" href="#Monitoring-extensions">6 Monitoring extensions</a>
<ul>
<li><a href="#Integration-of-monitoring-with-knowledge-base">6.1 Integration of monitoring with knowledge base</a>
<li><a href="#Long-term-trends">6.2 Long term trends</a>
<li><a href="#Custom-promises-to-measure">6.3 Custom promises to measure</a>
<ul>
<li><a href="#Extraction-strings-and-logging">6.3.1 Extraction strings and logging</a>
<li><a href="#Extracting-one_002doff-numerical-data">6.3.2 Extracting one-off numerical data</a>
<li><a href="#Extraction-to-list-variable">6.3.3 Extraction to list variable</a>
</li></ul>
<li><a href="#Uses-for-custom-monitoring">6.4 Uses for custom monitoring</a>
</li></ul>
<li><a name="toc_File-Access-Control-Lists" href="#File-Access-Control-Lists">7 File Access Control Lists</a>
<ul>
<li><a href="#ACL-Introduction">7.1 ACL Introduction</a>
<li><a href="#File-ACL-example">7.2 File ACL example</a>
<ul>
<li><a href="#Concepts">7.2.1 Concepts</a>
<li><a href="#Entity-types">7.2.2 Entity types</a>
<li><a href="#Owners">7.2.3 Owners</a>
<li><a href="#Changing-owner">7.2.4 Changing owner</a>
<li><a href="#Permissions">7.2.5 Permissions</a>
<li><a href="#Deny-permissions">7.2.6 Deny permissions</a>
<li><a href="#Changing-permissions">7.2.7 Changing permissions</a>
<li><a href="#Effective-permissions">7.2.8 Effective permissions</a>
<li><a href="#Inheritance">7.2.9 Inheritance</a>
</li></ul>
<li><a href="#CFEngine-3-Generic-ACL-Syntax">7.3 CFEngine 3 Generic ACL Syntax</a>
<ul>
<li><a href="#Generic-syntax-examples">7.3.1 Generic syntax examples</a>
</li></ul>
<li><a href="#POSIX-ACL-type">7.4 POSIX ACL type</a>
<ul>
<li><a href="#POSIX_002dspecific-ACL-syntax">7.4.1 POSIX-specific ACL syntax</a>
<li><a href="#Generic-syntax-mapping">7.4.2 Generic syntax mapping</a>
<li><a href="#POSIX-ACL-examples">7.4.3 POSIX ACL examples</a>
</li></ul>
<li><a href="#NT-ACL-type">7.5 NT ACL type</a>
<ul>
<li><a href="#NT_002dspecific-ACL-syntax">7.5.1 NT-specific ACL syntax</a>
<li><a href="#NT_002dspecific-ACL-syntax">7.5.2 Generic syntax mapping</a>
<li><a href="#NT_002dspecific-ACL-syntax">7.5.3 NT ACL examples</a>
</li></ul>
</li></ul>
<li><a name="toc_Server-extensions" href="#Server-extensions">8 Server extensions</a>
<ul>
<li><a href="#Server-access-resource-type">8.1 Server access resource type</a>
<li><a href="#Function-remotescalar">8.2 Function <code>remotescalar</code></a>
<li><a href="#Example-remote-scalar-lookup">8.3 Example remote scalar lookup</a>
</li></ul>
<li><a name="toc_Environments-and-workflows" href="#Environments-and-workflows">9 Environments and workflows</a>
<ul>
<li><a href="#Environments-in-Nova">9.1 Environments in Nova</a>
<li><a href="#Implementing-workflows-in-Nova">9.2 Implementing workflows in Nova</a>
</li></ul>
<li><a name="toc_Virtualization" href="#Virtualization">10 Virtualization</a>
<ul>
<li><a href="#What-are-virtualization-and-cloud-computing_003f">10.1 What are virtualization and cloud computing?</a>
<li><a href="#Why-build-virtualization-support-into-CFEngine_003f">10.2 Why build virtualization support into CFEngine?</a>
<li><a href="#What-can-CFEngine-do-with-virtual-machines_003f">10.3 What can CFEngine do with virtual machines?</a>
<li><a href="#Environments-promises">10.4 Environments promises</a>
<li><a href="#Virtualization-types-supported">10.5 Virtualization types supported</a>
<li><a href="#Distinct-states">10.6 Distinct states</a>
<li><a href="#Example-deployment">10.7 Example deployment</a>
</li></ul>
<li><a name="toc_Content_002dDriven-Policies" href="#Content_002dDriven-Policies">11 Content-Driven Policies</a>
<ul>
<li><a href="#Content_002dDriven-Policies">11.1 Benefits of Content-Driven Policies</a>
<li><a href="#Content_002dDriven-Policies">11.2 Getting started</a>
</li></ul>
<li><a name="toc_Windows_002dspecific-features-in-Nova" href="#Windows_002dspecific-features-in-Nova">12 Windows-specific features in Nova</a>
<ul>
<li><a href="#Windows_002dspecific-features-in-Nova">12.1 Windows service management</a>
<li><a href="#Windows_002dspecific-features-in-Nova">12.2 Windows event logging</a>
<li><a href="#Windows_002dspecific-features-in-Nova">12.3 Windows special variables</a>
<li><a href="#Windows_002dspecific-features-in-Nova">12.4 Windows hard classes</a>
<li><a href="#Windows_002dspecific-features-in-Nova">12.5 Notes on windows policies</a>
</li></ul>
<li><a name="toc_Configuration-of-external-authentication" href="#Configuration-of-external-authentication">Appendix A Configuration of external authentication</a>
<ul>
<li><a href="#Configure-LDAP">A.1 Configure LDAP</a>
<li><a href="#Configure-Active-Directory">A.2 Configure Active Directory</a>
<li><a href="#Directory-structure">A.3 Directory structure</a>
</li></ul>
</li></ul>
</div>



<!-- The file is structured like a programming language. Each chapter -->
<!-- starts with a chapter comment. -->
<!-- Menus list the subsections so that an online info-reader can parse -->
<!-- the file hierarchically. -->
   <p><script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-2576171-2");
pageTracker._initData();
pageTracker._trackPageview();
</script>

   <div class="footnote">
<hr>
<a name="texinfo-footnotes-in-document"></a><h4>Footnotes</h4><p class="footnote"><small>[<a name="fn-1" href="#fnd-1">1</a>]</small> Major version 3</p>

   <p class="footnote"><small>[<a name="fn-2" href="#fnd-2">2</a>]</small> You will obtain credentials to the CFEngine Support ticketing system and software download repository as a part of your purchase.</p>

   <p class="footnote"><small>[<a name="fn-3" href="#fnd-3">3</a>]</small> Blue hosts will not appear here</p>

   <p class="footnote"><small>[<a name="fn-4" href="#fnd-4">4</a>]</small> You have to stop CFEngine on the concerned host before deleting it in the Mission Portal, else the host will contact the hub and re-appear in the database.</p>

   <p class="footnote"><small>[<a name="fn-5" href="#fnd-5">5</a>]</small> Predicted mean based on a weighted average. The weights used in computing this mean correspond to the probabilities in case of a discrete random variable, or densities in case of a continuous random variable.</p>

   <p class="footnote"><small>[<a name="fn-6" href="#fnd-6">6</a>]</small> You have to stop CFEngine on the concerned host before deleting it in the Mission Portal, else the host will contact the hub and re-appear in the database.</p>

   <p class="footnote"><small>[<a name="fn-7" href="#fnd-7">7</a>]</small> Blue hosts will not appear</p>

   <hr></div>

</body></html>


