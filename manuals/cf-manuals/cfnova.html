<html lang="en">
<head>
<title>CFEngine Nova Technical Supplement</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="CFEngine Nova Technical Supplement">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="top" href="#Top">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; }
  span.sansserif { font-family:sans-serif; font-weight:normal; }
body {
	font-family: Verdana, DejaVu, Vera, Geneva, sans-serif;
	padding: 10px;
}
.node
{
	text-align: right;
	padding: 2px;
	font-size: smaller;
}
.node hr {
	border: 0;
	width: 100%;
	color: #CCC;
	background-color: #CCC;
	height: 5px;
}
.section {
	padding-right: 0px;
	padding-bottom: 0px;
	padding-left: 0px;
}
h1 {
	font-weight: bold;
	color: #666;
}
h2 {
	font-weight: bold;
	color: #666;
}
h3 {
	margin-top: 3px;
	margin-right: 0px;
	margin-bottom: 10px;
	margin-left: 0px;
}

.menu
{
}

.contents
{
	background-color: #CCC;
	padding-top: 2px;
	padding-right: 2px;
	padding-bottom: 2px;
	padding-left: 10px;
}

.index-cp
{
background: #fff url(index-cp.png) right repeat-y;
}

.index-vr
{
background: #fff url(index-vr.png) right repeat-y;
}

.index-mb
{
background: #eee url(index-faq.png) right repeat-y;
}

table.border
{
	border-color: #666;
	border-width: 0px;
}

FONT.liten {font-size: 70%; }

.tynn {
        font-family: Arial, Helvetica, sans-serif;
        font-size: smaller;
        font-style: normal;
        font-weight: lighter;
        margin-bottom: 0em;
     font-size: 11pt;
        }

.verbatim {
	font-family: "Lucida Console", Monaco, monospace;
	color: #000;
	padding-top: 30px;
	padding-right: 30px;
	padding-bottom: 3px;
	padding-left: 30px;
	background-color: #FEFFCA;
	border-left-width: medium;
	border-left-style: outset;
	border-left-color: #FDFFD5;
	margin-top: 0px;
	margin-right: 0px;
	margin-bottom: 20px;
	margin-left: 0px;
}

.red { color: #b80047; font-weight: bold; }

.blue { color: blue;  /*font-weight: bold;*/ }

.green { color: darkgreen; }

.comment { font-style: italic; }

.example {
	font-family: "Lucida Console", Monaco, monospace;
	color: #000;
	width: 100%;
	padding-top: 30px;
	padding-right: 30px;
	padding-bottom: 3px;
	padding-left: 30px;
	background-color: #FEFFCA;
	border-left-width: medium;
	border-left-style: outset;
	border-left-color: #FDFFD5;
	margin-top: 0px;
	margin-right: 0px;
	margin-bottom: 20px;
	margin-left: 0px;
}
.smallexample {
	font-family: "Lucida Console", Monaco, monospace;
	color: #000;
	width: 100%;
	padding-top: 30px;
	padding-right: 30px;
	padding-bottom: 3px;
	padding-left: 30px;
	background-color: #FEFFCA;
	border-left-width: medium;
	border-left-style: outset;
	border-left-color: #FDFFD5;
	margin-top: 0px;
	margin-right: 0px;
	margin-bottom: 20px;
	margin-left: 0px;
}
.cartouche {
	background-color: #CCC;
	border-top-style: none;
	border-right-style: none;
	border-bottom-style: none;
	border-left-style: none;
	padding: 5px;
	font-style: italic;
        width: 100%;
}

A:link { color: #2c2e70 }
A:visited { color: black }
A:active { color: #600041 }--></style>
</head>
<body>
<h1 class="settitle">CFEngine Nova Technical Supplement</h1>
<div class="node">
<a name="Top"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Introduction-to-CFEngine-Nova">Introduction to CFEngine Nova</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#dir">(dir)</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#dir">(dir)</a>

</div>

<h2 class="unnumbered">CFEngine-AutoReference</h2>

   <p><a href="#Contents"><h1>COMPLETE TABLE OF CONTENTS</h1></a>
<h2>Summary of contents</h2>

<!-- ***************************************************** -->
<!-- * CHAPTER -->
<!-- ***************************************************** -->
<ul class="menu">
<li><a accesskey="1" href="#Introduction-to-CFEngine-Nova">Introduction to CFEngine Nova</a>
<li><a accesskey="2" href="#Installing-CFEngine-Nova">Installing CFEngine Nova</a>
<li><a accesskey="3" href="#Mission-Portal">Mission Portal</a>
<li><a accesskey="4" href="#Business-Integration">Business Integration</a>
<li><a accesskey="5" href="#Monitoring-extensions">Monitoring extensions</a>
<li><a accesskey="6" href="#Database-Promises">Database Promises</a>
<li><a accesskey="7" href="#File-Access-Control-Lists">File Access Control Lists</a>
<li><a accesskey="8" href="#Server-extensions">Server extensions</a>
<li><a accesskey="9" href="#Environments-and-workflows">Environments and workflows</a>
<li><a href="#Virtualization">Virtualization</a>
<li><a href="#Content_002dDriven-Policies">Content-Driven Policies</a>
<li><a href="#Windows_002dspecific-features-in-Nova">Windows-specific features in Nova</a>
</ul>

<div class="node">
<a name="Introduction-to-CFEngine-Nova"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Installing-CFEngine-Nova">Installing CFEngine Nova</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Top">Top</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">1 Introduction to CFEngine Nova</h2>

<p>CFEngine Nova is a commercially licensed version of the core CFEngine
software<a rel="footnote" href="#fn-1" name="fnd-1"><sup>1</sup></a> with enterprise library extensions. All of
the documentation for CFEngine 3 applies to CFEngine Nova. This
document is a supplement describing features particular to CFEngine Nova.

   <p>The aim of CFEngine Nova is to offer a knowledge-enhanced framework
for configuration management that goes beyond mere technical
configuration to support the needs of businesses. Features include
compliance management, reporting and business integration, and tools
for handling necessary complexity. CFEngine Nova has features to support
Cloud Computing for public and private clouds, as well as greater integration
facilities with database resources.

   <p>You should use this brief guide to CFEngine Nova's features in concert with
the CFEngine Concept Guide and CFEngine Reference Manual, available
from the CFEngine website, or in the <samp><span class="file">docs</span></samp> directory of your
Nova hub installation.

<ul class="menu">
<li><a accesskey="1" href="#What-are-enterprise-versions_003f">What are enterprise versions?</a>
<li><a accesskey="2" href="#What_0027s-new-in-Nova-2_002e0_003f">What's new in Nova 2.0?</a>
<li><a accesskey="3" href="#About-the-CFEngine-architecture">About the CFEngine architecture</a>
<li><a accesskey="4" href="#Nova-Commercial-Enhancements">Nova Commercial Enhancements</a>
</ul>

<div class="node">
<a name="What-are-enterprise-versions%3f"></a>
<a name="What-are-enterprise-versions_003f"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#What_0027s-new-in-Nova-2_002e0_003f">What's new in Nova 2.0?</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Introduction-to-CFEngine-Nova">Introduction to CFEngine Nova</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Introduction-to-CFEngine-Nova">Introduction to CFEngine Nova</a>

</div>

<h3 class="section">1.1 What are enterprise versions of CFEngine?</h3>

<p>CFEngine Enterprise versions contain features designed to both extend
and simplify the use of CFEngine in enterprise scenarios.  This
includes quick setup, business alignment features and improved
self-documentation, ultimately providing a single framework for
self-healing, hands-free automation with integrated knowledge
management. Each extended feature has been carefully designed to meet a specific
need in the server life-cycle, replacing cumbersome or insecure
technologies currently available in datacentre products.
CFEngine Nova adds the following capabilities:

   <pre class="sp">

</pre>
     <ul>
<li>Simple bootstrap and installation.
<li>Scalable management of complex, federated environments.
<li>Lightweight reporting engine.
<li>Distributed orchestration of tasks.
<li>Virtualization control (using libvirt).
<li>Simplified policy writing with Content-Driven Policies.
<li>Integrated Knowledge Management.
<li>Bundle managed services.
<li>Provides a simple window onto IT Operations for Business.
</ul>

   <pre class="sp">

</pre>

Of course, as a Nova user, you have access to all of the features of
the CFEngine Community Edition, and access to its on-line and community
resources.

<div class="node">
<a name="What's-new-in-Nova-2.0%3f"></a>
<a name="What_0027s-new-in-Nova-2_002e0_003f"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#About-the-CFEngine-architecture">About the CFEngine architecture</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#What-are-enterprise-versions_003f">What are enterprise versions?</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Introduction-to-CFEngine-Nova">Introduction to CFEngine Nova</a>

</div>

<h3 class="section">1.2 What's new in Nova 2.0?</h3>

<p>CFEngine Nova 2.0 is a major upgrade of CFEngine's commercial software, including the
latest community core and many improvements to the language interface.
In addition, some of the major features in Nova 2.0 include:

     <ul>
<li>Fast, lightweight report collection to a hub.
<li>A browsable Web interface allows you to see policy and state side by side.
<li>CMDB/SKMS capabilities in the Web interface.
<li>Embedded compliance reporting engine.
<li>Searchable reporting and analytics.
<li>A local customizable version of the Copernicus Knowledge Map is now fully integrated providing searchable on-line documentation, integrated with the policy browser.
<li>Virtualization (Libvirt model) support.
<li>Simplified management through Content-Driven Policies.
<li>Unique-ID support for mobile and dynamic IP support.
<li>FIPS validated encryption mode.
</ul>

   <p>In addition to these features, Nova 2.0 is built around our extensive bug-reporting and
self-diagnostic test suite that has allowed us to improve the reliability and
functionality of the software for the most demanding environments.

<div class="node">
<a name="About-the-CFEngine-architecture"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Nova-Commercial-Enhancements">Nova Commercial Enhancements</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#What_0027s-new-in-Nova-2_002e0_003f">What's new in Nova 2.0?</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Introduction-to-CFEngine-Nova">Introduction to CFEngine Nova</a>

</div>

<h3 class="section">1.3 About the CFEngine architecture</h3>

<ul class="menu">
<li><a accesskey="1" href="#CFEngine-is-agent-based-software">CFEngine is agent based software</a>
<li><a accesskey="2" href="#Single-point-of-coordination">Single point of coordination</a>
<li><a accesskey="3" href="#Requirements-and-scalability-of-CFEngine-Nova">Requirements and scalability of CFEngine Nova</a>
<li><a accesskey="4" href="#Phases-of-the-server-life_002dcycle">Phases of the server life-cycle</a>
</ul>

<div class="node">
<a name="CFEngine-is-agent-based-software"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Single-point-of-coordination">Single point of coordination</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#About-the-CFEngine-architecture">About the CFEngine architecture</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#About-the-CFEngine-architecture">About the CFEngine architecture</a>

</div>

<h4 class="subsection">1.3.1 CFEngine is agent based software</h4>

<p>CFEngine is agent based software. It resides on and runs processes on
each individual computer under its management. That means you do not
need to grant any security credentials for login to CFEngine. Instead, for
normal operation, CFEngine runs in privileged `root' or
`Administrator' mode to get access to system resources and makes these
available safely to authorized inquiries.

   <p>A CFEngine installation is thus required on every machine you want to
manage: client and server, desktop or blade.  Typically, you will
single out one machine to be a <i>policy server</i> or <i>hub</i>. In very
large networks of many thousands of machines, you might need several
policy servers, i.e. several hubs.

<div class="node">
<a name="Single-point-of-coordination"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Requirements-and-scalability-of-CFEngine-Nova">Requirements and scalability of CFEngine Nova</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#CFEngine-is-agent-based-software">CFEngine is agent based software</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#About-the-CFEngine-architecture">About the CFEngine architecture</a>

</div>

<h4 class="subsection">1.3.2 Single point of coordination</h4>

<p>The default CFEngine Nova architecture uses a single hub or policy
server to publish changes of policy and to aggregate knowledge about
the environment, but you can set up as many as you like to manage
different parts of your organization independently.  The CFEngine
technology is not centralized by nature. Most users choose to
centralize updating of policy and report aggregation for convenience
however.

   <pre class="sp">

</pre>
<img src="hub.pdf" alt="The front page">
<div align="center">Figure: A policy server or `hub' is implemented in CFEngine Nova</div>
<div align="center">as a simple solution that will scale for most sites `out of the box'.</div>
   <pre class="sp">

</pre>

If you operate CFEngine Nova in its default mode, the hub acts as a
server from which every other client machine can access policy
updates. It also acts as a collector, aggregating summary information
from each machine and weaving it into a knowledge map about the datacentre.

   <p>For a single hub configuration, the figure below shows a normal
process approach to managing policy. Policy is edited and developed at
a Policy Definition Point, outside of normal production
environment. This can be done using the specialized editor embedded
in CFEngine Nova, or it can be done using any text editor of your choice.

   <p>Edits are made in conjunction with a version control
repository<a rel="footnote" href="#fn-2" name="fnd-2"><sup>2</sup></a>, which should be used to document the <i>reasons</i> for changes
to policy<a rel="footnote" href="#fn-3" name="fnd-3"><sup>3</sup></a>.  When a
change has been tested and approved, it will be copied manually to the
policy dispatch point on one or more distribution servers. All other
machines will then download policy updates from that single location according
to their own schedule.

   <pre class="sp">

</pre>
<img src="/img/outside/arch.png" alt="The front page">
<div align="center">Figure: Policy coordinated from a central root location</div>
<div align="center">is implemented in a distributed manner at every leaf node.</div>
   <pre class="sp">

</pre>

<div class="node">
<a name="Requirements-and-scalability-of-CFEngine-Nova"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Phases-of-the-server-life_002dcycle">Phases of the server life-cycle</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Single-point-of-coordination">Single point of coordination</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#About-the-CFEngine-architecture">About the CFEngine architecture</a>

</div>

<h4 class="subsection">1.3.3 Requirements and scalability of CFEngine Nova</h4>

<p>The default architecture and configuration skeleton is expected to
scale to a few thousand hosts with a dedicated policy hub. Your hub
machine should have at least 2 GB of memory and a modern processor.
You will need about 2 MB of disk storage for every machine under
Cfengine's management.

   <p>CFEngine will scale to very large systems, with tens of thousands of
machines. This is only possible because of its decentralized agent-based
operation. CFEngine encourages the federation of policy in complex
environments, so that local domain experts manage what they know and
baseline policies can be handled generally for all. We also encourage
a practice of small adjustments, as opposed to large risky redesigns
of operational policy.

   <pre class="sp">

</pre>
<p><table class="cartouche" summary="cartouche" border="1"><tr><td>
Cfengine's recommended practice is to encourage small incremental changes
to policy, not to save up changes into  `big project roll-outs'. This
strategy lowers the risk of error and offers improved scalability.
</td></tr></table>

   <pre class="sp">

</pre>

CFEngine will operate autonomously (hands-free) in a network, under
your guidance.  If your site is large (thousands of servers) you
should spend some time discussing with CFEngine experts how to tune
this description to your environment as <em>scale</em> requires you to
have more infrastructure, and a potentially more complicated
configuration. The essence of any CFEngine deployment is the same.

<div class="node">
<a name="Phases-of-the-server-life-cycle"></a>
<a name="Phases-of-the-server-life_002dcycle"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Requirements-and-scalability-of-CFEngine-Nova">Requirements and scalability of CFEngine Nova</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#About-the-CFEngine-architecture">About the CFEngine architecture</a>

</div>

<h4 class="subsection">1.3.4 Phases of the server life-cycle</h4>

<p>The four phases in managing systems, summarized in the Build, Deploy,
Manage, Audit (BDMA) framework originated with a model of system
management based on transactional changes (`roll-out').  CFEngine's conception of
management is some different, as transaction processing is not a good
model for highly distributed systems, but we can use this template to see how
CFEngine works differently.

     <dl>
<dt><em>Build</em><dd>CFEngine is often used together with other tools to build new machines,
whether virtual or real. You integrate it into the `kickstart' or `jumpstart'
process, using PXE network booting, etc, by including the CFEngine software
in the initial build and executing CFEngine once at the end of the installation.

     <p>To complete the installation of your system, you create a set of
promises about the system state, or policy-template of proposed
promises. When systems keep these promises, they will function
seamlessly as planned.

     <br><dt><em>Deploy</em><dd>Deploying software or changes really means implementing the policy
that has been decided.  In CFEngine you simply publish your proposed
policy and the machines can adjust accordingly.  Each installed agent
is capable of implementing policies and maintaining them over time
without further assistance.

     <br><dt><em>Manage</em><dd>Once a decision is made, unplanned events will occur. Such
incidents usually set off alarms and humans rush to make new transactions
to repair them. In CFEngine, the autonomous agent manages the system,
and you only have to deal with rare events that cannot be dealt with
automatically.

     <br><dt><em>Audit</em><dd>
Promises are assured by design in CFEngine and maintained
automatically, so the main worry when using CFEngine is whether or not
you have coded conflicting intentions. The compliance of machines
with the policy template is easily measured by CFEngine, using its
model-oriented approach. This can be viewed from the web-browsable
interface.

   </dl>

<div class="node">
<a name="Nova-Commercial-Enhancements"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#About-the-CFEngine-architecture">About the CFEngine architecture</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Introduction-to-CFEngine-Nova">Introduction to CFEngine Nova</a>

</div>

<h3 class="section">1.4 Nova Commercial Enhancements</h3>

<p>The enhancement provide by CFEngine Nova fall into a number categories:

   <pre class="sp">

</pre>
     <ul>
<li>Business transparency and reporting enhancements, providing insight into IT operations
for both Business and IT. CFEngine Nova connects the dots between high level business goals and
low level configuration, supporting Knowledge Management for ITIL processes.

     <li>Productivity enhancements &ndash; easier getting started and making changes.

     <li>Continuity and repair related enhancements.

     <li>Full integrated Knowledge Management.

     <li>Special support for operating system features and virtualization, such as Solaris zones
and the libvirt interface.

     <li>Native support for the Windows platform, with access to the configuration of
the Windows registry, processes and file access control lists.

   </ul>

   <pre class="sp">

</pre>

<ul class="menu">
<li><a accesskey="1" href="#Productivity-enhancements">Productivity enhancements</a>
<li><a accesskey="2" href="#Functional-enhancements">Functional enhancements</a>
<li><a accesskey="3" href="#Reporting-enhancements">Reporting enhancements</a>
<li><a accesskey="4" href="#Documentation-enhancements">Documentation enhancements</a>
<li><a accesskey="5" href="#Knowledge-Management-in-Nova">Knowledge Management in Nova</a>
</ul>

<div class="node">
<a name="Productivity-enhancements"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Functional-enhancements">Functional enhancements</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Nova-Commercial-Enhancements">Nova Commercial Enhancements</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Nova-Commercial-Enhancements">Nova Commercial Enhancements</a>

</div>

<h4 class="subsection">1.4.1 Productivity enhancements</h4>

<p>Features that are designed to make it easier to work with
CFEngine on a day to day basis.

     <ul>
<li>Simple automatic installation (one command per system)
<li>A template library of managed services for common platforms.
<li>Auto-analyzing system knowledge console
<li>Policy mining and semantic knowledge representation
<li>Auto-classification of systems
<li>Performance and Service Level reports
<li>On- and off-line syntax look-up.
<li>Integration with LDAP directory services.
</ul>

   <p>The most important productivity tool is the CFEngine Mission Portal,
which contains an interface for browsing and editing policy, and
understanding it in the context of reports and a Knowledge Map of the system.

   <p>A library of managed services for common Linux operating systems is
provided as part of the knowledge base. This makes setting up specialized
service nodes a simple process of matching hosts to services from a required
list.

   <p>The ability to look up syntax on the fly, from the web or the command
line, can be save experienced users considerable time. Using the tools
for database interaction, the process of setting up a CFEngine
knowledge base at your organization is fully automated and you only
have to think about local customizations you want to make.

   <p>LDAP query functions have been added for integration with
LDAP services or Active Directory information, allowing a single
point of definition for system lists and identity management.

<div class="node">
<a name="Functional-enhancements"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Reporting-enhancements">Reporting enhancements</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Productivity-enhancements">Productivity enhancements</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Nova-Commercial-Enhancements">Nova Commercial Enhancements</a>

</div>

<h4 class="subsection">1.4.2 Functional enhancements</h4>

     <ul>
<li>Database verification and editing including SQL (Mysql,Postgres)
<li>MS Registry management and repair
<li>File-system ACL security management (Linux, Windows, Solaris)
<li>Extended monitoring probes and system classification capabilities.
</ul>

   <p>These include the ability to interact with and repair popular SQL databases
(currently MySQL and PostgreSQL), as well as embedded system databases
such as the Microsoft System Registry, defining, validating, scanning
or repairing their tabular structure and the data within them.

     <ul>
<li>Access remote CFEngine variables (like a simple directory service)
<li>LDAP directory service integration
<li>Role based access control on policy execution by class.
</ul>

   <p>Access Control List (ACL) support for Linux is now added for pinpoint
accuracy in file permission security. CFEngine Nova's ACL support
includes a completely new generic CFEngine model for ACLs that will
translate across multiple platforms so that users can as closely as
possible translate identical requirements across multiple platforms
with different implementations.  Native ACLs are also supported.

   <p>Fault tolerant features have been added in Nova to functions for retrieval
of data from network connections. It is risky to rely of data from a
network when configuring hosts. If the network connection could fail, erroneous
data might be written to a local configuration. Nova adds local caching to
network results and works opportunistically to provide the latest known
values; however, look-up functions, such as LDAP retrieval of <code>remotescalar</code>
data will not fail.

<div class="node">
<a name="Reporting-enhancements"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Documentation-enhancements">Documentation enhancements</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Functional-enhancements">Functional enhancements</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Nova-Commercial-Enhancements">Nova Commercial Enhancements</a>

</div>

<h4 class="subsection">1.4.3 Reporting enhancements</h4>

<p>Nova can provide a wider range of system reports about information
collected by CFEngine on performance, security and state. This
includes the ability to perform custom system discovery, and log the
data into a variety of special reports.

   <pre class="sp">

</pre>
<p><table class="cartouche" summary="cartouche" border="1"><tr><td>
Discovery and measurement promises are made through CFEngine's
lightweight custom monitoring capabilities.
</td></tr></table>

   <pre class="sp">

</pre>
     <ul>
<li>HTML, XML, CSV report generation
<li>Service and performance level reports
<li>Reliability reports
<li>Deep history analysis and visualization, through knowledge base.
<li>Policy dependency and impact analysis reporting
</ul>

   <p>Information can be extracted in HTML, XML and text formats (e.g. CSV)
for easy integration with other presentation tools, or for direct
viewing through the knowledge console.

   <p>As part of policy-writing, CFEngine Nova allows you to track
dependencies on policy items.  The knowledge agent can take this
information, analyze it and present it as part of an overview of the
system (see the chapter on Knowledge Management for more information).
This enables virtual impact analysees to be inspected.

<div class="node">
<a name="Documentation-enhancements"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Knowledge-Management-in-Nova">Knowledge Management in Nova</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Reporting-enhancements">Reporting enhancements</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Nova-Commercial-Enhancements">Nova Commercial Enhancements</a>

</div>

<h4 class="subsection">1.4.4 Documentation enhancements</h4>

<p>Additional documentation is provided for Nova users through program
built-in help, additional manuals and integration of syntax
information into the CFEngine Knowledge Console.

   <p>An annoying aspect of any software is the need to browse through a manual
to find quick answers to questions. Ideally one would only look at manuals
during a learning phase; thereafter we want to see examples and summaries of
what we basically already know but cannot keep in our heads.

   <p>System administrators often prefer to work in the command line and
find the need to go to a manual a distraction. Indeed, if the network
is non-functional or we are working off-line, instant command line
help is a great bonus.  Other users prefer the point and click of a
familiar web interface. CFEngine Nova provides both these options to
users to provide quick answers.

   <p>Of the two, a web interface is clearly the most flexible. Far more
information can be browsed on the web than is practical with a simple
text interface. However, of the two, the command line interface is by
far the fastest way to get answers to simple questions of syntax.
Cfengine's knowledge agent knows CFEngine's syntax tree and can
summarize it at the keyword level.

   <pre class="sp">

</pre>
<p><table class="cartouche" summary="cartouche" border="1"><tr><td>
<pre class="smallexample">
     atlas$ ./cf-know --syntax link_from
     Constraint link_from (of promise type files) has possible values:

        link_from  ~ defined in a separate body, with elements

          source                ~ ()
          link_type             ~ (symlink,hardlink,relative,absolute,none)
          copy_patterns         ~ ()
          when_no_source        ~ (force,delete,nop)
          link_children         ~ (true,false,yes,no,on,off)
          when_linking_children ~ (override_file,if_no_such_file)

     Description: A set of patterns that should be copied and synchronized instead of linked

</pre>
   </td></tr></table>

<div class="node">
<a name="Knowledge-Management-in-Nova"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Documentation-enhancements">Documentation enhancements</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Nova-Commercial-Enhancements">Nova Commercial Enhancements</a>

</div>

<h4 class="subsection">1.4.5 Knowledge Management in Nova</h4>

<p>The future of datacentre management lies in a more complete model of knowledge and transparency
for processes and resources. CFEngine Nova provides a platform for this through:

     <ul>
<li>Auto-generated central knowledge console.
<li>Access to CFEngine's company support knowledge base.
<li>Tie-in knowledge base with local documentation.
<li>Dependency mapping between promises in CFEngine, with integration into the semantic
<li>Trace high level policies to low level policies
</ul>

<!-- ***************************************************** -->
<!-- * CHAPTER -->
<!-- ***************************************************** -->
<div class="node">
<a name="Installing-CFEngine-Nova"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Mission-Portal">Mission Portal</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Introduction-to-CFEngine-Nova">Introduction to CFEngine Nova</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">2 Installing CFEngine Nova</h2>

<ul class="menu">
<li><a accesskey="1" href="#Operating-system-support">Operating system support</a>
<li><a accesskey="2" href="#Installing-the-software">Installing the software</a>
<li><a accesskey="3" href="#Upgrading-Nova">Upgrading Nova</a>
<li><a accesskey="4" href="#What-is-the-default-configuration-_002d-out-of-the-box">What is the default configuration - out of the box</a>
</ul>

<p>CFEngine Nova is designed to be simple to install in its default configuration. The installation
process has three phases:

     <ul>
<li>Unpacking the software.
<li>Obtaining a license.
<li>Adapting policy.
</ul>

<div class="node">
<a name="Operating-system-support"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Installing-the-software">Installing the software</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Installing-CFEngine-Nova">Installing CFEngine Nova</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Installing-CFEngine-Nova">Installing CFEngine Nova</a>

</div>

<h3 class="section">2.1 Operating system support</h3>

<p>CFEngine can be made to run on most operating systems. For efficiency
CFEngine only supports a number of recent popular operating systems,
which should be up to date with patches. If we don't have packages for
your particular operating systems we can usually make packages by
special arrangement.

   <p>The hub (or policy server) is only available for derivatives of the
top GNU/Linux distributions (Debian, Red Hat, SuSE), as these make available
software that the hub relies on for data storage and processing.
Operating system choices for the hub are:

<pre class="example">      Debian 5,6
      Ubuntu 8,9,10
      RedHat 4,5
      SuSE   11
</pre>
   <p>No special software is required on other machines in your
network. CFEngine bundles all dependencies in the Nova package.

   <p>Nova provides a version of CFEngine running natively on Windows, with
support for registry management, Windows services and file
security, See <a href="#Windows_002dspecific-features-in-Nova">Windows-specific features in Nova</a>. Support for Solaris zones has been added through
automated zone detection and process model adaptation.

<div class="node">
<a name="Installing-the-software"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Upgrading-Nova">Upgrading Nova</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Operating-system-support">Operating system support</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Installing-CFEngine-Nova">Installing CFEngine Nova</a>

</div>

<h3 class="section">2.2 Installing the software on a new host</h3>

<p>Nova is provided in two packages. The main software package (for each operating system) must be installed
on every host. The second package is only installed on the <i>hub</i> or <i>policy server</i>. You should install
the hub first.

   <p>On a new host, installation follows the following procedure. References to package managers
assume that additional packages might need to be installed of the policy server, e.g. the Apache
Web Server.

     <ol type=1 start=1>
<li>Verify that the machine's network connection is working and that it can resolve
names. On the hub verify that package managers <code>yum</code>, <code>zypper</code> or <code>apt-get</code> are working.

     <li>Copy the Nova packages to the system. On the hub or policy server:
     <pre class="example">          cfengine-nova-2.<var>xxx.[rpm|deb]</var>
          cfengine-nova-expansion-2.<var>xxx.[rpm|deb]</var>
</pre>
     <p class="noindent">On all other machines
     <pre class="example">          cfengine-nova-2.<var>xxx.[rpm|deb]</var>
</pre>
     <li>Unpack the software:
          <dl>
<dt><i>Red Hat family</i><dd>
          <pre class="example">               host# rpm -ihv <var>packages</var>
</pre>
          <br><dt><i>Debian family</i><dd>
          <pre class="example">               host# dpkg --install  <var>packages</var>
</pre>
          </dl>

     <li>A public key has now been created in <samp><span class="file">/var/cfengine/ppkeys/localhost.pub</span></samp> on the policy hub as part of the
package installation. You should email this public key to CFEngine
Support, as an attachment, to obtain a license file <samp><span class="file">license.dat</span></samp>. Save the returned license
file to <samp><span class="file">/var/cfengine/masterfiles/license.dat</span></samp> on the hub before continuing.

     <li>The remaining steps apply to all hosts, but you should install the hub or policy server first.
Find the name or IP address of the hub (policy server), here we assume &lsquo;<samp><span class="samp">123.456.789.123</span></samp>&rsquo; is the address.
<pre class="verbatim">     /var/cfengine/bin/cf-agent --bootstrap --policy-server 123.456.789.123
</pre>
Use the same command on all hosts, i.e. do not bootstrap the policy
server with a localhost address.
<li>The software should now be running.

     <li>To complete to licensing, you should make a promise to accept the license
terms by editing the <samp><span class="file">/var/cfengine/masterfiles/promises.cf</span></samp> on
the policy server, and editing the &lsquo;<samp><span class="samp">host_licenses_paid =&gt; "100";</span></samp>&rsquo;
line in &lsquo;<samp><span class="samp">body common control</span></samp>&rsquo; to reflect the correct number of
licenses that you have subscribed to.

        </ol>

<p class="noindent"><b>How to assess success in this procedure:</b>

     <ol type=1 start=1>

     <li>Look at the process list on the systems &lsquo;<samp><span class="samp">ps waux | grep cf</span></samp>&rsquo;or &lsquo;<samp><span class="samp">ps -ef | grep cf</span></samp>&rsquo;.
You should be able to see <code>cf-execd</code> running, and eventually other processes from the CFEngine suite like <code>cf-monitord</code>
<code>cf-serverd</code>.

     <li>Look for files in <samp><span class="file">/var/cfengine/inputs</span></samp> (Unix)
or <samp><span class="file">X:\Program Files\Cfengine\inputs</span></samp> (Windows). The license
file will be copied out from the policy server to the clients as part
of the normal distribution of policy. Each Unix machine should get a
copy of the <samp><span class="file">license.dat</span></samp> file in <samp><span class="file">/var/cfengine/inputs</span></samp>
(Unix) or <samp><span class="file">X:\Program Files\Cfengine\inputs</span></samp> (Windows).

     <li>The file <samp><span class="file">/var/cfengine/promise_knowledge.cf</span></samp> should have been
created, and should contain data.

     <li>Finally try connecting to the web server at port 80 on the hub / policy host.
You should see a summary page like the one shown in the figure below.
        </ol>

   <pre class="sp">

</pre>
<div align="center"><img src="/img/outside/summary.png" alt="The front page"></div>
<div align="center">The opening page of the CFEngine Nova Mission Portal.</div>
   <pre class="sp">

</pre>

<div class="node">
<a name="Upgrading-Nova"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#What-is-the-default-configuration-_002d-out-of-the-box">What is the default configuration - out of the box</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Installing-the-software">Installing the software</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Installing-CFEngine-Nova">Installing CFEngine Nova</a>

</div>

<h3 class="section">2.3 Upgrading Nova</h3>

<p>When upgrading the software from an earlier version, you should
upgrade the policy server (hub) machine first. Any other hosts
in your network that act as servers for encrypted copy operations
would preferably be upgraded first. This is because a stronger form of
encryption-hash is used in newer versions, which the older servers
cannot understand.

   <p>CFEngine packages its software in operating system compatible package
formats (RPM, PKG, MSI, etc). New packages are made available on the
software.cfengine.com website; these can be downloaded and installed
in the standard way.

     <ol type=1 start=1>
<li>Go to the <code>software.cfengine.com</code> website
<li>Select the version of the software you require
<li>Download the particular package for your operating systems to a
correspondingly named sub-directory on your policy server under
<samp><span class="file">/var/cfengine/master_software_updates</span></samp>, or simply mirror the entire file
tree on your policy server under
<br>
<samp><span class="file">/var/cfengine/master_software_updates</span></samp>.
        </ol>

     <ul>
<li>You do not need to delete the contents of the work directory, e.g. <samp><span class="file">/var/cfengine</span></samp>
to upgrade. An upgrade only involves changing the binary code base.

     <li>Users are encouraged to take advantage of changes to the Nova base policy, e.g.
the <samp><span class="file">update.cf</span></samp> policy. We have reduced the number of files distributed and managed
by CFEngine in 2.0.0. To gain the full benefits of the software, you should use the latest
versions of these files:

     <pre class="smallexample">          cdp_inputs/  cfengine.cf         failsafe.cf     knowledge.cf  promises.cf   update.cf
          cdp_lib/     cfengine_stdlib.cf  file_change.cf  OrionCloud/
</pre>
     <p>Note that some log files have new names, and that the audit database is no longer used
by default. If you do not upgrade the files above, make sure you rotate the log files
and perform garbage collection as detailed in these files.

     <li>You can upgrade systems manually by copying the relevant package
to the local host and running the appropriate package update command (see summary below).

     <li>To upgrade all of your systems automatically, you only need to copy a
new package release to a specially designated location on your policy
server, and CFEngine will do the rest. Each CFEngine client will
detect the presence of the update, download it, install and restart
CFEngine services locally. Thus you can deploy software using a single
point of management.
</ul>

<ul class="menu">
<li><a accesskey="1" href="#Troubleshooting-upgrade">Troubleshooting upgrade</a>
</ul>

<div class="node">
<a name="Troubleshooting-upgrade"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Upgrading-Nova">Upgrading Nova</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Upgrading-Nova">Upgrading Nova</a>

</div>

<h4 class="subsection">2.3.1 Troubleshooting upgrade</h4>

<p>You might experience some authentication errors during secure copy
operations during upgrade from older versions of Nova. These will self-repair once the servers
have been upgraded.

   <p>To avoid these altogether, you can temporarily disable copy verification,
i.e. set
<pre class="example">     verify =&gt; "false";
</pre>
   <p>in your <code>copy_from</code> bodies, should you wish. For standard
installations, this setting is typically part of the definition of &lsquo;<samp><span class="samp">secure_cp</span></samp>&rsquo;
defined in the <samp><span class="file">cfengine_stdlib.cf</span></samp> file.

<div class="node">
<a name="What-is-the-default-configuration---out-of-the-box"></a>
<a name="What-is-the-default-configuration-_002d-out-of-the-box"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Upgrading-Nova">Upgrading Nova</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Installing-CFEngine-Nova">Installing CFEngine Nova</a>

</div>

<h3 class="section">2.4 What is the default configuration?</h3>

<p>Following the above procedure, you should have a fully functional
CFEngine on all clients. However, in the default configuration,
CFEngine does nothing other look after itself, and look for possible
policy updates from the master file policy distribution point on the
policy server. The policy server is configured to collect data from
non-policy server machines and generate reports that are integrated
into the knowledge base.

   <p>To alter policies, you need to change the files on the policy hub,
in the directory <samp><span class="file">/var/cfengine/masterfiles</span></samp>. To begin with
most of the policy examples are commented out in these files:
   <pre class="sp">

</pre>
<p><table class="cartouche" summary="cartouche" border="1"><tr><td>
<pre class="smallexample">
     active_directory.cf   failsafe.cf            spp.cf               spp_registry.cf
     win_emergency.cf      app_baseline.cf        file_change.cf       scheduling.cf
     spp_commands.cf       spp_services.cf        win_registry.cf      cfengine.cf
     file_security.cf      OrionCloud             software_local.cf    spp_file_changes.cf
     system.cf             win_services.cf        garbage_collection.cf process_matching.cf
     spp_file_diffs.cf     update.cf              cfengine_stdlib.cf   knowledge.cf
     <b>promises.cf</b>           spp_acls.cf            spp_inputs

</pre>
   </td></tr></table>

   <pre class="sp">

</pre>
To change this, you can go to the main file <samp><span class="file">promises.cf</span></samp>, and include additional
pre-made bundles of promises. You should always verify the contents of the bundles
you include before activating and deploying to new machines.

   <p><table class="cartouche" summary="cartouche" border="1"><tr><td>
<pre class="verbatim">bundle agent main
{
methods:

  any::

   "general" usebundle => def;

#   "jobs" usebundle => system_scheduling;
#   "security" usebundle => change_management;
#   "security" usebundle => security_files;
#   "windows boxes" usebundle => active_directory;

#  windows::
#   "windows boxes" usebundle => software_local;
#   "windows boxes" usebundle => app_baseline;
#   "windows boxes" usebundle => win_services;
#   "windows boxes" usebundle => win_registry;
#   "windows boxes" usebundle => win_emergency;

#  !windows::
#   "security"    usebundle => system_xinetd;
#   "maintenance" usebundle => garbage_collection;
}
</pre>
</td></tr></table>

<!-- ======================================================================= -->
<div class="node">
<a name="Mission-Portal"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Business-Integration">Business Integration</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Installing-CFEngine-Nova">Installing CFEngine Nova</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">3 Mission Portal</h2>

<p>Knowledge management has become a new focus in IT management, and it
is a core focus at CFEngine. Comprehending the growing complexity of
IT operations is one of the main challenges in IT today. CFEngine Nova
has a number of key features for knowledge management, including
automated documentation, report generation and associative inference. The
CFEngine Mission Portal is the centerpiece of user interaction with
CFEngine Nova.

   <p>The structure of the Mission Portal interface follows the concept of a Topic Map. A
Topic Map is an ISO standard for indexing electronic information as a
<i>semantic web</i>. In a semantic web, you are presented with links to
documents about your chosen topic, as usual; in addition you are
offered <i>leads</i> and possible pathways to topics that are known to be
related. These leads don't just point you to more documents, but
explain <i>how</i> neighboring issues are related.  The aim is to help
the user learn from the experience of browsing, by conveying the
meaning of the current topic in relation to other issues in the
system. This is how <i>knowledge transfer</i> occurs.

   <pre class="sp">

</pre>
<img src="/img/outside/mission.png" alt="The front page">
<div align="center">Figure: The mission portal</div>
<pre class="sp">

</pre>

There are four main categories in the mission portal:

     <ul>
<li>Mission Summary - a top level overview of compliance status
<li>Mission Planning - a place to plan and make policy changes
<li>Mission Status - a place to see the current state of system repair
<li>Mission Library - a knowledge bank that connects information together
</ul>

   <p>Each of these categories is a beginning from which you can refine your overview and search
through information.

<ul class="menu">
<li><a accesskey="1" href="#Mission-Portal-Views">Mission Portal Views</a>
<li><a accesskey="2" href="#Report-extensions">Report extensions</a>
<li><a accesskey="3" href="#Should-monitoring-and-configuration-be-separate_003f">Should monitoring and configuration be separate?</a>
<li><a accesskey="4" href="#What-is-a-CMDB_003f">What is a CMDB?</a>
<li><a accesskey="5" href="#CMDB-and-Cfengine">CMDB and CFEngine</a>
<li><a accesskey="6" href="#Decentralized-data-collection-in-Cfengine">Decentralized data collection in CFEngine</a>
<li><a accesskey="7" href="#Reporting-in-Cfengine">Reporting in CFEngine</a>
<li><a accesskey="8" href="#Standard-reports-in-CFEngine-Nova">Standard reports in CFEngine Nova</a>
<li><a accesskey="9" href="#Knowledge-Map">Knowledge Map</a>
<li><a href="#Using-the-knowledge-map">Using the knowledge map</a>
<li><a href="#cf_002dhub-and-data-collection">cf-hub and data collection</a>
</ul>

<div class="node">
<a name="Mission-Portal-Views"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Report-extensions">Report extensions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Mission-Portal">Mission Portal</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Mission-Portal">Mission Portal</a>

</div>

<h3 class="section">3.1 Mission Portal Views</h3>

<p>The Mission Portal offers insight into three main areas:
     <ul>
<li>Operations and performance.
<li>Business and compliance.
<li>Organizational knowledge and library.
</ul>

   <pre class="sp">

</pre>
<img src="/img/outside/views.png" alt="The front page">
<div align="center">Figure: Topic Maps provide a variety of viewpoints on the information</div>
<pre class="sp">

</pre>

Mission portal views link together a number of relevant resources for common system roles, like operator, security officer or system architect.
This is an example of how the mission portal offers relationships that transcend simple categories. The same information can appear
in many different contexts.

<ul class="menu">
<li><a accesskey="1" href="#Mission-status">Mission status</a>
<li><a accesskey="2" href="#Host-view">Host view</a>
<li><a accesskey="3" href="#Status-level-meters">Status level meters</a>
<li><a accesskey="4" href="#Top-50-weakest-hosts">Top 50 weakest hosts</a>
<li><a accesskey="5" href="#Pulse-and-vital-signs">Pulse and vital signs</a>
<li><a accesskey="6" href="#Detail-views">Detail views</a>
<li><a accesskey="7" href="#The-policy-editor">The policy editor</a>
<li><a accesskey="8" href="#Integration-with-subversion">Integration with subversion</a>
</ul>

<div class="node">
<a name="Mission-status"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Host-view">Host view</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Mission-Portal-Views">Mission Portal Views</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Mission-Portal-Views">Mission Portal Views</a>

</div>

<h4 class="subsection">3.1.1 Mission status</h4>

<pre class="sp">

</pre>
<img src="/img/outside/status.png" alt="The front page">
<div align="center">Figure: The status of IT operations.</div>
<pre class="sp">

</pre>

Mission status is a high level summary of how well the entire system
is behaving. From this page you can dive down into details about managed hosts,
by machine or by information type.

   <p>The row of bar meters shows the compliance of all registered hosts over the past
week, the past day and the past hour. It also summarizes performance
and anomalous behavior in a simple red, yellow green scale.

   <p>The hosts themselves are classified into red, yellow and green using a combination of
these considerations. Clicking on the colored links produces a list of the
hosts in that category.

<div class="node">
<a name="Host-view"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Status-level-meters">Status level meters</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Mission-status">Mission status</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Mission-Portal-Views">Mission Portal Views</a>

</div>

<h4 class="subsection">3.1.2 Host view</h4>

<p>Clicking on a host name or address leads to a specialized host page, which has the following broad
characteristics:

     <ul>
<li>Operating system and host type.
<li>Host name, address and unique identity.
<li>A summary meter for compliance, performance, etc.
<li>Detailed reports.
</ul>

   <pre class="sp">

</pre>
<div align="center"><img src="/img/outside/hostpage.png" alt="The front page"></div>
<div align="center">Figure: A page specific for each host.</div>
   <pre class="sp">

</pre>

<div class="node">
<a name="Status-level-meters"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Top-50-weakest-hosts">Top 50 weakest hosts</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Host-view">Host view</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Mission-Portal-Views">Mission Portal Views</a>

</div>

<h4 class="subsection">3.1.3 Status level meters</h4>

<p>IT operations are referred to as <i>the mission</i> in the knowledge
base. The mission depends on key resources and can be viewed from a
number of perspectives, shown on the opening page.

   <p>The bar meter shows the site-summary status of a number of key
performance indicators. This is the highest level summary of mission
status.

     <ol type=1 start=1>
<li><b>Week</b>: The average level of promise-compliance over the whole past week.
<li><b>Day</b>:  The average level of promise-compliance over the past day.
<li><b>Hour</b>:  The average level of promise-compliance over the past hour.
<li><b>Perf</b>: The average performance status of the system, compared to the learned norm.
<li><b>Soft</b>: Software update status of the system.
<li><b>Lics</b>: Summary of licenses, i.e. number of active clients versus number of paid licenses promised.
<li><b>Anom</b>: Level of anomalous site-wide activity on the system.
        </ol>

<div class="node">
<a name="Top-50-weakest-hosts"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Pulse-and-vital-signs">Pulse and vital signs</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Status-level-meters">Status level meters</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Mission-Portal-Views">Mission Portal Views</a>

</div>

<h4 class="subsection">3.1.4 Top 50 weakest hosts</h4>

<p>One the status page, there is a link to the top 50 worst machines.
Clicking on the bar meter graph takes you to the host directory, where a similar graph
displays the status of the list of managed hosts.

   <pre class="sp">

</pre>
<img src="/img/outside/weakest.png" alt="xyz">
<div align="center">Figure: The Top 50 weakest hosts list.</div>
<pre class="sp">

</pre>

Clicking further on each host takes you do detailed performance data as measured
by CFEngine's monitoring daemon.

   <p>We call this view pseudo-real time monitoring data, because there is
always some delay between when data were measured and when they become
available for you to view. Most tools simply hide this delay, but
CFEngine tells you precisely when data were last updated, providing crucial
information about system latencies.

<div class="node">
<a name="Pulse-and-vital-signs"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Detail-views">Detail views</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Top-50-weakest-hosts">Top 50 weakest hosts</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Mission-Portal-Views">Mission Portal Views</a>

</div>

<h4 class="subsection">3.1.5 Pulse and vital signs</h4>

<p>For each host there is a `pulse and vital signs' link. This shows an
overview of monitoring data from each host and its current performance
statistics. In order to see data in these graphs, each host in the CFEngine
managed network must be running <code>cf-monitord</code> and <code>cf-serverd</code>.
This is the default behavior for a Nova installation.

   <p>The main page of the pulse and vital signs shows up to 100 different measured
values, for which some activity has been seen<a rel="footnote" href="#fn-4" name="fnd-4"><sup>4</sup></a>.

   <p>The graphs are arranged into three columns, representing three
different time-scales.  From the left:

     <ul>
<li>Past four hours.
<li>Past weeks.
<li>Statistical complete history.
</ul>

   <p>The past four hours graph is updated regularly and shows the current
levels in 5 minute resolution. The weekly view shows data collected
over many weeks, overlaid onto a `periodogram', i.e. multiple weeks
averaged over a single week view. This reveals the strongest trends of
usage on the system.

   <p>The statistical history shows a spectral histogram, indicating the
distribution of all measured values about the mean. This shows how much
entropy or variation there is in the performance characteristic.

   <pre class="sp">

</pre>
<div align="center"><img src="/img/outside/trends.png" alt="The front page"></div>
<div align="center">Figure: Overview of performance characteristics</div>
   <pre class="sp">

</pre>

<div class="node">
<a name="Detail-views"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#The-policy-editor">The policy editor</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Pulse-and-vital-signs">Pulse and vital signs</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Mission-Portal-Views">Mission Portal Views</a>

</div>

<h4 class="subsection">3.1.6 Detail views</h4>

<p>Clicking on the individual graphs in the vital signs provides a deeper
analysis of each graph, with some basic statistics. These statistics are
updated at different rates, depending on the time scales. `Past four hour'
graphs are updated every 5-10 minutes, while the others are updated every 6 hours.
The numerical values are reanalyzed on a corresponding interval.

   <pre class="sp">

</pre>
<div align="center"><img src="/img/outside/detail.png" alt="The front page"></div>
<div align="center">Figure: Details of the graph.</div>
   <pre class="sp">

</pre>

<div class="node">
<a name="The-policy-editor"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Integration-with-subversion">Integration with subversion</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Detail-views">Detail views</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Mission-Portal-Views">Mission Portal Views</a>

</div>

<h4 class="subsection">3.1.7 The policy editor</h4>

<p>The CFEngine Nova Mission Portal provides an editor for working on
CFEngine language. It does not support user management
itself<a rel="footnote" href="#fn-5" name="fnd-5"><sup>5</sup></a>, however there is a tie-in for Subversion version
control repositories.

   <p>Because there is no user management, each web-browser session will get
its own working environment. Thus, there will be limited persistence,
so remember to <em>commit your changes often</em>, especially before
closing the browser.

   <p>For security reasons, there is no automatic link between the policy
editor and the company policy in <code>masterfiles</code>. Subversion can be
used to handle access control, and a manual review and copy step is
required to deploy policy written in the editor.

   <p>The editor provides syntax high-lighting and look-up to make working
with CFEngine's extensive language easier.

   <p>The main key commands in the editor Window are:

     <dl>
<dt><i>Autocompletion: Ctrl+Space</i><dd>Shows a pop-up menu of possible items. This is context sensitive,
e.g. it also works inside lists (e.g. <code>bsdflags</code>) to provide
possible values.
<br><dt><i>Undo: Ctrl+Z</i><dd> In Safari, Ctrl-backspace may be used.
<br><dt><i>Redo: Ctrl+Y</i><dd>Undo an undo operation, i.e. reverse the direction of transaction roll.
<br><dt><i>Indent: TAB</i><dd>Format a file to a standard indentation.
</dl>
   Multiple documents appear as tabs along the top of the screen.
   <pre class="sp">

</pre>
<div align="center"><img src="/img/outside/editor.png" alt="The front page"></div>
<div align="center">Figure: The Policy Editor</div>
   <pre class="sp">

</pre>

The CFEngine Nova policy editor detects syntax errors and highlights
these in red to avoid mistakes when editing.  In addition, by using
the <code>Check syntax</code> button, it is possible to pre-test the policy
before committing changes to a repository. This will run
<code>promises.cf</code> through the <code>cf-promises</code> parser.

   <p>The main menu on the left hand panel shows the main workflow items for
policy editing. Clicking the arrow in the panel divider collapses the
menu and gives full-screen editing.

   <pre class="sp">

</pre>
<div align="center"><img src="/img/outside/Editormenu.png" alt="The front page"></div>
<div align="center">Figure: The policy editor main menu</div>
   <pre class="sp">

</pre>

<div class="node">
<a name="Integration-with-subversion"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#The-policy-editor">The policy editor</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Mission-Portal-Views">Mission Portal Views</a>

</div>

<h4 class="subsection">3.1.8 Integration with subversion</h4>

<p>The default architecture (page) proposes to work in close dialogue with a version
repository. CFEngine recommends the use of such a repository and currently
supports subversion.

   <p>Since the CFEngine Nova policy editor is a single user console,
authentication is required for each interaction with the
repository. Access control and authorization for policy are handled by
subversion's authentication system so that edits made in the Mission
Portal can be interleaved with edits from other sources.  The
subversion repository thus becomes the centerpiece of the distributed
coordination, as is the intended function of version control systems.

   <p>When working with a subversion repository, you first do a
&ldquo;checkout&rdquo;. This allows you to select the repository you want to
download and creates a working environment based on it. Note that the
editor currently only views files in the checked out repository, so if
you have a directory hierarchy, you need to check out multiple
times. After doing a checkout, you can view the path to the current
repository by clicking the link at the top.

   <pre class="sp">

</pre>
<div align="center"><img src="/img/outside/editor-svnpath.png" alt="Path to the current repository"></div>
<div align="center">Figure: Path to the current repository.</div>
   <pre class="sp">

</pre>

   <p>The
&ldquo;update&rdquo; command downloads the newest files from the already checked
out subversion repository, while &ldquo;commit&rdquo; updates the repository
with your working copy. You also have the ability to see the
repository log of the 20 last changes. This includes changed files,
users and log messages. For more detailed information on working with
subversion, see <a href="http://svnbook.red-bean.com">http://svnbook.red-bean.com</a>.

   <p>After editing you may or may not commit changes. When closing an
edited file, you are also given the option to commit at once.

   <pre class="sp">

</pre>
<div align="center"><img src="/img/outside/savefiledlg.png" alt="The front page"></div>
<div align="center">Figure: Save file with repository commit</div>
   <pre class="sp">

</pre>
The menu choice to commit a current version commits all files in the
configuration repository. Commits require a mandatory comment. CFEngine recommends
you use this to explain why a change was made, or relate it to an incident number, etc.
The details of <i>what</i> was changed are already documented by the version control
logs.
   <pre class="sp">

</pre>
<div align="center"><img src="/img/outside/commitdlg.png" alt="The front page"></div>
<div align="center">Figure: Commit dialogue</div>
   <pre class="sp">

</pre>
   <pre class="sp">

</pre>
<div align="center"><img src="/img/outside/updatedialog.png" alt="The front page"></div>
<div align="center">Figure: Updating the repository contents.</div>
   <pre class="sp">

</pre>

<div class="node">
<a name="Report-extensions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Should-monitoring-and-configuration-be-separate_003f">Should monitoring and configuration be separate?</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Mission-Portal-Views">Mission Portal Views</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Mission-Portal">Mission Portal</a>

</div>

<h3 class="section">3.2 Reports in the Mission Portal</h3>

<p>A significant capability of CFEngine Nova over previous versions of
CFEngine is the existence of automated system reporting. CFEngine collects
history, state and change data about computers and ties them together.
The CFEngine strategy is to replace conventional CMDBs with a more
scalable and flexible approach to information mining over the coming
years. Commercial versions of CFEngine are designed to bring state of
the art methods to the problem of information management for IT
operations.

   <p>A report is a tabular summary of CFEngine's internal information, tailored to
a particular purpose. Reports in CFEngine Nova are searchable, and describe
attributes and qualities of managed hosts.

   <p>In CFEngine Nova 2 reports are summarized and collected automatically by
the <code>cf-hub</code> program. This is a daemon which runs only on the system
hub or policy server. Its sole function is to connect to all registered
systems and build a searchable summary of its running state, in as efficient
a manner as possible.

   <p>In addition to the automated hub, reports may be generated on each individual
host using the <code>cf-report</code> program. This generates reports in a variety of
formats, either for direct viewing (in HTML) or for import/export to other
software systems, using XML or CSV output formats.

<div class="node">
<a name="Should-monitoring-and-configuration-be-separate%3f"></a>
<a name="Should-monitoring-and-configuration-be-separate_003f"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#What-is-a-CMDB_003f">What is a CMDB?</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Report-extensions">Report extensions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Mission-Portal">Mission Portal</a>

</div>

<h3 class="section">3.3 Should monitoring and configuration be separate?</h3>

<pre class="sp">

</pre>
The traditional view of IT operations is that configuration,
monitoring and reporting a three different things that should not be
joined. Traditionally, all three have been independent centralized
processes. This view has emerged historically, but it has a major
problem.

   <p>Monitoring as an independent activity is inherently non-scalable.
When numbers of hosts grow beyond a few thousands, centralized
monitoring schemes fail to manage the information. Tying configuration
(and therefore repair) to monitoring at the host level is essential
for the effective management of large and distributed data facilities.
CFEngine foresaw this need in 1998, with its Computer Immunology
initiative, and continues to develop this strategy.

   <p>Cfengine's approach is to focus on scalability. The commercial editions
of CFEngine provide what meaningful information they can in a manner that
can be scaled to tens of thousands of machines.

<div class="node">
<a name="What-is-a-CMDB%3f"></a>
<a name="What-is-a-CMDB_003f"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#CMDB-and-Cfengine">CMDB and CFEngine</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Should-monitoring-and-configuration-be-separate_003f">Should monitoring and configuration be separate?</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Mission-Portal">Mission Portal</a>

</div>

<h3 class="section">3.4 What is a CMDB?</h3>

<pre class="sp">

</pre>

A Configuration Management Database (CMDB), sometimes called a Change
and Configuration Management Database (CCMDB), is a repository of
information about hardware and its expected state. CMDBs are basically
an outgrowth of <i>inventory databases</i>. They were embraced by many IT
companies as a plausible solution to configuration management, in the
absence of an alternative.

   <p>A CMDB records so-called <i>configuration items</i> (CI), which record
technical, ownership and proposed state data. A CMDB does not
generally record actual state &ndash; this is left for monitoring software.

   <p>The term CMDB originates from the IT Infrastructure Library (ITIL)
framework, where it is given a prominent role in system planning and
verification. The CMDB is by definition a centralized repository.

<div class="node">
<a name="CMDB-and-Cfengine"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Decentralized-data-collection-in-Cfengine">Decentralized data collection in CFEngine</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#What-is-a-CMDB_003f">What is a CMDB?</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Mission-Portal">Mission Portal</a>

</div>

<h3 class="section">3.5 CMDB and CFEngine</h3>

<pre class="sp">

</pre>

CFEngine deviates from the classical view of a CMDB to modernize the
concept for modern scaling requirements.  Configuration management
requires something more sophisticated than a database to describe
system patterns. The CMDB applies a <i>brute force</i> approach to
collection and searching of system data that does not scale well, and requires
large and expensive resources to manage.

   <p>CFEngine works with a highly compressed description of system
properties that is based on category classification rather than an
exhaustive inventory of computers. Being distributed in operation,
CFEngine can also enforce policy on state, without brute force imaging.

<div class="node">
<a name="Decentralized-data-collection-in-Cfengine"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Reporting-in-Cfengine">Reporting in CFEngine</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#CMDB-and-Cfengine">CMDB and CFEngine</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Mission-Portal">Mission Portal</a>

</div>

<h3 class="section">3.6 Decentralized data collection in CFEngine</h3>

<pre class="sp">

</pre>

CFEngine is designed to scale to vast numbers of machines.  It does so
because it is fundamentally decentralized. Data about system state are
recorded <i>in situ</i> and are not transmitted over the network
directly. CFEngine summarizes and compresses system information before
making it available for central aggregation and analysis. This means
that high resolution data are available where they count, processing
is decentralized, and inexpensive summaries may be compared and mined
for correlations.

   <p>Cfengine's distributed architecture means that no data are lost if the
network fails temporarily. CFEngine uses the network <i>opportunistically</i>,
but it is not reliant on it for real-time operations.

<div class="node">
<a name="Reporting-in-Cfengine"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Standard-reports-in-CFEngine-Nova">Standard reports in CFEngine Nova</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Decentralized-data-collection-in-Cfengine">Decentralized data collection in CFEngine</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Mission-Portal">Mission Portal</a>

</div>

<h3 class="section">3.7 Reporting in CFEngine</h3>

<pre class="sp">

</pre>

<p><table class="cartouche" summary="cartouche" border="1"><tr><td>
If you have regular reporting needs, we recommend using our commercially supported
version of CFEngine (CFEngine Nova or above), as you will save considerable time
and resources in programming, and you will have access to the latest developments
through the software subscription.
</td></tr></table>

   <p>No promises made in CFEngine imply automatic aggregation of data to a central
location. In commercial CFEngine versions, e.g. CFEngine Nova, an optimized
aggregation of standardized reports is provided, but the ultimate decision to
aggregate must be yours.

   <p>Monitoring and reporting capabilities in CFEngine depend on the
software version include:

     <ul>
<li><b>Community Edition:</b> Basic output to file or logs may be customized on a per-promise basis. Users can design their own log and report formats, but data processing and extraction from CFEngine's embedded databases must be scripted by the user.

     <li><b>Nova:</b> In addition to community features, Nova provides automated extraction of
data from CFEngine's self-learning agents, and the generation of a
standard set of reports in text, HTML or XML formats. Nova summarizes
distributed data and provides simple compression and aggregation of
these summaries. Finally summaries are tied into a knowledge map or
semantic index for browsing by IT operations. At this level CFEngine exceeds
other industry CMDB solutions for configuration.

     <li><b>Constellation:</b> In addition to Nova features, Constellation performs
additional data extraction from the collected reports. It analyses correlations
and provides reverse look up of system attributes based on searchable expressions.
At this level, CFEngine exceeds other industry CMDB solutions in both reporting
and configuration.

     <li><b>Galaxy:</b> In addition to Constellation features, Galaxy adds a number
of state of the art active probes that integrate network monitoring
with system node monitoring, offering a total and integrated overview
of networked system behavior.

   </ul>

<div class="node">
<a name="Standard-reports-in-CFEngine-Nova"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Knowledge-Map">Knowledge Map</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Reporting-in-Cfengine">Reporting in CFEngine</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Mission-Portal">Mission Portal</a>

</div>

<h3 class="section">3.8 Standard reports in CFEngine Nova</h3>

     <dl>
<dt><em>Available patches report</em><dd>Patches already installed on system if available.
<br><dt><em>Classes report</em><dd>User defined classes observed on the system &ndash; inventory data.
<br><dt><em>Compliance report</em><dd>Total summary of host compliance, all promises aggregated over time.
<br><dt><em>File_changes report</em><dd>Latest observed changes to system files with time discovered.
<br><dt><em>File_diffs report</em><dd>Latest observed differences to system files, in a simple diff format.
<br><dt><em>Hashes report</em><dd>File hash values measured (change detection).
<br><dt><em>Installed patches report</em><dd>Patches not yet installed, but published by vendor if available.
<br><dt><em>Installed software report</em><dd>Software already installed on system if available.
<br><dt><em>Last-seen report</em><dd>Time and frequency of communications with peers, host reliability.
<br><dt><em>Micro-audit report</em><dd>Generated by CFEngine self-auditing. This report is not aggregated.
<br><dt><em>Monitor summary report</em><dd>Pseudo-real-time measurement of time series data.
<br><dt><em>Performance report</em><dd>Time cost of verifying system promises.
<br><dt><em>Promise report</em><dd>Per-promise average compliance report over time.
<br><dt><em>Promises not kept report</em><dd>Promises that were recently un-kept.
<br><dt><em>Promises repaired report</em><dd>Promises that were recently kept by repairing system state.
<br><dt><em>Setuid report</em><dd>Known setuid programs found on system.
<br><dt><em>Variables report</em><dd>Current variable values expanded on different hosts.
</dl>

<ul class="menu">
<li><a accesskey="1" href="#Performance-logs">Performance logs</a>
<li><a accesskey="2" href="#Installed-software-packages">Installed software packages</a>
<li><a accesskey="3" href="#A-promise-compliance-report">A promise compliance report</a>
<li><a accesskey="4" href="#A-file-content-change-report">A file content change report</a>
<li><a accesskey="5" href="#Installed-setuid-program-report">Installed setuid program report</a>
</ul>

<div class="node">
<a name="Performance-logs"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Installed-software-packages">Installed software packages</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Standard-reports-in-CFEngine-Nova">Standard reports in CFEngine Nova</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Standard-reports-in-CFEngine-Nova">Standard reports in CFEngine Nova</a>

</div>

<h4 class="subsection">3.8.1 Performance logs</h4>

<p>Performance logs show the last measured and average times taken to complete a particular
promise from start to finish. The standard deviation of the time is quoted to show
the major variations.

     <ul>
<li>Promises that have anomalous performance, especially long jobs might be worthy of
attention if they do not have a predictable execution time.

     <li>The frequency of long jobs can be restricted

     <li>Jobs that are especially long can be backgrounded for improved throughput.

   </ul>

   <div class="block-image"><img src="/img/outside/performance.png" alt="A promiser performance report"></div>

<div class="node">
<a name="Installed-software-packages"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#A-promise-compliance-report">A promise compliance report</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Performance-logs">Performance logs</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Standard-reports-in-CFEngine-Nova">Standard reports in CFEngine Nova</a>

</div>

<h4 class="subsection">3.8.2 Installed software packages</h4>

<p>An overview of installed software as viewed through the eyes of the locally installed
package manager. These data are collected as a byproduct of the <code>packages</code>
promises. You must check for the existence of at least one package to generate
this report. Moreover, the report can only be generated by sufficiently smart package
managers or by custom scripts (see the &lsquo;<samp><span class="samp">packages</span></samp>&rsquo; promise in the reference manual).

   <div class="block-image"><img src="/img/outside/software.png" alt="An installed software report"></div>

<div class="node">
<a name="A-promise-compliance-report"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#A-file-content-change-report">A file content change report</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Installed-software-packages">Installed software packages</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Standard-reports-in-CFEngine-Nova">Standard reports in CFEngine Nova</a>

</div>

<h4 class="subsection">3.8.3 A promise compliance report</h4>

<p>Each time <code>cf-agent</code> completes a scan of whether local promises are kept
it computes a simple high level summary of the state of the system in terms of
whether promises were kept before and after execution.

   <p>The agent distinguished three categories

     <dl>
<dt><em>Promise kept</em><dd>The promise was already kept, and no action was required on the system.
<br><dt><em>Promise repaired</em><dd>The promise was not properly kept but maintenance was performed and the
problem was healed. The system is now in compliance.
<br><dt><em>Promise not kept</em><dd>The promise was not kept, and no remedial action was taken to correct it. (This
is usually a result of an explicit policy decision to not repair a problem, e.g. selecting
action `warn' instead of `fix'.)
</dl>

   <div class="block-image"><img src="/img/outside/compliance.png" alt="A promise compliance report"></div>

<div class="node">
<a name="A-file-content-change-report"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Installed-setuid-program-report">Installed setuid program report</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#A-promise-compliance-report">A promise compliance report</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Standard-reports-in-CFEngine-Nova">Standard reports in CFEngine Nova</a>

</div>

<h4 class="subsection">3.8.4 A file content change report</h4>

<p>Hash scans of files are a common way of detecting any small changes in file integrity.
This log shows the specific times that change events were detected. The resolution of
this log depends on the frequency of scanning, which is the purview of a <code>files</code> promise.

<div align="center"><img src="/img/outside/file_change.png" alt="A file content/hash change report"></div>

   <p>If you enable the <code>report_diffs</code> feature in Nova, on
individually named files, a second `change tracking' report will be
aggregated, summarizing the major changes. On text-only files this
reports major changed in the spirit of the Unix <code>diff</code> command,
though comparatively simplified for a readability. Users can then use
other more specialized difference tools for alternative view for forensic
detail on the host concerned.

<div class="node">
<a name="Installed-setuid-program-report"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#A-file-content-change-report">A file content change report</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Standard-reports-in-CFEngine-Nova">Standard reports in CFEngine Nova</a>

</div>

<h4 class="subsection">3.8.5 Installed setuid program report</h4>

<p>Setuid root programs (Unix systems) are programs given special privileges to carry out
actions normally restricted to Administrative or root users. Attention to
programs with setuid permissions is a matter of security, and thus CFEngine watches
out for changes in the known list of these programs as a matter of course.
This report summarizes the known programs.

<div align="center"><img src="/img/outside/setuid.png" alt="A discovered setuid program report"></div>

<div class="node">
<a name="Knowledge-Map"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Using-the-knowledge-map">Using the knowledge map</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Standard-reports-in-CFEngine-Nova">Standard reports in CFEngine Nova</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Mission-Portal">Mission Portal</a>

</div>

<h3 class="section">3.9 Knowledge Map</h3>

<p>The Knowledge Map is a tool that may be used as:
     <ul>
<li>An index of the information in the Knowledge Map
<li>A tool for brainstorming
<li>A tool for self-learning
</ul>

   <p>It is designed to show relationships between subjects of importance.
The relationships are shown graphically and in text format.

   <p>The text relationships on the right hand side of the screen show direct relationships
between the current subject and neighboring subjects, but with semantic explanations.
The graphical renditions attempt to show greater depth if possible. Due to the limited size of the
screen, and limitations of human cognition, only about twenty of the closest relationships are
depicted to create a sense of `where we are' in the landscape of knowledge. The actual
map might contain many thousands of entries.

   <p>There are up to two graphical representations on each page. The Copernicus view
is a depiction of the current topic in relation to its most important neighbors.
The nodes in the graph are shown as `planetary balls'. The highest ranking (most connected)
topic is shown in yellow, and each node is sized according to its rank.
The current topic has a black label, whereas all others have a white label.

   <pre class="sp">

</pre>
<div align="center"><img src="/img/outside/topicmap.png" alt="Topic map"></div>
<div align="center">Figure: Copernicus view of the Knowledge Map.</div>
   <pre class="sp">

</pre>

On selected promise pages, two images will appear. The lower image called `influence channel',
shows a causation or dependency graph between promises. This graph offers a simple form
of impact analysis. The links between subjects show only dependency relationships.

   <pre class="sp">

</pre>
<p><table class="cartouche" summary="cartouche" border="1"><tr><td>
<i>&ldquo;What am I looking for in a knowledge base?&rdquo;</i>

   <p>There are many reasons to browse knowledge. You browse an encyclopedia
because you are curious. You look up in a dictionary because you want an answer.
You look at wind-dials and thermometers to gauge the environment. You look
at dependencies and diagnostics to answer: what is the <i>cause</i> of some effect?
</td></tr></table>

   <pre class="sp">

</pre>

The helm screen is divided into several parts. On the right hand side there are two
images on each page.

<ul class="menu">
<li><a accesskey="1" href="#The-knowledge-map-pages">The knowledge map pages</a>
<li><a accesskey="2" href="#The-knowledge-base-map_002dgraphs">The knowledge base map-graphs</a>
<li><a accesskey="3" href="#Results-for-this-topic">Results for this topic</a>
<li><a accesskey="4" href="#Topics-that-have-Category_002dTopic-as-a-subject_002dheader">Topics that have Category-Topic as a subject-header</a>
<li><a accesskey="5" href="#Other-topics-found-under-Category">Other topics found under Category</a>
</ul>

<div class="node">
<a name="The-knowledge-map-pages"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#The-knowledge-base-map_002dgraphs">The knowledge base map-graphs</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Knowledge-Map">Knowledge Map</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Knowledge-Map">Knowledge Map</a>

</div>

<h4 class="subsection">3.9.1 The knowledge map pages</h4>

<p>Each page of the console represents a single topic in the
documentation. The topic name is described in the title of the
page. Topics fall into categories, and these are reflected in the name

<pre class="example">     Category::Topic
</pre>
   <p class="noindent">Categories are also topics that can be looked up. Clicking on one of the
links centers your page view on that particular topic.

<div class="node">
<a name="The-knowledge-base-map-graphs"></a>
<a name="The-knowledge-base-map_002dgraphs"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Results-for-this-topic">Results for this topic</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#The-knowledge-map-pages">The knowledge map pages</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Knowledge-Map">Knowledge Map</a>

</div>

<h4 class="subsection">3.9.2 The knowledge base maps</h4>

<p>On each page you will find one or two graphics that illustrate the
current topic and its relationship to neighboring leads and
perspectives. This neighborhood shows you up to 30 of the closest
related topics, but it does not show you <i>how</i> they are
related. This picture is useful for seeing the `bigger picture', but
for a more detailed understanding you should look at the <i>Insight, leads and
Perspectives</i> panel. That panel tells you the exact nature of the relationship
to the closest topics in the map: in other words, what should you expect
to learn by following that link?

   <p>The graphical representation of the knowledge map shows the local
neighborhood you are currently exploring. Clicking on a panel to the right
will enlarge it. The current topic will be shown in yellow (with red text).
You will only see a maximum of thirty topics at any one time.

   <p>The relative importance of the topics is shown by their size, and size is
determined by how many references a topic has to nearby topics. The most
important topic is placed as the star at the center of this `solar
system' view. Other nodes are colors pink, brown, grey depending on
their distance from it.

   <p>The current topic might not be the most important
in the neighborhood you are exploring. The graphs are designed to guide
you towards what is important in your system and its work-flows.

<div class="node">
<a name="Results-for-this-topic"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Topics-that-have-Category_002dTopic-as-a-subject_002dheader">Topics that have Category-Topic as a subject-header</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#The-knowledge-base-map_002dgraphs">The knowledge base map-graphs</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Knowledge-Map">Knowledge Map</a>

</div>

<h4 class="subsection">3.9.3 Results for this topic</h4>

<p>This panel shows document references and information pertaining directly
to the current topic (if any). The red links point to URL documents. The text
to the left explains what kind of information you should expect to find about
the current topic.

<div class="node">
<a name="Topics-that-have-Category-Topic-as-a-subject-header"></a>
<a name="Topics-that-have-Category_002dTopic-as-a-subject_002dheader"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Other-topics-found-under-Category">Other topics found under Category</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Results-for-this-topic">Results for this topic</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Knowledge-Map">Knowledge Map</a>

</div>

<h4 class="subsection">3.9.4 Topics that have Category::Topic as a subject-header</h4>

<p>If the current topic is a category with several sub-themes, this panel
contains a list of possible sub-topics that lie under this category.
In other words, the list shown here is a depth search in the knowledge base.

<div class="node">
<a name="Other-topics-found-under-Category"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Topics-that-have-Category_002dTopic-as-a-subject_002dheader">Topics that have Category-Topic as a subject-header</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Knowledge-Map">Knowledge Map</a>

</div>

<h4 class="subsection">3.9.5 Other topics found under Category</h4>

<p>This panel shows any other topics in the same category as the current topic.
In other words, the list shown here is a breadth search of the knowledge base.

<div class="node">
<a name="Using-the-knowledge-map"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#cf_002dhub-and-data-collection">cf-hub and data collection</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Knowledge-Map">Knowledge Map</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Mission-Portal">Mission Portal</a>

</div>

<h3 class="section">3.10 Using the knowledge map</h3>

<p>Go to the URL set up for the policy server, using a web browser of your choice.

<pre class="example">     http://policy_server.example.com
</pre>
   <p>When you look at the knowledge base for the first time, you can either
explore using the links, or type in a search word into the top field
to jump to the closest matching topic.

   <p>No matter where you begin your search, you will end up on a page which
has the same basic structure (described above).

   <p>The front page of the knowledge map is shown in the figure below. This has a number of
links and a number of graphic images which are also links.

   <div class="block-image"><img src="/img/outside/mission.png" alt="The front page"></div>

<ul class="menu">
<li><a accesskey="1" href="#Policy-analysis">Policy analysis</a>
<li><a accesskey="2" href="#Understanding-dependencies">Understanding dependencies</a>
<li><a accesskey="3" href="#A-quick-tour-of-the-knowledge-console">A quick tour of the knowledge console</a>
<li><a accesskey="4" href="#Why-knowledge-management_003f">Why knowledge management?</a>
</ul>

<div class="node">
<a name="Policy-analysis"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Understanding-dependencies">Understanding dependencies</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Using-the-knowledge-map">Using the knowledge map</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Using-the-knowledge-map">Using the knowledge map</a>

</div>

<h4 class="subsection">3.10.1 Policy analysis</h4>

<p>CFEngine helps you to make sense of the knowledge implicit in your
current CFEngine policy, by turning it into an annotated map. You can
extend the automatically generated map with your own comments, topics
and documents, in order to tie in with your own enterprise
information. The knowledge map will normally run on a single machine,
such as the CFEngine policy server, but this is not a requirement.

   <p>The example figure below shows typical page generated by the knowledge
agent. It describes a CFEngine promise from the policy files. One such
page is generated for each policy promise, and pages may be generated
for reports from different computers. You can also create `topic
pages' for any local (enterprise) information that you have. In this
case the promise has been given the promise-handle
<code>update_policy</code>, and the associations and the lower graph shows
how this promise relates to other promises through its documented
dependencies (these are documented from the promisees and
<code>depends_on</code> attributes of other promises.).

   <p>The example page shows two figures, one above the other.  The upper
figure shows the thirty nearest topics (of any kind) that are related
to this one.  Here the relationships are unspecific. This diagram can
reveal pathways to related information that are often unexpected, and
illustrates relationships that broaden one's understanding of the
place the current promise occupies within the whole.

   <div class="block-image"><img src="/img/outside/dependency.png" alt="The visualization of dependencies in CFEngine with the knowledge agent's web rendering"></div>

   <p>The second figure shows a blow up of the dependency map
illustration. It is a subset of the larger picture, choosing only
those topics that are linked by impact-related associations.

   <p>Although these illustrations are just renderings of the `leads and perspectives' associations
shown in text, they are useful for visualizing several levels of depth
in the associative network. In particular, one can see the other
promises that could be affected if we were to make a change to the
current promise.
Such impact analyses can be crucial to planning change and release management of policy.
ITIL best practices recommend thorough pre-analyses of release changes. CFEngine Nova
combined with good practice of documentation makes this straightforward.
<a name="index-Impact-analysis-1"></a>
<img src="/img/outside/influence_cfengine_inputs.png" alt="Influence of the current policy promise">

   <p>Another example topic page.

   <div class="block-image"><img src="/img/outside/promise_page.png" alt="Influence of the current policy promise"></div>

   <pre class="sp">

</pre>
<p><table class="cartouche" summary="cartouche" border="1"><tr><td>
A CFEngine knowledge base is not a new document format, it is an overlay
map that joins ideas and resources together, and displays relationships.
</td></tr></table>

   <pre class="sp">

</pre>

<div class="node">
<a name="Understanding-dependencies"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#A-quick-tour-of-the-knowledge-console">A quick tour of the knowledge console</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Policy-analysis">Policy analysis</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Using-the-knowledge-map">Using the knowledge map</a>

</div>

<h4 class="subsection">3.10.2 Understanding dependencies</h4>

<p>Nova adds automatically instrumentation to the policy compilation that allows
you to trace dependencies, provided you follow the best-practice when
constructing your promise rules.

   <p>When writing promises, get into the habit of giving every promise a comment
that explains its intention.

   <p>Also, give related promises <i>handles</i>, or labels that can be used to
refer to them by.

<pre class="verbatim">
files:

  "/var/cfengine/inputs"

    handle => "update_policy",

    perms => system("600"),
    copy_from => mycopy("$(master_location)","$(policy_server)"),
    depth_search => recurse("inf"),
    file_select => input_files,
    action => immediate;

</pre>
If a promise affects another promise in some way, you can make the affected
promise one of the promisees, like this:

<pre class="verbatim">
access:

  "/master/cfengine/inputs" -> { "update_policy", "other_promisee" },

    handle  => "serve_updates",

    admit   => { "217.77.34.*" };

</pre>

   <p>Conversely, if a promise might depend on another in some (even indirect) way, document this too.

<pre class="verbatim">
files:

  "/var/cfengine/inputs"

    handle     => "update_policy",
    depends_on => "serve_updates",

    perms => system("600"),
    copy_from => my-copy("$(master_location)","$(policy_server)"),
    depth_search => recurse("inf"),
    file_select => input_files,
    action => immediate;


</pre>

   <p>The lower of the two diagrams on the knowledge page (called the influence channel) shows graphically
how dependency trails flow. The text links show the specific of each
relationship.

     <ul>
<li>When a bundle is passed a parameter by another
<li>In method calls, a passed variable value is considered a causal influence.
<li>When a variable is used in a shell command
<li>When a variable is set by a function call that retrieves from a database/file
</ul>

<div class="node">
<a name="A-quick-tour-of-the-knowledge-console"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Why-knowledge-management_003f">Why knowledge management?</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Understanding-dependencies">Understanding dependencies</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Using-the-knowledge-map">Using the knowledge map</a>

</div>

<h4 class="subsection">3.10.3 A quick tour of the knowledge console</h4>

<pre class="sp">

</pre>
<p><table class="cartouche" summary="cartouche" border="1"><tr><td>

     <ol type=1 start=1>

     <li>Click on the top bar to go back to the start page. This takes you to the mission status summary.

     <li>Look at the different panels
          <ul>
<li>References to this topic - showing immediate results and documents
<li>Topic (current focus) includes - showing sub categories of this major heading
<li>Insight, Leads and perspectives - show intelligent hints and tips
<li>Other topics found under (major heading) - similar topics to the current
</ul>

     <li>Click on `Manager view', and look at the new panels. Explore at will.

     <li>Click on the upper network image to the right, showing topics that
are closely related through `leads and perspectives'. Click back to the mission
status page.

     <li>Click on the bar-meter `site summary'. This takes you to the monitoring
portal for individual machines. Here you see all managed hosts.

     <li>Click on a new bar meter to drill down into performance statistics, and keep
clicking until you can go no further to see detail.

     <li>Go back to main page and find the search field at the top right. Enter `BDMA'
to search for this topic.

        </ol>

   </td></tr></table>

<div class="node">
<a name="Why-knowledge-management%3f"></a>
<a name="Why-knowledge-management_003f"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#A-quick-tour-of-the-knowledge-console">A quick tour of the knowledge console</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Using-the-knowledge-map">Using the knowledge map</a>

</div>

<h4 class="subsection">3.10.4 Why knowledge management?</h4>

<p>At CFEngine, we believe that Knowledge Management is the challenge of our times.
As futurist Alvin Toffler wrote in his seminal 1970 study <i>Future Shock</i>
about the rapidity of industrial changes of the '60s:

   <pre class="sp">

</pre>
<blockquote>
<i>"Rising novelty renders irrelevant the traditional goals of our chief
institutions...Acceleration produces a faster turnover of
goals. Diversity or fragmentation leads to a relentless multiplication...
Caught in this churning, goal-cluttered environment, we
stagger...from crisis to crisis, pursuing a welter of
conflicting and self-cancelling purposes."</i>
</blockquote>

   <pre class="sp">

</pre>

We see it as a key strategy to provide simple tools that explain
<i>intentions</i> and <i>meaning</i> amongst the welter of system documentation and information.

<div class="node">
<a name="cf-hub-and-data-collection"></a>
<a name="cf_002dhub-and-data-collection"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Using-the-knowledge-map">Using the knowledge map</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Mission-Portal">Mission Portal</a>

</div>

<h3 class="section">3.11 cf-hub and data collection</h3>

<p>The `hub' is both a machine and a process in a default centralized
reporting architecture.  For most purposes, CFEngine avoids
centralization of effort in order to scale efficiently.  For
reporting, however, one needs a common location and standard of data
collection to provide accurate information, so we make an
exception. To make hub aggregation scale efficiently, Nova 2 uses an
extremely lightweight data encoding that is several hundred times
faster than the approach used in Nova 1. Using a hub, the process
can be parallelized and kept up to date more often than before.

<pre class="example">     host# /var/cfengine/bin/cf-hub
</pre>
   <p>The CFEngine hub runs in the background and connects to all known registered hosts and builds a
summary model of their state in a database. This database is
searchable and may be browsed using the Mission Portal.  Updates may
be collected manually also:

<pre class="example">     host# cf-runagent -H hostname -q delta
     host# cf-runagent -H hostname -q full
</pre>
   <ul class="menu">
<li><a accesskey="1" href="#CMDB-or-SKMS">CMDB or SKMS</a>
<li><a accesskey="2" href="#The-reporting-agent">The reporting agent</a>
</ul>

<div class="node">
<a name="CMDB-or-SKMS"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#The-reporting-agent">The reporting agent</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#cf_002dhub-and-data-collection">cf-hub and data collection</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#cf_002dhub-and-data-collection">cf-hub and data collection</a>

</div>

<h4 class="subsection">3.11.1 CMDB or SKMS</h4>

<p>Last generation systems have used the concept of the Configuration
Management Database (CMDB) as a central repository of information. The
CMDB concept was primitive and data-intensive; it had no concept of
intended versus un-intended state. Today the term SKMS or Service
Knowledge Management System is coming into use, based in ITIL version
3.  The idea here is to go beyond mere data-mining to a knowledge
oriented system.

   <p>CFEngine Nova provides a `next generation' knowledge-oriented overview
of IT operations in its Mission Portal. It combines intended state
maintained through policy, with actual state measured by observation,
and relates these for the user in a semantic web. This enables users
to relate measured data to actual strategic goals, and `connect the dots
between Business and IT'.

<div class="node">
<a name="The-reporting-agent"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#CMDB-or-SKMS">CMDB or SKMS</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#cf_002dhub-and-data-collection">cf-hub and data collection</a>

</div>

<h4 class="subsection">3.11.2 The reporting agent</h4>

<p>A control body for the reporter looks like this:

<pre class="verbatim">
body reporter control
{
reports => { "performance", "last_seen", "monitor_history" };
build_directory => "/var/cfengine/reports";
report_output => "html";
}

</pre>

     <ul>
<li>Knowledge management leads to better IT decisions
<li>Advance from knowledge hunter-gathers to a knowledge-sharing society
<li>Knowledge yields improved response to business needs
<li>Sharing the lessons learned results in best practices across the organization.
<li>Knowledge gives the accuracy and precision to succeed
</ul>

<!-- ***************************************************** -->
<!-- * CHAPTER -->
<!-- ***************************************************** -->
<div class="node">
<a name="Business-Integration"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Monitoring-extensions">Monitoring extensions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Mission-Portal">Mission Portal</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">4 Business Integration</h2>

<ul class="menu">
<li><a accesskey="1" href="#Nova-attends-to-business-goals">Nova attends to business goals</a>
<li><a accesskey="2" href="#Business-value-reports">Business value reports</a>
<li><a accesskey="3" href="#Simple-insight-into-IT-compliance">Simple insight into IT compliance</a>
</ul>

<div class="node">
<a name="Nova-attends-to-business-goals"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Business-value-reports">Business value reports</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Business-Integration">Business Integration</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Business-Integration">Business Integration</a>

</div>

<h3 class="section">4.1 Business goals and the Service Catalogue</h3>

<pre class="sp">

</pre>
Trust and confidence form just one of the pillars of business; agility
and creativity make up the others.  CFEngine Nova brings features that
make it possible to connect the dots meaningfully between high level
business goals and low level configuration implementation.
This enables different layers of an organization to gain insight into how
the system is being managed, in relation to the strategic goals.

     <ul>
<li>CFEngine Nova's rich repertoire of configuration capabilities
allows model-based integration of systems, attending to the unique requirements
of each business service. Off-the-shelf does not have to mean bland and generic.
Customization is CFEngine's forte. It is the glue holding applications together.

     <li>Nova's speed and use of patterns allows many small changes to be made
very quickly.
</ul>
   Nova provides appropriate insight into IT operations
through explanation, reporting and visualization of policy, allowing
business and IT to gather around information of mutual interest.
Of course, CFEngine is not going to make IT experts of business staff, or vice
versa.  However, business and IT work best together when then can
communicate effectively.  Our aim with Nova is to give business heads
just the right level of insight into technical IT operations to be assured that
their needs are being met<a rel="footnote" href="#fn-6" name="fnd-6"><sup>6</sup></a>. Similarly,
Nova makes business goals available to IT staff so that they can feel
connected and responsible for the strategic goals of the organization.

   <div class="float">
   <pre class="sp">

</pre>
<div align="center"><img src="/img/outside/service_catalogue.png" alt="iso"></div>
<div align="center">A human-readable Service Catalogue generated from technical specifications</div>
<div align="center">shows what goals are being attended to automatically</div>
   <pre class="sp">

</pre>
<p><strong class="float-caption"></strong></p></div>

   <p>The Service Catalogue is a concept that has been promoted as part of
the IT Infrastructure Library (ITIL).  Nova generates a service
catalogue directly from a model of the knowledge about policy.

<pre class="verbatim">bundle agent service_catalogue
{
methods:

   "everyone" usebundle => time_management,
                comment => "Ensure clocks are synchronized";

   "everyone" usebundle => garbage_collection,
                comment => "Keep disks free of junk and rotate logs";

   "everyone" -> goal_3,

              usebundle => change_management,
                 comment=> "Monitor change";

   "managed hosts" -> goal_1,

                   usebundle => cfengine_management,
                     comment => "Management of cfengine internals";

   "mail server"  -> { "goal_3", "goal_1", "goal_2" }

                  usebundle => app_mail_postfix,
                    comment => "The mail delivery agent";
}

</pre>

   <p>Technical IT administrators can document which promises or bundles of promises
are directed towards specific goals by adding a simple reference
The Nova Knowledge Map will then build a narrative around these references
and tie the goals to the services in the catalogue (See the Planning tab).

<div class="node">
<a name="Business-value-reports"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Simple-insight-into-IT-compliance">Simple insight into IT compliance</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Nova-attends-to-business-goals">Nova attends to business goals</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Business-Integration">Business Integration</a>

</div>

<h3 class="section">4.2 Business value reports</h3>

<p>One of the capabilities of CFEngine is to add business or
organizational value to the configuration model. The notion of
business value is not a clear concept, but a very simple
approach to measuring value is to attach a monetary value
to the outcome of promises.

   <p>The <code>value_kept</code> (default value 1), <code>value_repaired</code>
(default value 0.5), <code>value_notkept</code> (default value -1) settings
fall under CFEngine transaction logging and allow administrators to
attach actual monetary (or other) values to promises kept, or issues
repaired, or conversely measure the loss of non-compliance in dollar
terms (choose your currency). This value is summed and recorded for
each execution of CFEngine, and can be turned into graphs for your
management reports.

   <p>An example of this report is shown below. The results are summed for each day and
presented in column form.

   <div class="float">
   <pre class="sp">

</pre>
<div align="center"><img src="/img/outside/bval.png" alt="iso"></div>
<div align="center">Business value accounting can be entered into the model.</div>
   <pre class="sp">

</pre>
<p><strong class="float-caption"></strong></p></div>

<div class="node">
<a name="Simple-insight-into-IT-compliance"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Business-value-reports">Business value reports</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Business-Integration">Business Integration</a>

</div>

<h3 class="section">4.3 Simple insight into IT compliance</h3>

<p>While business and IT can come together to decide what promises IT services
should keep, a simple confirmation of that compliance helps business units
to be assured
<div class="float">
   <pre class="sp">

</pre>
<div align="center"><img src="/img/outside/mission.png" alt="iso"></div>
<div align="center">An overview of compliance</div>
   <pre class="sp">

</pre>
<p><strong class="float-caption"></strong></p></div>
Increasing and graded levels of detail can be obtained to match the level of expertise
of the viewer. Bar meters can represent more specific details.
<div class="float">
   <pre class="sp">

</pre>
<div align="center"><img src="/img/outside/weakest.png" alt="iso"></div>
<div align="center">Weakest hosts broken down by compliance, performance and change.</div>
   <pre class="sp">

</pre>
<p><strong class="float-caption"></strong></p></div>

   <p>For system analysts, Nova can recognize and highlight trends and patterns of behavior
that inform further strategic decision making.
<div class="float">
   <pre class="sp">

</pre>
<div align="center"><img src="/img/outside/trends.png" alt="iso"></div>
<div align="center">Analysis of system performance over multiple time-scales</div>
<div align="center">can aid with resource deployment and future planning.</div>
   <pre class="sp">

</pre>
<p><strong class="float-caption"></strong></p></div>

<!-- ***************************************************** -->
<!-- * CHAPTER -->
<!-- ***************************************************** -->
<div class="node">
<a name="Monitoring-extensions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Database-Promises">Database Promises</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Business-Integration">Business Integration</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">5 Monitoring extensions</h2>

<p>CFEngine Nova incorporates a lightweight monitoring agent, whose aim
is to provide meaningful performance data about systems, in a scalable
fashion.  CFEngine Nova does not aim to replace specialized
rapid-update monitoring and alarm systems; it provides a context-aware
summary of current state that is always displayed in relation to
previous system behavior, for comparison. The aim is to offer useful
analytics rather than jump-to alarms.

   <p>Cfengine's monitoring component <code>cf-monitord</code> records a number of
performance data about the system by default. These include process
counts, service traffic, load average and CPU utilization and
temperature when available.  In the Community Edition, data are
only collected and stored for personal use, but users have to work to see
results.  CFEngine Nova improves on this in three ways.

     <ul>
<li>Data collected from the monitoring system are integrated into
the aggregate knowledge console.

     <li>It adds a three year life-cycle trend summary, based any
`shift'-averages.

     <li>It add customizable promises to monitor or
log specific highly specific user data through the generic promise
interface.

   </ul>

   <p>The end result is to display time series traces of system performance, like the
above mentioned values, and customized logs feeding custom-defined
reports.

<ul class="menu">
<li><a accesskey="1" href="#Integration-of-monitoring-with-knowledge-base">Integration of monitoring with knowledge base</a>
<li><a accesskey="2" href="#Long-term-trends">Long term trends</a>
<li><a accesskey="3" href="#Custom-promises-to-measure">Custom promises to measure</a>
<li><a accesskey="4" href="#Uses-for-custom-monitoring">Uses for custom monitoring</a>
</ul>

<div class="node">
<a name="Integration-of-monitoring-with-knowledge-base"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Long-term-trends">Long term trends</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Monitoring-extensions">Monitoring extensions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Monitoring-extensions">Monitoring extensions</a>

</div>

<h3 class="section">5.1 Integration of monitoring with knowledge base</h3>

<p>CFEngine Nova integrates monitoring reports with the automated base
knowledge to provided self-analysis and simple summary reporting.
A `graphic equalizer' view shows important status summaries, and
the semantic links allow users to drill down to specific reporting data.

   <div class="block-image"><img src="/img/outside/mission.png" alt="Integrated Monitoring"></div>

   <p>Detailed time-series views can be collected and collated, providing
honest and accurate data that allow you to gauge your own confidence
level in system performance.  Unlike most monitoring solutions,
CFEngine shows you its own confidence in the measurements taken. It
takes a finite amount of time to measure and transport data from
systems to the knowledge console. That time also provides information
about system performance. CFEngine always promises to tell you how old
data are and how confident it is in the values.

   <div class="block-image"><img src="/img/outside/trends.png" alt="Integrated Monitoring"></div>

<div class="node">
<a name="Long-term-trends"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Custom-promises-to-measure">Custom promises to measure</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Integration-of-monitoring-with-knowledge-base">Integration of monitoring with knowledge base</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Monitoring-extensions">Monitoring extensions</a>

</div>

<h3 class="section">5.2 Long term trends</h3>

<p>CFEngine normally operates with time-series data represented
in two forms:

     <ul>
<li>A weekly average, plotted on a periodogram, showing performance now in relation
to the same time of week in previous weeks. After about a month data are forgotten
to ensure a sufficient rate of adaptation to new patterns.
<li>The past four hours in high resolution.
</ul>

   <p>CFEngine Nova adds quarter day averages of recorded time-series which go back three
years in time. Three years is considered to be the lifetime of a computer.
Summaries of the detailed performance are summarized by flat averages for
a four-shift day:
     <ul>
<li><b>Night shift</b>: from midnight 00:00 to 06:00
<li><b>Morning shift</b>: from 06:00 to 12:00
<li><b>Afternoon shift</b>: from 12:00 to 18:00
<li><b>Evening shift</b>: from 18:00 to 00:00
</ul>

<div class="node">
<a name="Custom-promises-to-measure"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Uses-for-custom-monitoring">Uses for custom monitoring</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Long-term-trends">Long term trends</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Monitoring-extensions">Monitoring extensions</a>

</div>

<h3 class="section">5.3 Custom promises to measure</h3>

<p>CFEngine Nova adds a new promise type in bundles for the monitoring
agent. These are written just like all other promises within a bundle
destined for the agent concerned. In this case:

<pre class="verbatim">bundle monitor watch

{
measurements:

  # promises ...

}

</pre>

<ul class="menu">
<li><a accesskey="1" href="#Extraction-strings-and-logging">Extraction strings and logging</a>
<li><a accesskey="2" href="#Extracting-one_002doff-numerical-data">Extracting one-off numerical data</a>
<li><a accesskey="3" href="#Extraction-to-list-variable">Extraction to list variable</a>
</ul>

<div class="node">
<a name="Extraction-strings-and-logging"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Extracting-one_002doff-numerical-data">Extracting one-off numerical data</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Custom-promises-to-measure">Custom promises to measure</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Custom-promises-to-measure">Custom promises to measure</a>

</div>

<h4 class="subsection">5.3.1 Extraction strings and logging</h4>

<p>Let's take a generic example. Suppose we have a file of nonsense  <samp><span class="file">/tmp/testmeasure</span></samp>
and we want to extract some information that we call a `blonk'
from the file. A blonk is always on the second line of this file following
a prefix `Blonk blonk '. We would get the value like this:

<pre class="verbatim">
  "/tmp/testmeasure"

      handle => "blonk_watch",
      stream_type => "file",
      data_type => "string",
      history_type => "log",
      units => "blonks",
      match_value => find_blonks,
      action => sample_min("10");

</pre>

   <p>This promise body has several attributes.

     <dl>
<dt><code>handle</code><dd>It is essential to give measurement promises handles, as these are used to label the
log files that will store the values.

     <br><dt><code>stream_type</code><dd>Tells us that we are reading from what the system considered to be a regular file
on the file-system.

     <br><dt><code>data_type</code><dd>This says that data are to be treated as text with no other meaning.

     <br><dt><code>history_type</code><dd>This tells us that we want to log the values with a time stamp.

     <br><dt><code>units</code><dd>This string is used in documentation to explain the measurement units of this result.

     <br><dt><code>match_value</code><dd>This is a body reference that represents the algorithm by which we extract data from the file.

     <br><dt><code>action</code><dd>This is the generic action parameter that may be added to all promises. We use it
here to limit the sample rate of this promise; <code>cf-monitord</code> samples by default
at a rate of once per 2.5 minutes.
</dl>

   <p>The matching body uses a method for selecting the correct line, and a way
for extracting a pattern from the line. In every case the value extracted
is described  by using a regular expression <i>back-reference</i>, i.e.
a parenthesized expression  within a regular expression. The expression should
match the entire line and should contain exactly one parenthesis.

<pre class="verbatim">body match_value find_blonks
{
select_line_number => "2";
extraction_regex => "Blonk blonk ([blonk]+).*";
}
</pre>

   <p>The sampling rate is controlled by using the generic <code>action</code> constraint.
<pre class="verbatim">body action sample_min(x)
{
ifelapsed => "$(x)";
expireafter => "$(x)";
}
</pre>

<div class="node">
<a name="Extracting-one-off-numerical-data"></a>
<a name="Extracting-one_002doff-numerical-data"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Extraction-to-list-variable">Extraction to list variable</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Extraction-strings-and-logging">Extraction strings and logging</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Custom-promises-to-measure">Custom promises to measure</a>

</div>

<h4 class="subsection">5.3.2 Extracting one-off numerical data</h4>

<p>In this example we extract an integer value from an existing file.
Notice that CFEngine samples the process table during <code>processes</code>
promises so you might be able to save a new execution of a
shell command and use the cached data, depending on your need
for immediacy. It is always good practice to limit the system
load incurred by monitoring.

<pre class="verbatim">  # Test 2 - follow a special process over time
  # using cfengine's process cache to avoid resampling

   "/var/cfengine/state/cf_rootprocs"

      handle => "monitor_self_watch",
      stream_type => "file",
      data_type => "int",
      history_type => "static",
      units => "kB",
      match_value => proc_value(".*cf-monitord.*",

         "root\s+[0-9.]+\s+[0-9.]+\s+[0-9.]+\s+[0-9.]+\s+([0-9]+).*");

</pre>

   <p>This match body selects a line matching a particular regular expression
and extracts the 6th column of the process table. The regular expression
skips first the root string and then five numerical values.
The value is extracted into a one-off value

<pre class="verbatim">body match_value proc_value(x,y)
{
select_line_matching => "$(x)";
extraction_regex => "$(y)";
}
</pre>

<div class="node">
<a name="Extraction-to-list-variable"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Extracting-one_002doff-numerical-data">Extracting one-off numerical data</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Custom-promises-to-measure">Custom promises to measure</a>

</div>

<h4 class="subsection">5.3.3 Extraction to list variable</h4>

<p>In this example we discover a list of disks attached to the system.
<pre class="verbatim">  # Test 3, discover disk device information

  "/bin/df"

      stream_type => "pipe",
      data_type => "slist",
      history_type => "static",
      units => "device",
      match_value => file_system,
      action => sample_min("480"); # this is not changing much!

</pre>

<pre class="verbatim">
body match_value file_system
{
select_line_matching => "/.*";
extraction_regex => "(.*)";
}

</pre>

<div class="node">
<a name="Uses-for-custom-monitoring"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Custom-promises-to-measure">Custom promises to measure</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Monitoring-extensions">Monitoring extensions</a>

</div>

<h3 class="section">5.4 Uses for custom monitoring</h3>

<p>Unlike most other monitoring tools that use heavy-weight scripting
languages to exact data, often running many processes for each
measurement, CFEngine is a lightweight probe, using file interfaces
and regular expressions to extract data. Thus its impact on the
system is minimal. The possibilities for using this are therefore
extremely broad:

     <ul>
<li>Extracting accounting data from systems for charge-back.
This could be useful in cloud scenarios.
<li>Discovering memory leaks.
<li>Looking for zombie processes relating to specific software.
<li>Logging up-time.
<li>System class-dependent discovery and extraction of any kind of text
for insertion into a CMDB.
</ul>

<!-- ***************************************************** -->
<!-- * CHAPTER -->
<!-- ***************************************************** -->
<div class="node">
<a name="Database-Promises"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#File-Access-Control-Lists">File Access Control Lists</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Monitoring-extensions">Monitoring extensions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">6 Database Promises</h2>

<p>CFEngine Nova can interact with commonly used database servers to keep
promises about the structure and content of data within them.

   <p>CFEngine is, of course, not the tool of choice for performing complex
database transactions, but it is an appropriate choice of tool for
managing policy about the existence and structure of databases and
correcting discrepancies.

<ul class="menu">
<li><a accesskey="1" href="#How-to-manage-databases">How to manage databases</a>
<li><a accesskey="2" href="#Database-access-rights">Database access rights</a>
<li><a accesskey="3" href="#Creating-a-point-of-contact-on-a-server">Creating a point of contact on a server</a>
<li><a accesskey="4" href="#Creating-SQL-databases">Creating SQL databases</a>
<li><a accesskey="5" href="#Database-promises">Database promises</a>
<li><a accesskey="6" href="#MS-Registry-functions">MS Registry functions</a>
<li><a accesskey="7" href="#LDAP-integration">LDAP integration</a>
</ul>

<div class="node">
<a name="How-to-manage-databases"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Database-access-rights">Database access rights</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Database-Promises">Database Promises</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Database-Promises">Database Promises</a>

</div>

<h3 class="section">6.1 How to manage databases</h3>

<p>There are two main cases of database management to address: small
embedded databases and large centralized databases.

   <p>CFEngine is a tool whose strength lies distributed management of
computers.  Databases are often centralized entities that have
single point of management, so a large monolithic database
is more easily managed with other tools. However, CFEngine can still
monitor changes and discrepancies, and it can manage smaller embedded
databases that are distributed in nature, whether they are SQL,
registry or future types.

   <p>So creating 100 new databases for test purposes is a task for
CFEngine, but adding a new item to an important production database is
not a task that we recommend using CFEngine for.

   <p>There are three kinds of database supported by Nova:

     <dl>
<dt><em>LDAP - The Lightweight Directory Access Protocol</em><dd>A hierarchical network database primarily for reading simple schema.

     <br><dt><em>SQL - Structured Query Language</em><dd>A number of relational databases (currently supported: MySQL, Postgres)
for reading and writing complex data.

     <br><dt><em>Registry - Microsoft Registry</em><dd>An embedded database for interfacing with system values in Microsoft Windows.

   </dl>
   In addition, CFEngine uses a  variety of embedded databases
for its own internals.

<div class="node">
<a name="Database-access-rights"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Creating-a-point-of-contact-on-a-server">Creating a point of contact on a server</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#How-to-manage-databases">How to manage databases</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Database-Promises">Database Promises</a>

</div>

<h3 class="section">6.2 Database access rights</h3>

<p>Cfengine's ability to make promises about databases depends on the
good grace of the database server. Embedded databases are directly
part of the system and promises can be made directly. However,
databases running through a server process (either on the same host or
on a different host) are independent agents and CFEngine cannot make
promises on their behalf, unless they promise (grant) permission for
CFEngine to make the changes. Thus the pre-requisite for making
SQL database promises is to grant a point of access on the server.

<div class="node">
<a name="Creating-a-point-of-contact-on-a-server"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Creating-SQL-databases">Creating SQL databases</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Database-access-rights">Database access rights</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Database-Promises">Database Promises</a>

</div>

<h3 class="section">6.3 Creating a point of contact on a server</h3>

<p>The default behavior is for databases to deny connection access
to external parties. However, it is possible to create a connection database
that can be used as an anchor point. Once CFEngine is connected to any database,
it can create new ones.

<div class="node">
<a name="Creating-SQL-databases"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Database-promises">Database promises</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Creating-a-point-of-contact-on-a-server">Creating a point of contact on a server</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Database-Promises">Database Promises</a>

</div>

<h3 class="section">6.4 Creating SQL databases</h3>

<p>Although the Structured Query Language (SQL) is a standard, database servers
diverge wildly in their approaches to interaction. CFEngine currently supports
two open source database implementations: MySQL and PostgreSQL and these two
could not be more different.

   <p>Although it would be desirable to perform operations like create and
destroy databases from within CFEngine, these operations can be
difficult to set up due to security design of the database
servers. This is where CFEngine's idea of <i>voluntary cooperation</i>
helps us to understand why. The database service (even running on
localhost) is an independent entity that we must interact with through
its service portal. It promises nothing a priori, so we must arrange
for the necessary promises to be kept so that the database will
respond to CFEngine's manipulations. In other words, we have to grant
access.

<ul class="menu">
<li><a accesskey="1" href="#Creating-a-database-manually">Creating a database manually</a>
<li><a accesskey="2" href="#Creating-a-database-directly">Creating a database directly</a>
</ul>

<div class="node">
<a name="Creating-a-database-manually"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Creating-a-database-directly">Creating a database directly</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Creating-SQL-databases">Creating SQL databases</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Creating-SQL-databases">Creating SQL databases</a>

</div>

<h4 class="subsection">6.4.1 Creating a database manually</h4>

<pre class="verbatim">
body common control
{
bundlesequence => { "databases" };
}

bundle agent databases

{
# Create database first - for postgres we could use a command

commands:

  "/usr/bin/createdb cf_topic_maps",

        contain => as_user("postgres");

# Create a table in the new database

databases:

  "cf_topic_maps/topics"

    database_operation => "create",
    database_type => "sql",
    database_columns => {
                        "topic_name,varchar,256",
                        "topic_comment,varchar,1024",
                        "topic_id,varchar,256",
                        "topic_type,varchar,256",
                        "topic_extra,varchar,26"
                        },

    database_server => myserver;

}

################################################

body database_server myserver
{
db_server_owner => "postgres";
db_server_password => "";
db_server_host => "localhost";
db_server_type => "postgres";
}

#

body contain as_user(x)
{
exec_owner => "$(x)";
}

</pre>

<div class="node">
<a name="Creating-a-database-directly"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Creating-a-database-manually">Creating a database manually</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Creating-SQL-databases">Creating SQL databases</a>

</div>

<h4 class="subsection">6.4.2 Creating a database directly</h4>

<p>Both MySQL and PostgreSQL provide default databases of the same name
to connect to as an anchor point, allowing further databases to be
created thereafter. In fact any database will do, you must just make
sure that CFEngine has access rights to connect to the database.

<pre class="verbatim">
body common control
{
bundlesequence => { "databases" };
}

bundle agent databases

{
databases:

  # Create table topics in database cf_topic_maps

  "cf_topic_maps"

    database_operation => "create",
    database_type => "sql",
    database_server => myserver("mysql");

}

################################################

body database_server myserver(x)
{
db_server_owner => "$(x)";
db_server_password => "";
db_server_host => "localhost";
db_server_type => "$(mysql)";
db_server_connection_db => "$(x)";
}

body contain as_user(x)
{
exec_owner => "$(x)";
}
</pre>

<ul class="menu">
<li><a accesskey="1" href="#Database-promises">Database promises</a>
</ul>

<div class="node">
<a name="Database-promises"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#MS-Registry-functions">MS Registry functions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Creating-SQL-databases">Creating SQL databases</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Database-Promises">Database Promises</a>

</div>

<h3 class="section">6.5 Database table promises</h3>

<p>To refer to tables in an SQL database, you treat the tables as if they
were sub-directories of the database. In this example, we create one of
the topic map tables for the knowledge base.

   <p>Table existence is determined by the <code>database_operation</code> attribute.
We specify columns in a table as doublets or triplets with SQL type-names.
In this example CFEngine will assume the promise below to be a complete
specification of the table. Thus

     <ul>
<li>It will create non-existing columns (in no guaranteed order).
<li>It will report about columns that exist but are not promised,
i.e. indicating that the table has been edited inappropriately.
<li>It will verify that the existing column names match their specification.
</ul>

<pre class="verbatim">
bundle agent databases

{
databases:

  "cf_topic_maps/topics"

    database_operation => "create",
    database_type => "sql",
    database_columns => {
                        "topic_name,varchar,256",
                        "topic_comment,varchar,1024",
                        "topic_id,varchar,256",
                        "topic_type,varchar,256",
                        "topic_extra,varchar,26"
                        },

    database_server => myserver;

}

################################################

body database_server myserver
{
any::
 db_server_owner => "postgres";
 db_server_password => "";
 db_server_host => "localhost";
 db_server_type => "postgres";
 db_server_connection_db => "postgres";
none::
 db_server_owner => "root";
 db_server_password => "";
 db_server_host => "localhost";
 db_server_type => "mysql";
 db_server_connection_db => "mysql";
}

body contain as_user(x)
{
exec_owner => "$(x)";
}
</pre>

<div class="node">
<a name="MS-Registry-functions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#LDAP-integration">LDAP integration</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Database-promises">Database promises</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Database-Promises">Database Promises</a>

</div>

<h3 class="section">6.6 MS Registry functions</h3>

<p>Another important database for Windows systems is the MS registry.
The registry looks like a file-system, with files inside directories.
in MS nomenclature, the registry consists of <i>(value,data)</i> pairs inside
"keys" which are like directories. Keys may contain sub-keys in a hierarchical
manner.

   <p>Managing data in the registry is a key part of Windows administration.

     <ul>
<li>Important system settings are located in and hence controlled by the registry.
<li>Security and compliance guidelines often specify values for the registry.
<li>If registry data become corrupted, software can cease to function.
Compliance with government standards such as the U.S. FDCC regulations involves
registry compliance checking.
<li>Automated repair (self-healing) of Windows machines can involve registry repair.
</ul>

   <p>CFEngine Nova has functions for
     <ul>
<li>Creating and deleting keys, and <i>(value,data)</i> pairs.
<li>Scanning values and performing change detection.
<li>Restore or repair damaged registry data its cache in real-time.
</ul>

<ul class="menu">
<li><a accesskey="1" href="#Creating-a-registry-key">Creating a registry key</a>
<li><a accesskey="2" href="#Creating-a-value_002ddata-pair">Creating a value-data pair</a>
<li><a accesskey="3" href="#Deleting-registry-keys">Deleting registry keys</a>
<li><a accesskey="4" href="#Deleting-registry-values">Deleting registry values</a>
<li><a accesskey="5" href="#Scanning-and-restoring-the-registry">Scanning and restoring the registry</a>
</ul>

<div class="node">
<a name="Creating-a-registry-key"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Creating-a-value_002ddata-pair">Creating a value-data pair</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#MS-Registry-functions">MS Registry functions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#MS-Registry-functions">MS Registry functions</a>

</div>

<h4 class="subsection">6.6.1 Creating a registry key</h4>

<pre class="verbatim">
body common control
{
bundlesequence => { "registry" };
}

bundle agent registry

{
databases:

 windows::

  "HKEY_LOCAL_MACHINE\SOFTWARE\CFEngine AS"

    database_operation => "create",
    database_type => "ms_registry";

}

</pre>

<p class="noindent">In this example we create a sub-key called `CFEngine AS' inside the software
key. Directory-like notation is used, as in the Windows registry editor.
To create a sub-key of this new key, we simply add another link:

<pre class="verbatim">
bundle agent registry
{
databases:

 windows::

  "HKEY_LOCAL_MACHINE\SOFTWARE\CFEngine AS\Cfengine"

    database_operation => "create",
    database_type => "ms_registry";

}
</pre>

<div class="node">
<a name="Creating-a-value-data-pair"></a>
<a name="Creating-a-value_002ddata-pair"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Deleting-registry-keys">Deleting registry keys</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Creating-a-registry-key">Creating a registry key</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#MS-Registry-functions">MS Registry functions</a>

</div>

<h4 class="subsection">6.6.2 Creating a value-data pair</h4>

<pre class="verbatim">
body common control
{
bundlesequence => { "registry" };
}

bundle agent registry

{
databases:

 windows::

  "HKEY_LOCAL_MACHINE\SOFTWARE\CFEngine AS\Cfengine"

    database_operation => "create",
    database_rows => { "value1,REG_SZ,new value 1", "value2,REG_SZ,new val 2"} ,
    database_type => "ms_registry";

}

</pre>

<p>Value-data pairs are in-fact value-type-data triplets, though the most common
registry type is REG_SZ. Users are referred to the Microsoft Developer Network documentation
on the registry for details (search for `msdn registry').

<div class="node">
<a name="Deleting-registry-keys"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Deleting-registry-values">Deleting registry values</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Creating-a-value_002ddata-pair">Creating a value-data pair</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#MS-Registry-functions">MS Registry functions</a>

</div>

<h4 class="subsection">6.6.3 Deleting registry keys</h4>

<p>The <code>drop</code> or <code>delete</code> option is used to delete keys from a database.
CFEngine does not (presently) perform recursive deletions of keys. It is debatable whether
this feature would be potentially too destructive an operation to make simple.

   <p>In order to be allowed to delete a key or database, you must define a comment. This
acts as a confirmation of intent to avoid accidents.

<pre class="verbatim">
  "HKEY_LOCAL_MACHINE\SOFTWARE\CFEngine AS\Cfengine"

    database_operation => "delete",
    database_type => "ms_registry";

</pre>

<div class="node">
<a name="Deleting-registry-values"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Scanning-and-restoring-the-registry">Scanning and restoring the registry</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Deleting-registry-keys">Deleting registry keys</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#MS-Registry-functions">MS Registry functions</a>

</div>

<h4 class="subsection">6.6.4 Deleting registry values</h4>

<p>If a registry deletion contains <code>columns</code>, these can be selected for deletion.
It is not possible to delete rows in the registry (which corresponds to
the just the data in a value-data pair.

<pre class="verbatim">
  "HKEY_LOCAL_MACHINE\SOFTWARE\CFEngine AS\Cfengine"

    database_operation => "delete",
    database_columns => { "value1", "value2" } ,
    database_type => "ms_registry";

</pre>

   <p>Note that, unlike the case of adding values, there should be no comma separated
doublets in this list of values, as one cannot delete by data, only by value.

<div class="node">
<a name="Scanning-and-restoring-the-registry"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Deleting-registry-values">Deleting registry values</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#MS-Registry-functions">MS Registry functions</a>

</div>

<h4 class="subsection">6.6.5 Scanning and restoring the registry</h4>

<p>CFEngine has the ability to scan a portion of the registry and cache its
values for change detection and even later restoration. Since this is
a resource consuming operation it should be performed only rarely, i.e.
one should limit the policy to scan to special occasions.

   <p>The key question to ask is: when do I expect the current state of the registry
to be a proper and true reflection of the `correct state' of the system.
This is not a trivial question to answer and it should be given careful thought
before any talk of restoring the state of the registry based on such a scan.

   <p>Some values in the registry change often and one would like to ignore them
entirely. The <code>registry_exclude</code> list allows you to make a list
of regular expressions to match keys and value-names which are neither scanned
nor restored.

<pre class="verbatim">
bundle agent registry

{
databases:

 windows:: # add a time qualifier to this class

 "HKEY_LOCAL_MACHINE\SOFTWARE\CFEngine AS\Cfengine"

    database_operation => "cache",   # cache,restore

    registry_exclude => {
                        ".*Windows.*CurrentVersion.*",
                        ".*Touchpad.*",
                        ".*Capabilities.FileAssociations.*",
                        ".*Rfc1766.*" ,
                        ".*Synaptics.SynTP.*",
                        ".*SupportedDevices.*8086",
                        ".*Microsoft.*ErrorThresholds"
                        },

    database_type     => "ms_registry";

</pre>

   <p>Once one believes and trusts in a scan of the registry as a matter of policy,
the values can be compared to this golden standard and restored if in error
with the following kind of promise:

<pre class="verbatim">
"HKEY_LOCAL_MACHINE\SOFTWARE\CFEngine AS"

   database_operation => "restore",
   database_type      => "ms_registry";

</pre>

   <p>Deletion or alteration of a key or value will now be swiftly repaired
without the need to reboot the system.

<!-- ============================================================== -->
<div class="node">
<a name="LDAP-integration"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#MS-Registry-functions">MS Registry functions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Database-Promises">Database Promises</a>

</div>

<h3 class="section">6.7 LDAP integration</h3>

<p>The Lightweight Directory Access Protocol (LDAP) is the basis of
enterprise data centralization in many organizations using a variety
of products from multiple vendors, including the MS Active Directory.
CFEngine Nova supports special inbuilt functions for extracting data
from LDAP repositories.
The functions follow the general pattern of Open LDAP search functions.

<ul class="menu">
<li><a accesskey="1" href="#Function-ldapvalue">Function ldapvalue</a>
<li><a accesskey="2" href="#Function-ldaplist">Function ldaplist</a>
<li><a accesskey="3" href="#Function-ldaparray">Function ldaparray</a>
<li><a accesskey="4" href="#Function-regldap">Function regldap</a>
<li><a accesskey="5" href="#LDAP-function-examples">LDAP function examples </a>
<li><a accesskey="6" href="#Best-practice-for-LDAP-integration">Best practice for LDAP integration</a>
</ul>

<div class="node">
<a name="Function-ldapvalue"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Function-ldaplist">Function ldaplist</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#LDAP-integration">LDAP integration</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#LDAP-integration">LDAP integration</a>

</div>

<h4 class="subsection">6.7.1 Function <code>ldapvalue</code></h4>

<p><table class="cartouche" summary="cartouche" border="1"><tr><td>
<pre class="example">
     (string) ldapvalue(<var>uri</var>,<var>dn</var>,<var>filter</var>,<var>name</var>,<var>scope</var>,<var>security</var>)

</pre>
   </td></tr></table>

   <p>This function retrieves a single field from a single LDAP record identified by the search
parameters. The first matching value it taken.

<p class="noindent"><b>ARGUMENTS</b>:

     <dl>
<dt>&lsquo;<samp><span class="samp">uri</span></samp>&rsquo;<dd>String value of the ldap server. e.g. <code>"ldap://ldap.cfengine.com.no"</code>
<br><dt>&lsquo;<samp><span class="samp">dn</span></samp>&rsquo;<dd>Distinguished name, an ldap formatted name built from components, e.g. "dc=cfengine,dc=com".
<br><dt>&lsquo;<samp><span class="samp">filter</span></samp>&rsquo;<dd>String filter criterion, in ldap search, e.g. "(sn=User)".
<br><dt>&lsquo;<samp><span class="samp">name</span></samp>&rsquo;<dd>String value, the name of a single record to be retrieved, e.g. <code>uid</code>.
<br><dt>&lsquo;<samp><span class="samp">scope</span></samp>&rsquo;<dd>Menu option, the type of ldap search, from the specified root. May take values:
     <pre class="smallexample">              subtree
              onelevel
              base
</pre>
     <br><dt>&lsquo;<samp><span class="samp">security</span></samp>&rsquo;<dd>Menu option indicating the encryption and authentication settings
for communication with the LDAP server. These features might be subject
to machine and server capabilities.
     <pre class="smallexample">               none
               ssl
               sasl
</pre>
     </dl>

<div class="node">
<a name="Function-ldaplist"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Function-ldaparray">Function ldaparray</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Function-ldapvalue">Function ldapvalue</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#LDAP-integration">LDAP integration</a>

</div>

<h4 class="subsection">6.7.2 Function <code>ldaplist</code></h4>

<p><table class="cartouche" summary="cartouche" border="1"><tr><td>
<pre class="example">
     (slist) ldaplist(<var>uri</var>,<var>dn</var>,<var>filter</var>,<var>name</var>,<var>scope</var>,<var>security</var>)

</pre>
   </td></tr></table>

   <p>This function retrieves a single field from all matching LDAP records identified by the search
parameters.

<p class="noindent"><b>ARGUMENTS</b>:

     <dl>
<dt>&lsquo;<samp><span class="samp">uri</span></samp>&rsquo;<dd>String value of the ldap server. e.g. <code>"ldap://ldap.cfengine.com.no"</code>
<br><dt>&lsquo;<samp><span class="samp">dn</span></samp>&rsquo;<dd>Distinguished name, an ldap formatted name built from components, e.g. "dc=cfengine,dc=com".
<br><dt>&lsquo;<samp><span class="samp">filter</span></samp>&rsquo;<dd>String filter criterion, in ldap search, e.g. "(sn=User)".
<br><dt>&lsquo;<samp><span class="samp">name</span></samp>&rsquo;<dd>String value, the name of a single record to be retrieved, e.g. <code>uid</code>.
<br><dt>&lsquo;<samp><span class="samp">scope</span></samp>&rsquo;<dd>Menu option, the type of ldap search, from the specified root. May take values:
     <pre class="smallexample">              subtree
              onelevel
              base
</pre>
     <br><dt>&lsquo;<samp><span class="samp">security</span></samp>&rsquo;<dd>Menu option indicating the encryption and authentication settings
for communication with the LDAP server. These features might be subject
to machine and server capabilities.
     <pre class="smallexample">               none
               ssl
               sasl
</pre>
     </dl>

<div class="node">
<a name="Function-ldaparray"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Function-regldap">Function regldap</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Function-ldaplist">Function ldaplist</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#LDAP-integration">LDAP integration</a>

</div>

<h4 class="subsection">6.7.3 Function <code>ldaparray</code></h4>

<p><table class="cartouche" summary="cartouche" border="1"><tr><td>
<pre class="example">
     (class) ldaparray (<var>array</var>,<var>uri</var>,<var>dn</var>,<var>filter</var>,<var>scope</var>,<var>security</var>)

</pre>
   </td></tr></table>

   <p>This function retrieves an entire record with all elements and
populates an associative array with the entries. It returns a class
which is true if there was a match for the search and false if nothing
was retrieved.

<p class="noindent"><b>ARGUMENTS</b>:

     <dl>
<dt>&lsquo;<samp><span class="samp">array</span></samp>&rsquo;<dd>String name of the array to populate with the result of the search
<br><dt>&lsquo;<samp><span class="samp">uri</span></samp>&rsquo;<dd>String value of the ldap server. e.g. <code>"ldap://ldap.cfengine.com.no"</code>
<br><dt>&lsquo;<samp><span class="samp">dn</span></samp>&rsquo;<dd>Distinguished name, an ldap formatted name built from components, e.g. "dc=cfengine,dc=com".
<br><dt>&lsquo;<samp><span class="samp">filter</span></samp>&rsquo;<dd>String filter criterion, in ldap search, e.g. "(sn=User)".
<br><dt>&lsquo;<samp><span class="samp">scope</span></samp>&rsquo;<dd>Menu option, the type of ldap search, from
     <pre class="smallexample">              subtree
              onelevel
              base
</pre>
     <br><dt>&lsquo;<samp><span class="samp">security</span></samp>&rsquo;<dd>Menu option indicating the encryption and authentication settings
for communication with the LDAP server. These features might be subject
to machine and server capabilites.
     <pre class="smallexample">               none
               ssl
               sasl
</pre>
     </dl>

<div class="node">
<a name="Function-regldap"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#LDAP-function-examples">LDAP function examples</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Function-ldaparray">Function ldaparray</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#LDAP-integration">LDAP integration</a>

</div>

<h4 class="subsection">6.7.4 Function <code>regldap</code></h4>

<p><table class="cartouche" summary="cartouche" border="1"><tr><td>
<pre class="example">
     (class) regldap(<var>uri</var>,<var>dn</var>,<var>filter</var>,<var>name</var>,<var>scope</var>,<var>regex</var>,<var>security</var>)

</pre>
   </td></tr></table>

   <p>This function retrieves a single field from all matching LDAP records identified by the search
parameters and compares it to a regular expression. If there is a match, true is returned
else false.

<p class="noindent"><b>ARGUMENTS</b>:

     <dl>
<dt>&lsquo;<samp><span class="samp">uri</span></samp>&rsquo;<dd>String value of the ldap server. e.g. <code>"ldap://ldap.cfengine.com.no"</code>
<br><dt>&lsquo;<samp><span class="samp">dn</span></samp>&rsquo;<dd>Distinguished name, an ldap formatted name built from components, e.g. "dc=cfengine,dc=com".
<br><dt>&lsquo;<samp><span class="samp">filter</span></samp>&rsquo;<dd>String filter criterion, in ldap search, e.g. "(sn=User)".
<br><dt>&lsquo;<samp><span class="samp">name</span></samp>&rsquo;<dd>String value, the name of a single record to be retrieved, e.g. <code>uid</code>.
<br><dt>&lsquo;<samp><span class="samp">scope</span></samp>&rsquo;<dd>Menu option, the type of ldap search, from the specified root. May take values:
     <pre class="smallexample">              subtree
              onelevel
              base
</pre>
     <br><dt>&lsquo;<samp><span class="samp">regex</span></samp>&rsquo;<dd>A regular expression string to match to the results of an LDAP search. If any
item matches, the result will be true.

     <br><dt>&lsquo;<samp><span class="samp">security</span></samp>&rsquo;<dd>Menu option indicating the encryption and authentication settings
for communication with the LDAP server. These features might be subject
to machine and server capabilities.
     <pre class="smallexample">               none
               ssl
               sasl
</pre>
     </dl>

<div class="node">
<a name="LDAP-function-examples"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Best-practice-for-LDAP-integration">Best practice for LDAP integration</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Function-regldap">Function regldap</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#LDAP-integration">LDAP integration</a>

</div>

<h4 class="subsection">6.7.5 LDAP function examples</h4>

<pre class="verbatim">
# LDAP example function usage

body common control
{
bundlesequence => { "ldap" };
}

bundle agent ldapbundle
{
vars:

   # Get the first matching value for "uid"

  "value" string => ldapvalue(
                             "ldap://ldap.cfengine.com.no",
                             "dc=cfengine,dc=com",
                             "(sn=User)",
                             "uid",
                             "subtree",
                             "none"
                             );

   # Get a all matching values for "uid"

  "list" slist =>  ldaplist(
                           "ldap://ldap.cfengine.com.no",
                           "dc=cfengine,dc=com",
                           "(sn=User)",
                           "uid",
                           "subtree",
                           "none"
                           );

classes:

   # Get first matching value with all fields

   "gotdata" expression => ldaparray(
                                    "myarray",
                                    "ldap://ldap.cfengine.com.no",
                                    "dc=cfengine,dc=com",
                                    "(sn=User)",
                                    "subtree",
                                    "none"
                                    );

   # Look for a regex match within the ldap match

   "found" expression => regldap(
                                "ldap://ldap.cfengine.com.no",
                                "dc=cfengine,dc=com",
                                "(sn=User)",
                                "uid",
                                "subtree",
                                "jon.*",
                                "none");


reports:

 linux::

   "LDAP VALUE $(value) found";
   "LDAP LIST VALUE $(list)";

 gotdata::

   "found data $(ldapbundle.myarray[uid])";

  found::

    "Matched regex";

}

</pre>

<div class="node">
<a name="Best-practice-for-LDAP-integration"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#LDAP-function-examples">LDAP function examples</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#LDAP-integration">LDAP integration</a>

</div>

<h4 class="subsection">6.7.6 Best practice for LDAP integration</h4>

<p>Relying on LDAP or other network data without validation is a
potentially dangerous policy. One could destroy a system by assuming
that the service will respond with a sensible result. CFEngine does
not recommend reliance on any network services in a configuration policy.

   <p>The failure to find an item in LDAP does not imply its non-existence.
Policies should work opportunistically. If something is found, it may be
used. If something is not found, it is difficult to conclude the reason
for this.

   <p>If users are removed from a system, a best practice would be to add
their names to a list of users who should not exist, rather than
assuming that the failure of a search for the user implies his/her
absence from the system.

<!-- ***************************************************** -->
<!-- * CHAPTER -->
<!-- ***************************************************** -->
<div class="node">
<a name="File-Access-Control-Lists"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Server-extensions">Server extensions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Database-Promises">Database Promises</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">7 File Access Control Lists</h2>

<ul class="menu">
<li><a accesskey="1" href="#Introduction">Introduction</a>
<li><a accesskey="2" href="#File-ACL-example">File ACL example</a>
</ul>

<div class="node">
<a name="Introduction"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#File-ACL-example">File ACL example</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#File-Access-Control-Lists">File Access Control Lists</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-Access-Control-Lists">File Access Control Lists</a>

</div>

<h3 class="section">7.1 Introduction</h3>

<p>Access Control Lists (ACL) allow for a more fine-grained access control on
file system objects than standard Unix permissions. In spite of the success
of the POSIX model's simplicity the functionality is limited.

   <p>File permission security is a subtle topic. Users should take care
when experimenting with ACLs as the results can often be
counter-intuitive. In some cases the functioning of a system can be
compromised by changes of access rights.

   <p>Not all file systems support ACLs. In Unix systems there is a plethora
of different file system types, which have different models of ACLs.
Be aware that the mount-options for a file-system may affect the ACL
semantics.

   <p><table class="cartouche" summary="cartouche" border="1"><tr><td>
<i>Note that when adding a user to a group, this will not have any
effect until the next time the user logs in on many operating
systems.</i>
</td></tr></table>

   <p>As CFEngine works across multiple platforms and needs to support ACLs
with different APIs, a common ACL syntax has been abstracted to add a
layer of portability. This is a specific feature of CFEngine, not of
the host systems. A generic syntax ensures that the ACLs that are
commonly needed can be coded in a portable fashion. CFEngine Nova's
ACL model is translated into native permissions for implementation;
CFEngine does not interfere with native access mechanisms in any way.
The CFEngine ACL syntax is similar to the POSIX ACL syntax, which is
supported by BSD, Linux, HP-UX and Solaris.

   <p>CFEngine also allows you to specify platform-dependent ACLs. Of
course, these ACLs will only work on the given platform, and must
therefore be shielded with classes that select the appropriate model
within the promise body.

   <p>Currently, CFEngine Nova supports the following ACL APIs and operating
systems.

   <p><table summary=""><tr align="left"><th valign="top" width="30%">ACL type </th><th valign="top" width="30%">Operating system
<br></th></tr><tr align="left"><td valign="top" width="30%">NTFS </td><td valign="top" width="30%">Windows Server 2003, 2008
<br></td></tr><tr align="left"><td valign="top" width="30%">POSIX </td><td valign="top" width="30%">Linux
   <br></td></tr></table>

<div class="node">
<a name="File-ACL-example"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Introduction">Introduction</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-Access-Control-Lists">File Access Control Lists</a>

</div>

<h3 class="section">7.2 File ACL example</h3>

<p>The form of a CFEngine files promise that uses ACLs is as follows:
<pre class="verbatim">
#
# test_acl.cf
#

body common control
{
bundlesequence => { "acls" };
}

#########################################

bundle agent acls

{
files:

  "/office/shared"

    acl => template;
}

#########################################

body acl template

{
acl_method => "overwrite";
acl_directory_inherit => "parent";

 linux|solaris::

  acl_type => "posix";

  aces => {
          "user:*:rw",
          "user:root:rw",
          "group:*:r",
          "mask:rwx",
          "all:r"
          };

 windows::

  acl_type => "ntfs";

  aces => {
          "user:Administrator:rw(po)",
          "all:r"
          };
}

</pre>

<ul class="menu">
<li><a accesskey="1" href="#Concepts">Concepts</a>
<li><a accesskey="2" href="#Entity-types">Entity types</a>
<li><a accesskey="3" href="#Owners">Owners</a>
<li><a accesskey="4" href="#Changing-owner">Changing owner</a>
<li><a accesskey="5" href="#Permissions">Permissions</a>
<li><a accesskey="6" href="#Deny-permissions">Deny permissions</a>
<li><a accesskey="7" href="#Changing-permissions">Changing permissions</a>
<li><a accesskey="8" href="#Effective-permissions">Effective permissions</a>
</ul>

<div class="node">
<a name="Concepts"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Entity-types">Entity types</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#File-ACL-example">File ACL example</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-ACL-example">File ACL example</a>

</div>

<h4 class="subsection">7.2.1 Concepts</h4>

<p>As mentioned, there are many different ACL APIs. For example, the
POSIX draft standard, NTFS and NFSv4 have different and incompatible
ACL APIs. As CFEngine is cross-platform, these differences should, for
the most usual cases, be transparent to the user. However, some
distinctions are impossible to make transparent, and thus the user
needs to know about them.

   <p>We will explore the different concepts of ACL implementations that are
critical to understanding how permissions are defined and enforced in
the different file systems. As a running example, we will consider
NTFS ACLs and POSIX ACLs, because the distinction between these ACL
APIs is strong.

<div class="node">
<a name="Entity-types"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Owners">Owners</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Concepts">Concepts</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-ACL-example">File ACL example</a>

</div>

<h4 class="subsection">7.2.2 Entity types</h4>

<p>All ACL APIs support three basic entity types: user, group and
all. User and group are simply users and groups of the system, where a
group may contain multiple users. all is all users of the system, this
type is called "other" in POSIX and "Everyone" in NTFS.

<div class="node">
<a name="Owners"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Changing-owner">Changing owner</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Entity-types">Entity types</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-ACL-example">File ACL example</a>

</div>

<h4 class="subsection">7.2.3 Owners</h4>

<p>All file system objects have an owner, which by default is the entity
that created the object. The owner can always be a user. However, in
some file systems, groups can also be owners (e.g. the
"Administrators" group in NTFS). In some ACL APIs (e.g POSIX),
permissions can be set explicitly for the owner, i.e. the owner has an
independent ACL entry.

<div class="node">
<a name="Changing-owner"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Permissions">Permissions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Owners">Owners</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-ACL-example">File ACL example</a>

</div>

<h4 class="subsection">7.2.4 Changing owner</h4>

<p>It is generally not possible for user A to set user B as the
owner of a file system object, even if A owns the object. The
superuser ("root" in POSIX, "Administrator" in NTFS) can however
always set itself as the owner of an object. In POSIX, the superuser
may in fact set any user as the owner, but it NTFS it can only take
ownership.

<div class="node">
<a name="Permissions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Deny-permissions">Deny permissions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Changing-owner">Changing owner</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-ACL-example">File ACL example</a>

</div>

<h4 class="subsection">7.2.5 Permissions</h4>

<p>An entity can be given a set of permissions on a file system object
(e.g. read and write). The data structure holding the permissions for
one entity is called an "Access Control Entry" (ACE). As many users
and groups may have sets of permissions on a given object, multiple
Access Control Entries are combined to an Access Control List, which
is associated with the object.

   <p>The set of available permissions differ with ACL APIs. For example,
the "Take Ownership" permission in NTFS has no equivalent in
POSIX. However, for the most common situations, it is possible to get
equivalent security properties by mapping a set of permissions in one
API to another set in a second API.

   <p>There are however different rules for the access to the contents of a
directory with no access. In POSIX, no sub-objects of a directory with
no access can be accessed. However, in NTFS, sub-objects that the entity
has access rights to can be accessed, regardless of whether the entity
has access rights to the containing directory.

<div class="node">
<a name="Deny-permissions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Changing-permissions">Changing permissions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Permissions">Permissions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-ACL-example">File ACL example</a>

</div>

<h4 class="subsection">7.2.6 Deny permissions</h4>

<p>If no permissions are given to a particular entity, the entity will be
denied any access to the object. But in some file systems, like NTFS,
it is also possible to explicitly deny specific permissions to
entities. Thus, two types of permissions exist in these systems: allow
and deny.

   <p>It is generally good practice to design the ACLs to specify who is
allowed to do some operations, in contrary to who is not allowed to do
some operations, if possible. The reason for this is that describing
who is not allowed to do things tend to lead to more complex
rules and could therefore more easily lead to mis-configurations and
security holes. A good rule is to only define that users should not be
able to access a resource in the following two scenarios:

     <ul>
<li>Denying access to a subset of a group which is allowed access
<li>Denying a specific permission when a user or a group has full access
</ul>

   <p>If you think about it, this is the same principle that applies to
firewall configuration: it is easier to white-list, specify who should
have access, than to blacklist, specify who should not have access. In
addition, since CFEngine is designed to be cross-platform and some ACL
permissions are not available on all platforms, we should strive to
keep the ACLs as simple as possible. This helps us avoid surprises
when the ACLs are enforced by different platforms.

<div class="node">
<a name="Changing-permissions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Effective-permissions">Effective permissions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Deny-permissions">Deny permissions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-ACL-example">File ACL example</a>

</div>

<h4 class="subsection">7.2.7 Changing permissions</h4>

<p>Generally, only the owner may change permissions on a file system
object. However, superusers can also indirectly change permissions by
taking ownership first. In POSIX, superusers can change permissions
without taking ownership. In NTFS, either ownership or a special
permission ("Change Permissions") is needed to alter permissions.

<div class="node">
<a name="Effective-permissions"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Changing-permissions">Changing permissions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-ACL-example">File ACL example</a>

</div>

<h4 class="subsection">7.2.8 Effective permissions</h4>

<p>Unfortunately, even though two ACL APIs support all the permissions
listed in an ACL, the ACL may be interpreted differently. For a given
entity and object with ACL, there are two conceptually different ways
to interpret which permissions the entity obtains: ACE precedence and
cumulative ACL.

<!-- TODO: create figure of example? -->
   <p>For example, let &lsquo;<samp><span class="samp">alice</span></samp>&rsquo; be a user of the group
&lsquo;<samp><span class="samp">staff</span></samp>&rsquo;. There is an ACL on the file <samp><span class="file">schedule</span></samp>, giving
&lsquo;<samp><span class="samp">alice</span></samp>&rsquo; write permission, and the group &lsquo;<samp><span class="samp">staff</span></samp>&rsquo; read
permission. We will consider two ways to determine the effective
permissions of &lsquo;<samp><span class="samp">alice</span></samp>&rsquo; to <samp><span class="file">schedule</span></samp>.

   <p>Firstly, by taking the most precise match in the ACL, &lsquo;<samp><span class="samp">alice</span></samp>&rsquo; will be
granted write permission only. This is because an ACE describing &lsquo;<samp><span class="samp">alice</span></samp>&rsquo;
is more precise than an ACE describing a group &lsquo;<samp><span class="samp">alice</span></samp>&rsquo; is member
of. However, note that some ACEs may have the same precedence, like
two ACEs describing permissions for groups &lsquo;<samp><span class="samp">alice</span></samp>&rsquo; is member of. Then,
cumulative matching will be done on these ACEs (explained next). This
is how POSIX does it.

   <p>Secondly, we can take the cumulative permissions, which yields a user
permissions from all the ACE entries with his user name, groups he is
member of or the ACE entry specifying all users. In this case,
&lsquo;<samp><span class="samp">alice</span></samp>&rsquo; would get read and write on <samp><span class="file">schedule</span></samp>. NTFS
computes the effective permissions in this way.

<h4 class="subsection">7.2.9 Inheritance</h4>

<!-- TODO: Correct to inherit to someone ? -->
<p>Directories have ACLs associated with them, but they also have the
ability to inherit an ACL to sub-objects created within them. POSIX
calls the former ACL type "access ACL" and the latter "default ACL",
and we will use the same terminology.

<!-- TODO: Create tool to output effective permissions if ACL is applied ? -->
<h3 class="section">7.3 CFEngine 3 Generic ACL Syntax</h3>

<!-- FIXME: TODO: Say which OS's we are supporting, and which ACL types -->
<!-- we are supporting on them. -->
<p>The CFEngine 3 ACL syntax is divided into two main parts, a generic
and an API specific (native). The generic syntax can be used on any
file system for which CFEngine supports ACLs, while the native syntax
gives access to all the permissions available under a particular ACL
API.

   <p>An ACL can contain both generic and native syntax. However, if it
contains native syntax, it can only be enforced on systems supporting
the given ACL API. Thus, only the generic syntax is portable.

   <p>Note that even though the same generic ACL is set on two systems with
different ACL APIs, it may be enforced differently because the ACE
matching algorithms differ. For instance, as discussed earlier, NTFS
uses cumulative matching, while POSIX uses precedence
matching. CFEngine cannot alter the matching algorithms, and
simulating one or the other by changing ACL definitions is not
possible in all cases, and would probably lead to confusion. Thus, if
an ACL is to be used on two systems with different ACL APIs, the user
is encouraged to check that any differences in matching algorithms do
not lead to mis-configurations.

   <p>The CFEngine generic ACL syntax explained next, and native syntax is
described in following sections.

   <p><table class="cartouche" summary="cartouche" border="1"><tr><td>
<pre class="smallexample">     body acl acl_alias:
     {
     acl_type              =&gt; "<var>generic</var>"/"<var>ntfs</var>"/"<var>posix</var>";
     acl_method            =&gt; "<var>append</var>"/"<var>overwrite</var>";
     acl_directory_inherit =&gt; "<var>nochange</var>"/"<var>clear</var>"/"<var>parent</var>"/"<var>specify</var>";
     aces                  =&gt; {
                               "user:uid:mode[:perm_type]", ...,
                               "group:gid:mode[:perm_type]", ...,
                               "all:mode[:perm_type]"
                              };
     specify_inherit_aces  =&gt; {
                               "user:uid:mode[:perm_type]", ...,
                               "group:gid:mode[:perm_type]", ...,
                               "all:mode[:perm_type]"
                              };
     }
</pre>
   </td></tr></table>

     <ul>
<li><code>acl_alias</code> is the name of the specified ACL. It can be any
  identifier containing alphanumeric characters and underscores. We
will use this name when referring to the ACL.

     <li><code>acl_type</code> (optional) specifies the ACL API used to
describe the ACL. It defaults to <code>generic</code>, which allows only
CFEngine generic ACL syntax, but is valid on all supported
systems. <code>acl_type</code> only needs to be specified if native
permissions are being used in the ACL (see <code>nperms</code> below). If
<code>acl_type</code> is set to anything other than <code>generic</code>, the
system on which it is enforced must support this ACL API.

     <li><code>acl_method</code> (optional) can be set to either
  <code>append</code> or <code>overwrite</code>, and defaults to
  <code>append</code>. Setting it to <code>append</code> only adds or modifies the
  ACEs that are specified in <code>aces</code> (and
  <code>specify_inherit_aces</code>, see below). If set to
  <code>overwrite</code>, the specified ACL will completely replace the
  currently set ACL. All required fields must then be set in the
  specified ACL (e.g. <code>all</code> in POSIX), see the following sections
  describing the supported native APIs.

     <!-- TODO: Support acl_method:append for specify_inherit_aces independently? -->
     <li><code>acl_directory_inherit</code> (optional) specifies the ACL of
  newly created sub-objects. Only valid if the ACL is set on a
directory. On directories, <code>nochange</code> is the default and
indicates that the ACL that is currently given to newly created child
objects is left unchanged. If set to <code>clear</code>, no ACL will be
inherited, but the file system specifies a default ACL, which varies
with the file system (see the following sections on the supported ACL
APIs). <code>parent</code> indicates that the ACL set in <code>aces</code> (see
below) should be inherited to sub-objects.  If set to <code>specify</code>,
<code>specify_inherit_aces</code> specifies the inherited ACL, and
<code>acl_method</code> applies for <code>specify_inherit_aces</code> too.

     <li><code>aces</code> is a list of access control entries. It is parsed
  from left to right, and multiple entries with the same entity-type
  and id is allowed. This is necessary to specify permissions with
  different <code>perm_type</code> for the same entity (e.g. to allow read
  permission but explicitly deny write).

     <li><code>specify_inherit_aces</code> (optional) is a list of access control
  entries that are set on child objects. It is also parsed from left
  to right and allows multiple entries with same entity-type and
  id. Only valid if <code>acl_directory_inherit</code> is set to
  <code>specify</code>.

     <li><code>user</code> indicates that the line applies to a user specified
  by the user identifier <code>uid</code>. <code>mode</code> is the permission
  mode string.

     <li><code>group</code> indicates that the line applies to a group specified
  by the group identifier <code>gid</code>. <code>mode</code> is the permission
  mode string.

     <li><code>all</code> indicates that the line applies to every
  user. <code>mode</code> is the permission mode string.

     <li><code>uid</code> is a valid user name for the system and
  cannot be empty. However, if <code>acl_type</code> is <code>posix</code>,
<code>uid</code> can be set to * to indicate the user that owns the file
system object.

     <li><code>gid</code> is a valid group name for the system and
  cannot be empty. However, if <code>acl_type</code> is <code>posix</code>,
<code>gid</code> can be set to * to indicate the file group.

     <li><code>mode</code> is one or more strings
  <code>op</code>|<code>gperms</code>|(<code>nperms</code>); a concatenation of <code>op</code>,
  <code>gperms</code> and optionally (<code>nperms</code>), see below, separated
  with commas (e.g. +rx,-w(s)). <code>mode</code> is parsed from left to
  right.
<!-- TODO: include support for @code{fullaccess}, @code{noaccess}, -->
<!-- and @code{remove} -->

     <li><code>op</code> specifies the operation on any existing permissions,
  if the specified ACE already exists. <code>op</code> can be =, empty, + or
  -. = or empty sets the permissions to the ACE as stated, + adds and
  - removes the permissions from any existing ACE.

     <li><code>nperms</code> (optional) specifies ACL API specific
  (native) permissions. Only valid if <code>acl_type</code> is not
  <code>generic</code>. Valid values for <code>nperms</code> varies with different
  ACL types, and are specified in subsequent sections.

     <li><code>perm_type</code> (optional) can be set to either <code>allow</code> or
  <code>deny</code>, and defaults to <code>allow</code>. <code>deny</code> is only valid
  if <code>acl_type</code> is set to an ACL type that support deny
  permissions.

     <li><code>gperms</code> (generic permissions) is a concatenation of zero
  or more of the characters shown in the table below. If left empty,
  none of the permissions are set.
</ul>

   <p><table summary=""><tr align="left"><th valign="top" width="5%">Flag </th><th valign="top" width="20%">Description </th><th valign="top" width="30%">Semantics on file </th><th valign="top" width="40%">Semantics on directory

<p><br></th></tr><tr align="left"><td valign="top" width="5%"><code>r</code> </td><td valign="top" width="20%">Read </td><td valign="top" width="30%">Read data, permissions, attributes </td><td valign="top" width="40%">Read
directory contents, permissions, attributes
<br></td></tr><tr align="left"><td valign="top" width="5%"><code>w</code> </td><td valign="top" width="20%">Write </td><td valign="top" width="30%">Write data </td><td valign="top" width="40%">Create, delete, rename sub-objects
<br></td></tr><tr align="left"><td valign="top" width="5%"><code>x</code> </td><td valign="top" width="20%">Execute </td><td valign="top" width="30%">Execute file </td><td valign="top" width="40%">Access sub-objects
   <br></td></tr></table>

   <p>Note that the <code>r</code> permission is not necessary to read an object's
permissions and attributes in all file systems (e.g. in POSIX, having
<code>x</code> on its containing directory is sufficient).

<h4 class="subsection">7.3.1 Generic syntax examples</h4>

<pre class="verbatim">body common control
{
bundlesequence => { "acls" };
}

bundle agent acls
{
files:
  "/office/schedule"
    acl => small;

  "/office/audit_dir"
    acl => dirinherit;
}

body acl small
{
aces => {"user:alice:w", "group:staff:r", "all:"};
}

body acl dirinherit
{
acl_directory_inherit => "parent";
aces => {"user:alice:+w,-x", "user:bob:+r,-w", "group:staff:=rx", "all:-w"};
}
</pre>
See the following sections on native ACL types for more examples.

<!-- TODO: inlcude support for the following as mode -->
<!-- Keywords: -->
<!-- remove              = setting mode = remove removes any existing -->
<!-- ACE with the given user or group. Only valid if -->
<!-- @code{method}:@code{overwrite}. -->
<!-- fullaccess  = setting mode = fullaccess grants every permission -->
<!-- supported by the file system to the given entity -->
<!-- (user, group, all). The owner of the object and -->
<!-- properties like suid, sgid and -->
<!-- sticky are left unchanged. -->
<!-- noaccess    = setting mode = noaccess denies every permission for -->
<!-- the entity (user, group, all). The entity is left -->
<!-- with no access rights to the object. Note that the -->
<!-- entity might nonetheless be able to change the -->
<!-- permissions (e.g. by being the owner of the object -->
<!-- or a superuser). -->
<!-- TODO: Define user, group, mask and other to u, g, m, o instead / also? -->
<!-- TODO: Examples: ACLs, console output, screen-shots -->
<!-- ================================================================ -->
<h3 class="section">7.4 POSIX ACL type</h3>

<h4 class="subsection">7.4.1 POSIX-specific ACL syntax</h4>

<p><b>Native permissions</b>
The valid values for <code>nperms</code> in POSIX are <code>r</code>,<code>w</code>, and
<code>x</code>. These are in fact the same as the generic permissions, so
specifying them as generic or native gives the same effect.

   <p><b>File owner and group</b>
A user-ACE with uid set to * indicates file object owner. A group-ACE
with gid set to * indicates file group.

   <p><b>mask</b> mask can be specified as a normal ACE, as
<code>mask:mode</code>. mask specifies the maximum permissions that are
granted to named users (not owning user), file group and named
groups. mask is optional, if it is left unspecified it will will be
computed as the union of the permissions granted to named users, file
group and named groups (see acl_calc_mask(3)).

   <p><b>Required ACEs</b> POSIX requires existence of an ACE for the file
owner, (<code>user:*:mode</code>), the file group (<code>group:*:mode</code>),
other (<code>all:mode</code>) and mask (<code>mask:mode</code>). As mentioned,
CFEngine automatically creates a mask-ACE, if missing. However, if
<code>method</code> is set to <code>overwrite</code>, the user must ensure that
the rest of the required entries are specified.

<h4 class="subsection">7.4.2 Generic syntax mapping</h4>

<p><b>Entity types</b>
All entity types in the generic syntax are mapped to the corresponding
entity types with the same name in POSIX, except <code>all</code> which
corresponds to <code>other</code> in POSIX.

   <p><b>Generic permissions</b>

   <p>As shown in the table below, <code>gperms</code> is mapped straightforward
from generic to POSIX permission flags.

   <p><table summary=""><tr align="left"><th valign="top" width="30%">Generic flag  </th><th valign="top" width="30%">POSIX flag
<br></th></tr><tr align="left"><td valign="top" width="30%"><code>r</code> </td><td valign="top" width="30%"><code>r</code>
<br></td></tr><tr align="left"><td valign="top" width="30%"><code>w</code> </td><td valign="top" width="30%"><code>w</code>
<br></td></tr><tr align="left"><td valign="top" width="30%"><code>x</code> </td><td valign="top" width="30%"><code>x</code>
   <br></td></tr></table>

   <p><b>Inheritance</b> POSIX supports <code>acl_directory_inherit</code> set to
<code>specify</code>. The <code>specify_inherit_aces</code> list is then set as the
default ACL in POSIX (see acl(5)).

   <p>If <code>acl_directory_inherit</code> is set to <code>parent</code>, CFEngine
copies the access ACL to the default ACL. Thus, newly created objects
get the same access ACL as the containing directory.

   <p><code>acl_directory_inherit</code> set to <code>clear</code> corresponds to no
POSIX default ACL. This results in that newly created objects get ACEs
for owning user, group and other. The permissions are set in
accordance with the mode parameter to the creating function and the
umask (usually results in 644 for files and 755 for directories).

   <p><b>Further reading</b> The manual page <code>acl(5)</code> contains much
information on POSIX ACLs, including the access check algorithm. In
particular, this shows that POSIX uses ACE precedence matching, and
exactly how it is done. Operating systems usually bundle tools for
manipulating ACLs, for example <code>getfacl(1)</code> and
<code>setfacl(1)</code>.

<h4 class="subsection">7.4.3 POSIX ACL examples</h4>

<pre class="verbatim">body common control
{
bundlesequence => { "acls" };
}

bundle agent acls
{
files:

  "/office/timetable"
    acl => nativeperms;

  "/office/user_dir"
    acl => specifyinherit;
}

body acl nativeperms
{
acl_type => "posix";
aces => {"user:alice:r(w)", "user:root:=(rwx)",
         "group:staff:-r(x)", "all:-(w)", "mask:(rx)"};
}

body acl specifyinherit
{
acl_type => "posix";
acl_method => "overwrite";
acl_directory_inherit => "specify";
aces => {"user:*:rwx", "group:*:rx", "user:alice:rwx",
         "user:root:rx", "group:staff:r", "all:rx"};
specify_inherit_aces => {"user:*:", "group:*:", "all:"};
}
</pre>

<h3 class="section">7.5 NT ACL type</h3>

<h4 class="subsection">7.5.1 NT-specific ACL syntax</h4>

<p><b>Native permissions</b>
NTFS supports fourteen so-called special file permissions. However, we
do not consider the <code>Synchronize</code> permission because it is used
for a different purpose than the other permissions. In order to give
access to the thirteen relevant permissions, CFEngine defines a native
permission flag for each of them. This one-to-one mapping is as
follows.

   <p><table summary=""><tr align="left"><th valign="top" width="40%">NTFS Special Permission </th><th valign="top" width="20%">CFEngine nperm
<br></th></tr><tr align="left"><td valign="top" width="40%">Execute File / Traverse Folder </td><td valign="top" width="20%">x
<br></td></tr><tr align="left"><td valign="top" width="40%">Read Data / List Folder </td><td valign="top" width="20%">r
<br></td></tr><tr align="left"><td valign="top" width="40%">Read Attributes </td><td valign="top" width="20%">t
<br></td></tr><tr align="left"><td valign="top" width="40%">Read Extended Attributes </td><td valign="top" width="20%">T
<br></td></tr><tr align="left"><td valign="top" width="40%">Write Data / Create Files </td><td valign="top" width="20%">w
<br></td></tr><tr align="left"><td valign="top" width="40%">Append Data / Create Folders </td><td valign="top" width="20%">a
<br></td></tr><tr align="left"><td valign="top" width="40%">Write Attributes </td><td valign="top" width="20%">b
<br></td></tr><tr align="left"><td valign="top" width="40%">Write Extended Attributes </td><td valign="top" width="20%">B
<br></td></tr><tr align="left"><td valign="top" width="40%">Delete Sub-folders and Files </td><td valign="top" width="20%">D
<br></td></tr><tr align="left"><td valign="top" width="40%">Delete </td><td valign="top" width="20%">d
<br></td></tr><tr align="left"><td valign="top" width="40%">Read Permissions </td><td valign="top" width="20%">p
<br></td></tr><tr align="left"><td valign="top" width="40%">Change Permissions </td><td valign="top" width="20%">c
<br></td></tr><tr align="left"><td valign="top" width="40%">Take Ownership </td><td valign="top" width="20%">o
   <br></td></tr></table>

   <p>The semantics of these special permissions can be found in the
references for further reading below.

   <p><b>Denying permissions</b>
NTFS supports setting <code>perm_type</code> to <code>deny</code> in addition to
<code>allow</code>, which is the default. This can for instance be used to
denying a user a particular permission that a group membership grants
him. It is important to note that the precedence of allow and deny
permissions is as follows:

     <ol type=1 start=1>
<li>Explicit Deny
<li>Explicit Allow
<li>Inherited Deny from parent
<li>Inherited Allow from parent
<li>Inherited Deny from grandparent
<li>Inherited Allow from grandparent
<li>...
        </ol>

   <p>Thus, the closer the permission is to the object in the directory
path, the greater precedence it is given.

   <p>An important point here is that even though a user is denied access in
a parent directory and this permission is inherited, but one of the
groups he is member of is explicitly allowed access to a file in that
directory, he is actually allowed to access the file.

   <p><b>Ownership</b>
In NTFS, the default owner is the user who is currently logged on. The
only exceptions occur when the user is a member of either the
&lsquo;<samp><span class="samp">Administrators</span></samp>&rsquo; group or the &lsquo;<samp><span class="samp">Domain Admins</span></samp>&rsquo; group.

   <p>Owners of NTFS objects can allow another user to take ownership by
giving that user Take Ownership permission. Owners can also give other
users the Change Permissions flag. In addition, members of the
&lsquo;<samp><span class="samp">Administrator</span></samp>&rsquo; group can always take ownership. It is never
possible to give ownership of an object to a user, but members of
the &lsquo;<samp><span class="samp">Administrator</span></samp>&rsquo; group can give ownership to that group.

<h4 class="subsection">7.5.2 Generic syntax mapping</h4>

<p><b>Entity types</b>
The three entity types of NTFS are called user, group and
Everyone. The user and group entity types in NTFS are mapped to the
user and group entity types in CFEngine. Everyone is mapped to all in
Cfengine.

   <p><b>Generic permissions</b>
For NTFS, CFEngine maps the <code>gperms</code> to <code>nperms</code> as
follows.

   <p><table summary=""><tr align="left"><th valign="top" width="30%">Generic flag  </th><th valign="top" width="30%">Native flags
<br></th></tr><tr align="left"><td valign="top" width="30%"><code>r</code> </td><td valign="top" width="30%"><code>rtTp</code>
<br></td></tr><tr align="left"><td valign="top" width="30%"><code>w</code> </td><td valign="top" width="30%"><code>wabB</code>
<br></td></tr><tr align="left"><td valign="top" width="30%"><code>x</code> </td><td valign="top" width="30%"><code>x</code>
   <br></td></tr></table>

   <p>The rationale for this mapping is discussed next.

   <p>NTFS groups the thirteen special permissions to create five sets of
permissions:
     <ul>
<li>Read
<li>Read &amp; Execute
<li>Write
<li>Modify
<li>Full Control
</ul>
   In addition, we have the List Folder Contents set, which is equivalent
to the Read &amp; Execute set but is only available to- and inherited by
directories. The Full Control set is unsurprisingly all the thirteen
special permissions. An overview of the NTFS mapping of special
permissions to sets is given in the references stated as further
reading below. The NTFS permission sets can be expressed in CFEngine
syntax as follows.

   <p><table summary=""><tr align="left"><th valign="top" width="30%">NTFS sets  </th><th valign="top" width="40%">CFEngine gperms|(nperms)
<br></th></tr><tr align="left"><td valign="top" width="30%"><code>Read</code> </td><td valign="top" width="40%"><code>r</code>
<br></td></tr><tr align="left"><td valign="top" width="30%"><code>Write</code> </td><td valign="top" width="40%"><code>w</code>
<br></td></tr><tr align="left"><td valign="top" width="30%"><code>Read &amp; Execute</code> </td><td valign="top" width="40%"><code>rx</code>
<br></td></tr><tr align="left"><td valign="top" width="30%"><code>Modify</code> </td><td valign="top" width="40%"><code>rwx(d)</code>
<br></td></tr><tr align="left"><td valign="top" width="30%"><code>Full Control</code> </td><td valign="top" width="40%"><code>rwx(dDco)</code>
   <br></td></tr></table>

   <p><b>Inheritance</b>
<code>acl_directory_inherit</code> set to <code>clear</code> disables
inheritance, such that child objects get a default ACL specified by
the operating system, namely Full control for the file object creator and
<code>SYSTEM</code> accounts.

   <p><b>POSIX compatibility</b>
Be aware that setting <code>gperms</code> to &lsquo;<samp><span class="samp">rwx</span></samp>&rsquo; on directories is
more restrictive in NTFS than in POSIX ACLs. This is because NTFS does
not allow deletion of objects within a directory without a Delete
Sub-folders and Files permission on the directory (or a Delete
permission on the object itself), while in POSIX, &lsquo;<samp><span class="samp">rwx</span></samp>&rsquo; on the
directory is sufficient to delete any file or directory within it
(except when the sticky-flag is set on the directory). Thus, on
directories, the NTFS-equivalent to POSIX <code>gperms</code> set to
&lsquo;<samp><span class="samp">rwx</span></samp>&rsquo; is &lsquo;<samp><span class="samp">rwx(D)</span></samp>&rsquo;. However, for files, &lsquo;<samp><span class="samp">rwx</span></samp>&rsquo; is
equivalent in POSIX and NTFS semantics.

   <p>In POSIX ACLs, there is no explicit delete permission, but the
execute, write and sticky permissions on the containing directory
determines if a user has privileges to delete. In POSIX, the owner and
root can change permissions, while usually only the root may change
the ownership, so there is no direct equivalent to the Change
Permission and Take Ownership in POSIX.

   <p><b>Further reading</b>
A description of the fourteen NTFS permission and the mapping of these
into sets is given at <a href="http://support.microsoft.com/kb/308419">http://support.microsoft.com/kb/308419</a>.

<h4 class="subsection">7.5.3 NT ACL examples</h4>

<pre class="verbatim">body common control
{
bundlesequence => { "acls" };
}

bundle agent acls
{
files:

  "C:\Program Files\Secret Program"
    acl => restrictive;

  "D:\Shared"
    acl => sharespace;
}

body acl restrictive
{
acl_type => "ntfs";
acl_method => "overwrite";
acl_directory_inherit => "parent";
aces => {"user:Administrator:r"};
}

body acl sharespace
{
acl_type => "ntfs";
acl_method => "overwrite";
acl_directory_inherit => "specify";
aces => { "user:Administrator:rwx(dDco)",
          "group:Hackers:rwx(dDco):deny",
          "all:rw" };
specify_inherit_aces => {"user:Administrator:r"};
}
</pre>

<!-- ***************************************************** -->
<!-- * CHAPTER -->
<!-- ***************************************************** -->
<div class="node">
<a name="Server-extensions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Environments-and-workflows">Environments and workflows</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#File-Access-Control-Lists">File Access Control Lists</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">8 Server extensions</h2>

<p>CFEngine Nova adds a simple server extension to the Community Edition
server, namely the ability to encode data directly in policy.
This feature is useful for distributing password hashes
to systems.

<ul class="menu">
<li><a accesskey="1" href="#Server-access-resource-type">Server access resource type</a>
<li><a accesskey="2" href="#Function-remotescalar">Function remotescalar</a>
<li><a accesskey="3" href="#Example-remote-scalar-lookup">Example remote scalar lookup</a>
</ul>

<div class="node">
<a name="Server-access-resource-type"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Function-remotescalar">Function remotescalar</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Server-extensions">Server extensions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Server-extensions">Server extensions</a>

</div>

<h3 class="section">8.1 Server access resource type</h3>

<p>By default, access to resources granted by the server are
files. However, sometimes it is useful to cache <code>literal</code>
strings, hints and data in the server, e.g. the contents of variables,
hashed passwords etc for easy access. In the case of literal data, the
promise handle serves as the reference identifier for queries. Queries
are instigated by function calls by any agent.

<pre class="verbatim">access:

  "This is a string with a $(localvar) for remote collection"

        handle  => "test_scalar",
  resource_type => "literal",
        admit   => { "127.0.0.1" };

</pre>

   <p>The promise looks exactly like a promise for a file object, but the data
are literal and entered into the policy. This is a useful approach for
distributing password hashes on a need-to-know basis from a central location.
The server configuration file need not be distributed to any client, thus
only authorized systems will have access to the hashes.

<div class="node">
<a name="Function-remotescalar"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Example-remote-scalar-lookup">Example remote scalar lookup</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Server-access-resource-type">Server access resource type</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Server-extensions">Server extensions</a>

</div>

<h3 class="section">8.2 Function <code>remotescalar</code></h3>

<p>The client side of the literal look up function is:

   <p><table class="cartouche" summary="cartouche" border="1"><tr><td>
<pre class="example">
     (string) remotescalar(<var>resource handle</var>,<var>host/IP address</var>,<var>encrypt</var>);

</pre>
   </td></tr></table>

   <p>This function downloads a string from a remote server, using the promise handle
as a variable identifier.

<p class="noindent"><b>ARGUMENTS</b>:

     <dl>
<dt>&lsquo;<samp><span class="samp">resource handle</span></samp>&rsquo;<dd>The name of the promise on the server side
<br><dt>&lsquo;<samp><span class="samp">host or IP address</span></samp>&rsquo;<dd>The location of the server on which the resource resides.
<br><dt>&lsquo;<samp><span class="samp">encrypt</span></samp>&rsquo;<dd>Whether to encrypt the connection to the server.
     <pre class="smallexample">               true
               yes
               false
               no
</pre>
     </dl>

<div class="node">
<a name="Example-remote-scalar-lookup"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Function-remotescalar">Function remotescalar</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Server-extensions">Server extensions</a>

</div>

<h3 class="section">8.3 Example remote scalar lookup</h3>

<pre class="verbatim">########################################################
#
# Remote value from server connection to cf-serverd
#
########################################################

body common control

{
bundlesequence  => { "testbundle"  };

version => "1.2.3";
}

########################################################

bundle agent testbundle

{
vars:

 "remote" string => remotescalar("test_scalar","127.0.0.1","yes");

reports:

  linux::

    "Receive value $(remote)";
}

#########################################################
# Server config
#########################################################

body server control

{
allowconnects         => { "127.0.0.1" , "::1" };
allowallconnects      => { "127.0.0.1" , "::1" };
trustkeysfrom         => { "127.0.0.1" , "::1" };
allowusers            => { "mark" };
}

#########################################################

bundle server access_rules()

{
vars:

  "localvar" string => "literal string";

access:

  "This is a $(localvar) for remote access"

        handle  => "test_scalar",
  resource_type => "literal",
        admit   => { "127.0.0.1" };
}

</pre>

<!-- ***************************************************** -->
<!-- * CHAPTER -->
<!-- ***************************************************** -->
<div class="node">
<a name="Environments-and-workflows"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Virtualization">Virtualization</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Server-extensions">Server extensions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">9 Environments and workflows</h2>

<ul class="menu">
<li><a accesskey="1" href="#Environments-in-Nova">Environments in Nova</a>
<li><a accesskey="2" href="#Implementing-workflows-in-Nova">Implementing workflows in Nova</a>
</ul>

<div class="node">
<a name="Environments-in-Nova"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Implementing-workflows-in-Nova">Implementing workflows in Nova</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Environments-and-workflows">Environments and workflows</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Environments-and-workflows">Environments and workflows</a>

</div>

<h3 class="section">9.1 Environments in Nova</h3>

<pre class="sp">

</pre>

Nova supports notion of `environments' &ndash; named groups of hosts, like
`development', 'QA' and 'production' hosts.

   <p>Each environment gets
     <ul>
<li>Separate subdirectory `environment_&lt;NAME&gt;' for storing promises
<li>Separate subdirectory `environment_&lt;NAME&gt;/cdp_inputs' for content-based policies
<li>grouping of hosts belonging to environment in GUI
</ul>

   <p>Default Nova policies group hosts into environments in bundle `common
environments'. This bundle defines
     <ul>
<li>`environments.active' variable. This variable holds the name of environment for current host, and is used by other promises in Nova templates. This variable does not affect grouping in GUI.
<li>global `environment_&lt;NAME&gt;' class. This class should be defined if given host belongs to the `&lt;NAME&gt;' environment. GUI groups hosts using this class.
</ul>
   Administrator may customize this bundle as needed, adding or removing
environments defined (Nova does not have any built-in environment
names), changing rules for hosts selection and making any other
modifications, the only requirement for environments feature to work
is keeping aforementioned variables and classes defined. Note that the
environment name 'any' is reserved.

   <p>Default rules expect file `environment_$(promises.active)/promises.cf'
to exist and to contain bundle `agent main', this bundle is included
last from main promises.cf and should implement/include/use any
environment-specific rules.

<div class="node">
<a name="Implementing-workflows-in-Nova"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Environments-in-Nova">Environments in Nova</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Environments-and-workflows">Environments and workflows</a>

</div>

<h3 class="section">9.2 Implementing workflows in Nova</h3>

<p>Workflows are implemented easily with Nova, administrator starts with
defining necessary set of environments (usually those are
`development', `testing' and 'production'), then develops new
configuration in one enviroment, and promotes rules first to testing
and then to production environment.

   <p>Promotion of rules is performed by copying rules from one
environment's subdirectory to next one.

<!-- ***************************************************** -->
<!-- * CHAPTER -->
<!-- ***************************************************** -->
<div class="node">
<a name="Virtualization"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Content_002dDriven-Policies">Content-Driven Policies</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Environments-and-workflows">Environments and workflows</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">10 Virtualization</h2>

<ul class="menu">
<li><a accesskey="1" href="#What-are-virtualization-and-cloud-computing_003f">What are virtualization and cloud computing?</a>
<li><a accesskey="2" href="#Why-build-virtualization-support-into-Cfengine_003f">Why build virtualization support into CFEngine?</a>
<li><a accesskey="3" href="#What-can-CFEngine-do-with-virtual-machines_003f">What can CFEngine do with virtual machines?</a>
<li><a accesskey="4" href="#Environments-promises">Environments promises</a>
<li><a accesskey="5" href="#Virtualization-types-supported">Virtualization types supported</a>
<li><a accesskey="6" href="#Distinct-states">Distinct states</a>
<li><a accesskey="7" href="#Example-deployment">Example deployment</a>
</ul>

<div class="node">
<a name="What-are-virtualization-and-cloud-computing%3f"></a>
<a name="What-are-virtualization-and-cloud-computing_003f"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Why-build-virtualization-support-into-Cfengine_003f">Why build virtualization support into CFEngine?</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Virtualization">Virtualization</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Virtualization">Virtualization</a>

</div>

<h3 class="section">10.1 What are virtualization and cloud computing?</h3>

<pre class="sp">

</pre>

Virtualization refers to the ability to run multiple host instances on
a single physical node. Cloud computing typically refers to what is
called `platform as a service', or deployment of virtual machines on
demand, often as an on-line service.

   <p>In this document, virtualization support refers specifically to
hypervisor technologies supported by the open source library layer <i>libvirt</i>
project, which includes interfaces for Xen, KVM, Vmware-ESX, and more.
CFEngine thus integrates freely with other tools based on this library, such
as <i>virsh</i> and the <i>Virtual Manager</i> graphical user interface.

<div class="node">
<a name="Why-build-virtualization-support-into-Cfengine%3f"></a>
<a name="Why-build-virtualization-support-into-Cfengine_003f"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#What-can-CFEngine-do-with-virtual-machines_003f">What can CFEngine do with virtual machines?</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#What-are-virtualization-and-cloud-computing_003f">What are virtualization and cloud computing?</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Virtualization">Virtualization</a>

</div>

<h3 class="section">10.2 Why build virtualization support into CFEngine?</h3>

<pre class="sp">

</pre>

Virtualization engines (usually called supervisors or hypervisors) are
seeing an explosion of development. They exist as a number of projects
in various stages of maturity. The libvirt project was designed as
an integration layer based on an XML specification.

   <p>The tools for management are still quite primitive and require much
manual work. CFEngine has a unique role to play in maintaining desired
state in virtual machine systems.

   <p>In the cloud, virtual machines may be rented from remote commercial
providers, and managed as disposable resources. Convergent or
`self-healing' maintenance is an essential method for managing
machines that are geographically remote and awkward to access, e.g.
machines in other time-zones that it is impractical to monitor by
legacy methods.

<div class="node">
<a name="What-can-CFEngine-do-with-virtual-machines%3f"></a>
<a name="What-can-CFEngine-do-with-virtual-machines_003f"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Environments-promises">Environments promises</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Why-build-virtualization-support-into-Cfengine_003f">Why build virtualization support into CFEngine?</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Virtualization">Virtualization</a>

</div>

<h3 class="section">10.3 What can CFEngine do with virtual machines?</h3>

<pre class="sp">

</pre>

The simple answer is: anything that <i>libvirt</i> can do, with added
convergence to a desired state: that means, creating, destroying and
starting and stopping machines. By starting virtual machines through
CFEngine, you can be sure that a given `virtual guest' is running on
one and only one physical host, thus avoiding conflicts that are
difficult to detect with centralized systems.

   <p>CFEngine does not support everything that libvirt does &ndash; it offers a
simplified interface that is meant for robustness, stability and
hands-free repeatability.

   <pre class="sp">

</pre>
<p><table class="cartouche" summary="cartouche" border="1"><tr><td>
CFEngine does not use libvirt's TLS based web communication layer.  It
manages every host as an independent entity, in typical CFEngine
fashion, using CFEngine's own distributed cooperation to provide the
implicit communication.  CFEngine does not currently support so-called
`live migration' of virtual machines.
</td></tr></table>

   <pre class="sp">

</pre>

<div class="node">
<a name="Environments-promises"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Virtualization-types-supported">Virtualization types supported</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#What-can-CFEngine-do-with-virtual-machines_003f">What can CFEngine do with virtual machines?</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Virtualization">Virtualization</a>

</div>

<h3 class="section">10.4 Environments promises</h3>

<pre class="sp">

</pre>

A virtual machine is one example of what CFEngine calls an
`environment'.  You can promise to create (and host) an environment
with certain attributes, just as you can promise to host a file or a
process. Here is a simple example:

<pre class="verbatim">body common control
{
bundlesequence  => { "my_vm_cloud" };
}

#######################################################

bundle agent my_vm_cloud
{
environments:

   "myUbuntu" # the running instance name, defined in XML

       environment_resources => virt_xml,
       environment_type      => "xen",
       environment_host      => "my_physical_computer", # ipv4_10_1_2_3
       environment_state     => "create";
}

#######################################################

body environment_resources virt_xml
{
env_spec_file => "/srv/xen/centos5-libvirt-create.xml";
}

</pre>

     <ul>
<li>The promiser (in this case &lsquo;<samp><span class="samp">myUbuntu</span></samp>&rsquo;) is the name of the virtual
machine. This should be a unique identifier, as we need to be able to
refer to machines uniquely.

     <li>The environment host is the name of the computer that
is the host for the virtual machine.

     <li>Normally when we want to ensure something on a machine, we use classes
to decide where the promise will be made. For environments, however,
we need to make promises about the uniqueness of the machine. When you
make a machine instance you normally want it to be running on one and
only one host. So you want <i>every</i> machine to make a promise. On the
environment's host, you want to promise that the environment is
running, and on every other machine you want to promise that it is
not. In CFEngine, you simply include a unique class belonging to host
in the promise using <code>environment_host</code> and CFEngine assumes that
rest. Unique classes might include
          <ul>
<li>Hostname class e.g. <code>myhost_cfengine_com</code>
<li>IP address class e.g. <code>ipv4_123_456_789_123</code>
</ul>
     </ul>

   <p>An alternative way to write this example is to quote the XML
specification in CFEngine directly. This has a few advantages: you can
re-use the data and use it as a template, filling in
CFEngine-variables. You can thus adapt the configuration using
Cfengine's classes.

<pre class="verbatim">bundle agent my_vm_cloud
{
environments:

   "myUbuntu" # the running instance name, defined in XML
       environment_resources => virt_xml("$(this.promiser)"),
       environment_type      => "xen",
       environment_host      => "myphysicalcomputer";
       environment_state     => "create"
}

#######################################################

body environment_resources virt_xml(host)
{
env_spec_file =>

"&lt;domain type='xen'>
  &lt;name>$(host)&lt;/name>
  &lt;os>
    &lt;type>linux&lt;/type>
    &lt;kernel>/var/lib/xen/install/vmlinuz-ubuntu10.4-x86_64&lt;/kernel>
    &lt;initrd>/var/lib/xen/install/initrd-vmlinuz-ubuntu10.4-x86_64&lt;/initrd>
    &lt;cmdline> kickstart=http://example.com/myguest.ks &lt;/cmdline>
  &lt;/os>
  &lt;memory>131072&lt;/memory>
  &lt;vcpu>1&lt;/vcpu>
  &lt;devices>
    &lt;disk type='file'>
      &lt;source file='/var/lib/xen/images/$(host).img'/>
      &lt;target dev='sda1'/>
    &lt;/disk>
    &lt;interface type='bridge'>
      &lt;source bridge='xenbr0'/>
      &lt;mac address='aa:00:00:00:00:11'/>
      &lt;script path='/etc/xen/scripts/vif-bridge'/>
    &lt;/interface>
    &lt;graphics type='vnc' port='-1'/>
    &lt;console tty='/dev/pts/5'/>
  &lt;/devices>
&lt;/domain>
";
}
</pre>

   <p>You should consult the libvirt documentation for the details of the XML specification.

<div class="node">
<a name="Virtualization-types-supported"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Distinct-states">Distinct states</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Environments-promises">Environments promises</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Virtualization">Virtualization</a>

</div>

<h3 class="section">10.5 Virtualization types supported</h3>

<pre class="sp">

</pre>

CFEngine currently supports virtualization only through libvirt, so it supports
those technologies that libvirt supports. Currently this includes  most popular
technologies. You must choose the type of monitor that is to be responsible for
keeping the environment promise. In CFEngine, you should choose between a
machine environment or network environment of the following types:
     <dl>
<dt><code>xen</code><dd>A Xen hypervisor virtual domain.
<br><dt><code>kvm</code><dd>A KVM hypervisor virtual domain.
<br><dt><code>esx</code><dd>A VMware hypervisor virtual domain.
<br><dt><code>test</code><dd>The libvirt test-hypervisor virtual domain.
<br><dt><code>xen_net</code><dd>A Xen hypervisor virtual network.
<br><dt><code>kvm_net</code><dd>A KVM hypervisor virtual network
<br><dt><code>esx_net</code><dd>An ESX/VMWare hypervisor virtual network.
<br><dt><code>test_net</code><dd>The test hypervisor virtual network.
<br><dt><code>zone</code><dd>A Solaris zone (future development)
<br><dt><code>ec2</code><dd>An Amazon EC2 instance (future development)
<br><dt><code>eucalyptus</code><dd>A Eucalyptus instance (future development)
</dl>

   <p>Once again, you must consult the libvirt documentation for details.

<div class="node">
<a name="Distinct-states"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Example-deployment">Example deployment</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Virtualization-types-supported">Virtualization types supported</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Virtualization">Virtualization</a>

</div>

<h3 class="section">10.6 Distinct states</h3>

<pre class="sp">

</pre>

Libvirt recognizes a number of distinct states are transliterated into CFEngine
as
     <dl>
<dt><code>create</code><dd>Build and start an environment.
<br><dt><code>delete</code><dd>Halt and remove runtime resources associated with an environment.
<br><dt><code>running</code><dd>An existing environment is in a running state.
<br><dt><code>suspended</code><dd>An existing environment is in a `paused' state.
<br><dt><code>down</code><dd>An existing environment is in a halted state.
</dl>
   The default promised state is for a machine to be running
wherever the  <code>environment_host</code> class is true, and
suspended or down elsewhere.

<div class="node">
<a name="Example-deployment"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Distinct-states">Distinct states</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Virtualization">Virtualization</a>

</div>

<h3 class="section">10.7 Example deployment</h3>

<pre class="sp">

</pre>

Prerequisites: you need to make a `disk image' for the machine, or a
virtual disk of blocks that can be allocated. This image does not have to
contain any data, it will simply as a block device for the VM. You
can then install it by booting the machine from a network image, like a
PXE/kickstart installation.

   <p>If you want to allocate disk blocks as the file grows, you can create
a file with a hole. The following command will creates a file of
2048MB, but the actual data blocks are allocated in a lazy fashion:

<pre class="verbatim">
# dd if=/dev/zero of=/srv/xen/my.img oflag=direct bs=1M seek=2047 count=1

</pre>
To reserve all the data blocks right away:
<pre class="verbatim">
# dd if=/dev/zero of=/srv/xen/my.img oflag=direct bs=1M count=2048

</pre>

   <p>Libvirt uses an XML file format that cannot be circumvented. CFEngine
promises to honor the promises that are expressed in this file, as in
the examples above.  You need to find out about this file format from
the libvirt website.  To get CFEngine to Honor these promises, you
point it to the specification that it should promise using
<code>spec_file</code>.

   <p>You need to set up a network for virtual machines to communicate with
the outside world. This can also be done with CFEngine, using the
network promise types to build a bridge into a virtual network.

   <p>Then just run CFEngine to start, stop or manage the virtual environments on
each localhost. Run in verbose mode to see how CFEngine maintains the states
convergently.
<pre class="verbatim"># cf-agent -v
</pre>

<!-- ***************************************************** -->
<!-- * CHAPTER -->
<!-- ***************************************************** -->
<div class="node">
<a name="Content-Driven-Policies"></a>
<a name="Content_002dDriven-Policies"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Windows_002dspecific-features-in-Nova">Windows-specific features in Nova</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Virtualization">Virtualization</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">11 Content-Driven Policies</h2>

<p>In Nova 2.0, Content-Driven Policies (CDP) were introduced to make
policy management easier. In contrast to policies written in the
CFEngine language, these are semi-colon separated fields in a text
file that the user just fills with content. All the underlying
enforcement and reporting are taken care of automatically by Nova.

   <p>For example, to manage three Windows services, the following
services-CDP will suffice.

<pre class="verbatim"># masterfiles/cdp_inputs/service_list.txt

Dnscache;stop;fix;windows
ALG;start;warn;windows
RemoteRegistry;start;fix;Windows_Server_2008

</pre>

   <p>The meanings of the fields are different depending of the CDP-type,
but explained in the file header. With these three lines, we ensure
the correct status of three services on all our Windows machines and
are given specialized reports on the outcome. The Content-Driven
Policy services report is shown below.

   <div class="block-image"><img src="/img/outside/cdp_services_report.png" alt="The Content-Driven Policy services report"></div>

<h3 class="section">11.1 Benefits of Content-Driven Policies</h3>

<p>As seen in the example above, Content-Driven Policies are easy to
write and maintain, especially for users unfamiliar with the CFEngine
language. They are designed to capture the essence of a specific,
popular use of CFEngine, and make it easier. For example, the services
Content-Driven Policy above has the following equivalent in the
CFEngine language.

<pre class="smallexample">
     bundle agent service_example
     {
     services:

       "Dnscache"
         comment            =&gt; "Check services status of Dnscache",
         handle             =&gt; "srv_Dnscache_windows",
         service_policy     =&gt; "stop",
         service_method     =&gt; force_deps,
         action             =&gt; policy("fix"),
         ifvarclass         =&gt; "windows";

       "ALG"
         comment            =&gt; "Check services status of ALG",
         handle             =&gt; "srv_ALG_windows",
         service_policy     =&gt; "start",
         service_method     =&gt; force_deps,
         action             =&gt; policy("warn"),
         ifvarclass         =&gt; "windows";

       "RemoteRegistry"
         comment            =&gt; "Check services status of ALG",
         handle             =&gt; "srv_ALG_windows",
         service_policy     =&gt; "start",
         service_method     =&gt; force_deps,
         action             =&gt; policy("fix"),
         ifvarclass         =&gt; "Windows_Server_2008";

     }

</pre>
   <p>Writing this policy is clearly more time-consuming and error-prone. On
the other hand, it allows for much more flexibility than Content-Driven
Policies, when that is needed.

   <p>CFEngine provides Content-Driven Policies to cover mainstream
management tasks like the following.

     <ul>
<li>File change/difference management
<li>Service management
<li>Database management
<li>Application / script management
</ul>

<h3 class="section">11.2 Getting started</h3>

<p>All the CDP input files are located in
<code>/var/cfengine/masterfiles/cdp_inputs</code> on your policy hub. Nova
is bundled with some examples, but ensure to <em>edit the examples
before enabling them</em>.

   <p>To enable all the CDPs located in <code>cdp_inputs/</code>, open
<code>promises.cf</code> in your masterfiles directory. Remove the comment
(<code>#</code>) in front of the cdp entries in <code>bundlesequence</code> and
<code>inputs</code>, to make it look like the following.

<pre class="verbatim">bundlesequence => {
                  "def",
                  "cfengine_management",
                  "service_catalogue",
                  "cdp",
...

        inputs => {
...
                  "cdp_lib/cdp.cf",
                  "cdp_lib/cdp_acls.cf",
                  "cdp_lib/cdp_registry.cf",
                  "cdp_lib/cdp_file_changes.cf",
                  "cdp_lib/cdp_file_diffs.cf",
                  "cdp_lib/cdp_services.cf",
                  "cdp_lib/cdp_commands.cf",
...
</pre>

   <p>When the hosts start reporting back on the outcome of these policies
(usually within 10 minutes), you can view the reports from your
Knowledge Map on the policy hub. Go to the <code>Status</code> tab, find the
Content-Driven Policies drop-down, select the CDP type
(e.g. <code>Services</code>) and click <code>Generate</code>.

   <div class="block-image"><img src="/img/outside/cdp_reports_generate.png" alt="Generating Content-Driven Policy reports"></div>

<!-- ***************************************************** -->
<!-- * CHAPTER -->
<!-- ***************************************************** -->
<div class="node">
<a name="Windows-specific-features-in-Nova"></a>
<a name="Windows_002dspecific-features-in-Nova"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Content_002dDriven-Policies">Content-Driven Policies</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">12 Windows-specific features in Nova</h2>

<p>In this section, we will explore the Windows-specific features of the
native Windows version of CFEngine Nova, and how it integrates with
Windows. We will also consider features that are more interesting or
popular on Windows than on other platforms.

   <p>Feature highlights include Windows service management and integration,
event logging, Windows registry repair, and fine-tuned file security
support through access control lists. See the sections on databases
and ACLs to find information on Windows registry repair and NTFS ACLs,
respectively. We will look at some of the other added features next.

<h3 class="section">12.1 Windows service management</h3>

<p>CFEngine Nova can maintain complete control of the state of all
Windows services, in addition to Unix daemons. Services prone to
security issues or errors can easily be given a disabled state.

   <div class="block-image"><img src="/img/outside/winservice-disabled_policy.png" alt="Disabled Windows service"></div>

   <p>A service can also be given a running state, in which case CFEngine
Nova ensures that it is running, and starts it if it is not, with
parameters if desired. More advanced policy options are also
available, including support for starting and stopping dependencies,
and configuring when the services should be started (e.g. only when
they are being used).

   <p>Furthermore, the CFEngine executor in Nova now runs as a Windows
service itself. This means it runs in the background an starts with
Windows, before any user logs in. It can be configured, started and
stopped from the &ldquo;Services&rdquo; listing in Windows.

   <p>Note that the name of a service in Windows may be different from its
&ldquo;Display name&rdquo;. CFEngine Nova policies use the name, not the display
name, due to the need of uniqueness.

   <div class="block-image"><img src="/img/outside/winservice-properties_name.png" alt="Windows service name and Display name"></div>

<h3 class="section">12.2 Windows event logging</h3>

<p>Event logs are the Windows counterpart to syslog from Unix. The main
difference is that event logs aim to group similar log messages,
giving each group an event id.

   <div class="block-image"><img src="/img/outside/winevent-repaired-acl-closeup.png" alt="Promise repaired in Event Viewer"></div>

   <p>A program that creates logs, such as CFEngine Nova, must define the
possible event IDs, and their meaning. In many applications, only one
event id is defined, a generic log message. However, CFEngine Nova
defines the following range of event IDs, which allows for automatic
handling of log messages.

   <p><table summary=""><tr align="left"><th valign="top" width="40%">Description </th><th valign="top" width="20%">Event ID </th><th valign="top" width="20%">Type
<br></th></tr><tr align="left"><td valign="top" width="40%">Promise kept </td><td valign="top" width="20%">100 </td><td valign="top" width="20%">Information
<br></td></tr><tr align="left"><td valign="top" width="40%">Promise repaired </td><td valign="top" width="20%">101 </td><td valign="top" width="20%">Information
<br></td></tr><tr align="left"><td valign="top" width="40%">Promise not repaired due warn only policy </td><td valign="top" width="20%">102 </td><td valign="top" width="20%">Error
<br></td></tr><tr align="left"><td valign="top" width="40%">Promise not repaired due to error </td><td valign="top" width="20%">103 </td><td valign="top" width="20%">Error
<br></td></tr><tr align="left"><td valign="top" width="40%">Report promise </td><td valign="top" width="20%">104 </td><td valign="top" width="20%">Information
<br></td></tr><tr align="left"><td valign="top" width="40%">Generic information </td><td valign="top" width="20%">105 </td><td valign="top" width="20%">Information
<br></td></tr><tr align="left"><td valign="top" width="40%">Generic verbose </td><td valign="top" width="20%">106 </td><td valign="top" width="20%">Information
<br></td></tr><tr align="left"><td valign="top" width="40%">Generic warning </td><td valign="top" width="20%">107 </td><td valign="top" width="20%">Warning
<br></td></tr><tr align="left"><td valign="top" width="40%">Generic error </td><td valign="top" width="20%">108 </td><td valign="top" width="20%">Error
   <br></td></tr></table>

   <div class="block-image"><img src="/img/outside/winevent-notkept-storage.png" alt="Promise not kept in Event Viewer"></div>

   <p>The Nova event logs can be found under the &ldquo;System&rdquo; logs.  Almost
all monitoring products for Windows supports reading event logs, and
they can thus monitor logs from CFEngine Nova as well. This makes it
possible to do more advanced querying on the status of a machine
running CFEngine Nova, e.g. to show all promises that have not been
kept in a certain time interval. However, we recommend using the
Knowledge Map to do more advanced things, as it is specifically made
for this purpose and supports all operating systems that CFEngine runs
on.

<h3 class="section">12.3 Windows special variables</h3>

<p>Three new special variables have been added to the Windows version of
CFEngine Nova.

     <ul>
<li><code>sys.windir</code> contains the Windows directory,
e.g. &ldquo;C:\WINDOWS&rdquo;.

     <li><code>sys.winsysdir</code> contains the Windows system directory,
e.g. &ldquo;C:\WINDOWS\system32&rdquo;.

     <li><code>sys.winprogdir</code> contains the program files directory,
e.g. &ldquo;C:\Program Files&rdquo;.

   </ul>

   <p>Note that these variables are not statically coded, but retrieved from
the current system. For example, <code>sys.winprogdir</code> is often
different on Windows versions in distinct languages.

<h3 class="section">12.4 Windows hard classes</h3>

<p>The Windows version of CFEngine Nova defines hard classes to pinpoint
the exact version of Windows that it is running on, the service pack
version and if it's a server or workstation.

   <p>First of all, the class <code>windows</code> is defined on all Windows
platforms. For Windows workstations, such as Windows XP,
<code>WinWorkstation</code> is defined. On Windows servers, such as Windows
Server 2003, <code>WinServer</code> is defined. In addition, if the server
is a domain controller, <code>DomainController</code> is defined. Note that
if <code>DomainController</code> is defined, then <code>WinServer</code> is also
defined, for natural reasons.

   <p>The class <code>Service_Pack_X_Y</code> is defined according to the service
pack version. For example, at the time of writing,
<code>Service_Pack_3_0</code> is set on an updated Windows XP operating
system.

   <p>To allow taking specific actions on different Windows versions, one
of the following hard classes is defined.

     <ul>
<li><code>Windows_7</code>
<li><code>Windows_Server_2008_R2</code>
<li><code>Windows_Server_2008</code>
<li><code>Windows_Vista</code>
<li><code>Windows_Server_2003_R2</code>
<li><code>Windows_Home_Server</code>
<li><code>Windows_Server_2003</code>
<li><code>Windows_XP_Professional_x64_Edition</code>
<li><code>Windows_XP</code>
<li><code>Windows_2000</code>
</ul>

   <p>Note that all defined hard classes for a given system is shown by
running <code>cf-promises -v</code>.

<h3 class="section">12.5 Notes on windows policies</h3>

<p>A potential problem source when writing policies for windows is that
paths to executables often contain spaces. This makes it impossible
for CFEngine to know where the executable ends and the parameters to
it starts. To solve this, we place escaped quotes around the
executable.

   <p>Additionally, Windows does not support that processes start themselves
in in the background (i.e. fork off a child process in the Unix
world). The result is that CFEngine is always waiting for the commands
to finish execution before checking the next promise. To avoid this,
use the background attribute in the action body-part.

   <p>Both these things are demonstrated in the following example.

<pre class="verbatim">
body common control
{
bundlesequence  => { "main" };
}

bundle agent main
{
commands:

"\"C:\Program Files\Some Dir\program name.bat\" --silent --batch"
  action => background;
}

body action background
{
background => "true";
}

</pre>

   <p>Finally, one should note that Windows lacks support for certain
features that are utilized in Unix versions of CFEngine. These include
symbolic links, file groups, user and group identifiers.

   <p>Thus, the parts of promises containing these features will be
ignored. For example, the <code>getgid()</code> function does not return
anything on Windows. The reference manual documents exactly which
promises are ignored and not.  Also, <code>cf-agent</code> from CFEngine
Nova prints warning messages on ignored attributes when run in verbose
mode.

<!-- ========================================================================= -->
<!-- @node Index,  , CFEngine Methods, Top -->
<!-- @unnumbered Concept Index -->
<!-- @printindex cp -->
<!-- ========================================================================= -->
   <p><a name="Contents">
   <div class="contents">
<h2>Table of Contents</h2>
<ul>
<li><a name="toc_Top" href="#Top">CFEngine-AutoReference</a>
<li><a name="toc_Introduction-to-CFEngine-Nova" href="#Introduction-to-CFEngine-Nova">1 Introduction to CFEngine Nova</a>
<ul>
<li><a href="#What-are-enterprise-versions_003f">1.1 What are enterprise versions of CFEngine?</a>
<li><a href="#What_0027s-new-in-Nova-2_002e0_003f">1.2 What's new in Nova 2.0?</a>
<li><a href="#About-the-CFEngine-architecture">1.3 About the CFEngine architecture</a>
<ul>
<li><a href="#CFEngine-is-agent-based-software">1.3.1 CFEngine is agent based software</a>
<li><a href="#Single-point-of-coordination">1.3.2 Single point of coordination</a>
<li><a href="#Requirements-and-scalability-of-CFEngine-Nova">1.3.3 Requirements and scalability of CFEngine Nova</a>
<li><a href="#Phases-of-the-server-life_002dcycle">1.3.4 Phases of the server life-cycle</a>
</li></ul>
<li><a href="#Nova-Commercial-Enhancements">1.4 Nova Commercial Enhancements</a>
<ul>
<li><a href="#Productivity-enhancements">1.4.1 Productivity enhancements</a>
<li><a href="#Functional-enhancements">1.4.2 Functional enhancements</a>
<li><a href="#Reporting-enhancements">1.4.3 Reporting enhancements</a>
<li><a href="#Documentation-enhancements">1.4.4 Documentation enhancements</a>
<li><a href="#Knowledge-Management-in-Nova">1.4.5 Knowledge Management in Nova</a>
</li></ul>
</li></ul>
<li><a name="toc_Installing-CFEngine-Nova" href="#Installing-CFEngine-Nova">2 Installing CFEngine Nova</a>
<ul>
<li><a href="#Operating-system-support">2.1 Operating system support</a>
<li><a href="#Installing-the-software">2.2 Installing the software on a new host</a>
<li><a href="#Upgrading-Nova">2.3 Upgrading Nova</a>
<ul>
<li><a href="#Troubleshooting-upgrade">2.3.1 Troubleshooting upgrade</a>
</li></ul>
<li><a href="#What-is-the-default-configuration-_002d-out-of-the-box">2.4 What is the default configuration?</a>
</li></ul>
<li><a name="toc_Mission-Portal" href="#Mission-Portal">3 Mission Portal</a>
<ul>
<li><a href="#Mission-Portal-Views">3.1 Mission Portal Views</a>
<ul>
<li><a href="#Mission-status">3.1.1 Mission status</a>
<li><a href="#Host-view">3.1.2 Host view</a>
<li><a href="#Status-level-meters">3.1.3 Status level meters</a>
<li><a href="#Top-50-weakest-hosts">3.1.4 Top 50 weakest hosts</a>
<li><a href="#Pulse-and-vital-signs">3.1.5 Pulse and vital signs</a>
<li><a href="#Detail-views">3.1.6 Detail views</a>
<li><a href="#The-policy-editor">3.1.7 The policy editor</a>
<li><a href="#Integration-with-subversion">3.1.8 Integration with subversion</a>
</li></ul>
<li><a href="#Report-extensions">3.2 Reports in the Mission Portal</a>
<li><a href="#Should-monitoring-and-configuration-be-separate_003f">3.3 Should monitoring and configuration be separate?</a>
<li><a href="#What-is-a-CMDB_003f">3.4 What is a CMDB?</a>
<li><a href="#CMDB-and-Cfengine">3.5 CMDB and CFEngine</a>
<li><a href="#Decentralized-data-collection-in-Cfengine">3.6 Decentralized data collection in CFEngine</a>
<li><a href="#Reporting-in-Cfengine">3.7 Reporting in CFEngine</a>
<li><a href="#Standard-reports-in-CFEngine-Nova">3.8 Standard reports in CFEngine Nova</a>
<ul>
<li><a href="#Performance-logs">3.8.1 Performance logs</a>
<li><a href="#Installed-software-packages">3.8.2 Installed software packages</a>
<li><a href="#A-promise-compliance-report">3.8.3 A promise compliance report</a>
<li><a href="#A-file-content-change-report">3.8.4 A file content change report</a>
<li><a href="#Installed-setuid-program-report">3.8.5 Installed setuid program report</a>
</li></ul>
<li><a href="#Knowledge-Map">3.9 Knowledge Map</a>
<ul>
<li><a href="#The-knowledge-map-pages">3.9.1 The knowledge map pages</a>
<li><a href="#The-knowledge-base-map_002dgraphs">3.9.2 The knowledge base maps</a>
<li><a href="#Results-for-this-topic">3.9.3 Results for this topic</a>
<li><a href="#Topics-that-have-Category_002dTopic-as-a-subject_002dheader">3.9.4 Topics that have Category::Topic as a subject-header</a>
<li><a href="#Other-topics-found-under-Category">3.9.5 Other topics found under Category</a>
</li></ul>
<li><a href="#Using-the-knowledge-map">3.10 Using the knowledge map</a>
<ul>
<li><a href="#Policy-analysis">3.10.1 Policy analysis</a>
<li><a href="#Understanding-dependencies">3.10.2 Understanding dependencies</a>
<li><a href="#A-quick-tour-of-the-knowledge-console">3.10.3 A quick tour of the knowledge console</a>
<li><a href="#Why-knowledge-management_003f">3.10.4 Why knowledge management?</a>
</li></ul>
<li><a href="#cf_002dhub-and-data-collection">3.11 cf-hub and data collection</a>
<ul>
<li><a href="#CMDB-or-SKMS">3.11.1 CMDB or SKMS</a>
<li><a href="#The-reporting-agent">3.11.2 The reporting agent</a>
</li></ul>
</li></ul>
<li><a name="toc_Business-Integration" href="#Business-Integration">4 Business Integration</a>
<ul>
<li><a href="#Nova-attends-to-business-goals">4.1 Business goals and the Service Catalogue</a>
<li><a href="#Business-value-reports">4.2 Business value reports</a>
<li><a href="#Simple-insight-into-IT-compliance">4.3 Simple insight into IT compliance</a>
</li></ul>
<li><a name="toc_Monitoring-extensions" href="#Monitoring-extensions">5 Monitoring extensions</a>
<ul>
<li><a href="#Integration-of-monitoring-with-knowledge-base">5.1 Integration of monitoring with knowledge base</a>
<li><a href="#Long-term-trends">5.2 Long term trends</a>
<li><a href="#Custom-promises-to-measure">5.3 Custom promises to measure</a>
<ul>
<li><a href="#Extraction-strings-and-logging">5.3.1 Extraction strings and logging</a>
<li><a href="#Extracting-one_002doff-numerical-data">5.3.2 Extracting one-off numerical data</a>
<li><a href="#Extraction-to-list-variable">5.3.3 Extraction to list variable</a>
</li></ul>
<li><a href="#Uses-for-custom-monitoring">5.4 Uses for custom monitoring</a>
</li></ul>
<li><a name="toc_Database-Promises" href="#Database-Promises">6 Database Promises</a>
<ul>
<li><a href="#How-to-manage-databases">6.1 How to manage databases</a>
<li><a href="#Database-access-rights">6.2 Database access rights</a>
<li><a href="#Creating-a-point-of-contact-on-a-server">6.3 Creating a point of contact on a server</a>
<li><a href="#Creating-SQL-databases">6.4 Creating SQL databases</a>
<ul>
<li><a href="#Creating-a-database-manually">6.4.1 Creating a database manually</a>
<li><a href="#Creating-a-database-directly">6.4.2 Creating a database directly</a>
</li></ul>
<li><a href="#Database-promises">6.5 Database table promises</a>
<li><a href="#MS-Registry-functions">6.6 MS Registry functions</a>
<ul>
<li><a href="#Creating-a-registry-key">6.6.1 Creating a registry key</a>
<li><a href="#Creating-a-value_002ddata-pair">6.6.2 Creating a value-data pair</a>
<li><a href="#Deleting-registry-keys">6.6.3 Deleting registry keys</a>
<li><a href="#Deleting-registry-values">6.6.4 Deleting registry values</a>
<li><a href="#Scanning-and-restoring-the-registry">6.6.5 Scanning and restoring the registry</a>
</li></ul>
<li><a href="#LDAP-integration">6.7 LDAP integration</a>
<ul>
<li><a href="#Function-ldapvalue">6.7.1 Function <code>ldapvalue</code></a>
<li><a href="#Function-ldaplist">6.7.2 Function <code>ldaplist</code></a>
<li><a href="#Function-ldaparray">6.7.3 Function <code>ldaparray</code></a>
<li><a href="#Function-regldap">6.7.4 Function <code>regldap</code></a>
<li><a href="#LDAP-function-examples">6.7.5 LDAP function examples</a>
<li><a href="#Best-practice-for-LDAP-integration">6.7.6 Best practice for LDAP integration</a>
</li></ul>
</li></ul>
<li><a name="toc_File-Access-Control-Lists" href="#File-Access-Control-Lists">7 File Access Control Lists</a>
<ul>
<li><a href="#Introduction">7.1 Introduction</a>
<li><a href="#File-ACL-example">7.2 File ACL example</a>
<ul>
<li><a href="#Concepts">7.2.1 Concepts</a>
<li><a href="#Entity-types">7.2.2 Entity types</a>
<li><a href="#Owners">7.2.3 Owners</a>
<li><a href="#Changing-owner">7.2.4 Changing owner</a>
<li><a href="#Permissions">7.2.5 Permissions</a>
<li><a href="#Deny-permissions">7.2.6 Deny permissions</a>
<li><a href="#Changing-permissions">7.2.7 Changing permissions</a>
<li><a href="#Effective-permissions">7.2.8 Effective permissions</a>
<li><a href="#Effective-permissions">7.2.9 Inheritance</a>
</li></ul>
<li><a href="#Effective-permissions">7.3 CFEngine 3 Generic ACL Syntax</a>
<ul>
<li><a href="#Effective-permissions">7.3.1 Generic syntax examples</a>
</li></ul>
<li><a href="#Effective-permissions">7.4 POSIX ACL type</a>
<ul>
<li><a href="#Effective-permissions">7.4.1 POSIX-specific ACL syntax</a>
<li><a href="#Effective-permissions">7.4.2 Generic syntax mapping</a>
<li><a href="#Effective-permissions">7.4.3 POSIX ACL examples</a>
</li></ul>
<li><a href="#Effective-permissions">7.5 NT ACL type</a>
<ul>
<li><a href="#Effective-permissions">7.5.1 NT-specific ACL syntax</a>
<li><a href="#Effective-permissions">7.5.2 Generic syntax mapping</a>
<li><a href="#Effective-permissions">7.5.3 NT ACL examples</a>
</li></ul>
</li></ul>
<li><a name="toc_Server-extensions" href="#Server-extensions">8 Server extensions</a>
<ul>
<li><a href="#Server-access-resource-type">8.1 Server access resource type</a>
<li><a href="#Function-remotescalar">8.2 Function <code>remotescalar</code></a>
<li><a href="#Example-remote-scalar-lookup">8.3 Example remote scalar lookup</a>
</li></ul>
<li><a name="toc_Environments-and-workflows" href="#Environments-and-workflows">9 Environments and workflows</a>
<ul>
<li><a href="#Environments-in-Nova">9.1 Environments in Nova</a>
<li><a href="#Implementing-workflows-in-Nova">9.2 Implementing workflows in Nova</a>
</li></ul>
<li><a name="toc_Virtualization" href="#Virtualization">10 Virtualization</a>
<ul>
<li><a href="#What-are-virtualization-and-cloud-computing_003f">10.1 What are virtualization and cloud computing?</a>
<li><a href="#Why-build-virtualization-support-into-Cfengine_003f">10.2 Why build virtualization support into CFEngine?</a>
<li><a href="#What-can-CFEngine-do-with-virtual-machines_003f">10.3 What can CFEngine do with virtual machines?</a>
<li><a href="#Environments-promises">10.4 Environments promises</a>
<li><a href="#Virtualization-types-supported">10.5 Virtualization types supported</a>
<li><a href="#Distinct-states">10.6 Distinct states</a>
<li><a href="#Example-deployment">10.7 Example deployment</a>
</li></ul>
<li><a name="toc_Content_002dDriven-Policies" href="#Content_002dDriven-Policies">11 Content-Driven Policies</a>
<ul>
<li><a href="#Content_002dDriven-Policies">11.1 Benefits of Content-Driven Policies</a>
<li><a href="#Content_002dDriven-Policies">11.2 Getting started</a>
</li></ul>
<li><a name="toc_Windows_002dspecific-features-in-Nova" href="#Windows_002dspecific-features-in-Nova">12 Windows-specific features in Nova</a>
<ul>
<li><a href="#Windows_002dspecific-features-in-Nova">12.1 Windows service management</a>
<li><a href="#Windows_002dspecific-features-in-Nova">12.2 Windows event logging</a>
<li><a href="#Windows_002dspecific-features-in-Nova">12.3 Windows special variables</a>
<li><a href="#Windows_002dspecific-features-in-Nova">12.4 Windows hard classes</a>
<li><a href="#Windows_002dspecific-features-in-Nova">12.5 Notes on windows policies</a>
</li></ul>
</li></ul>
</div>



<!-- The file is structured like a programming language. Each chapter -->
<!-- starts with a chapter comment. -->
<!-- Menus list the subsections so that an online info-reader can parse -->
<!-- the file hierarchically. -->
   <p><script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-2576171-2");
pageTracker._initData();
pageTracker._trackPageview();
</script>

   <div class="footnote">
<hr>
<a name="texinfo-footnotes-in-document"></a><h4>Footnotes</h4><p class="footnote"><small>[<a name="fn-1" href="#fnd-1">1</a>]</small> Major version 3</p>

   <p class="footnote"><small>[<a name="fn-2" href="#fnd-2">2</a>]</small> CFEngine supports integration with Subversion
through its Mission Portal, but any versioning system can of course be
used.</p>

   <p class="footnote"><small>[<a name="fn-3" href="#fnd-3">3</a>]</small> CFEngine and version control will document <i>what</i>
the changes are, but what is usually missing from user documentation
is an explanation of the reasoning behind the change. This is most
valuable when trying to diagnose and debug changes later.</p>

   <p class="footnote"><small>[<a name="fn-4" href="#fnd-4">4</a>]</small> There is a known issue with
the algorithm for determining whether or not there are actual data to be shown
for a given metric. Noise and sporadic port connections might result in
the Mission Portal showing strange looking graphs with blanks and holes.
Alternative approaches to auto-detecting data are being investigated for
future releases.</p>

   <p class="footnote"><small>[<a name="fn-5" href="#fnd-5">5</a>]</small> A full multi-user version will be part of CFEngine
Constellation</p>

   <p class="footnote"><small>[<a name="fn-6" href="#fnd-6">6</a>]</small> Often it is enough to be able to
ask a relevant question and feel that one has a voice, while experts are taking care of the details.</p>

   <hr></div>

</body></html>

